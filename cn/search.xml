<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>GitHub+PicGo+jsDelivr搭建免费图床</title>
    <url>/2021/02/20/GitHub+PicGo+jsDelivr%E6%90%AD%E5%BB%BA%E5%85%8D%E8%B4%B9%E5%9B%BE%E5%BA%8A/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\css\APlayer.min.css"><script src="\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\js\Meting.min.js"></script><h1>前言</h1>
<p>最开始一直是将图片保存在博客项目之中，调用的时候直接写路径，感觉也没啥不方便的，就一直没整图床。但有时候想展示一些图片发现有点慢（当然原因是因为图片文件本身较大），就想着压缩以下，想来干脆顺便整个图床，然后发现真香。之于我本人最大的提升就在写文章的时候，直接可以复制<code>url</code>或者<code>Markdown</code>格式的图片路径，而且可以实时显示（我写博客用的软件是<code>Typora</code>），这个可较之以往太爽了。</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/tcshow.png" alt=""></p>
<p>如图，直接起飞！！！！</p>
<hr>
<h1>操作步骤</h1>
<ol>
<li>
<p>首先需要下载<code>PicGo</code></p>
<p>官方下载链接：<a href="https://github.com/Molunerfinn/PicGo/releases">https://github.com/Molunerfinn/PicGo/releases</a></p>
<p>我这里下载的是<code>正式版2.2.2</code>，如图点击：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/tcPicGo2x.png" alt=""></p>
<p>点击👉<a href="https://github.com/Molunerfinn/PicGo/releases/download/v2.2.2/PicGo-Setup-2.2.2.exe">PicGo-Setup-2.2.2.exe</a>进行下载（我使用的是<code>win64位</code>操作系统，各位按需下载），链接已奉上👈，也可以直接点击下载。安装过程很简单，这里不再赘述。</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/tcPicGodownload.png" alt=""></p>
</li>
<li>
<p>下载完之后打开的界面如图所示：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/tcPicGo.png" alt=""></p>
</li>
<li>
<p>点击<code>图床设置</code>下拉按钮，选中<code>GitHub图床</code>选项，进行配置。</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/tcPGsetting.png" alt=""></p>
</li>
<li>
<p>在GitHub上创建一个仓库，填写对应的数据：</p>
<ul>
<li>
<p>设定仓库名：GitHub账号名/仓库名（例：CNhuazhu/Image）</p>
</li>
<li>
<p>设定分支名：仓库的分支名（例：master）</p>
</li>
<li>
<p>设定Token：点击Github右上角的用户头像→<code>Settings</code>→<code>Developer settiings</code>→<code>Personal access tokens</code>→<code>Generate new token</code>，在<code>Note</code>一栏输入创建的仓库名称，并勾选<code>repo</code>，最后在最下方点击<code>Generate token</code>按钮，就生成了对应的<strong>Token</strong>。</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/tcToken.png" alt=""></p>
</li>
<li>
<p>指定存储路径：填写你在仓库中创建的文件路径（可不填）</p>
</li>
<li>
<p>设定自定义域名：<code>https://cdn.jsdelivr.net/gh/GitHub账号名/仓库名</code>（例：<a href="https://cdn.jsdelivr.net/gh/CNhuazhu/Image%EF%BC%89">https://cdn.jsdelivr.net/gh/CNhuazhu/Image）</a></p>
<p>（注：这里使用了<code>jsDelivr</code>进行加速）</p>
</li>
</ul>
</li>
<li>
<p>点击<code>设置为默认图库</code>，点击<code>确定</code>，这样就完成了所有的操作步骤。</p>
</li>
</ol>
<h1>使用</h1>
<p>使用方法非常简单，直接<code>将图片拖拽至区域</code>或<code>点击上传</code>，图片就自动上传至刚刚搭建的图床啦（在<code>相册</code>中查看）。</p>
<p>在<code>上传区</code>中可以选择自动生成的链接(url)的格式</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/tcPG.png" alt=""></p>
<p>在<code>相册</code>中可以选择<code>复制url</code>、<code>修改url</code>、<code>删除图片</code>三个选项</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/tcPGchoose.png" alt=""></p>
<p><strong>补充</strong>：建议上传的图片大小在1M以内，如果图片文件太大，可以选择压缩后再上传。</p>
<p>这里提供一个在线压缩网站：<a href="https://docsmall.com/">https://docsmall.com/</a></p>
<hr>
<h1>结尾</h1>
<p>再一次证实了真香定律~~~~</p>
]]></content>
      <categories>
        <category>博客</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
        <tag>图床</tag>
      </tags>
  </entry>
  <entry>
    <title>Hexo快速搭建一个博客</title>
    <url>/2021/01/21/Hexo%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E5%8D%9A%E5%AE%A2/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\css\APlayer.min.css"><script src="\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\js\Meting.min.js"></script><h1>前言</h1>
<p>  首先非常感谢羊哥的教程，跟着一步步操作，非常快速地搭建好了个人博客。这里抛出两个链接：</p>
<p>  b站教学视频：<a href="https://www.bilibili.com/video/BV1Yb411a7ty">https://www.bilibili.com/video/BV1Yb411a7ty</a></p>
<p>  羊哥的个人博客：<a href="https://www.codesheep.cn/">https://www.codesheep.cn/</a></p>
<p>  上个学期的Python课设就写了一个基于<strong>Flask框架</strong>的博客管理系统，虽然用起来很方便，但是写起来还是有点繁琐的。框架的学习还是有一些成本在内的，而且前端如果没两把刷子那真的是不能看😂。假期是有打算继续优化下那个项目，“稍微”改一下部署到服务器上去（前端的静态模板我都找好了，这里再安利一下<a href="https://www.yangqq.com/">杨青青</a>的个人博客：<a href="https://www.yangqq.com/">https://www.yangqq.com/</a> 里面的模板还是非常好看的，静态和动态的模板都有~~）</p>
<p>  但是奈何自己太辣鸡，这玩意儿倒不是说不想碰了，就是感觉好麻烦，一个功能实现太耗时（这个项目大部分时间都花在了前端上，出bug最多的地方也在前端）。但是用起来确实方便，不像静态博客，目前更新一次的操作步骤比起项目来说还是繁琐了一些。综合考虑了一下还是选择了静态博客，用<strong>Hexo</strong>搭建，在前端框架基础之上DIY，还是蛮有趣的。</p>
<hr>
<h1>搭建博客</h1>
<h2 id="前期准备">前期准备</h2>
<ol>
<li>
<p>安装Node.js</p>
<p>官网链接：<a href="https://nodejs.org/en/">https://nodejs.org/en/</a></p>
</li>
<li>
<p>为了解决速度慢的问题。建议给Node.js换一个镜像源，这里根据羊哥的教程更换了淘宝的镜像源，代码如下：</p>
</li>
</ol>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">npm install <span class="literal">-g</span> npm -<span class="literal">-registry</span>=https://registry.npm.taobao.org</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>
<p>安装Hexo</p>
<p>官网链接：<a href="https://hexo.io/">https://hexo.io/</a></p>
<p>直接在首页复制代码，粘贴运行就好：</p>
</li>
</ol>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">cnpm install <span class="literal">-g</span> hexo<span class="literal">-cli</span></span><br></pre></td></tr></table></figure>
<h2 id="快速搭建">快速搭建</h2>
<ol>
<li>
<p>初始化</p>
<p>在本地创建一个文件夹，作为博客部署的空间。（<strong>注：以后所有的操作都基于此文件夹，如果出现了什么问题无法解决，删掉重来就好</strong>）在此文件夹内初始化hexo：</p>
</li>
</ol>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">hexo init</span><br></pre></td></tr></table></figure>
<p>接下来就会在此目录下自动生成一些文件，初始化完成</p>
<ol start="2">
<li>启动本地服务</li>
</ol>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">hexo s</span><br></pre></td></tr></table></figure>
<p>通过本地默认的4000端口访问：<a href="http://localhost:4000">http://localhost:4000</a></p>
<ol start="3">
<li>
<p>尝试写第一篇博文</p>
<p>语法：hexo n “文章名称”</p>
</li>
</ol>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">hexo n <span class="string">&quot;第一篇博客文章&quot;</span></span><br></pre></td></tr></table></figure>
<p>然后会发现在<code>sourse/_posts</code>目录下，生成一个<code>.md</code>文件,在此就可以编写文章了。</p>
<ol start="4">
<li>清理缓存</li>
</ol>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">hexo clean</span><br></pre></td></tr></table></figure>
<ol start="5">
<li>生成静态文件</li>
</ol>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">hexo g</span><br></pre></td></tr></table></figure>
<p>这就是最基本的操作流程啦~~~~</p>
<hr>
<h1>部署到github/gitee</h1>
<h2 id="部署到github">部署到github</h2>
<ol>
<li>
<p>到github去新建仓库</p>
<p>注意命名格式：<a href="http://xn--rprwbz35y.github.io">账号名.github.io</a>（例：<a href="http://CNhuazhu.github.io">CNhuazhu.github.io</a>）</p>
</li>
<li>
<p>安装git部署的插件</p>
</li>
</ol>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">cnpm install -<span class="literal">-save</span> hexo<span class="literal">-deployer</span><span class="literal">-git</span></span><br></pre></td></tr></table></figure>
<ol start="3">
<li>
<p>设置<code>_config.yml</code>文件</p>
<p>在博客目录下找到<code>_config.yml</code>文件，最底部有一个<code># Deployment</code>模块，在此设置：</p>
</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Deployment</span></span><br><span class="line"><span class="comment">## Docs: https://hexo.io/docs/one-command-deployment</span></span><br><span class="line"><span class="attr">deploy:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">git</span></span><br><span class="line">  <span class="attr">repo:</span> <span class="string">https://github.com/CNhuazhu/CNhuazhu.github.io.git</span></span><br><span class="line">  <span class="attr">branch:</span> <span class="string">master</span></span><br></pre></td></tr></table></figure>
<ol start="4">
<li>部署到远端</li>
</ol>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">hexo d</span><br></pre></td></tr></table></figure>
<p>注：访问可能要过一段时间才会生效；账户中含有大写字母也没有关系，地址栏输入的时候同一替换为小写就可以访问</p>
<h2 id="部署到gitee">部署到gitee</h2>
<p>前四步和github的方法一样，<a href="#%E7%AC%AC%E4%BA%94%E6%AD%A5"><strong>点击此处</strong></a>跳转到第五步。</p>
<ol>
<li>
<p>到gitee去新建仓库</p>
<p>注意:这里同github不同，仓库名可以随便，不必使用自己的账号名</p>
</li>
<li>
<p>安装git部署的插件</p>
</li>
</ol>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">cnpm install -<span class="literal">-save</span> hexo<span class="literal">-deployer</span><span class="literal">-git</span></span><br></pre></td></tr></table></figure>
<ol start="3">
<li>设置<code>_config.yml</code>文件<br>
在博客目录下找到<code>_config.yml</code>文件，最底部有一个<code># Deployment</code>模块，在此设置：</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line">   <span class="comment"># Deployment</span></span><br><span class="line"><span class="comment">## Docs: https://hexo.io/docs/one-command-deployment</span></span><br><span class="line"><span class="attr">deploy:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">git</span></span><br><span class="line">  <span class="attr">repo:</span> <span class="string">https://gitee.com/CNhuazhu/cnhuazhu.git</span></span><br><span class="line">  <span class="attr">branch:</span> <span class="string">master</span></span><br></pre></td></tr></table></figure>
<ol start="4">
<li>部署到远端</li>
</ol>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">hexo d</span><br></pre></td></tr></table></figure>
<ol start="5">
<li>
<p><span id="第五步"><strong>开启 Gitee Pages 静态网页托管服务</strong></span></p>
<p>进入到仓库中，选择<strong>服务</strong>下拉框中的<strong>Gitee Pages</strong>选项,进入后点击<strong>部署</strong>。使用提供的网址即可访问博客：<a href="http://cnhuazhu.gitee.io">http://cnhuazhu.gitee.io</a></p>
<p>注：每次重新部署代码到gitee时，都需要点击下方的<strong>更新</strong>按钮重启page服务</p>
</li>
</ol>
<hr>
<h1>更换主题</h1>
<p>hexo提供多种主题，直接抛链接：</p>
<p>hexo主题官网：<a href="https://hexo.io/themes/">https://hexo.io/themes/</a></p>
<ol>
<li>
<p>下载主题</p>
<p>可以直接输入命令进行下载，格式：<code>git clone 主题地址.git themes/目录</code>，这里以下载<code>yilia</code>主题为例：</p>
</li>
</ol>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">git clone https://github.com/litten/hexo<span class="literal">-theme</span><span class="literal">-yilia</span>.git themes/yilia</span><br></pre></td></tr></table></figure>
<p>然后在<code>themes</code>目录下就会出现名为<code>yilia</code>的主题文件夹</p>
<ol start="2">
<li>
<p>修改_config.yml文件</p>
<p>找到<code># Extensions</code>模块下的<code>theme</code>标签（默认为<code>landscape</code>），将其替换为下载好的主题名称<code>yilia</code></p>
</li>
</ol>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">theme: yilia</span><br></pre></td></tr></table></figure>
<p>然后再重新清理缓存、部署、启动本地服务、推到远端，就可以啦~~~~</p>
<hr>
<h1>总结</h1>
<p>按照教程来操作，没什么难度。<br>
<br><br>
<strong>*“一切都是那么的优雅~~~~”</strong>*</p>
]]></content>
      <categories>
        <category>博客</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>Markdown语法</title>
    <url>/2021/01/20/Markdown%E8%AF%AD%E6%B3%95/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\css\APlayer.min.css"><script src="\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\js\Meting.min.js"></script><h1>前言</h1>
<p>建站小白想来写点什么东西。这几天里看过许许多多的超级厉害的博客，大多开篇都是关于Markdown语法的一些基本介绍。想来写一篇也好，留个笔记。<br><br>
注: 本篇文章使用VScode编写。<code>Ctrl + Shift + P</code>调出主命令框，输入<code>Markdown</code>，就可以匹配到<code>Markdown</code>的相关命令。</p>
<h1>Markdown的基本语法</h1>
<h2 id="标题">标题</h2>
<p>注：一共有6个级别的标题</p>
<p><strong>代码</strong></p>
<h2 id="code￼0"><figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="section"># h1</span></span><br><span class="line"><span class="section">## h2</span></span><br><span class="line"><span class="section">### h3</span></span><br><span class="line"><span class="section">#### h4</span></span><br><span class="line"><span class="section">##### h5</span></span><br><span class="line"><span class="section">###### h6</span></span><br></pre></td></tr></table></figure></h2>
<h2 id="引用">引用</h2>
<p><strong>代码</strong></p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">&gt;这里是引用代码</span><br><span class="line">&gt;&gt;可以多级嵌套</span><br></pre></td></tr></table></figure>
<p><strong>效果</strong></p>
<blockquote>
<p>这里是引用效果</p>
<blockquote>
<p>可以多级嵌套</p>
</blockquote>
</blockquote>
<hr>
<h2 id="字体">字体</h2>
<p><strong>代码</strong></p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="strong">**加粗 效果代码**</span></span><br><span class="line"><span class="emphasis">*倾斜 效果代码*</span></span><br><span class="line"><span class="strong">**<span class="emphasis">*斜体加粗 效果代码<span class="strong">**<span class="emphasis">*</span></span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong"><span class="emphasis">~~加删除线 效果代码~~</span></span></span></span></span><br></pre></td></tr></table></figure>
<p><strong>效果</strong></p>
<p><strong>加粗 效果代码</strong><br>
<br><br>
<em>倾斜 效果代码</em><br>
<br><br>
<em><strong>斜体加粗 效果代码</strong></em><br>
<br><br>
<s>加删除线 效果代码</s></p>
<hr>
<h2 id="分割线">分割线</h2>
<p><strong>代码</strong></p>
<p>三个或者三个以上的<code>-</code>或者<code>*</code>都可以</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">---</span><br><span class="line"><span class="strong">**<span class="emphasis">*</span></span></span><br></pre></td></tr></table></figure>
<p><strong>效果</strong></p>
<p>这里的分割线被主题美化了</p>
<hr>
<hr>
<h2 id="代码展示">代码展示</h2>
<p><strong>代码</strong></p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">(<span class="code">```)</span></span><br><span class="line"><span class="code">    代码块的语法：使用一对```将代码块包围起来。（这里加了括号是防止转义）</span></span><br><span class="line"><span class="code">(```)</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">`` --&gt; 单行代码直接用一对`将其包围就好，也可以行内标记。</span></span><br></pre></td></tr></table></figure>
<p><strong>效果</strong></p>
<p>这里展示<code>行内标记（Hello World）</code>效果</p>
<hr>
<h2 id="超链接">超链接</h2>
<p><strong>语法</strong></p>
<p><code>[超链接名](超链接地址 &quot;超链接title&quot;)</code></p>
<p><strong>代码</strong></p>
<p><code>[百度](https://www.baidu.com &quot;百度一下&quot;)</code></p>
<p><strong>效果</strong></p>
<p><a href="https://www.baidu.com" title="百度一下">百度</a></p>
<hr>
<h2 id="图片">图片</h2>
<p><strong>语法</strong></p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">![<span class="string">图片alt</span>](<span class="link">图片地址 &#x27;&#x27;图片title&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">注：图片alt就是显示在图片下面的文字，相当于对图片内容的解释。</span><br><span class="line">   图片title是图片的标题，当鼠标移到图片上时显示的内容。title可加可不加</span><br></pre></td></tr></table></figure>
<p><strong>代码</strong></p>
<p><code>![](https://cdn.jsdelivr.net/gh/CNhuazhu/Image/page1.jpg)</code></p>
<p><strong>效果</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/page1.jpg" alt=""></p>
<hr>
<h2 id="列表">列表</h2>
<p>无序列表：用<code>- + *</code>任何一种都可以<br><br>
有序列表：为<code>数字.</code><br><br>
列表嵌套：上一级和下一级之间敲三个空格即可</p>
<p><strong>代码</strong></p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> 无序列表内容</span><br><span class="line"><span class="bullet">+</span> 无序列表内容</span><br><span class="line"><span class="bullet">*</span> 无序列表内容</span><br><span class="line"></span><br><span class="line"><span class="bullet">1.</span> 有序列表内容</span><br><span class="line"><span class="bullet">2.</span> 有序列表内容</span><br><span class="line"><span class="bullet">3.</span> 有序列表内容</span><br><span class="line"></span><br><span class="line"><span class="bullet">*</span> 外层无序列表</span><br><span class="line"><span class="bullet">   1.</span> 内层有序列表</span><br><span class="line"><span class="bullet">   2.</span> 内层有序列表</span><br></pre></td></tr></table></figure>
<p><strong>效果</strong></p>
<ul>
<li>无序列表内容</li>
</ul>
<ul>
<li>无序列表内容</li>
</ul>
<ul>
<li>无序列表内容</li>
</ul>
<ol>
<li>有序列表内容</li>
<li>有序列表内容</li>
<li>有序列表内容</li>
</ol>
<ul>
<li>外层无序列表
<ol>
<li>内层有序列表</li>
<li>内层有序列表</li>
</ol>
</li>
</ul>
<hr>
<h2 id="表格">表格</h2>
<p><strong>语法</strong></p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">表头|表头|表头</span><br><span class="line">---|:--:|---:</span><br><span class="line">内容|内容|内容</span><br><span class="line">内容|内容|内容</span><br><span class="line"></span><br><span class="line">注：</span><br><span class="line"><span class="code">    第二行分割表头和内容。</span></span><br><span class="line"><span class="code">    - 有一个就行，为了对齐，多加了几个</span></span><br><span class="line"><span class="code">    文字默认居左</span></span><br><span class="line"><span class="code">    -两边加：表示文字居中</span></span><br><span class="line"><span class="code">    -右边加：表示文字居右</span></span><br><span class="line"><span class="code">注：原生的语法两边都要用 | 包起来。</span></span><br></pre></td></tr></table></figure>
<p><strong>代码</strong></p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">|    a    |       b       |    c       |</span><br><span class="line">|:-------:|:------------- | ----------:|</span><br><span class="line">|   居中  |     左对齐    |   右对齐   |</span><br><span class="line">|=========|===============|============|</span><br></pre></td></tr></table></figure>
<p><strong>效果</strong></p>
<table>
<thead>
<tr>
<th style="text-align:center">a</th>
<th style="text-align:left">b</th>
<th style="text-align:right">c</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">居中</td>
<td style="text-align:left">左对齐</td>
<td style="text-align:right">右对齐</td>
</tr>
<tr>
<td style="text-align:center">=========</td>
<td style="text-align:left">===============</td>
<td style="text-align:right">============</td>
</tr>
</tbody>
</table>
<hr>
<h2 id="表情包">表情包</h2>
<p>这里抛一个网站：<a href="https://www.webfx.com/tools/emoji-cheat-sheet/">https://www.webfx.com/tools/emoji-cheat-sheet/</a><br><br>
里面复制相应表情代码，粘贴。一气呵成（但是这里为什么用不了😭）<br><br><br>
那我就再抛一个网站：<a href="https://www.emojidaquan.com/">https://www.emojidaquan.com/</a><br><br>
这里直接复制表情就好☀️（没有什么能难倒👴,哈哈哈哈）</p>
<hr>
<h2 id="空格字符">空格字符</h2>
<p><strong>代码</strong></p>
<p><code>&amp;emsp; 注意是英文分号</code></p>
<hr>
<h2 id="锚点">锚点</h2>
<p><strong>语法</strong></p>
<ul>
<li>
<p>跳转链接：</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">[跳转链接（说明文字）]（#jump）</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>跳转位置</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span> = <span class="string">&quot;jump&quot;</span>&gt;</span></span>跳转位置（说明文字）<span class="xml"><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h2 id="上、下标">上、下标</h2>
<p><strong>语法</strong></p>
<p>Markdown兼容HTML语法，所以直接用HTML语法中的上、下标来实现：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">H<span class="tag">&lt;<span class="name">sub</span>&gt;</span>2<span class="tag">&lt;/<span class="name">sub</span>&gt;<span class="name">O</span></span> </span><br><span class="line">2×10<span class="tag">&lt;<span class="name">sup</span>&gt;</span>8<span class="tag">&lt;/<span class="name">sup</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>效果</strong></p>
<p>H<sub>2</sub>O<br>
2×10<sup>8</sup></p>
<hr>
<h1>结语</h1>
<p>第一篇博文写完，开心！！！！<br><br>
（暂且先记到这里，以后如果需要其他内容，再学习，再补充）</p>
]]></content>
      <categories>
        <category>博客</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
        <tag>Markdown</tag>
      </tags>
  </entry>
  <entry>
    <title>Xftp传输文件失败解决方案</title>
    <url>/2021/10/18/Xftp%E4%BC%A0%E8%BE%93%E6%96%87%E4%BB%B6%E5%A4%B1%E8%B4%A5%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\css\APlayer.min.css"><script src="\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\js\Meting.min.js"></script><h1>问题描述</h1>
<p>在使用Xftp向服务器“拖拽”传输文件时，报“<strong>No such path found</strong>”错误。</p>
<hr>
<h1>解决方案</h1>
<p>修改需要上传到服务器的<strong>目录权限设置为777</strong></p>
<p>例如：需要将文件上传至服务器的<code>/var/www</code>目录下，则在终端键入如下命令：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo chmod 777 -R /var/www</span><br></pre></td></tr></table></figure>
<p>问题解决。</p>
]]></content>
      <categories>
        <category>错误</category>
      </categories>
      <tags>
        <tag>Xftp</tag>
      </tags>
  </entry>
  <entry>
    <title>关于Hexo添加豆瓣页面踩过的坑</title>
    <url>/2021/02/19/%E5%85%B3%E4%BA%8EHexo%E6%B7%BB%E5%8A%A0%E8%B1%86%E7%93%A3%E9%A1%B5%E9%9D%A2%E8%B8%A9%E8%BF%87%E7%9A%84%E5%9D%91/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\css\APlayer.min.css"><script src="\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\js\Meting.min.js"></script><h1>前言</h1>
<p>我之前一直想添加一个豆瓣读书和电影页面，但就如介绍所说，<code>0 books have been loaded in 934 ms, because you are offline or your network is bad</code>问题一直在困扰着我。尝试了各种解决方案，网上也找了很多相关内容，但是依然无法解决，就这么搁置下了。今天偶然看到一个博客的评论中提到了问题的关键是<code>Nodejs</code>版本的问题。</p>
<blockquote>
<p>答案在这个链接的评论区：<a href="https://github.com/mythsman/hexo-douban/issues/57">https://github.com/mythsman/hexo-douban/issues/57</a></p>
</blockquote>
<p>按照报错信息整改网络问题、升级hexo版本、更新主题甚至重新搭建博客等一些类操作都做了个遍，万万没想到问题在<code>Nodejs</code>，简直要吐了。</p>
<h1>问题描述</h1>
<p>想添加豆瓣页面的小伙伴可以参考这篇官方：<a href="https://github.com/mythsman/hexo-douban">https://github.com/mythsman/hexo-douban</a></p>
<p>然而按照官方操作却出现的这样的问题：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/dbError.png" alt=""></p>
<p>无论如何操作都爬不到数据。。。。</p>
<hr>
<h1>问题解决</h1>
<p>问题关键在于<code>Nodejs</code>版本的问题，我之前的版本为<code>v14.15.4</code>，按照评论区的说法，我更换了<code>v12.20.2</code>的版本。更换完之后再尝试爬取数据，流下了激动的泪水，呜呜呜~~~~😭😭😭😭</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/dbCorrect.png" alt=""></p>
<p><strong>补充</strong>：更换<code>Nodejs</code>版本的方法网上有很多简单的方法。我就很直接粗暴，把之前<code>v14.x</code>的版本直接卸载，又下载了一个<code>v12.x</code>的版本。</p>
<p>下载链接放在这里：<a href="https://nodejs.org/dist/latest-v12.x/">https://nodejs.org/dist/latest-v12.x/</a></p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/dbNodejs.png" alt=""></p>
<p>由于我是win版本64位操作系统，就下载了<code>node-v12.20.2-x64.msi</code>这个链接，各位按需索取就好，安装过程很简单。</p>
<hr>
<h1>后记</h1>
<p>我发现有的问题解决真的是看脸，要不是偶然我看到了评论区的讨论，真不晓得猴年马月才能解决这个问题。（这都快半个月了）</p>
]]></content>
      <categories>
        <category>博客</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>虚拟机部署phpStudy后无法访问</title>
    <url>/2021/07/24/%E8%99%9A%E6%8B%9F%E6%9C%BA%E9%83%A8%E7%BD%B2phpStudy%E5%90%8E%E6%97%A0%E6%B3%95%E8%AE%BF%E9%97%AE/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\css\APlayer.min.css"><script src="\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\js\Meting.min.js"></script><h1>问题描述</h1>
<p>学习渗透不免要部署靶场，这里在虚拟机部署phpStudy并开启服务后，虚拟机可以访问站点，但是在物理机以及其他机器中无法访问。</p>
<hr>
<h1>解决</h1>
<p>目前的解决方案是重新启用虚拟机的网络。</p>
<ol>
<li>
<p>首先打开<code>网络和Internet设置</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/TuChuang2/XNJphpStudyError-step1.png" alt=""></p>
</li>
<li>
<p>点击<code>更改适配器选项</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/TuChuang2/XNJphpStudyError-step2.png" alt=""></p>
</li>
<li>
<p>将VMware的网络先禁用，再重新启动就可以了</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/TuChuang2/XNJphpStudyError-step3.png" alt=""></p>
</li>
</ol>
<hr>
<h1>后记</h1>
<p>每天进步一点点。</p>
]]></content>
      <categories>
        <category>虚拟机</category>
        <category>错误</category>
      </categories>
      <tags>
        <tag>phpStudy</tag>
      </tags>
  </entry>
  <entry>
    <title>Flask利用ajax实现前端到后端的数据传输</title>
    <url>/2021/06/07/Flask/Flask%E5%88%A9%E7%94%A8ajax%E5%AE%9E%E7%8E%B0%E5%89%8D%E7%AB%AF%E5%88%B0%E5%90%8E%E7%AB%AF%E7%9A%84%E6%95%B0%E6%8D%AE%E4%BC%A0%E8%BE%93/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\css\APlayer.min.css"><script src="\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\js\Meting.min.js"></script><h1>前言</h1>
<p>需求：最近自己在写一个基于Flask框架的博客管理系统。需要在访客载入首页时，实时获取访客的IP地址及其所在地（这在本站点首页的侧边栏有示例），并将其传回至后端。</p>
<p>在网上找了很多教程，都是在介绍如何利用<code>form</code>表单进行传输，但是这并不符合需求（要求在访问首页URL时即刻获取数据并向后端发送），自己利用<code>ajax</code>尝试了很久，终于利用<code>GET</code>请求实现了。</p>
<p>（没学过啊，头脑中一点没有相关知识储备量写起代码来可太痛苦了。立个Flag，假期系统学习一下前端的知识）</p>
<hr>
<h1>实现</h1>
<p>首先给出前端<code>base-visitor.html</code>页脚部分的代码：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;script src=<span class="string">&quot;http://libs.baidu.com/jquery/1.9.0/jquery.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src=&quot;http://pv.sohu.com/cityjson?ie=utf-8&quot;&gt;&lt;/script&gt;  &#123;# 利用此连接获取IP地址信息 #&#125;</span><br><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">   var cname= returnCitySN[&quot;cname&quot;].toString() &#123;# 获取访客地址信息 #&#125;</span><br><span class="line">   var cip = returnCitySN[&quot;cip&quot;].toString()  &#123;# 获取访客地IP信息 #&#125;</span><br><span class="line">   var data = &#123;  &#123;# 将信息利用json格式进行封装 #&#125;</span><br><span class="line">       <span class="string">&quot;ip_num&quot;</span> : cip,</span><br><span class="line">       <span class="string">&quot;ip_location&quot;</span> : cname</span><br><span class="line">   &#125;</span><br><span class="line">   function test() &#123;  &#123;# 创建函数利用ajax向后端传数据 #&#125;</span><br><span class="line">       $.ajax(&#123;</span><br><span class="line">       type: <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">       url: &#x27;/visitor/&#x27;,  &#123;# 路由函数路径 #&#125;</span><br><span class="line">       data: data,  &#123;# 之前封装好的data #&#125;</span><br><span class="line">       dataType: &#x27;json&#x27;,  &#123;# 定义为json格式 #&#125;</span><br><span class="line">       success: <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">       &#125;,</span><br><span class="line">       error: <span class="function"><span class="keyword">function</span>(<span class="params">xhr, type</span>) </span>&#123;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   )&#125;</span><br><span class="line">   test()  &#123;# 调用函数 #&#125;</span><br><span class="line">   <span class="built_in">document</span>.write(<span class="string">&#x27;&lt;p style=&quot;text-align: center&quot;&gt;&lt;strong style=&quot;color: aquamarine; font-size: 20px&quot;&gt;欢迎来自&#x27;</span>+cname+<span class="string">&quot;的访客&lt;/strong&gt;&lt;/p&gt;&quot;</span>)</span><br><span class="line">   <span class="built_in">document</span>.write(<span class="string">&#x27;&lt;p style=&quot;text-align: center&quot;&gt;&lt;strong style=&quot;color: crimson; font-size: 20px&quot;&gt;您当前的IP地址为：&#x27;</span>+cip+<span class="string">&quot;&lt;/strong&gt;&lt;/p&gt;&quot;</span>)</span><br><span class="line"></span><br><span class="line">        &lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>说明：</p>
<ul>
<li>
<p>首先利用 <a href="http://pv.sohu.com/cityjson?ie=utf-8">http://pv.sohu.com/cityjson?ie=utf-8</a> 获取访问者的IP地址信息</p>
</li>
<li>
<p>将得到的数据进行json封装</p>
</li>
<li>
<p>利用ajax发送GET请求</p>
</li>
<li>
<p>将其在首页footer中打印出来（如下图）</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/FL%E5%88%A9%E7%94%A8ajax%E4%BC%A0%E8%BE%93%E6%95%B0%E6%8D%AE.png" alt=""></p>
</li>
</ul>
<p>下面是visitor的路由函数:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@visitor_bp.route(<span class="params"><span class="string">&#x27;/visitor&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>():</span></span><br><span class="line">    ip_num = request.args.get(<span class="string">&#x27;ip_num&#x27;</span>) <span class="comment"># GET方法</span></span><br><span class="line">    ip_location = request.args.get(<span class="string">&#x27;ip_location&#x27;</span>) <span class="comment"># GET方法</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;base-visitor.html&#x27;</span>)  <span class="comment"># 渲染首页</span></span><br></pre></td></tr></table></figure>
<p>注意：这里我没有给前端响应。</p>
<p>通过此方法，两个参数会包含在URL中传输至后端，具体格式如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;url&#x2F;visitor&#x2F;?ip_num&#x3D;xxx&amp;ip_location&#x3D;xxx</span><br></pre></td></tr></table></figure>
<p>至此，实现了利用ajax从前端到后端数据传输的需求。</p>
<hr>
<h1>后记</h1>
<p>试了很久的POST请求，但是还未成功，有时间再深入研究一下。</p>
<p>参考链接：<a href="https://www.cnblogs.com/zeug/p/11441378.html">前端与后端的数据交互（jquery ajax+python flask） - zeug - 博客园 (cnblogs.com)</a></p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Flask</tag>
      </tags>
  </entry>
  <entry>
    <title>Flask前端用CSS修饰循环代码的注意事项</title>
    <url>/2021/06/07/Flask/Flask%E5%89%8D%E7%AB%AF%E7%94%A8CSS%E4%BF%AE%E9%A5%B0%E5%BE%AA%E7%8E%AF%E4%BB%A3%E7%A0%81%E7%9A%84%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\css\APlayer.min.css"><script src="\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\js\Meting.min.js"></script><h1>前言</h1>
<p>最近在写一个基于Flask框架的动态博客管理项目，在实践过程中遇到了很多问题，有一些在网上也找不到相应的解决办法，故记录一下。</p>
<p>（并未系统性学过前端，都是临时查、学、套用）</p>
<hr>
<h1>问题描述&amp;解决</h1>
<p>后端从数据库调取数据，由于数据记录数未知，因此把符合查询条件的记录以对象列表的形式传递给前端，前端通过<code>&#123;% for 名称 in 列表名 %&#125;</code>的形式加载数据。但是在利用CSS渲染的时候，只能渲染第一条数据：</p>
<p>CSS代码：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">&lt;style&gt;</span><br><span class="line">    <span class="selector-id">#container</span> &#123;</span><br><span class="line">        <span class="attribute">max-width</span>: <span class="number">800px</span>;</span><br><span class="line">        <span class="attribute">margin</span>: <span class="number">0</span> auto;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<p>这里是想给列表对象加载一个宽度为800px的容器。</p>
<p>被修饰的代码如下：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;container&quot;</span>&gt;</span>  &#123;# 标签在循环体外 #&#125;</span><br><span class="line">    &#123;% for ip in ip %&#125;</span><br><span class="line">       IP: &#123;&#123; ip.ip_num &#125;</span><br><span class="line">       地址: &#123;&#123; ip.ip_location &#125;&#125;</span><br><span class="line">       访问时间: &#123;&#123; ip.ip_datetime &#125;&#125;</span><br><span class="line">    &#123;% endfor %&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>（这里为了简洁省去了其他的CSS渲染代码）</p>
<p>这里<code>container</code>标签是在循环体外，但是这样只有第一条数据被修饰，具体效果如下图：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/FL%E5%89%8D%E7%AB%AFCSS%E4%BF%AE%E9%A5%B0%E9%97%AE%E9%A2%98%E5%B1%95%E7%A4%BA1.png" alt=""></p>
<p>这个情况还蛮有意思的，但是我不理解这是为何。</p>
<p>然后将<code>container</code>标签放于循环体内，想要的效果就出来了，代码如下：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">&#123;% for ip in ip %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;container&quot;</span>&gt;</span>  &#123;# 标签在循环体内 #&#125;</span><br><span class="line">       IP: &#123;&#123; ip.ip_num &#125;</span><br><span class="line">       地址: &#123;&#123; ip.ip_location &#125;&#125;</span><br><span class="line">       访问时间: &#123;&#123; ip.ip_datetime &#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure>
<p>效果展示如下图：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/FL%E5%89%8D%E7%AB%AFCSS%E4%BF%AE%E9%A5%B0%E9%97%AE%E9%A2%98%E5%B1%95%E7%A4%BA2.png" alt=""></p>
<hr>
<h1>后记</h1>
<p>真正在写一个项目的时候发现还是很锻炼人的，平时学习过程中没留意的问题会在实践过程中暴露出来。</p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Flask</tag>
      </tags>
  </entry>
  <entry>
    <title>Flask解决跨域问题</title>
    <url>/2021/08/19/Flask/Flask%E8%A7%A3%E5%86%B3%E8%B7%A8%E5%9F%9F%E9%97%AE%E9%A2%98/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\css\APlayer.min.css"><script src="\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\js\Meting.min.js"></script><h1>前言</h1>
<p>学习前端网络请求部分的时候，用Flask实现一个简单的后端服务器，但是遇到了跨域问题。</p>
<hr>
<h1>跨域</h1>
<h2 id="什么是跨域">什么是跨域</h2>
<blockquote>
<p>以下内容摘自知乎：<a href="https://zhuanlan.zhihu.com/p/28562290">跨域的那些事儿 - 知乎 (zhihu.com)</a></p>
</blockquote>
<h3 id="造成跨域的两种策略">造成跨域的两种策略</h3>
<p>浏览器的同源策略会导致跨域，这里同源策略又分为以下两种：</p>
<ol>
<li>DOM同源策略：禁止对不同源页面DOM进行操作。这里主要场景是iframe跨域的情况，不同域名的iframe是限制互相访问的。</li>
<li>XmlHttpRequest同源策略：禁止使用XHR对象向不同源的服务器地址发起HTTP请求。</li>
</ol>
<p><strong>只要协议、域名、端口有任何一个不同，都被当作是不同的域，之间的请求就是跨域操作。</strong></p>
<h3 id="为什么要有跨域限制">为什么要有跨域限制</h3>
<p>跨域限制主要是为了安全考虑。</p>
<p>AJAX同源策略主要用来防止CSRF攻击。如果没有AJAX同源策略，相当危险，我们发起的每一次HTTP请求都会带上请求地址对应的cookie，那么可以做如下攻击：</p>
<ol>
<li>用户登录了自己的银行页面 <a href="https://link.zhihu.com/?target=http%3A//mybank.com">http://mybank.com</a>，<a href="https://link.zhihu.com/?target=http%3A//mybank.com">http://mybank.com</a>向用户的cookie中添加用户标识。</li>
<li>用户浏览了恶意页面 <a href="https://link.zhihu.com/?target=http%3A//evil.com">http://evil.com</a>。执行了页面中的恶意AJAX请求代码。</li>
<li><a href="https://link.zhihu.com/?target=http%3A//evil.com">http://evil.com</a>向<a href="https://link.zhihu.com/?target=http%3A//mybank.com">http://mybank.com</a>发起AJAX HTTP请求，请求会默认把<a href="https://link.zhihu.com/?target=http%3A//mybank.com">http://mybank.com</a>对应cookie也同时发送过去。</li>
<li>银行页面从发送的cookie中提取用户标识，验证用户无误，response中返回请求数据。此时数据就泄露了。</li>
<li>而且由于Ajax在后台执行，用户无法感知这一过程。</li>
</ol>
<p>DOM同源策略也一样，如果iframe之间可以跨域访问，可以这样攻击：</p>
<ol>
<li>做一个假网站，里面用iframe嵌套一个银行网站 <a href="https://link.zhihu.com/?target=http%3A//mybank.com">http://mybank.com</a>。</li>
<li>把iframe宽高啥的调整到页面全部，这样用户进来除了域名，别的部分和银行的网站没有任何差别。</li>
<li>这时如果用户输入账号密码，我们的主网站可以跨域访问到<a href="https://link.zhihu.com/?target=http%3A//mybank.com">http://mybank.com</a>的dom节点，就可以拿到用户的输入了，那么就完成了一次攻击。</li>
</ol>
<p>所以说有了跨域跨域限制之后，我们才能更安全的上网了。</p>
<h2 id="解决跨域问题">解决跨域问题</h2>
<p>这里只讲一种方式，其他自行百度。（后面如遇到其他跨域问题再补充）</p>
<h3 id="Python-Flask-解决跨域问题">Python | Flask 解决跨域问题</h3>
<ol>
<li>
<p>pip引入<code>flask-cors</code>库</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">pip install flask-cors</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>配置</p>
<p><code>flask-cors</code>有两种用法，一种为全局使用，一种对指定的路由使用。</p>
<ul>
<li>
<p>使用<code>CORS()</code>配置全局路由：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask,request</span><br><span class="line"><span class="keyword">from</span> flask_cors <span class="keyword">import</span> CORS  <span class="comment">#导入CORS库</span></span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">CORS(app, supports_credentials=<span class="literal">True</span>)  <span class="comment">#配置全局路由</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/&quot;</span>,methods=[<span class="string">&quot;GET&quot;</span>,<span class="string">&quot;POST&quot;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span>():</span></span><br><span class="line">    <span class="keyword">if</span> request.method==<span class="string">&quot;GET&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;get请求已收到&quot;</span></span><br><span class="line">    <span class="keyword">elif</span> request.method==<span class="string">&quot;POST&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;post请求已收到&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;网络请求方式不正确&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run()</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>使用<code>@cross_origin()</code>配置单一指定路由：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask,request</span><br><span class="line"><span class="keyword">from</span> flask_cors <span class="keyword">import</span> cross_origin  <span class="comment">#导入cross_origin库</span></span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/&quot;</span>,methods=[<span class="string">&quot;GET&quot;</span>,<span class="string">&quot;POST&quot;</span>]</span>)</span></span><br><span class="line"><span class="meta">@cross_origin(<span class="params">supports_credentials=<span class="literal">True</span></span>)  </span><span class="comment">#配置单一指定路由</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span>():</span></span><br><span class="line">    <span class="keyword">if</span> request.method==<span class="string">&quot;GET&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;get请求已收到&quot;</span></span><br><span class="line">    <span class="keyword">elif</span> request.method==<span class="string">&quot;POST&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;post请求已收到&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;网络请求方式不正确&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run()</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
<hr>
<h1>后记</h1>
<p>日后再补充。</p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Flask</tag>
      </tags>
  </entry>
  <entry>
    <title>HexoMAC代码框样式美化</title>
    <url>/2021/07/05/Hexo%E9%AD%94%E6%94%B9/HexoMAC%E4%BB%A3%E7%A0%81%E6%A1%86%E6%A0%B7%E5%BC%8F%E7%BE%8E%E5%8C%96/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\css\APlayer.min.css"><script src="\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\js\Meting.min.js"></script><h1>前言</h1>
<p>本文将介绍如何美化MAC代码框。具体效果如下：</p>
<p>MAC白色样式：</p>
<img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/MACwhite.png" style="zoom: 80%;" />
<p>MAC黑色样式：</p>
<img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/MACblack.png" style="zoom:80%;" />
<blockquote>
<p>教程链接：<a href="https://blog.csdn.net/u012208219/article/details/106883001/">Hexo博客之butterfly主题优雅魔改系列（持续更新）_小康博客-CSDN博客</a></p>
</blockquote>
<hr>
<h1>正文</h1>
<ol>
<li>
<p>打开站点的主题配置文件<code>_config.butterfly.yml</code>，找到<code>inject</code>，在<code>head</code>处直接引入以下链接：</p>
<p><strong>MAC黑色</strong>：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="string">&lt;link</span> <span class="string">rel=&quot;stylesheet&quot;</span> <span class="string">href=&quot;https://cdn.jsdelivr.net/gh/sviptzk/StaticFile_HEXO@latest/butterfly/css/macblack.css&quot;&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>MAC白色</strong>：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="string">&lt;link</span> <span class="string">rel=&quot;stylesheet&quot;</span> <span class="string">href=&quot;https://cdn.jsdelivr.net/gh/sviptzk/StaticFile_HEXO@latest/butterfly/css/macWhite.css&quot;&gt;</span></span><br></pre></td></tr></table></figure>
<p>（以上两种样式二选一）</p>
</li>
<li>
<p>重新部署，即可看到效果。</p>
</li>
</ol>
<hr>
<h1>后记</h1>
<p>重新记录一下。</p>
]]></content>
      <categories>
        <category>博客</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>Hexo修改友链界面</title>
    <url>/2021/02/25/Hexo%E9%AD%94%E6%94%B9/Hexo%E4%BF%AE%E6%94%B9%E5%8F%8B%E9%93%BE%E7%95%8C%E9%9D%A2/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\css\APlayer.min.css"><script src="\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\js\Meting.min.js"></script><h1>前言</h1>
<p>本文将介绍如何修改站点加载动画。</p>
<p>之前看到友链界面的修改需要动大量源码，就没有弄。后来逐渐开始摸索、修改。自己表示很满意，按照各路大神的教程来操作也并不难。效果展示可以点击我的友链页面查看。</p>
<p><strong>注意</strong>：</p>
<ul>
<li>本篇教程需要改动大量源码，对缩进也有严格要求，如没有把握的小伙伴可以移步下方链接下载源码。</li>
<li>本篇教程修改基于<code>Butterfly3.6.2</code>，针对前期版本号的修改也请移步下方链接。</li>
</ul>
<blockquote>
<p>教程链接：<a href="https://akilar.top/posts/57291286/">https://akilar.top/posts/57291286/</a></p>
</blockquote>
<hr>
<h1>操作</h1>
<ol>
<li>
<p>在<code>\themes\butterfly\layout\includes\page</code>目录下，找到<code>flink.pug</code>文件并将其内容全部做如下替换：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#article-container</span></span><br><span class="line">  <span class="keyword">if</span> top_img === false</span><br><span class="line">    h1.page-title= page.title</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (theme.flink_style === <span class="string">&#x27;butterfly&#x27;</span>)</span><br><span class="line">    .flink</span><br><span class="line">      <span class="keyword">if</span> site.data.link</span><br><span class="line">        each i <span class="keyword">in</span> site.data.link</span><br><span class="line">          <span class="keyword">if</span> i.class_name</span><br><span class="line">            h2!= i.class_name</span><br><span class="line">          <span class="keyword">if</span> i.class_desc</span><br><span class="line">            .flink-desc!=i.class_desc</span><br><span class="line">          .flink-<span class="built_in">list</span></span><br><span class="line">            each item <span class="keyword">in</span> i.link_list</span><br><span class="line">              .flink-<span class="built_in">list</span>-item</span><br><span class="line">                a(href=url_for(item.link)  title=item.name target=<span class="string">&quot;_blank&quot;</span>)</span><br><span class="line">                  <span class="keyword">if</span> theme.lazyload.enable</span><br><span class="line">                    img(data-lazy-src=url_for(item.avatar) onerror=`this.onerror=null;this.src=<span class="string">&#x27;` + url_for(theme.error_img.flink) + `&#x27;</span>` alt=item.name )</span><br><span class="line">                  <span class="keyword">else</span></span><br><span class="line">                    img(src=url_for(item.avatar) onerror=`this.onerror=null;this.src=<span class="string">&#x27;` + url_for(theme.error_img.flink) + `&#x27;</span>` alt=item.name )</span><br><span class="line">                  span.flink-item-name= item.name</span><br><span class="line">                  span.flink-item-desc(title=item.descr)= item.descr</span><br><span class="line">      != page.content</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (theme.flink_style === <span class="string">&#x27;volantis&#x27;</span>)</span><br><span class="line">    .flink</span><br><span class="line">      <span class="keyword">if</span> site.data.link</span><br><span class="line">        each i <span class="keyword">in</span> site.data.link</span><br><span class="line">          <span class="keyword">if</span> i.class_name</span><br><span class="line">            h2!= i.class_name</span><br><span class="line">          <span class="keyword">if</span> i.class_desc</span><br><span class="line">            .flink-desc!=i.class_desc</span><br><span class="line">          .site-card-group</span><br><span class="line">            each item <span class="keyword">in</span> i.link_list</span><br><span class="line">              a.site-card(target=<span class="string">&#x27;_blank&#x27;</span> rel=<span class="string">&#x27;noopener&#x27;</span> href=url_for(item.link))</span><br><span class="line">                .img</span><br><span class="line">                  - var siteshot = item.siteshot ? url_for(item.siteshot) : &#x27;https://image.thum.io/get/width/400/crop/800/allowJPG/wait/20/noanimate/&#x27; + item.link</span><br><span class="line">                  <span class="keyword">if</span> theme.lazyload.enable</span><br><span class="line">                    img(data-lazy-src=siteshot onerror=`this.onerror=null;this.src=<span class="string">&#x27;` + url_for(theme.error_img.post_page) + `&#x27;</span>` alt=<span class="string">&#x27;&#x27;</span> )</span><br><span class="line">                  <span class="keyword">else</span></span><br><span class="line">                    img(src=siteshot onerror=`this.onerror=null;this.src=<span class="string">&#x27;` + url_for(theme.error_img.flink) + `&#x27;</span>` alt=<span class="string">&#x27;&#x27;</span> )</span><br><span class="line">                .info</span><br><span class="line">                  <span class="keyword">if</span> theme.lazyload.enable</span><br><span class="line">                    img(data-lazy-src=url_for(item.avatar) onerror=`this.onerror=null;this.src=<span class="string">&#x27;` + url_for(theme.error_img.flink) + `&#x27;</span>` alt=<span class="string">&#x27;&#x27;</span> )</span><br><span class="line">                  <span class="keyword">else</span></span><br><span class="line">                    img(src=url_for(item.avatar) onerror=`this.onerror=null;this.src=<span class="string">&#x27;` + url_for(theme.error_img.flink) + `&#x27;</span>` alt=<span class="string">&#x27;&#x27;</span> )</span><br><span class="line">                  span.title= item.name</span><br><span class="line">                  span.desc(title=item.descr)= item.descr</span><br><span class="line">      != page.content</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (theme.flink_style === <span class="string">&#x27;flexcard&#x27;</span>)</span><br><span class="line">    .flink</span><br><span class="line">      <span class="keyword">if</span> site.data.link</span><br><span class="line">        each i <span class="keyword">in</span> site.data.link</span><br><span class="line">          <span class="keyword">if</span> i.class_name</span><br><span class="line">            h2!= i.class_name</span><br><span class="line">          <span class="keyword">if</span> i.class_desc</span><br><span class="line">            .flink-desc!=i.class_desc</span><br><span class="line">          .flink-<span class="built_in">list</span></span><br><span class="line">            each item <span class="keyword">in</span> i.link_list</span><br><span class="line">              a.flink-<span class="built_in">list</span>-card(href=url_for(item.link) target=<span class="string">&#x27;_blank&#x27;</span> data-title=item.descr)</span><br><span class="line">                .wrapper.cover</span><br><span class="line">                  - var siteshot = item.siteshot ? url_for(item.siteshot) : &#x27;https://image.thum.io/get/width/400/crop/800/allowJPG/wait/20/noanimate/&#x27; + item.link</span><br><span class="line">                  <span class="keyword">if</span> theme.lazyload.enable</span><br><span class="line">                    img.cover.fadeIn(data-lazy-src=siteshot onerror=`this.onerror=null;this.src=<span class="string">&#x27;` + url_for(theme.error_img.post_page) + `&#x27;</span>` alt=<span class="string">&#x27;&#x27;</span> )</span><br><span class="line">                  <span class="keyword">else</span></span><br><span class="line">                    img.cover.fadeIn(src=siteshot onerror=`this.onerror=null;this.src=<span class="string">&#x27;` + url_for(theme.error_img.flink) + `&#x27;</span>` alt=<span class="string">&#x27;&#x27;</span> )    </span><br><span class="line">                .info</span><br><span class="line">                  <span class="keyword">if</span> theme.lazyload.enable</span><br><span class="line">                    img.flink-avatar(data-lazy-src=url_for(item.avatar) onerror=`this.onerror=null;this.src=<span class="string">&#x27;` + url_for(theme.error_img.flink) + `&#x27;</span>` alt=<span class="string">&#x27;&#x27;</span> )</span><br><span class="line">                  <span class="keyword">else</span></span><br><span class="line">                    img(src=url_for(item.avatar) onerror=`this.onerror=null;this.src=<span class="string">&#x27;` + url_for(theme.error_img.flink) + `&#x27;</span>` alt=<span class="string">&#x27;&#x27;</span> )</span><br><span class="line">                  span.flink-sitename= item.name</span><br><span class="line">      != page.content</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>在<code>\themes\butterfly\source\css\_page</code>，找到<code>flink.styl</code>文件并将其内容全部做如下替换：</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> hexo-config(<span class="string">&#x27;flink_style&#x27;</span>) == <span class="string">&#x27;butterfly&#x27;</span></span><br><span class="line">  .flink#article-container</span><br><span class="line">    .flink-desc</span><br><span class="line">      margin: .2rem 0 .5rem</span><br><span class="line"></span><br><span class="line">    .flink-list</span><br><span class="line">      <span class="attribute">overflow</span>: auto</span><br><span class="line">      <span class="attribute">padding</span>: <span class="number">10px</span> <span class="number">10px</span> <span class="number">0</span></span><br><span class="line">      <span class="attribute">text-align</span>: center</span><br><span class="line"></span><br><span class="line">      &amp; &gt; .flink-list-item</span><br><span class="line">        <span class="attribute">position</span>: relative</span><br><span class="line">        <span class="attribute">float</span>: left</span><br><span class="line">        <span class="attribute">overflow</span>: hidden</span><br><span class="line">        <span class="attribute">margin</span>: <span class="number">15px</span> <span class="number">7px</span></span><br><span class="line">        <span class="attribute">width</span>: calc(<span class="number">100%</span> / <span class="number">3</span> - <span class="number">15px</span>)</span><br><span class="line">        <span class="attribute">height</span>: <span class="number">90px</span></span><br><span class="line">        <span class="attribute">border-radius</span>: <span class="number">8px</span></span><br><span class="line">        <span class="attribute">line-height</span>: <span class="number">17px</span></span><br><span class="line">        -webkit-<span class="attribute">transform</span>: translateZ(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">        +maxWidth1024()</span><br><span class="line">          <span class="attribute">width</span>: calc(<span class="number">50%</span> - <span class="number">15px</span>) <span class="meta">!important</span></span><br><span class="line"></span><br><span class="line">        +maxWidth600()</span><br><span class="line">          <span class="attribute">width</span>: calc(<span class="number">100%</span> - <span class="number">15px</span>) <span class="meta">!important</span></span><br><span class="line"></span><br><span class="line">        &amp;:hover</span><br><span class="line">          img</span><br><span class="line">            <span class="attribute">transform</span>: rotate(<span class="number">360deg</span>)</span><br><span class="line"></span><br><span class="line">        &amp;:before</span><br><span class="line">          <span class="attribute">position</span>: absolute</span><br><span class="line">          <span class="attribute">top</span>: <span class="number">0</span></span><br><span class="line">          <span class="attribute">right</span>: <span class="number">0</span></span><br><span class="line">          <span class="attribute">bottom</span>: <span class="number">0</span></span><br><span class="line">          <span class="attribute">left</span>: <span class="number">0</span></span><br><span class="line">          <span class="attribute">z-index</span>: -<span class="number">1</span></span><br><span class="line">          <span class="attribute">background</span>: var(--text-bg-hover)</span><br><span class="line">          <span class="attribute">content</span>: <span class="string">&#x27;&#x27;</span></span><br><span class="line">          transition: transform .3s ease-out</span><br><span class="line">          <span class="attribute">transform</span>: scale(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">        <span class="selector-pseudo">&amp;:hover</span>:before,</span><br><span class="line">        <span class="selector-pseudo">&amp;:focus</span>:before,</span><br><span class="line">        <span class="selector-pseudo">&amp;:active</span>:before</span><br><span class="line">          <span class="attribute">transform</span>: scale(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        a</span><br><span class="line">          <span class="attribute">color</span>: var(--font-color)</span><br><span class="line">          <span class="attribute">text-decoration</span>: none</span><br><span class="line"></span><br><span class="line">          img</span><br><span class="line">            <span class="attribute">float</span>: left</span><br><span class="line">            <span class="attribute">margin</span>: <span class="number">15px</span> <span class="number">10px</span></span><br><span class="line">            <span class="attribute">width</span>: <span class="number">60px</span></span><br><span class="line">            <span class="attribute">height</span>: <span class="number">60px</span></span><br><span class="line">            <span class="attribute">border-radius</span>: <span class="number">35px</span></span><br><span class="line">            transition: all .3s</span><br><span class="line"></span><br><span class="line">          .img-alt</span><br><span class="line">            <span class="attribute">display</span>: none</span><br><span class="line"></span><br><span class="line">          .flink-item-name</span><br><span class="line">            <span class="keyword">@extend</span> .limit-one-line</span><br><span class="line">            <span class="attribute">display</span>: block</span><br><span class="line">            <span class="attribute">padding</span>: <span class="number">16px</span> <span class="number">10px</span> <span class="number">0</span> <span class="number">0</span></span><br><span class="line">            <span class="attribute">height</span>: <span class="number">40px</span></span><br><span class="line">            <span class="attribute">font-weight</span>: bold</span><br><span class="line">            <span class="attribute">font-size</span>: <span class="number">1.43em</span></span><br><span class="line"></span><br><span class="line">          .flink-item-desc</span><br><span class="line">            <span class="keyword">@extend</span> .limit-one-line</span><br><span class="line">            <span class="attribute">display</span>: block</span><br><span class="line">            <span class="attribute">padding</span>: <span class="number">16px</span> <span class="number">10px</span> <span class="number">16px</span> <span class="number">0</span></span><br><span class="line">            <span class="attribute">height</span>: <span class="number">50px</span></span><br><span class="line">            font-size: .93em</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> hexo-config(<span class="string">&#x27;flink_style&#x27;</span>) == <span class="string">&#x27;volantis&#x27;</span></span><br><span class="line">  trans(<span class="variable">$time</span> = <span class="number">0.28s</span>)</span><br><span class="line">    <span class="attribute">transition</span>: all <span class="variable">$time</span> ease</span><br><span class="line">    -moz-<span class="attribute">transition</span>: all <span class="variable">$time</span> ease</span><br><span class="line">    -webkit-<span class="attribute">transition</span>: all <span class="variable">$time</span> ease</span><br><span class="line">    -o-<span class="attribute">transition</span>: all <span class="variable">$time</span> ease</span><br><span class="line">  .site-card-group</span><br><span class="line">    <span class="attribute">display</span>: flex</span><br><span class="line">    <span class="attribute">flex-wrap</span>: wrap</span><br><span class="line">    <span class="attribute">justify-content</span>: flex-start</span><br><span class="line">    <span class="attribute">margin</span>: -<span class="number">0.5</span> * <span class="number">16px</span></span><br><span class="line">    <span class="attribute">align-items</span>: stretch</span><br><span class="line">  .site-card</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">16px</span> * <span class="number">0.5</span></span><br><span class="line">    <span class="attribute">width</span>: <span class="string">&quot;calc(100% / 4 - %s)&quot;</span> % <span class="number">16px</span></span><br><span class="line">    <span class="keyword">@media</span> screen <span class="keyword">and</span> (<span class="attribute">min-width</span>: <span class="number">2048px</span>)</span><br><span class="line">        <span class="attribute">width</span>: &quot;calc(<span class="number">100%</span> / <span class="number">5</span> - %s)&quot; % <span class="number">16px</span></span><br><span class="line">    @media screen <span class="keyword">and</span> (<span class="attribute">max-width</span>: <span class="number">768px</span>)</span><br><span class="line">        <span class="attribute">width</span>: &quot;calc(<span class="number">100%</span> / <span class="number">3</span> - %s)&quot; % <span class="number">16px</span></span><br><span class="line">    @media screen <span class="keyword">and</span> (<span class="attribute">max-width</span>: <span class="number">500px</span>)</span><br><span class="line">        <span class="attribute">width</span>: &quot;calc(<span class="number">100%</span> / <span class="number">2</span> - %s)&quot; % <span class="number">16px</span></span><br><span class="line">    display: block</span><br><span class="line">    line-height: <span class="number">1.4</span></span><br><span class="line">    <span class="attribute">height</span> <span class="number">100%</span></span><br><span class="line">    .img</span><br><span class="line">      <span class="attribute">width</span>: <span class="number">100%</span></span><br><span class="line">      <span class="attribute">height</span> <span class="number">120px</span></span><br><span class="line">      @media screen <span class="keyword">and</span> (<span class="attribute">max-width</span>: <span class="number">500px</span>)</span><br><span class="line">        <span class="attribute">height</span> <span class="number">100px</span></span><br><span class="line">      overflow: hidden</span><br><span class="line">      border-radius: <span class="number">12px</span> * <span class="number">0.5</span></span><br><span class="line">      box-shadow: <span class="number">0</span> <span class="number">1px</span> <span class="number">2px</span> <span class="number">0px</span> rgba(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.2</span>)</span><br><span class="line">      background: #f6f6f6</span><br><span class="line">      img</span><br><span class="line">        <span class="attribute">width</span>: <span class="number">100%</span></span><br><span class="line">        <span class="attribute">height</span> <span class="number">100%</span></span><br><span class="line">        // trans(.<span class="number">75s</span>)</span><br><span class="line">        transition: transform <span class="number">2s</span> ease</span><br><span class="line">        object-fit: cover</span><br><span class="line"></span><br><span class="line">    .info</span><br><span class="line">      margin-top: <span class="number">16px</span> * <span class="number">0.5</span></span><br><span class="line">      img</span><br><span class="line">        <span class="attribute">width</span>: <span class="number">32px</span></span><br><span class="line">        <span class="attribute">height</span>: <span class="number">32px</span></span><br><span class="line">        border-radius: <span class="number">16px</span></span><br><span class="line">        float: left</span><br><span class="line">        margin-right: <span class="number">8px</span></span><br><span class="line">        margin-top: <span class="number">2px</span></span><br><span class="line">      span</span><br><span class="line">        display: block</span><br><span class="line">      .title</span><br><span class="line">        font-weight: <span class="number">600</span></span><br><span class="line">        font-size: $fontsize-list</span><br><span class="line">        <span class="attribute">color</span>: #<span class="number">444</span></span><br><span class="line">        display: -webkit-box</span><br><span class="line">        -webkit-box-orient: vertical</span><br><span class="line">        overflow: hidden</span><br><span class="line">        -webkit-line-clamp: <span class="number">1</span></span><br><span class="line">        trans()</span><br><span class="line">      .desc</span><br><span class="line">        font-size: $fontsize-footnote</span><br><span class="line">        word-wrap: break-word;</span><br><span class="line">        <span class="attribute">line-height</span>: <span class="number">1.2</span></span><br><span class="line">        <span class="attribute">color</span>: <span class="number">#888</span></span><br><span class="line">        <span class="attribute">display</span>: -webkit-box</span><br><span class="line">        -webkit-box-orient: vertical</span><br><span class="line">        <span class="attribute">overflow</span>: hidden</span><br><span class="line">        -webkit-line-clamp: <span class="number">2</span></span><br><span class="line">    .img</span><br><span class="line">      trans()</span><br><span class="line">    &amp;:hover</span><br><span class="line">      .img</span><br><span class="line">        <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">4px</span> <span class="number">8px</span> <span class="number">0px</span> rgba(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.1</span>), <span class="number">0</span> <span class="number">2px</span> <span class="number">4px</span> <span class="number">0px</span> rgba(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.1</span>), <span class="number">0</span> <span class="number">4px</span> <span class="number">8px</span> <span class="number">0px</span> rgba(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.1</span>), <span class="number">0</span> <span class="number">8px</span> <span class="number">16px</span> <span class="number">0px</span> rgba(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.1</span>)</span><br><span class="line">      <span class="selector-class">.info</span> .title</span><br><span class="line">        <span class="attribute">color</span>: <span class="number">#ff5722</span></span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> hexo-config(<span class="string">&#x27;flink_style&#x27;</span>) == <span class="string">&#x27;flexcard&#x27;</span></span><br><span class="line">  <span class="selector-id">#article-container</span> img</span><br><span class="line">        <span class="attribute">margin</span> <span class="number">0</span> auto<span class="meta">!important</span></span><br><span class="line">  .flink-list</span><br><span class="line">    <span class="attribute">overflow</span> auto</span><br><span class="line">    &amp; &gt; a</span><br><span class="line">      <span class="attribute">width</span> calc(<span class="number">25%</span> - <span class="number">15px</span>)</span><br><span class="line">      <span class="attribute">height</span> <span class="number">130px</span></span><br><span class="line">      <span class="attribute">position</span> relative</span><br><span class="line">      <span class="attribute">display</span> block</span><br><span class="line">      <span class="attribute">margin</span> <span class="number">15px</span> <span class="number">7px</span></span><br><span class="line">      <span class="attribute">float</span> left</span><br><span class="line">      <span class="attribute">overflow</span> hidden</span><br><span class="line">      <span class="attribute">border-radius</span> <span class="number">10px</span></span><br><span class="line">      transition all .3s ease 0s, transform .6s cubic-bezier(.6, .2, .1, 1) 0s</span><br><span class="line">      box-shadow 0 14px 38px rgba(0, 0, 0, .08), 0 3px 8px rgba(0, 0, 0, .06)</span><br><span class="line">      &amp;:hover</span><br><span class="line">        .info</span><br><span class="line">          <span class="attribute">transform</span> translateY(-<span class="number">100%</span>)</span><br><span class="line">        .wrapper</span><br><span class="line">          img</span><br><span class="line">            <span class="attribute">transform</span> scale(<span class="number">1.2</span>)</span><br><span class="line">        &amp;:before</span><br><span class="line">          <span class="attribute">position</span>: fixed</span><br><span class="line">          <span class="attribute">width</span>:inherit</span><br><span class="line">          <span class="attribute">margin</span>:auto</span><br><span class="line">          <span class="attribute">left</span>:<span class="number">0</span></span><br><span class="line">          <span class="attribute">right</span>:<span class="number">0</span></span><br><span class="line">          <span class="attribute">top</span>:<span class="number">10%</span></span><br><span class="line">          <span class="attribute">border-radius</span>: <span class="number">10px</span></span><br><span class="line">          <span class="attribute">text-align</span>: center</span><br><span class="line">          <span class="attribute">z-index</span>: <span class="number">100</span></span><br><span class="line">          <span class="attribute">content</span>: attr(data-title)</span><br><span class="line">          <span class="attribute">font-size</span>: <span class="number">20px</span></span><br><span class="line">          <span class="attribute">color</span>: <span class="number">#fff</span></span><br><span class="line">          <span class="attribute">padding</span>: <span class="number">10px</span></span><br><span class="line">          <span class="attribute">background-color</span>: rgba(<span class="variable">$theme</span>-color,<span class="number">0.8</span>)</span><br><span class="line">      .cover</span><br><span class="line">        <span class="attribute">width</span> <span class="number">100%</span></span><br><span class="line">        transition transform .5s ease-out</span><br><span class="line">      .wrapper</span><br><span class="line">        <span class="attribute">position</span> relative</span><br><span class="line">        .fadeIn</span><br><span class="line">          animation coverIn .8s ease-out forwards</span><br><span class="line">        img</span><br><span class="line">          <span class="attribute">height</span> <span class="number">130px</span></span><br><span class="line">          <span class="attribute">pointer-events</span> none</span><br><span class="line">      .info</span><br><span class="line">        <span class="attribute">display</span> flex</span><br><span class="line">        <span class="attribute">flex-direction</span> column</span><br><span class="line">        <span class="attribute">justify-content</span> center</span><br><span class="line">        <span class="attribute">align-items</span> center</span><br><span class="line">        <span class="attribute">width</span> <span class="number">100%</span></span><br><span class="line">        <span class="attribute">height</span> <span class="number">100%</span></span><br><span class="line">        <span class="attribute">overflow</span> hidden</span><br><span class="line">        <span class="attribute">border-radius</span> <span class="number">3px</span></span><br><span class="line">        background-color hsla(0, 0%, 100%, .7)</span><br><span class="line">        transition transform .5s cubic-bezier(.6, .2, .1, 1) 0s</span><br><span class="line">        img</span><br><span class="line">          <span class="attribute">position</span> relative</span><br><span class="line">          <span class="attribute">top</span> <span class="number">22px</span> //因为字体大小不同，可能导致头像偏高，可以在此处通过修改top的值来微调头像框的位置至卡片正中。</span><br><span class="line">          <span class="attribute">width</span> <span class="number">66px</span></span><br><span class="line">          <span class="attribute">height</span> <span class="number">66px</span></span><br><span class="line">          <span class="attribute">border-radius</span> <span class="number">50%</span></span><br><span class="line">          box-shadow 0 0 10px rgba(0, 0, 0, .3)</span><br><span class="line">          <span class="attribute">z-index</span> <span class="number">1</span></span><br><span class="line">          <span class="attribute">text-align</span> center</span><br><span class="line">          <span class="attribute">pointer-events</span> none</span><br><span class="line">        span</span><br><span class="line">          <span class="attribute">padding</span> <span class="number">20px</span> <span class="number">10%</span> <span class="number">60px</span> <span class="number">10%</span></span><br><span class="line">          <span class="attribute">font-size</span> <span class="number">16px</span></span><br><span class="line">          <span class="attribute">width</span> <span class="number">100%</span></span><br><span class="line">          <span class="attribute">text-align</span> center</span><br><span class="line">          box-shadow 0 0 10px rgba(0, 0, 0, .3)</span><br><span class="line">          background-color hsla(0, 0%, 100%, .7)</span><br><span class="line">          <span class="attribute">color</span> var(--font-color)</span><br><span class="line">          <span class="attribute">white-space</span> nowrap</span><br><span class="line">          <span class="attribute">overflow</span> hidden</span><br><span class="line">          <span class="attribute">text-overflow</span> ellipsis</span><br><span class="line">  .flink-list&gt;<span class="selector-tag">a</span> <span class="selector-class">.info</span>,</span><br><span class="line">  .flink-list&gt;<span class="selector-tag">a</span> <span class="selector-class">.wrapper</span> .cover</span><br><span class="line">    <span class="attribute">position</span> absolute</span><br><span class="line">    <span class="attribute">top</span> <span class="number">0</span></span><br><span class="line">    <span class="attribute">left</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">@media</span> screen <span class="keyword">and</span> (<span class="attribute">max-width</span>:<span class="number">1024px</span>)</span><br><span class="line">    .flink-list</span><br><span class="line">      &amp; &gt; a</span><br><span class="line">        <span class="attribute">width</span> calc(<span class="number">33.33333%</span> - <span class="number">15px</span>)</span><br><span class="line"></span><br><span class="line">  @media screen <span class="keyword">and</span> (<span class="attribute">max-width</span>:<span class="number">600px</span>)</span><br><span class="line">    .flink-list</span><br><span class="line">      &amp; &gt; a</span><br><span class="line">        <span class="attribute">width</span> calc(<span class="number">50%</span> - <span class="number">15px</span>)</span><br><span class="line"></span><br><span class="line">  [data-theme=dark]</span><br><span class="line">    .flink-list a .info,</span><br><span class="line">    .flink-list a .info span</span><br><span class="line">      background-color rgba(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, .<span class="number">6</span>)</span><br><span class="line">    .flink-list</span><br><span class="line">      &amp; &gt; a</span><br><span class="line">        &amp;:<span class="attribute">hover</span></span><br><span class="line">          &amp;:before</span><br><span class="line">            background-color: rgba(#<span class="number">121212</span>,<span class="number">0.8</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>因为此友链样式相比传统默认样式需要站点缩略图，因此需要添加一个<code>siteshot</code>的配置项。</p>
<p>在<code>\source\_data</code>目录下，找到<code>link.yml</code>文件，添加一条名为 <code>siteshot</code> 的配置项：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">花猪</span></span><br><span class="line">      <span class="attr">link:</span> <span class="string">https://cnhuazhu.gitee.io/</span></span><br><span class="line">      <span class="attr">avatar:</span> <span class="string">https://cdn.jsdelivr.net/gh/CNhuazhu/Image/avatar.jpg</span></span><br><span class="line">      <span class="attr">descr:</span> <span class="string">佛系青年</span></span><br><span class="line">      <span class="attr">siteshot:</span> <span class="string">https://cdn.jsdelivr.net/gh/CNhuazhu/Image/top.jpg</span> <span class="comment"># 站点缩略图</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>找到主题配置文件<code>_config.butterfly.yml</code>，手动添加配置项代码（原本没有）：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 友链样式，butterfly为默认样式，volantis为站点卡片样式，flexcard为弹性卡片样式</span></span><br><span class="line"><span class="attr">flink_style:</span> <span class="string">flexcard</span> <span class="comment"># butterfly | volantis | flexcard</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>对于懒加载和图片失效替换的部分也在主题配置文件<code>_config.butterfly.yml</code>中，可以自行修改：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Replace Broken Images (替換無法顯示的圖片)</span></span><br><span class="line"><span class="attr">error_img:</span></span><br><span class="line">  <span class="attr">flink:</span>   <span class="comment"># 头像失效替换图</span></span><br><span class="line">  <span class="attr">post_page:</span>  <span class="comment"># 站点缩略图</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>可能遇到的 bug：使用 <code>flexcard</code> 样式时，因为全站字体大小配置与本站不一致的关系，可能导致友链卡片的头像位置偏移较大。请读者按照 <code>flink.styl</code> 里的注释内容自己微调。</p>
</li>
<li>
<p>重新部署，启动，即可看到友链页面发生了变化。</p>
</li>
</ol>
<hr>
<h1>可能遇到的bug</h1>
<p>关于友链样式：</p>
<ul>
<li>
<p>如果想换回Butterfly的默认样式，建议改回原文件，因为在配置文件<code>_config.butterfly.yml</code>里直接修改可能会显示错误</p>
</li>
<li>
<p>如果想选择<code>flexcard</code>样式，要注意看一下<code>Gallery图库</code>的图片展示有没有什么问题，如果图片位置出现严重偏移，可采取以下办法：</p>
<p>在<code>\themes\butterfly\source\css</code>目录下新建一个<code>xxx.css</code>文件，并将以下内容写入该文件中：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*相册页面定位修复*/</span></span><br><span class="line"><span class="selector-tag">a</span> &gt; <span class="selector-tag">img</span>, <span class="selector-class">.justified-gallery</span> &gt; <span class="selector-tag">div</span> &gt; <span class="selector-tag">img</span>,</span><br><span class="line"><span class="selector-class">.justified-gallery</span> &gt; <span class="selector-tag">figure</span> &gt; <span class="selector-tag">img</span>,</span><br><span class="line"><span class="selector-class">.justified-gallery</span> &gt; <span class="selector-tag">a</span> &gt; <span class="selector-tag">a</span> &gt; <span class="selector-tag">img</span>,</span><br><span class="line"><span class="selector-class">.justified-gallery</span> &gt; <span class="selector-tag">div</span> &gt; <span class="selector-tag">a</span> &gt; <span class="selector-tag">img</span>,</span><br><span class="line"><span class="selector-class">.justified-gallery</span> &gt; <span class="selector-tag">figure</span> &gt; <span class="selector-tag">a</span> &gt; <span class="selector-tag">img</span>,</span><br><span class="line"><span class="selector-class">.justified-gallery</span> &gt; <span class="selector-tag">a</span> &gt; svg,</span><br><span class="line"><span class="selector-class">.justified-gallery</span> &gt; <span class="selector-tag">div</span> &gt; svg,</span><br><span class="line"><span class="selector-class">.justified-gallery</span> &gt; <span class="selector-tag">figure</span> &gt; svg,</span><br><span class="line"><span class="selector-class">.justified-gallery</span> &gt; <span class="selector-tag">a</span> &gt; <span class="selector-tag">a</span> &gt; svg,</span><br><span class="line"><span class="selector-class">.justified-gallery</span> &gt; <span class="selector-tag">div</span> &gt; <span class="selector-tag">a</span> &gt; svg,</span><br><span class="line"><span class="selector-class">.justified-gallery</span> &gt; <span class="selector-tag">figure</span> &gt; <span class="selector-tag">a</span> &gt; svg&#123;</span><br><span class="line">  <span class="attribute">position</span>:static<span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>找到主题配置文件<code>_config.butterfly.yml</code>，在<code>inject</code>的<code>head</code>处引入该css文件:</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">inject:</span></span><br><span class="line">  <span class="attr">head:</span> </span><br><span class="line">    <span class="bullet">-</span> <span class="string">&lt;link</span> <span class="string">rel=&quot;stylesheet&quot;</span> <span class="string">href=&quot;/css/xxx.css&quot;&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>目前我使用<code>volantis</code>样式，没有发现问题</p>
</li>
</ul>
<hr>
<h1>结尾</h1>
<p>针对站点缩略图更进一步的操作本篇并未介绍，更详细的内容请读者移步<a href="https://akilar.top/">Akilar</a>的博客，文章链接如下：</p>
<blockquote>
<p>《Friend Link Card Beautify》：<a href="https://akilar.top/posts/57291286/">https://akilar.top/posts/57291286/</a></p>
</blockquote>
]]></content>
      <categories>
        <category>博客</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>Hexo在顶部增加天气小部件</title>
    <url>/2021/02/24/Hexo%E9%AD%94%E6%94%B9/Hexo%E5%9C%A8%E9%A1%B6%E9%83%A8%E5%A2%9E%E5%8A%A0%E5%A4%A9%E6%B0%94%E5%B0%8F%E9%83%A8%E4%BB%B6/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\css\APlayer.min.css"><script src="\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\js\Meting.min.js"></script><h1>前言</h1>
<p>本文将介绍如何在顶部增加天气小部件，效果在顶部即可看到。</p>
<blockquote>
<p>教程链接：<a href="https://surpsec.cn/3178170368.html">https://surpsec.cn/3178170368.html</a></p>
</blockquote>
<hr>
<h1>操作</h1>
<ol>
<li>
<p>去<a href="https://cj.weather.com.cn/">中国天气</a>官网：<a href="https://cj.weather.com.cn/">https://cj.weather.com.cn/</a> 先注册一个账号，然后点击<code>自定义插件</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/weatherWeb.png" alt=""></p>
</li>
<li>
<p>根据自己的需求创建插件样式，并生成代码：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/weatherWeb2.png" alt=""></p>
<p>复制图中框选的代码</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/weathercreate.png" alt=""></p>
</li>
<li>
<p>在<code>\themes\butterfly\source\js</code>目录下创建一个<code>weather.js</code>文件，将刚刚复制的代码写入该文件：</p>
<p>（<strong>注意</strong>：<code>key</code>处要替换为你自己的key值）</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">WIDGET = &#123;</span><br><span class="line">  CONFIG: &#123;</span><br><span class="line">    <span class="string">&quot;modules&quot;</span>: <span class="string">&quot;01234&quot;</span>,</span><br><span class="line">    <span class="string">&quot;background&quot;</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="string">&quot;tmpColor&quot;</span>: <span class="string">&quot;FFFFFF&quot;</span>,</span><br><span class="line">    <span class="string">&quot;tmpSize&quot;</span>: <span class="number">16</span>,</span><br><span class="line">    <span class="string">&quot;cityColor&quot;</span>: <span class="string">&quot;FFFFFF&quot;</span>,</span><br><span class="line">    <span class="string">&quot;citySize&quot;</span>: <span class="number">16</span>,</span><br><span class="line">    <span class="string">&quot;aqiSize&quot;</span>: <span class="number">16</span>,</span><br><span class="line">    <span class="string">&quot;weatherIconSize&quot;</span>: <span class="number">24</span>,</span><br><span class="line">    <span class="string">&quot;alertIconSize&quot;</span>: <span class="number">18</span>,</span><br><span class="line">    <span class="string">&quot;padding&quot;</span>: <span class="string">&quot;10px 10px 10px 10px&quot;</span>,</span><br><span class="line">    <span class="string">&quot;shadow&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;language&quot;</span>: <span class="string">&quot;auto&quot;</span>,</span><br><span class="line">    <span class="string">&quot;borderRadius&quot;</span>: <span class="number">5</span>,</span><br><span class="line">    <span class="string">&quot;fixed&quot;</span>: <span class="string">&quot;false&quot;</span>,</span><br><span class="line">    <span class="string">&quot;vertical&quot;</span>: <span class="string">&quot;middle&quot;</span>,</span><br><span class="line">    <span class="string">&quot;horizontal&quot;</span>: <span class="string">&quot;center&quot;</span>,</span><br><span class="line">    <span class="string">&quot;key&quot;</span>: <span class="string">&quot;替换为你自己的key&quot;</span></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>找到主题配置文件<code>_config.butterfly.yml</code>，在<code>inject</code>的<code>bottom</code>处引入两个js文件，一个是刚刚创建的<code>weather.js</code>，另一个是如下文件：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="string">&lt;script</span> <span class="string">src=&quot;https://apip.weatherdt.com/simple/static/js/weather-simple-common.js?v=2.0&quot;&gt;&lt;/script&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/weatherwrite.png" alt=""></p>
</li>
<li>
<p>在<code>\themes\butterfly\layout\includes\header</code>路径下找到<code>nav.pug</code>文件，添加如下代码（<strong>注意缩进）</strong>;</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">span#weather-v2-plugin-simple</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/weathernavcode.png" alt=""></p>
</li>
<li>
<p>重新部署，启动，就可以看到效果啦。</p>
</li>
</ol>
<hr>
<h1>结尾</h1>
<p>慢慢地开始接触并修改源文件了。</p>
]]></content>
      <categories>
        <category>博客</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>Hexo增添上升气泡效果</title>
    <url>/2021/02/24/Hexo%E9%AD%94%E6%94%B9/Hexo%E5%A2%9E%E6%B7%BB%E4%B8%8A%E5%8D%87%E6%B0%94%E6%B3%A1%E6%95%88%E6%9E%9C/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\css\APlayer.min.css"><script src="\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\js\Meting.min.js"></script><h1>前言</h1>
<p>本文将介绍如何增添上升气泡效果，效果如下图：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/bubble.png" alt=""></p>
<p>教程链接：<a href="https://weilining.cf/95.html">https://weilining.cf/95.html</a></p>
<hr>
<h1>操作</h1>
<p>找到主题配置文件<code>_config.butterfly.yml</code>，在<code>inject</code>的<code>bottom</code>处引入以下文件:</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">inject:</span></span><br><span class="line">  <span class="attr">head:</span></span><br><span class="line">  <span class="attr">bottom:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&lt;script</span> <span class="string">defer</span> <span class="string">src=&quot;https://cdn.jsdelivr.net/combine/npm/jquery@latest/dist/jquery.min.js,gh/weilining/jsdelivr/jquery/circlemagic/circlemagic.min.js,gh/weilining/jsdelivr@latest/jquery/circlemagic/butterflycirclemagic.js&quot;&gt;&lt;/script&gt;</span></span><br></pre></td></tr></table></figure>
<p>重新部署，启动，就可以看到效果啦。</p>
<hr>
<h1>结尾</h1>
<p>还是很好看的一个效果（虽然我没采用，因为画面太乱了）。</p>
]]></content>
      <categories>
        <category>博客</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>Hexo增添公告栏计时器小部件</title>
    <url>/2021/02/24/Hexo%E9%AD%94%E6%94%B9/Hexo%E5%A2%9E%E6%B7%BB%E5%85%AC%E5%91%8A%E6%A0%8F%E8%AE%A1%E6%97%B6%E5%99%A8%E5%B0%8F%E9%83%A8%E4%BB%B6/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\css\APlayer.min.css"><script src="\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\js\Meting.min.js"></script><h1>前言</h1>
<p>本问将介绍如何在公告栏增加计时器小部件，效果如下图所示：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/ggldemo.png" alt=""></p>
<blockquote>
<p>教程链接：<a href="https://surpsec.cn/3178170368.html">https://surpsec.cn/3178170368.html</a></p>
</blockquote>
<hr>
<h1>操作</h1>
<ol>
<li>
<p>在<code>\themes\butterfly\source\js</code>目录下创建一个<code>timing.js</code>文件，并将如下代码写入该文件：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> oSpan = <span class="built_in">document</span>.getElementsByTagName(<span class="string">&quot;timing&quot;</span>)[<span class="number">0</span>];</span><br><span class="line"><span class="keyword">let</span> localhostTime = <span class="keyword">new</span> <span class="built_in">Date</span>();<span class="comment">//获取页面打开的时间</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">tow</span>(<span class="params">n</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> n &gt;= <span class="number">0</span> &amp;&amp; n &lt; <span class="number">10</span> ? <span class="string">&#x27;0&#x27;</span> + n : <span class="string">&#x27;&#x27;</span> + n;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">setInterval</span>(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> goTime = <span class="keyword">new</span> <span class="built_in">Date</span>();<span class="comment">//获取动态时间</span></span><br><span class="line">    <span class="keyword">let</span> diffTime = goTime.getTime() - localhostTime.getTime();</span><br><span class="line">    <span class="keyword">var</span> second = <span class="built_in">Math</span>.floor(diffTime / <span class="number">1000</span>);<span class="comment">//未来时间距离现在的秒数</span></span><br><span class="line">    <span class="keyword">var</span> day = <span class="built_in">Math</span>.floor(second / <span class="number">86400</span>);<span class="comment">//整数部分代表的是天；一天有24*60*60=86400秒 ；</span></span><br><span class="line">    second = second % <span class="number">86400</span>;<span class="comment">//余数代表剩下的秒数；</span></span><br><span class="line">    <span class="keyword">var</span> hour = <span class="built_in">Math</span>.floor(second / <span class="number">3600</span>);<span class="comment">//整数部分代表小时；</span></span><br><span class="line">    second %= <span class="number">3600</span>; <span class="comment">//余数代表 剩下的秒数；</span></span><br><span class="line">    <span class="keyword">var</span> minute = <span class="built_in">Math</span>.floor(second / <span class="number">60</span>);</span><br><span class="line">    second %= <span class="number">60</span>;</span><br><span class="line">    <span class="comment">// var str = tow(day) + &#x27;&lt;span class=&quot;time&quot;&gt;天&lt;/span&gt;&#x27;</span></span><br><span class="line">    <span class="comment">//     + tow(hour) + &#x27;&lt;span class=&quot;time&quot;&gt;小时&lt;/span&gt;&#x27;</span></span><br><span class="line">    <span class="comment">//     + tow(minute) + &#x27;&lt;span class=&quot;time&quot;&gt;分钟&lt;/span&gt;&#x27;</span></span><br><span class="line">    <span class="comment">//     + tow(second) + &#x27;&lt;span class=&quot;time&quot;&gt;秒&lt;/span&gt;&#x27;;</span></span><br><span class="line">    <span class="keyword">var</span> str = tow(hour) + <span class="string">&#x27;&lt;span class=&quot;time&quot;&gt;小时&lt;/span&gt;&#x27;</span></span><br><span class="line">        + tow(minute) + <span class="string">&#x27;&lt;span class=&quot;time&quot;&gt;分钟&lt;/span&gt;&#x27;</span></span><br><span class="line">        + tow(second) + <span class="string">&#x27;&lt;span class=&quot;time&quot;&gt;秒&lt;/span&gt;&#x27;</span>;</span><br><span class="line">    oSpan.innerHTML = <span class="string">&quot;您已浏览网页&quot;</span> + str;</span><br><span class="line">&#125;, <span class="number">1000</span>)</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>找到主题配置文件<code>_config.butterfly.yml</code>，在<code>inject</code>的<code>bottom</code>处引入该js文件：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">inject:</span></span><br><span class="line">  <span class="attr">bottom:</span></span><br><span class="line">  	<span class="bullet">-</span> <span class="string">&lt;script</span> <span class="string">src=&quot;/js/timing.js&quot;&gt;&lt;/script&gt;</span> <span class="comment"># 公告栏计时器插件</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>在<code>\themes\butterfly\layout\includes\widget</code>目录下找到<code>card_announcement.pug</code>文件，添加<code>timing</code>（<strong>注意缩进</strong>）：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/gglcardcode.png" alt=""></p>
</li>
<li>
<p>重新部署，启动，就可以看到效果啦。</p>
</li>
</ol>
<hr>
<h1>结尾</h1>
<p>一个小小的改动，还不错。</p>
]]></content>
      <categories>
        <category>博客</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>Hexo增添头像卡片动态背景</title>
    <url>/2021/02/24/Hexo%E9%AD%94%E6%94%B9/Hexo%E5%A2%9E%E6%B7%BB%E5%A4%B4%E5%83%8F%E5%8D%A1%E7%89%87%E5%8A%A8%E6%80%81%E8%83%8C%E6%99%AF/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\css\APlayer.min.css"><script src="\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\js\Meting.min.js"></script><h1>前言</h1>
<p>本文将介绍如何在侧边栏增添头像卡片动态背景。效果展示：将鼠标移至头像卡片即可看到。</p>
<blockquote>
<p>教程链接：<a href="https://www.tqwba.com/x_d/jishu/298102.html">https://www.tqwba.com/x_d/jishu/298102.html</a></p>
</blockquote>
<hr>
<h1>操作</h1>
<ol>
<li>
<p>在<code>\themes\butterfly\source\css</code>目录下创建一个<code>css</code>文件，将如下代码写入该文件（有两种效果，选其一）:</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* 效果一：彩带 */</span></span><br><span class="line"><span class="selector-class">.card-info-avatar</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">url</span>(<span class="string">https://cdn.jsdelivr.net/gh/rigodlee/BLOGCDN/img/H3342af90d24b4d62b9bbfec9688ccc25M.gif</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 效果二：花 */</span></span><br><span class="line"><span class="selector-class">.card-info-avatar</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">url</span>(<span class="string">https://cdn.jsdelivr.net/gh/rigodlee/BLOGCDN/img/20200530181856.gif</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>找到主题配置文件<code>_config.butterfly.yml</code>，在<code>inject</code>的<code>head</code>处引入该css文件：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">inject:</span></span><br><span class="line">  <span class="attr">head:</span></span><br><span class="line">  	<span class="bullet">-</span> <span class="string">&lt;link</span> <span class="string">rel=&quot;stylesheet&quot;</span> <span class="string">href=&quot;/css/xxx.css&quot;&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>重新部署，启动，就可以看到效果啦。</p>
</li>
</ol>
<hr>
<h1>结尾</h1>
<p>一个很简单的小修改</p>
]]></content>
      <categories>
        <category>博客</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>Hexo小标题旋转风车设置</title>
    <url>/2021/02/24/Hexo%E9%AD%94%E6%94%B9/Hexo%E5%B0%8F%E6%A0%87%E9%A2%98%E6%97%8B%E8%BD%AC%E9%A3%8E%E8%BD%A6%E8%AE%BE%E7%BD%AE/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\css\APlayer.min.css"><script src="\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\js\Meting.min.js"></script><h1>前言</h1>
<p>如果不喜欢<code>Butterfly</code>主题自带的<code>曲别针</code>图标，可以换一种口味。（比如我现在使用的<code>旋转风车</code>）</p>
<blockquote>
<p>教程链接：<a href="https://weilining.cf/70.html">https://weilining.cf/70.html</a></p>
</blockquote>
<hr>
<h1>操作</h1>
<p>找到主题配置文件<code>_config.butterfly.yml</code></p>
<ol>
<li>
<p>把<code>beautify</code>的<code>title-prefix-icon</code>处修改为:<code>'\f863'</code></p>
<p>（如果没有开启图标功能则需要将<code>enable</code>设置为<code>true</code>）</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">beautify:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">title-prefix-icon:</span> <span class="string">&#x27;\f863&#x27;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>在<code>inject</code>的<code>head</code>处引入以下文件:</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">inject:</span><br><span class="line">  head:</span><br><span class="line">    - &quot;<span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"><span class="selector-id">#article-container</span><span class="selector-class">.post-content</span> <span class="selector-tag">h1</span>:before, h2:before, h3:before, h4:before, h5:before, h6:before &#123; -webkit-animation: avatar_turn_around <span class="number">1s</span> linear infinite; -moz-<span class="attribute">animation</span>: avatar_turn_around <span class="number">1s</span> linear infinite; -o-<span class="attribute">animation</span>: avatar_turn_around <span class="number">1s</span> linear infinite; -ms-<span class="attribute">animation</span>: avatar_turn_around <span class="number">1s</span> linear infinite; <span class="attribute">animation</span>: avatar_turn_around <span class="number">1s</span> linear infinite; &#125;</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span>&quot;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>重新部署，启动，就可以看到效果啦。</p>
<hr>
<h1>结尾</h1>
<p>慢慢的博客就不一样了。</p>
]]></content>
      <categories>
        <category>博客</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>Hexo增添水波荡漾效果</title>
    <url>/2021/02/24/Hexo%E9%AD%94%E6%94%B9/Hexo%E5%A2%9E%E6%B7%BB%E6%B0%B4%E6%B3%A2%E8%8D%A1%E6%BC%BE%E6%95%88%E6%9E%9C/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\css\APlayer.min.css"><script src="\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\js\Meting.min.js"></script><h1>前言</h1>
<p>本文将介绍如何增添水波荡漾效果，效果如图所示：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/waterwave.png" alt=""></p>
<blockquote>
<p>教程链接：<a href="https://weilining.cf/24.html">https://weilining.cf/24.html</a></p>
</blockquote>
<hr>
<h1>操作</h1>
<ol>
<li>
<p>在<code>\themes\butterfly\source\js</code>目录下创建一个<code>ripples.js</code>文件，并将如下代码写入该文件：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">$(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    $(<span class="string">&quot;#page-header&quot;</span>).ripples(&#123;</span><br><span class="line">      resolution: <span class="number">512</span>,</span><br><span class="line">      dropRadius: <span class="number">10</span>, <span class="comment">//px</span></span><br><span class="line">      perturbance: <span class="number">0.04</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    $(<span class="string">&quot;.error&quot;</span>).show().text(e);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>找到主题配置文件<code>_config.butterfly.yml</code>，在<code>inject</code>的<code>bottom</code>处引入以下文件:</p>
<ul>
<li>
<p>开启 pjax</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">inject:</span></span><br><span class="line">  <span class="attr">head:</span></span><br><span class="line">  <span class="attr">bottom:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&lt;script</span> <span class="string">defer</span> <span class="string">src=&quot;https://rmt.dogedoge.com/fetch/~/source/jsdelivr/npm/jquery@latest/dist/jquery.min.js&quot;&gt;&lt;/script&gt;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&lt;script</span> <span class="string">defer</span> <span class="string">data-pjax</span> <span class="string">src=&quot;https://cdn.jsdelivr.net/gh/sirxemic/jquery.ripples/dist/jquery.ripples.js&quot;&gt;&lt;/script&gt;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&lt;script</span> <span class="string">defer</span> <span class="string">data-pjax</span> <span class="string">src=&quot;/js/ripples.js&quot;&gt;&lt;/script&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>未开启 pjax</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">inject:</span></span><br><span class="line">  <span class="attr">head:</span></span><br><span class="line">  <span class="attr">bottom:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&lt;script</span> <span class="string">defer</span> <span class="string">src=&quot;https://rmt.dogedoge.com/fetch/~/source/jsdelivr/npm/jquery@latest/dist/jquery.min.js&quot;&gt;&lt;/script&gt;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&lt;script</span> <span class="string">defer</span> <span class="string">src=&quot;https://cdn.jsdelivr.net/gh/sirxemic/jquery.ripples/dist/jquery.ripples.js&quot;&gt;&lt;/script&gt;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&lt;script</span> <span class="string">defer</span> <span class="string">src=&quot;/js/ripples.js&quot;&gt;&lt;/script&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li>
<p>重新部署，启动，就可以看到效果啦。</p>
</li>
</ol>
<hr>
<h1>结尾</h1>
<p>用一些特定的背景，再搭配水波特效简直绝美。</p>
]]></content>
      <categories>
        <category>博客</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>Hexo建立分站</title>
    <url>/2021/07/14/Hexo%E9%AD%94%E6%94%B9/Hexo%E5%BB%BA%E7%AB%8B%E5%88%86%E7%AB%99/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\css\APlayer.min.css"><script src="\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\js\Meting.min.js"></script><h1>前言</h1>
<p>之前有人反映<code>Butterfly</code>主题有点花哨（一方面是所有“蝴蝶人”都知道的多图特点，另一方面当然也有自己魔改的原因）</p>
<p>这就导致有些文章的阅读体验太差。</p>
<p>正巧看到<a href="https://www.heson10.com/">黑石博客</a>有一篇建立分站的文章，于是就照着做了一番，建立了一个简洁的主题，效果不错。</p>
<p>（可以在顶部导航栏点击跳转到分站）</p>
<blockquote>
<p>教程链接：<a href="https://www.heson10.com/posts/46324.html">为Hexo博客建立其他主题分站 - 黑石博客 - Hexo博客 (heson10.com)</a></p>
</blockquote>
<hr>
<h1>正文</h1>
<ol>
<li>
<p>根据正常建立Hexo静态博客的步骤一样建站，并选择分站的主题（这里以<a href="https://theme-next.js.org/">Next主题</a>为例），在分站的根目录下找到<code>_config.yml</code>文件，将<code>theme</code>修改为<code>next</code>。</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">theme:</span> <span class="string">next</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>同样在分站的根目录下修改<code>_config.yml</code>文件中的<code>url</code>和<code>root</code>。</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">url:</span> <span class="string">https://站点域名/next</span></span><br><span class="line"><span class="attr">root:</span> <span class="string">/next/</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>之后在控制台键入命令<code>hexo g</code>，会发现在分站根目录下生成了<code>public</code>文件夹。</p>
<p>然后在主站的<code>source</code>文件夹中创建名为<code>next</code>的文件夹，再将分站中生成的<code>public</code>文件夹中的内容全部复制到主站的<code>next</code>文件夹中。</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/%E5%BB%BA%E7%AB%8B%E5%88%86%E7%AB%99.png" alt=""></p>
</li>
<li>
<p>设置主站渲染时跳过分站：</p>
<p>在主站的根目录下设置<code>_config.yml</code>文件中的<code>skip_render</code></p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">skip_render:</span> </span><br><span class="line">    <span class="bullet">-</span> <span class="string">next/**</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>在主站的<code>_config.butterfly.yml</code>文件中设置导航栏分站选项</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">menu:</span></span><br><span class="line">  <span class="string">分站||fas</span> <span class="attr">fa-sitemap:</span></span><br><span class="line">    <span class="attr">Next:</span> <span class="string">/next/</span> <span class="string">||</span> <span class="string">fas</span> <span class="string">fa-chevron-right</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>最后重新部署主站就可以了</p>
</li>
</ol>
<hr>
<h1>后记</h1>
<p>Hexo静态博客的好处就是可以随意修改站点内容。</p>
]]></content>
      <categories>
        <category>博客</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>Hexo插入响应式Bilibili视频代码块</title>
    <url>/2021/07/30/Hexo%E9%AD%94%E6%94%B9/Hexo%E6%8F%92%E5%85%A5%E5%93%8D%E5%BA%94%E5%BC%8FBilibili%E8%A7%86%E9%A2%91%E4%BB%A3%E7%A0%81%E5%9D%97/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\css\APlayer.min.css"><script src="\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\js\Meting.min.js"></script><h1>前言</h1>
<p>本文将介绍如何在Hexo页面中插入响应式Bilibili视频代码块。</p>
<blockquote>
<p>教程链接：<a href="https://blog.csdn.net/weixin_41216356/article/details/106911233">如何在Hugo/Hexo博客中插入响应式Bilibili视频代码块_知识星海-CSDN博客</a></p>
</blockquote>
<hr>
<h1>操作</h1>
<ol>
<li>
<p>b站官方已经提供了iframe标签，有些小伙伴可能已经发现了。在网页打开b站视频页时，鼠标移至分享按钮，就可以复制。</p>
<p><img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/bilibilivideo1.png" alt=""></p>
</li>
<li>
<p>只需要在页面中复制该代码即可。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">&quot;//player.bilibili.com/player.html?aid=206890880&amp;bvid=BV1Ah411z7Po&amp;cid=378344365&amp;page=1&quot;</span> <span class="attr">scrolling</span>=<span class="string">&quot;no&quot;</span> <span class="attr">border</span>=<span class="string">&quot;0&quot;</span> <span class="attr">frameborder</span>=<span class="string">&quot;no&quot;</span> <span class="attr">framespacing</span>=<span class="string">&quot;0&quot;</span> <span class="attr">allowfullscreen</span>=<span class="string">&quot;true&quot;</span>&gt;</span> <span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>但是为了在页面上获得更好的显示效果</p>
<ul>
<li>
<p>我们可以在该标签中添加一个css样式：</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">style=&quot;position:absolute; height: 100%; width: 100%;&quot;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>在标签外侧再嵌套一个<code>div</code>标签</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">&lt;div style=&quot;position: relative; width: 100%; height: 0; padding-bottom: 75%;&quot;&gt;</span><br><span class="line">&lt;/<span class="selector-tag">div</span>&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li>
<p>所以最后摆放一个完整的代码：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;position: relative; width: 100%; height: 0; padding-bottom: 75%;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">&quot;//player.bilibili.com/player.html?aid=206890880&amp;bvid=BV1Ah411z7Po&amp;cid=378344365&amp;page=1&quot;</span> <span class="attr">scrolling</span>=<span class="string">&quot;no&quot;</span> <span class="attr">border</span>=<span class="string">&quot;0&quot;</span> <span class="attr">frameborder</span>=<span class="string">&quot;no&quot;</span> <span class="attr">framespacing</span>=<span class="string">&quot;0&quot;</span> <span class="attr">allowfullscreen</span>=<span class="string">&quot;true&quot;</span> <span class="attr">style</span>=<span class="string">&quot;position:absolute; height: 100%; width: 100%;&quot;</span>&gt;</span> <span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>效果如下：</p>
<div style="position: relative; width: 100%; height: 0; padding-bottom: 75%;">
    <iframe src="//player.bilibili.com/player.html?aid=206890880&bvid=BV1Ah411z7Po&cid=378344365&page=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true" style="position:absolute; height: 100%; width: 100%;"> </iframe>
</div>
</li>
</ol>
<hr>
<h1>后记</h1>
<p>还是比较简单的，可以分享一些视频元素。</p>
]]></content>
      <categories>
        <category>博客</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>Hexo文章页透明效果</title>
    <url>/2021/02/19/Hexo%E9%AD%94%E6%94%B9/Hexo%E6%96%87%E7%AB%A0%E9%A1%B5%E9%80%8F%E6%98%8E%E6%95%88%E6%9E%9C/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\css\APlayer.min.css"><script src="\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\js\Meting.min.js"></script><h1>前言</h1>
<p>在不妨碍正常阅读的情况下想更好地展示背景或者一些效果，实现文章页透明是一种不错的选择。</p>
<hr>
<h1>操作</h1>
<ol>
<li>
<p>在<code>\themes\butterfly\source\css</code>路径下创建一个<code>xxx.css</code>文件，在文件中添加如下代码：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* 首页文章栏背景透明 */</span></span><br><span class="line"><span class="selector-id">#recent-posts</span>&gt;<span class="selector-class">.recent-post-item</span>,<span class="selector-class">.layout_page</span>&gt;<span class="selector-tag">div</span><span class="selector-pseudo">:first</span>-child<span class="selector-pseudo">:not</span>(<span class="selector-class">.recent-posts</span>),<span class="selector-class">.layout_post</span>&gt;<span class="selector-id">#page</span>,<span class="selector-class">.layout_post</span>&gt;<span class="selector-id">#post</span>,<span class="selector-class">.read-mode</span> <span class="selector-class">.layout_post</span>&gt;<span class="selector-id">#post</span> &#123;</span><br><span class="line">    <span class="attribute">background</span>: <span class="built_in">var</span>(--light_bg_color)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 侧边栏透明 */</span></span><br><span class="line"><span class="selector-id">#aside-content</span> <span class="selector-class">.card-widget</span> &#123;</span><br><span class="line">    <span class="attribute">background</span>: <span class="built_in">var</span>(--light_bg_color)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>然后将该文件引入到<code>_config.butterfly.yml</code>文件中<code>inject</code>的<code>head</code>处：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="string">&lt;link</span> <span class="string">rel=&quot;stylesheet&quot;</span> <span class="string">href=&quot;/css/xxx.css&quot;&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>至此，重新部署后就可以看到效果啦</p>
<hr>
<h1>结尾</h1>
<p>没得结尾。</p>
]]></content>
      <categories>
        <category>博客</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>Hexo添加两句诗词</title>
    <url>/2021/05/29/Hexo%E9%AD%94%E6%94%B9/Hexo%E6%B7%BB%E5%8A%A0%E4%B8%A4%E5%8F%A5%E8%AF%97%E8%AF%8D/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\css\APlayer.min.css"><script src="\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\js\Meting.min.js"></script><h1>前言</h1>
<p>本文将介绍如何增添随机诗词的展示。</p>
<p>之前在很多主题中见过这类设置，正好最近想在站点添加一个<code>留言</code>页，想着内容太过空洞，于是就把随机诗词搬了过来。</p>
<p>具体效果如下：</p>
<div class="poem-wrap">
  <div class="poem-border poem-left"></div>
  <div class="poem-border poem-right"></div>
    <h>念两句诗</h>
    <p id="poem">挑选中...</p>
    <p id="info">
  <script src="https://sdk.jinrishici.com/v2/browser/jinrishici.js" charset="utf-8"></script>
  <script type="text/javascript">
    jinrishici.load(function(result) {
      poem.innerHTML = result.data.content
      info.innerHTML = '【' + result.data.origin.dynasty + '】' + result.data.origin.author + '《' + result.data.origin.title + '》'
      document.getElementById("poem").value(poem);
      document.getElementById("info").value(info);  
  });
  </script>
</div>
<blockquote>
<p>刷新页面会有变化哦~~~~</p>
</blockquote>
<hr>
<h1>操作</h1>
<ol>
<li>
<p>输入命令<code>hexo n page &quot;Message&quot;</code>在<code>\source</code>文件夹下新建一个<code>Message</code>文件夹（名字可以自定义）</p>
</li>
<li>
<p>进入Message文件夹，编辑<code>index.md</code>文件，添加如下代码：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;poem-wrap&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;poem-border poem-left&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;poem-border poem-right&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h</span>&gt;</span>念两句诗<span class="tag">&lt;/<span class="name">h</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;poem&quot;</span>&gt;</span>挑选中...<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;info&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://sdk.jinrishici.com/v2/browser/jinrishici.js&quot;</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span></span><br><span class="line"><span class="javascript">    jinrishici.load(<span class="function"><span class="keyword">function</span>(<span class="params">result</span>) </span>&#123;</span></span><br><span class="line">      poem.innerHTML = result.data.content</span><br><span class="line"><span class="javascript">      info.innerHTML = <span class="string">&#x27;【&#x27;</span> + result.data.origin.dynasty + <span class="string">&#x27;】&#x27;</span> + result.data.origin.author + <span class="string">&#x27;《&#x27;</span> + result.data.origin.title + <span class="string">&#x27;》&#x27;</span></span></span><br><span class="line"><span class="javascript">      <span class="built_in">document</span>.getElementById(<span class="string">&quot;poem&quot;</span>).value(poem);</span></span><br><span class="line"><span class="javascript">      <span class="built_in">document</span>.getElementById(<span class="string">&quot;info&quot;</span>).value(info);  </span></span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>在<code>\themes\butterfly\source\css\index.styl</code>中添加以下代码（直接在底部添加）：</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*诗*/</span></span><br><span class="line"><span class="selector-class">.poem-wrap</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">730px</span>;</span><br><span class="line">    <span class="attribute">max-width</span>: <span class="number">80%</span>;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">2px</span> solid <span class="number">#797979</span>;</span><br><span class="line">    <span class="attribute">border-top</span>: none;</span><br><span class="line">    <span class="attribute">text-align</span>: center;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">80px</span> auto;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="selector-class">.poem-wrap</span> h &#123;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">40px</span>;</span><br><span class="line">    <span class="attribute">font-style</span>:oblique;</span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line">    <span class="attribute">margin-top</span>: -<span class="number">40px</span>;</span><br><span class="line">    <span class="attribute">display</span>: inline-block;</span><br><span class="line">    <span class="attribute">letter-spacing</span>: <span class="number">4px</span>;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#797979</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="selector-class">.poem-wrap</span> <span class="selector-tag">p</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">70%</span>;</span><br><span class="line">    <span class="attribute">margin</span>: auto;</span><br><span class="line">    <span class="attribute">line-height</span>: <span class="number">30px</span>;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#797979</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="selector-class">.poem-wrap</span> p<span class="selector-id">#poem</span> &#123;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">22px</span>;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">15px</span> auto;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="selector-class">.poem-wrap</span> p<span class="selector-id">#info</span> &#123;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">15px</span>;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">15px</span> auto;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="selector-class">.poem-border</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">2px</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">27%</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#797979</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="selector-class">.poem-right</span> &#123;</span><br><span class="line">    <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="selector-class">.poem-left</span> &#123;</span><br><span class="line">    <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">@media</span> (<span class="attribute">max-width</span>: <span class="number">685px</span>) &#123;</span><br><span class="line">    <span class="selector-class">.poem-border</span> &#123;</span><br><span class="line">        <span class="attribute">width</span>: <span class="number">18%</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">@media</span> (<span class="attribute">max-width</span>: <span class="number">500px</span>) &#123;</span><br><span class="line">    <span class="selector-class">.poem-wrap</span> &#123;</span><br><span class="line">        <span class="attribute">margin-top</span>: <span class="number">60px</span>;</span><br><span class="line">        <span class="attribute">margin-bottom</span>: <span class="number">20px</span>;</span><br><span class="line">        <span class="attribute">border-top</span>: <span class="number">2px</span> solid <span class="number">#797979</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="selector-class">.poem-wrap</span> h &#123;</span><br><span class="line">        <span class="attribute">margin</span>: <span class="number">20px</span> <span class="number">6px</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="selector-class">.poem-border</span> &#123;</span><br><span class="line">        <span class="attribute">display</span>: none;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>找到主题配置文件<code>_config.butterfly.yml</code>，在<code>menu</code>位置中添加留言页面的连接：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">menu:</span></span><br><span class="line">  <span class="string">留言:</span> <span class="string">/Message/</span> <span class="string">||</span> <span class="string">fas</span> <span class="string">fa-comment</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>重新部署，就可以看到效果啦。</p>
</li>
</ol>
<hr>
<h1>后记</h1>
<p>这里调用的是<code>今日诗词API</code>，是一个可以返回一句古诗词名句的接口。</p>
<p>它可以通过图片和 JSON 格式调用。今日诗词 API 根据不同地点、时间、节日、季节、天气、景观、城市进行智能推荐。</p>
<p>访问链接：<a href="https://www.jinrishici.com/">https://www.jinrishici.com/</a></p>
<p>可以访问：<a href="https://v2.jinrishici.com/one.json">https://v2.jinrishici.com/one.json</a> 查看效果</p>
]]></content>
      <categories>
        <category>博客</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>Hexo添加动态线条效果背景</title>
    <url>/2021/02/19/Hexo%E9%AD%94%E6%94%B9/Hexo%E6%B7%BB%E5%8A%A0%E5%8A%A8%E6%80%81%E7%BA%BF%E6%9D%A1%E6%95%88%E6%9E%9C%E8%83%8C%E6%99%AF/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\css\APlayer.min.css"><script src="\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\js\Meting.min.js"></script><h1>前言</h1>
<p>效果如本站所示，我看过一些博客，有很多一部分都有这个动线效果背景。于是查一查相关文章自己也搞起来。</p>
<hr>
<h1>操作</h1>
<p>操作步骤很简单，只需在<code>_config.butterfly.yml</code>文件中，找到<code>inject</code>，在<code>bottom</code>处直接引入：<a href="https://cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js">https://cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js</a></p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="string">&lt;script</span> <span class="string">src=&quot;https://cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js&quot;&gt;&lt;/script&gt;</span> <span class="comment"># 背景动态线条</span></span><br></pre></td></tr></table></figure>
<p>之后重新部署就可以看到效果啦。</p>
<hr>
<h1>结尾</h1>
<p>越玩越感谢并敬佩各路大神的操作，让我可以如此轻松的DIY。</p>
]]></content>
      <categories>
        <category>博客</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>Hexo添加当前访客信息</title>
    <url>/2021/05/28/Hexo%E9%AD%94%E6%94%B9/Hexo%E6%B7%BB%E5%8A%A0%E5%BD%93%E5%89%8D%E8%AE%BF%E5%AE%A2%E4%BF%A1%E6%81%AF/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\css\APlayer.min.css"><script src="\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\js\Meting.min.js"></script><h1>前言</h1>
<p>本文将介绍如何在主页侧边栏添加当前访客信息，具体效果如下：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/%E5%BD%93%E5%89%8D%E8%AE%BF%E5%AE%A2%E4%BF%A1%E6%81%AF%E5%B1%95%E7%A4%BA.png" alt=""></p>
<blockquote>
<p>教程链接：<a href="https://zykj.js.org/posts/e55bad60/">Hexo博客搭建 与 美化教程 | 卓越科技的Blog (zykj.js.org)</a></p>
</blockquote>
<hr>
<h1>操作</h1>
<div class="note info flat"><p>注意：必须确保使用了<a href="https://cnhuazhu.gitee.io/2021/05/28/Hexo%E9%AD%94%E6%94%B9/Hexotag-%E5%A4%96%E6%8C%82%E6%A0%87%E7%AD%BE/">Hexo tag 外挂标签</a>的<code>span的样式</code>（👈点击跳转），否则显示的内容没有彩色样式。</p>
</div>
<ol>
<li>
<p>在 <code>themes\Butterfly\layout\includes\widget\</code> 下创建 <code>card_ip.pug</code> 文件，并写入以下内容：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">.card-widget.card-ip</span><br><span class="line">  .card-content</span><br><span class="line">  .item-headline</span><br><span class="line">    i.fa.fa-user(aria-hidden&#x3D;&quot;true&quot;)</span><br><span class="line">    span&#x3D; _p(&#39;aside.card_ip&#39;)</span><br><span class="line">  .ip_content</span><br><span class="line">   &#x3D; _p(&#39;欢迎来自 &#39;)</span><br><span class="line">   span(class&#x3D;&quot;p red&quot;)&#x3D; _p(&#39;未知区域&#39;)</span><br><span class="line">   &#x3D; _p(&#39; 的小伙伴&#39;)</span><br><span class="line">   br</span><br><span class="line">   &#x3D; _p(&#39;访问IP为： &#39;)</span><br><span class="line">   span(class&#x3D;&quot;p cyan&quot;)&#x3D; _p(&#39;未知IP&#39;)</span><br><span class="line">   br</span><br><span class="line">   &#x3D; _p(&#39;浏览器版本：&#39;)</span><br><span class="line">   span(class&#x3D;&quot;p blue&quot;)&#x3D; _p(&#39;未知浏览器&#39;)</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>在 <code>themes\Butterfly\layout\includes\widget\index.pug</code>中添加如下内容：</p>
<p>如果主题版本小于3.6，添加如下内容</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">if theme.aside.card_ip</span><br><span class="line">    !&#x3D;partial(&#39;includes&#x2F;widget&#x2F;card_ip&#39;, &#123;&#125;, &#123;cache: theme.fragment_cache&#125;)</span><br></pre></td></tr></table></figure>
<p>如果主题版本大于3.6，添加如下内容</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">if theme.aside.card_ip</span><br><span class="line">    !&#x3D;partial(&#39;includes&#x2F;widget&#x2F;card_ip&#39;, &#123;&#125;, &#123; cache:true &#125;)</span><br></pre></td></tr></table></figure>
<p>具体添加位置如下图所示：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/%E8%AE%BF%E5%AE%A2%E4%BF%A1%E6%81%AF%E4%BB%A3%E7%A0%81%E4%BD%8D%E7%BD%AE.png" alt=""></p>
</li>
<li>
<p>编辑 <code>themes\Butterfly\languages\zh-CN.yml</code> 文件，在 <code>aside</code> 处添加<code>card_ip: 当前访问用户</code>代码（如下）：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">aside:</span><br><span class="line">  card_ip: 当前访问用户</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>配置主题文件<code>_config.butterfly.yml</code>，在<code>aside</code> 处添加<code>card_ip: true</code>代码（如下）：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">aside:</span><br><span class="line">  card_ip: true</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>在 <code>themes\Butterfly\source\js</code> 下创建 <code>ip_content.js</code>，并添加如下内容：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//获取当前IP地址和浏览器标识</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getBrowserInfo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> agent = navigator.userAgent.toLowerCase();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> regStr_ie = <span class="regexp">/msie [\d.]+;/gi</span>;</span><br><span class="line">    <span class="keyword">var</span> regStr_ff = <span class="regexp">/firefox\/[\d.]+/gi</span></span><br><span class="line">    <span class="keyword">var</span> regStr_chrome = <span class="regexp">/chrome\/[\d.]+/gi</span>;</span><br><span class="line">    <span class="keyword">var</span> regStr_saf = <span class="regexp">/safari\/[\d.]+/gi</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//IE</span></span><br><span class="line">    <span class="keyword">if</span> (agent.indexOf(<span class="string">&quot;msie&quot;</span>) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> agent.match(regStr_ie);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//firefox</span></span><br><span class="line">    <span class="keyword">if</span> (agent.indexOf(<span class="string">&quot;firefox&quot;</span>) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> agent.match(regStr_ff);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Chrome</span></span><br><span class="line">    <span class="keyword">if</span> (agent.indexOf(<span class="string">&quot;chrome&quot;</span>) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> agent.match(regStr_chrome);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Safari</span></span><br><span class="line">    <span class="keyword">if</span> (agent.indexOf(<span class="string">&quot;safari&quot;</span>) &gt; <span class="number">0</span> &amp;&amp; agent.indexOf(<span class="string">&quot;chrome&quot;</span>) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> agent.match(regStr_saf);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> ip_content = <span class="built_in">document</span>.querySelector(<span class="string">&quot;.ip_content&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (ip_content != <span class="literal">null</span> &amp;&amp; <span class="keyword">typeof</span> (returnCitySN) != <span class="literal">undefined</span>) &#123;</span><br><span class="line">    ip_content.innerHTML = <span class="string">&#x27;欢迎来自 &lt;span class=&quot;p red&quot;&gt;&#x27;</span> + returnCitySN[<span class="string">&quot;cname&quot;</span>] + <span class="string">&quot;&lt;/span&gt; 的小伙伴&lt;br&gt;&quot;</span> + <span class="string">&quot;访问IP为： &lt;span class=&#x27;p cyan&#x27;&gt;&quot;</span> + returnCitySN[<span class="string">&quot;cip&quot;</span>] + <span class="string">&quot;&lt;/span&gt;&lt;br&gt;浏览器版本：&lt;span class=&#x27;p blue&#x27;&gt;&quot;</span> + getBrowserInfo() + <span class="string">&#x27;&lt;/span&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>配置主题文件<code>_config.butterfly.yml</code>，在<code>inject</code>的<code>bottom</code>处引入以下内容：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">bottom:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&lt;script</span> <span class="string">src=&quot;https://pv.sohu.com/cityjson?ie=utf-8&quot;&gt;&lt;/script&gt;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&lt;script</span> <span class="string">src=&quot;/js/ip_content.js&quot;&gt;&lt;/script&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>至此完成配置，重新部署博客看看效果吧。</p>
</li>
</ol>
<hr>
<h1>后记</h1>
<p>ip位置通过访问：<a href="https://pv.sohu.com/cityjson?ie=utf-8">https://pv.sohu.com/cityjson?ie=utf-8</a> 获得。</p>
]]></content>
      <categories>
        <category>博客</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>Hexo添加自定义静态网页</title>
    <url>/2021/05/28/Hexo%E9%AD%94%E6%94%B9/Hexo%E6%B7%BB%E5%8A%A0%E8%87%AA%E5%AE%9A%E4%B9%89%E9%9D%99%E6%80%81%E7%BD%91%E9%A1%B5/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\css\APlayer.min.css"><script src="\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\js\Meting.min.js"></script><h1>前言</h1>
<p>不局限于Hexo站点的几个特定页面，可以自行添加静态Html页面，打开新世界的大门。</p>
<p>示例：<a href="https://cnhuazhu.top/blog-LeadPage/" title="引导页面">花猪のBlog引导页面</a>（点击顶部栏“引导”按钮也可以跳转）</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/Hexo%E8%87%AA%E5%AE%9A%E4%B9%89html%E9%A1%B5%E9%9D%A2.png" alt=""></p>
<blockquote>
<p>教程连接：<a href="https://blog.csdn.net/victoryxa/article/details/105841440">Hexo+Github博客搭建之Matery主题个性化修改篇（二）_过客~励む-CSDN博客_matery主题修改</a></p>
</blockquote>
<hr>
<h1>操作</h1>
<ol>
<li>
<p>在站点目录下的<code>/source</code>目录下新建一个<code>blog-LeadPage</code>文件夹（文件夹名字可以自定义），在其中添加写好的<code>index.html</code>文件（关于js、css文件的位置可以在同一目录，也可以放于其他位置，只要保证index.html引用到就好）</p>
</li>
<li>
<p>找到主题配置文件<code>_config.butterfly.yml</code>，在<code>menu</code>位置中添加页面的连接</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/Hexo%E8%87%AA%E5%AE%9A%E4%B9%89html%E9%A1%B5%E9%9D%A2%E8%BF%9E%E6%8E%A5%E4%B9%A6%E5%86%99.png" alt=""></p>
</li>
<li>
<p>找到主题配置文件<code>_config.yml</code>，在<code>skip_render</code>位置添加属性</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">skip_render:</span> </span><br><span class="line">    <span class="bullet">-</span> <span class="string">blog-LeadPage/**</span>  <span class="comment"># 表示blog-LeadPage文件里面的内容不会被站点渲染</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>至此，重新部署，就可以看到自己DIY的页面了</p>
</li>
</ol>
<hr>
<h1>后记</h1>
<p>当然也可以将静态页面放在其他站点，比如下面一个链接就是我在gitee重新创建了一个仓库，利用Page服务渲染出来的，效果一样。</p>
<p>gitee链接：<a href="http://cnhuazhu.gitee.io/blog-lead-page">http://cnhuazhu.gitee.io/blog-lead-page</a></p>
<p>如此一来DIY的空间就又拓展了一大步。</p>
]]></content>
      <categories>
        <category>博客</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>Hexo添加雪花动态效果背景</title>
    <url>/2021/02/24/Hexo%E9%AD%94%E6%94%B9/Hexo%E6%B7%BB%E5%8A%A0%E9%9B%AA%E8%8A%B1%E5%8A%A8%E6%80%81%E6%95%88%E6%9E%9C%E8%83%8C%E6%99%AF/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\css\APlayer.min.css"><script src="\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\js\Meting.min.js"></script><h1>前言</h1>
<p>偶然间看到名为<code>Ln</code>的博客界面，感觉这个雪花动效好美哦，之前也看过好多下雪效果，感觉个人唯独中意这款。</p>
<blockquote>
<p>教程链接：<a href="https://weilining.cf/112.html">https://weilining.cf/112.html</a></p>
</blockquote>
<hr>
<h1>操作</h1>
<p>操作过程很简单，找到主题配置文件<code>_config.butterfly.yml</code>，在<code>inject</code>的<code>bottom</code>引入以下js文件:</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">inject:</span></span><br><span class="line">  <span class="attr">head:</span></span><br><span class="line">  <span class="attr">bottom:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&lt;div&gt;&lt;canvas</span> <span class="string">id=&quot;snow&quot;</span> <span class="string">style=&quot;position:fixed;top:0;left:0;width:100%;height:100%;z-index:99999;pointer-events:none&quot;&gt;&lt;/canvas&gt;&lt;/div&gt;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&lt;script&gt;const</span> <span class="string">notMobile</span> <span class="string">=</span> <span class="string">(!(navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows</span> <span class="string">Phone)/i)));&lt;/script&gt;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&lt;script</span> <span class="string">async</span> <span class="string">type=&quot;text/javascript&quot;</span> <span class="string">src=&quot;https://cdn.jsdelivr.net/gh/Candinya/Kratos-Rebirth@latest/source/js/snow.min.js&quot;&gt;&lt;/script&gt;</span></span><br></pre></td></tr></table></figure>
<p>重新部署，启动就可以看见啦。</p>
<hr>
<h1>其他下雪动效</h1>
<p>顺便把之前找到过的一款下雪动效的操作方法也写出来，喜欢的可以拿去</p>
<h2 id="六边形雪片">六边形雪片</h2>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/snow.png" alt=""></p>
<p>操作过程也很简单，在<code>\themes\butterfly\source\js</code>目录下新建一个<code>snow.js</code>文件，然后将以下内容写入该文件：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">$</span>)</span>&#123;</span><br><span class="line">    $.fn.snow = <span class="function"><span class="keyword">function</span>(<span class="params">options</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> $flake = $(<span class="string">&#x27;&lt;div id=&quot;snowbox&quot; /&gt;&#x27;</span>).css(&#123;<span class="string">&#x27;position&#x27;</span>: <span class="string">&#x27;absolute&#x27;</span>,<span class="string">&#x27;z-index&#x27;</span>:<span class="string">&#x27;9999&#x27;</span>, <span class="string">&#x27;top&#x27;</span>: <span class="string">&#x27;-50px&#x27;</span>&#125;).html(<span class="string">&#x27;&amp;#10052;&#x27;</span>),</span><br><span class="line">    documentHeight  = $(<span class="built_in">document</span>).height(),</span><br><span class="line">    documentWidth   = $(<span class="built_in">document</span>).width(),</span><br><span class="line">    defaults = &#123;</span><br><span class="line">        minSize     : <span class="number">10</span>,</span><br><span class="line">        maxSize     : <span class="number">20</span>,</span><br><span class="line">        newOn       : <span class="number">1000</span>,</span><br><span class="line">        flakeColor  : <span class="string">&quot;#AFDAEF&quot;</span> <span class="comment">/* 此处可以定义雪花颜色，若要白色可以改为#FFFFFF */</span></span><br><span class="line">    &#125;,</span><br><span class="line">    options = $.extend(&#123;&#125;, defaults, options);</span><br><span class="line">    <span class="keyword">var</span> interval= <span class="built_in">setInterval</span>( <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> startPositionLeft = <span class="built_in">Math</span>.random() * documentWidth - <span class="number">100</span>,</span><br><span class="line">    startOpacity = <span class="number">0.5</span> + <span class="built_in">Math</span>.random(),</span><br><span class="line">    sizeFlake = options.minSize + <span class="built_in">Math</span>.random() * options.maxSize,</span><br><span class="line">    endPositionTop = documentHeight - <span class="number">200</span>,</span><br><span class="line">    endPositionLeft = startPositionLeft - <span class="number">500</span> + <span class="built_in">Math</span>.random() * <span class="number">500</span>,</span><br><span class="line">    durationFall = documentHeight * <span class="number">10</span> + <span class="built_in">Math</span>.random() * <span class="number">5000</span>;</span><br><span class="line">    $flake.clone().appendTo(<span class="string">&#x27;body&#x27;</span>).css(&#123;</span><br><span class="line">        left: startPositionLeft,</span><br><span class="line">        opacity: startOpacity,</span><br><span class="line">        <span class="string">&#x27;font-size&#x27;</span>: sizeFlake,</span><br><span class="line">        color: options.flakeColor</span><br><span class="line">    &#125;).animate(&#123;</span><br><span class="line">        top: endPositionTop,</span><br><span class="line">        left: endPositionLeft,</span><br><span class="line">        opacity: <span class="number">0.2</span></span><br><span class="line">    &#125;,durationFall,<span class="string">&#x27;linear&#x27;</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        $(<span class="built_in">this</span>).remove()</span><br><span class="line">    &#125;);</span><br><span class="line">    &#125;, options.newOn);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;)(jQuery);</span><br><span class="line">$(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    $.fn.snow(&#123; </span><br><span class="line">        minSize: <span class="number">5</span>, <span class="comment">/* 定义雪花最小尺寸 */</span></span><br><span class="line">        maxSize: <span class="number">50</span>,<span class="comment">/* 定义雪花最大尺寸 */</span></span><br><span class="line">        newOn: <span class="number">300</span>  <span class="comment">/* 定义密集程度，数字越小越密集 */</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>然后将该js文件引入主题配置文件<code>_config.butterfly.yml</code>，同样在在<code>inject</code>的<code>bottom</code>处：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">inject:</span></span><br><span class="line">  <span class="attr">head:</span></span><br><span class="line">  <span class="attr">bottom:</span></span><br><span class="line">	<span class="bullet">-</span> <span class="string">&lt;script</span> <span class="string">src=&quot;/js/snow.js&quot;&gt;&lt;/script&gt;</span> <span class="comment"># 下雪动效</span></span><br></pre></td></tr></table></figure>
<p>重新部署，启动，就可以看到效果啦。</p>
<hr>
<h1>结尾</h1>
<p>把之前无比喜爱的樱花🌸动效换掉了，也许碰到更好看的就把这个也换掉啦。</p>
]]></content>
      <categories>
        <category>博客</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>Hexo添加首页置顶轮播图</title>
    <url>/2021/03/28/Hexo%E9%AD%94%E6%94%B9/Hexo%E6%B7%BB%E5%8A%A0%E9%A6%96%E9%A1%B5%E7%BD%AE%E9%A1%B6%E8%BD%AE%E6%92%AD%E5%9B%BE/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\css\APlayer.min.css"><script src="\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\js\Meting.min.js"></script><h1>前言</h1>
<p>在写系列博文时对于某一篇文章的寻找过程会比较繁琐（对于博主而言自然会简单些，但是对于访客来讲就没那么轻松），因此参考Akilar的博文弄了一个置顶轮播图。可以把系列博文的链接汇总起来做一个索引，放置在轮播图中。这样既可以展示博主想对外展示的内容，又方便快速进行文章跳转。</p>
<p>效果可以在博客首页查看。</p>
<blockquote>
<p>本篇教程会涉及大量源码的改动，对缩进有严格要求。如果需要，可以移步下方链接至Akilar的博客教程去下载源码。</p>
<p>教程链接：《Slider Bar》<a href="https://akilar.top/posts/8e1264d1/">https://akilar.top/posts/8e1264d1/</a></p>
</blockquote>
<hr>
<h1>操作</h1>
<ol>
<li>
<p>在<code>\themes\butterfly\layout\includes</code>路径下创建文件<code>sliderbar.pug</code>，并将以下内容写入该文件：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">.blog-slider.swiper-container-fade.swiper-container-horizontal#swiper_container</span><br><span class="line">  .blog-slider__wrp.swiper-wrapper(style=&#x27;transition-duration: 0ms;&#x27;)</span><br><span class="line">    if site.data.slider</span><br><span class="line">      each i in site.data.slider</span><br><span class="line">        .blog-slider__item.swiper-slide(style=&#x27;width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;&#x27;)</span><br><span class="line">          a.blog-slider__img(href=url_for(i.link)  alt=&#x27;&#x27;)|</span><br><span class="line">            img(width=&#x27;48&#x27; height=&#x27;48&#x27; src=url_for(i.cover) onerror=`this.onerror=null;this.src=&#x27;` + url_for(theme.error_img.post_page) + `&#x27;`, alt=&#x27;&#x27;)</span><br><span class="line">          .blog-slider__content</span><br><span class="line">            span.blog-slider__code= i.timeline</span><br><span class="line">            a.blog-slider__title(href=url_for(i.link)  alt=&#x27;&#x27;)= i.title</span><br><span class="line">            .blog-slider__text= i.description</span><br><span class="line">            a.blog-slider__button(href=url_for(i.link)  alt=&#x27;&#x27;)= i.button      </span><br><span class="line">  .blog-slider__pagination.swiper-pagination-clickable.swiper-pagination-bullets</span><br><span class="line">script(defer src=url_for(theme.CDN.swiper_js))</span><br><span class="line">script(defer data-pjax src=url_for(theme.CDN.swiper_init))</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>在路径<code>\themes\butterfly\layout</code>修改文件<code>index.pug</code>，添加以下两行代码（注意缩进）引入轮播图板块。</p>
<p>注意在<code>butterfly_v3.6.0</code>中取消了缓存配置，需要将<code>&#123;cache:theme.fragment_cache&#125;</code>改为<code>&#123;cache: true&#125;</code></p>
<figure class="highlight diff"><table><tr><td class="code"><pre><span class="line">.recent-post-item(style=&#x27;height:auto;width:100%;&#x27;)</span><br><span class="line">  !=partial(&#x27;includes/sliderbar&#x27;, &#123;&#125;, &#123;cache:theme.fragment_cache&#125;)</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/LBT1.png" alt=""></p>
</li>
<li>
<p>在<code>\themes\butterfly\source\js</code>路径下，新建文件<code>swiper_init.js</code>，并将以下代码写入：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> swiper = <span class="keyword">new</span> Swiper(<span class="string">&#x27;.blog-slider&#x27;</span>, &#123;</span><br><span class="line">  passiveListeners: <span class="literal">true</span>,</span><br><span class="line">  spaceBetween: <span class="number">30</span>,</span><br><span class="line">  effect: <span class="string">&#x27;fade&#x27;</span>,</span><br><span class="line">  loop: <span class="literal">true</span>,</span><br><span class="line">  autoplay: &#123;</span><br><span class="line">    disableOnInteraction: <span class="literal">true</span>,</span><br><span class="line">    delay: <span class="number">3000</span></span><br><span class="line">  &#125;,</span><br><span class="line">  mousewheel: <span class="literal">false</span>,</span><br><span class="line">  <span class="comment">// autoHeight: true,</span></span><br><span class="line">  pagination: &#123;</span><br><span class="line">    el: <span class="string">&#x27;.blog-slider__pagination&#x27;</span>,</span><br><span class="line">    clickable: <span class="literal">true</span>,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> comtainer = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;swiper_container&#x27;</span>);</span><br><span class="line">comtainer.onmouseenter = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  swiper.autoplay.stop();</span><br><span class="line">&#125;;</span><br><span class="line">comtainer.onmouseleave = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  swiper.autoplay.start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>在<code>\themes\butterfly\source\css\_layout</code>路径下，创建文件<code>swiperstyle.styl</code>，并将以下代码写入：</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">*</span><br><span class="line">  <span class="attribute">box-sizing</span> border-box</span><br><span class="line">div#swiper_container</span><br><span class="line">  <span class="attribute">background</span> rgba(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>);</span><br><span class="line">.blog-slider</span><br><span class="line">  <span class="attribute">width</span> <span class="number">100%</span></span><br><span class="line">  <span class="attribute">position</span> relative</span><br><span class="line">  <span class="attribute">border-radius</span> <span class="number">12px</span> <span class="number">8px</span> <span class="number">8px</span> <span class="number">12px</span></span><br><span class="line">  <span class="attribute">margin</span> auto</span><br><span class="line">  <span class="attribute">background</span> var(--global-bg)</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">10px</span></span><br><span class="line">  transition all .3s</span><br><span class="line"></span><br><span class="line">.blog-slider__item</span><br><span class="line">  <span class="attribute">display</span> flex</span><br><span class="line">  <span class="attribute">align-items</span> center</span><br><span class="line">  &amp;.swiper-slide-active</span><br><span class="line">    .blog-slider__img</span><br><span class="line">      img</span><br><span class="line">        <span class="attribute">opacity</span> <span class="number">1</span></span><br><span class="line">        transition-delay .3s</span><br><span class="line">    .blog-slider__content</span><br><span class="line">      &amp; &gt; *</span><br><span class="line">        <span class="attribute">opacity</span> <span class="number">1</span></span><br><span class="line">        <span class="attribute">transform</span> none</span><br><span class="line">      &amp; &gt; *<span class="selector-pseudo">:nth-child</span>(<span class="number">1</span>)</span><br><span class="line">        <span class="attribute">transition-delay</span> <span class="number">0.3s</span></span><br><span class="line">      &amp; &gt; *<span class="selector-pseudo">:nth-child</span>(<span class="number">2</span>)</span><br><span class="line">        <span class="attribute">transition-delay</span> <span class="number">0.4s</span></span><br><span class="line">      &amp; &gt; *<span class="selector-pseudo">:nth-child</span>(<span class="number">3</span>)</span><br><span class="line">        <span class="attribute">transition-delay</span> <span class="number">0.5s</span></span><br><span class="line">      &amp; &gt; *<span class="selector-pseudo">:nth-child</span>(<span class="number">4</span>)</span><br><span class="line">        <span class="attribute">transition-delay</span> <span class="number">0.6s</span></span><br><span class="line">      &amp; &gt; *<span class="selector-pseudo">:nth-child</span>(<span class="number">5</span>)</span><br><span class="line">        <span class="attribute">transition-delay</span> <span class="number">0.7s</span></span><br><span class="line">      &amp; &gt; *<span class="selector-pseudo">:nth-child</span>(<span class="number">6</span>)</span><br><span class="line">        <span class="attribute">transition-delay</span> <span class="number">0.8s</span></span><br><span class="line">      &amp; &gt; *<span class="selector-pseudo">:nth-child</span>(<span class="number">7</span>)</span><br><span class="line">        <span class="attribute">transition-delay</span> <span class="number">0.9s</span></span><br><span class="line">      &amp; &gt; *<span class="selector-pseudo">:nth-child</span>(<span class="number">8</span>)</span><br><span class="line">        <span class="attribute">transition-delay</span> <span class="number">1s</span></span><br><span class="line">      &amp; &gt; *<span class="selector-pseudo">:nth-child</span>(<span class="number">9</span>)</span><br><span class="line">        <span class="attribute">transition-delay</span> <span class="number">1.1s</span></span><br><span class="line">      &amp; &gt; *<span class="selector-pseudo">:nth-child</span>(<span class="number">10</span>)</span><br><span class="line">        <span class="attribute">transition-delay</span> <span class="number">1.2s</span></span><br><span class="line">      &amp; &gt; *<span class="selector-pseudo">:nth-child</span>(<span class="number">11</span>)</span><br><span class="line">        <span class="attribute">transition-delay</span> <span class="number">1.3s</span></span><br><span class="line">      &amp; &gt; *<span class="selector-pseudo">:nth-child</span>(<span class="number">12</span>)</span><br><span class="line">        <span class="attribute">transition-delay</span> <span class="number">1.4s</span></span><br><span class="line">      &amp; &gt; *<span class="selector-pseudo">:nth-child</span>(<span class="number">13</span>)</span><br><span class="line">        <span class="attribute">transition-delay</span> <span class="number">1.5s</span></span><br><span class="line">      &amp; &gt; *<span class="selector-pseudo">:nth-child</span>(<span class="number">14</span>)</span><br><span class="line">        <span class="attribute">transition-delay</span> <span class="number">1.6s</span></span><br><span class="line">      &amp; &gt; *<span class="selector-pseudo">:nth-child</span>(<span class="number">15</span>)</span><br><span class="line">        <span class="attribute">transition-delay</span> <span class="number">1.7s</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">.blog-slider__img</span><br><span class="line">  <span class="attribute">width</span> <span class="number">200px</span></span><br><span class="line">  <span class="attribute">flex-shrink</span> <span class="number">0</span></span><br><span class="line">  <span class="attribute">height</span> <span class="number">200px</span></span><br><span class="line">  <span class="attribute">padding</span> <span class="number">10px</span></span><br><span class="line">  <span class="attribute">border-radius</span> <span class="number">5px</span></span><br><span class="line">  <span class="attribute">transform</span> translateX(<span class="number">0px</span>)</span><br><span class="line">  <span class="attribute">overflow</span> hidden</span><br><span class="line">  &amp;:after</span><br><span class="line">    <span class="attribute">content</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="attribute">position</span> absolute</span><br><span class="line">    <span class="attribute">top</span> <span class="number">0</span></span><br><span class="line">    <span class="attribute">left</span> <span class="number">0</span></span><br><span class="line">    <span class="attribute">width</span> <span class="number">100%</span></span><br><span class="line">    <span class="attribute">height</span> <span class="number">100%</span></span><br><span class="line">    <span class="attribute">border-radius</span> <span class="number">5px</span></span><br><span class="line">    <span class="attribute">opacity</span> <span class="number">0.8</span></span><br><span class="line">  img</span><br><span class="line">    <span class="attribute">width</span> <span class="number">100%</span></span><br><span class="line">    <span class="attribute">height</span> <span class="number">100%</span></span><br><span class="line">    <span class="attribute">object-fit</span> cover</span><br><span class="line">    <span class="attribute">display</span> block</span><br><span class="line">    <span class="attribute">opacity</span> <span class="number">0</span></span><br><span class="line">    <span class="attribute">border-radius</span> <span class="number">5px</span></span><br><span class="line">    transition all .3s</span><br><span class="line"></span><br><span class="line">.blog-slider__content</span><br><span class="line">  <span class="attribute">padding-right</span> <span class="number">50px</span></span><br><span class="line">  <span class="attribute">padding-left</span> <span class="number">50px</span></span><br><span class="line">  &amp; &gt; *</span><br><span class="line">    <span class="attribute">opacity</span> <span class="number">0</span></span><br><span class="line">    <span class="attribute">transform</span> translateY(<span class="number">25px</span>)</span><br><span class="line">    transition all .4s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">.blog-slider__code</span><br><span class="line">  <span class="attribute">color</span> var(--font-color)</span><br><span class="line">  <span class="attribute">margin-bottom</span> <span class="number">0px</span></span><br><span class="line">  <span class="attribute">display</span> block</span><br><span class="line">  <span class="attribute">font-weight</span> <span class="number">500</span></span><br><span class="line"></span><br><span class="line">.blog-slider__title</span><br><span class="line">  <span class="attribute">font-size</span> <span class="number">18px</span></span><br><span class="line">  <span class="attribute">font-weight</span> <span class="number">700</span></span><br><span class="line">  <span class="attribute">color</span> var(--font-color)</span><br><span class="line">  <span class="attribute">margin-bottom</span> <span class="number">15px</span></span><br><span class="line">  -webkit-line-clamp <span class="number">1</span></span><br><span class="line">  <span class="attribute">display</span> -webkit-box</span><br><span class="line">  <span class="attribute">overflow</span> hidden</span><br><span class="line">  -webkit-box-orient vertical</span><br><span class="line"></span><br><span class="line">.blog-slider__text</span><br><span class="line">  <span class="attribute">color</span> var(--font-color)</span><br><span class="line">  -webkit-line-clamp <span class="number">1</span></span><br><span class="line">  <span class="attribute">display</span> -webkit-box</span><br><span class="line">  <span class="attribute">overflow</span> hidden</span><br><span class="line">  -webkit-box-orient vertical</span><br><span class="line">  <span class="attribute">margin-bottom</span> <span class="number">15px</span></span><br><span class="line">  <span class="attribute">line-height</span> <span class="number">1.5em</span></span><br><span class="line">  <span class="attribute">width</span> <span class="number">100%</span></span><br><span class="line">  <span class="attribute">display</span> block</span><br><span class="line">  <span class="attribute">word-break</span> break-all</span><br><span class="line">  <span class="attribute">word-wrap</span> break-word</span><br><span class="line"></span><br><span class="line">.blog-slider__button</span><br><span class="line">  <span class="attribute">display</span> inline-flex</span><br><span class="line">  <span class="attribute">background-color</span> var(--btn-bg)</span><br><span class="line">  <span class="attribute">padding</span> <span class="number">4px</span> <span class="number">14px</span></span><br><span class="line">  <span class="attribute">border-radius</span> <span class="number">8px</span></span><br><span class="line">  <span class="attribute">color</span> var(--btn-color)</span><br><span class="line">  <span class="attribute">text-decoration</span> none</span><br><span class="line">  <span class="attribute">font-weight</span> <span class="number">500</span></span><br><span class="line">  <span class="attribute">justify-content</span> center</span><br><span class="line">  <span class="attribute">text-align</span> center</span><br><span class="line">  <span class="attribute">letter-spacing</span> <span class="number">1px</span></span><br><span class="line">  <span class="attribute">display</span> none</span><br><span class="line">  &amp;:hover</span><br><span class="line">    <span class="attribute">background-color</span> var(--btn-hover-color)</span><br><span class="line">    <span class="attribute">color</span> var(--btn-color)</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.blog-slider</span> <span class="selector-class">.swiper-container-horizontal</span> &gt; <span class="selector-class">.swiper-pagination-bullets</span>, <span class="selector-class">.blog-slider</span> <span class="selector-class">.swiper-pagination-custom</span>, <span class="selector-class">.blog-slider</span> .swiper-pagination-fraction</span><br><span class="line">  <span class="attribute">bottom</span> <span class="number">10px</span></span><br><span class="line">  <span class="attribute">left</span> <span class="number">0</span></span><br><span class="line">  <span class="attribute">width</span> <span class="number">100%</span></span><br><span class="line"></span><br><span class="line">.blog-slider__pagination</span><br><span class="line">  <span class="attribute">position</span> absolute</span><br><span class="line">  <span class="attribute">z-index</span> <span class="number">21</span></span><br><span class="line">  <span class="attribute">right</span> <span class="number">20px</span></span><br><span class="line">  <span class="attribute">width</span> <span class="number">11px</span> <span class="meta">!important</span></span><br><span class="line">  <span class="attribute">text-align</span> center</span><br><span class="line">  <span class="attribute">left</span> auto <span class="meta">!important</span></span><br><span class="line">  <span class="attribute">top</span> <span class="number">50%</span></span><br><span class="line">  <span class="attribute">bottom</span> auto <span class="meta">!important</span></span><br><span class="line">  <span class="attribute">transform</span> translateY(-<span class="number">50%</span>)</span><br><span class="line">  &amp;.swiper-pagination-bullets</span><br><span class="line">    .swiper-pagination-bullet</span><br><span class="line">      <span class="attribute">margin</span> <span class="number">8px</span> <span class="number">0</span></span><br><span class="line">  .swiper-pagination-bullet</span><br><span class="line">    <span class="attribute">width</span> <span class="number">11px</span></span><br><span class="line">    <span class="attribute">height</span> <span class="number">11px</span></span><br><span class="line">    <span class="attribute">display</span> block</span><br><span class="line">    <span class="attribute">border-radius</span> <span class="number">10px</span></span><br><span class="line">    <span class="attribute">background</span> <span class="number">#858585</span></span><br><span class="line">    <span class="attribute">opacity</span> <span class="number">0.2</span></span><br><span class="line">    transition all .3s</span><br><span class="line">  .swiper-pagination-bullet-active</span><br><span class="line">    <span class="attribute">opacity</span> <span class="number">1</span></span><br><span class="line">    <span class="attribute">background</span> var(--btn-bg)</span><br><span class="line">    <span class="attribute">height</span> <span class="number">30px</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@media</span> screen <span class="keyword">and</span> (<span class="attribute">max-width</span>: <span class="number">600px</span>)</span><br><span class="line">  .blog-slider__pagination</span><br><span class="line">    transform translateX(-<span class="number">50%</span>)</span><br><span class="line">    left <span class="number">50%</span> !important</span><br><span class="line">    top <span class="number">320px</span></span><br><span class="line">    <span class="attribute">width</span> <span class="number">100%</span> !important</span><br><span class="line">    display flex</span><br><span class="line">    justify-content center</span><br><span class="line">    align-items center</span><br><span class="line"></span><br><span class="line">  .blog-slider__pagination</span><br><span class="line">    &amp;.swiper-pagination-bullets</span><br><span class="line">      .swiper-pagination-bullet</span><br><span class="line">        margin <span class="number">0</span> <span class="number">5px</span></span><br><span class="line"></span><br><span class="line">  .blog-slider__pagination</span><br><span class="line">    .swiper-pagination-bullet-active</span><br><span class="line">      <span class="attribute">height</span> <span class="number">11px</span></span><br><span class="line">      <span class="attribute">width</span> <span class="number">30px</span></span><br><span class="line"></span><br><span class="line">  .blog-slider__button</span><br><span class="line">    display inline-flex</span><br><span class="line">    <span class="attribute">width</span> <span class="number">100%</span></span><br><span class="line">  .blog-slider__text</span><br><span class="line">    margin-bottom <span class="number">40px</span></span><br><span class="line"></span><br><span class="line">  .blog-slider</span><br><span class="line">    <span class="attribute">min-height</span> <span class="number">350px</span></span><br><span class="line">    <span class="attribute">height</span> auto</span><br><span class="line">    margin-top <span class="number">110px</span></span><br><span class="line">    margin-bottom <span class="number">10px</span></span><br><span class="line"></span><br><span class="line">  .blog-slider__content</span><br><span class="line">    margin-top -<span class="number">80px</span></span><br><span class="line">    text-align center</span><br><span class="line">    padding <span class="number">0</span> <span class="number">30px</span></span><br><span class="line"></span><br><span class="line">  .blog-slider__item</span><br><span class="line">    flex-direction column</span><br><span class="line"></span><br><span class="line">  .blog-slider__img</span><br><span class="line">    transform translateY(-<span class="number">50%</span>)</span><br><span class="line">    <span class="attribute">width</span> <span class="number">90%</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  .blog-slider__content</span><br><span class="line">    padding-left <span class="number">10px</span></span><br><span class="line">    padding-right <span class="number">10px</span></span><br><span class="line"></span><br><span class="line">  .blog-slider__pagination.swiper-pagination-clickable.swiper-pagination-bullets</span><br><span class="line">    top <span class="number">110px</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@media screen <span class="keyword">and</span> (<span class="attribute">min-width</span>: <span class="number">600px</span>)</span><br><span class="line">  .blog-slider</span><br><span class="line">    <span class="attribute">height</span> <span class="number">200px</span></span><br><span class="line"></span><br><span class="line">  .blog-slider__img</span><br><span class="line">    <span class="attribute">height</span> <span class="number">200px</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>配置CDN依赖项。</p>
<ul>
<li>
<p>修改文件<code>_config.butterfly.yml</code>，在CDN模块下添加如下代码：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 首页轮播图</span></span><br><span class="line">  <span class="attr">swiper_js:</span> <span class="string">https://cdnjs.cloudflare.com/ajax/libs/Swiper/4.1.6/js/swiper.min.js</span> </span><br><span class="line">  <span class="attr">swiper_css:</span> <span class="string">https://cdnjs.cloudflare.com/ajax/libs/Swiper/4.1.6/css/swiper.min.css</span> </span><br><span class="line">  <span class="attr">swiper_init:</span> <span class="string">/js/swiper_init.js</span> </span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/LBT2.png" alt=""></p>
</li>
<li>
<p>在路径<code>\themes\butterfly\source\css</code>下找到文件<code>index.styl</code>，在最上方添加如下代码：</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line"><span class="keyword">@import</span> url(hexo-config(<span class="string">&#x27;CDN.swiper_css&#x27;</span>))</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/LBT3.png" alt=""></p>
</li>
</ul>
</li>
<li>
<p>在路径<code>\source\_data</code>下创建文件<code>slider.yml</code>，在里面填写想要置顶文章的信息</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># - cover: 封面图片链接</span></span><br><span class="line"><span class="comment">#   timeline: &#x27;2020-10-01&#x27; # 日期，需要用&#x27;&#x27;包裹</span></span><br><span class="line"><span class="comment">#   link: 置顶文章链接，站内文章建议填相对链接</span></span><br><span class="line"><span class="comment">#   title: 置顶文章标题</span></span><br><span class="line"><span class="comment">#   description: 置顶文章描述</span></span><br><span class="line"><span class="comment">#   button: 手机端按钮内容</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 例</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">cover:</span> <span class="string">https://cdn.jsdelivr.net/gh/CNhuazhu/Image/RotatingImage6.jpg</span></span><br><span class="line">  <span class="attr">timeline:</span> <span class="string">&#x27;2021-01-20&#x27;</span></span><br><span class="line">  <span class="attr">link:</span> <span class="string">/2021/01/20/Markdown语法/</span></span><br><span class="line">  <span class="attr">title:</span> <span class="string">Markdown语法</span></span><br><span class="line">  <span class="attr">description:</span> <span class="string">总结常用的Markdown语法</span></span><br><span class="line">  <span class="attr">button:</span> <span class="string">详情</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<hr>
<h1>结尾</h1>
<p>个人觉得还蛮实用的一个修改。</p>
]]></content>
      <categories>
        <category>博客</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>Hexo用wowjs给博客添加动画效果</title>
    <url>/2021/05/30/Hexo%E9%AD%94%E6%94%B9/Hexo%E7%94%A8wowjs%E7%BB%99%E5%8D%9A%E5%AE%A2%E6%B7%BB%E5%8A%A0%E5%8A%A8%E7%94%BB%E6%95%88%E6%9E%9C/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\css\APlayer.min.css"><script src="\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\js\Meting.min.js"></script><h1>前言</h1>
<p>本文将介绍如何利用wowjs给博客添加动画效果。或丝滑，或炫酷都可以自行更改。</p>
<p>效果见博客首页的博文卡片以及侧边栏卡片的动画样式</p>
<p>查看更多样式见：<a href="https://animate.style/">animate.css 参考文档</a></p>
<div class="note danger flat"><p>本篇仅使用<code>butterfly_v3.6.0 +</code>的主题版本，如果是在这之前的版本，请移步下方教程链接。</p>
</div>
<blockquote>
<p>教程链接：<a href="https://akilar.top/posts/abab51cf/">Add Blog Animation – Wowjs | Akilar の糖果屋</a></p>
</blockquote>
<hr>
<h1>操作</h1>
<h2 id="配置方案">配置方案</h2>
<ol>
<li>
<p>在<code>\themes\butterfly\source\js</code>目录下新建<code>wow_init.js</code>文件，并写入以下内容：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">wow = <span class="keyword">new</span> WOW(&#123;</span><br><span class="line">  boxClass: <span class="string">&#x27;wow&#x27;</span>,</span><br><span class="line">  <span class="comment">// 当用户滚动时显示隐藏框的类名称</span></span><br><span class="line">  animateClass: <span class="string">&#x27;animate__animated&#x27;</span>,</span><br><span class="line">  <span class="comment">// 触发 CSS 动画的类名称（动画库默认为&quot;animate.css&quot;库）</span></span><br><span class="line">  offset: <span class="number">0</span>,</span><br><span class="line">  <span class="comment">// 定义浏览器视口底部与隐藏框顶部之间的距离。</span></span><br><span class="line">  <span class="comment">// 当用户滚动并到达此距离时，将显示隐藏的框。</span></span><br><span class="line">  mobile: <span class="literal">false</span>,</span><br><span class="line">  <span class="comment">// 在移动设备上打开/关闭wow.js。</span></span><br><span class="line">  <span class="comment">// 经测试此项配置无效。</span></span><br><span class="line">  live: <span class="literal">true</span></span><br><span class="line">  <span class="comment">// 在页面上检查新的 wow.js元素。</span></span><br><span class="line">&#125;)</span><br><span class="line">wow.init();</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>在<code>\themes\butterfly\layout\includes\third-party</code>目录下新建<code>wowjs.pug</code>文件，并写入以下内容：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">.pjax-reload</span><br><span class="line">  if theme.wowjs.animateitem</span><br><span class="line">    each item in theme.wowjs.animateitem</span><br><span class="line">      script(async).</span><br><span class="line">        var arr &#x3D; document.getElementsByClassName(&#39;!&#123;item.class&#125;&#39;);</span><br><span class="line">        for(var i &#x3D; 0;i&lt;arr.length;i++)&#123;</span><br><span class="line">            arr[i].classList.add(&#39;wow&#39;);</span><br><span class="line">            arr[i].classList.add(&#39;!&#123;item.style&#125;&#39;);</span><br><span class="line">            arr[i].setAttribute(&#39;data-wow-duration&#39;, &#39;!&#123;item.duration&#125;&#39;);</span><br><span class="line">            arr[i].setAttribute(&#39;data-wow-delay&#39;, &#39;!&#123;item.delay&#125;&#39;);</span><br><span class="line">            arr[i].setAttribute(&#39;data-wow-offset&#39;, &#39;!&#123;item.offset&#125;&#39;);</span><br><span class="line">            arr[i].setAttribute(&#39;data-wow-iteration&#39;, &#39;!&#123;item.iteration&#125;&#39;);</span><br><span class="line">          &#125;</span><br><span class="line">script(defer src&#x3D;url_for(theme.CDN.wowjs))</span><br><span class="line">script(defer src&#x3D;url_for(theme.CDN.wowjs_init))</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>修改 <code>\themes\butterfly\layout\includes\head.pug</code> 中的内容，添加以下代码：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F;- animate_css</span><br><span class="line">if theme.wowjs.enable</span><br><span class="line">  link(rel&#x3D;&#39;stylesheet&#39; href&#x3D;url_for(theme.CDN.animate_css) media&#x3D;&quot;print&quot; onload&#x3D;&quot;this.media&#x3D;&#39;all&#39;&quot;)</span><br></pre></td></tr></table></figure>
<p>添加位置如下：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/wowjs%E4%BB%A3%E7%A0%81%E5%B1%95%E7%A4%BA1.png" alt=""></p>
</li>
<li>
<p>修改 <code>\themes\butterfly\layout\includes\additional-js.pug</code> 中的内容，添加如下代码：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">if theme.wowjs.enable</span><br><span class="line">  !&#x3D;partial(&#39;includes&#x2F;third-party&#x2F;wowjs&#39;, &#123;&#125;, &#123;cache: true&#125;)</span><br></pre></td></tr></table></figure>
<p>在最下方添加就好：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/wowjs%E4%BB%A3%E7%A0%81%E5%B1%95%E7%A4%BA2.png" alt=""></p>
</li>
<li>
<p>修改 <code>\themes\butterfly\layout\includes\third-party\pjax.pug</code> 的内容：</p>
<p>删去代码：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">document.querySelectorAll(&#39;script[data-pjax]&#39;).forEach(item &#x3D;&gt; &#123;</span><br></pre></td></tr></table></figure>
<p>将其替换为：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">document.querySelectorAll(&#39;script[data-pjax], .pjax-reload script&#39;).forEach(*item* *&#x3D;&gt;* &#123;</span><br></pre></td></tr></table></figure>
<p>效果如下：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/wowjs%E4%BB%A3%E7%A0%81%E5%B1%95%E7%A4%BA3.png" alt=""></p>
</li>
<li>
<p>找到主题配置文件<code>_config.butterfly.yml</code>，添加CDN配置项：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">CDN:</span></span><br><span class="line">  <span class="comment"># main</span></span><br><span class="line">  <span class="attr">wowjs:</span> <span class="string">https://cdn.jsdelivr.net/gh/graingert/wow@1.3.0/dist/wow.min.js</span></span><br><span class="line">  <span class="attr">wowjs_init:</span> <span class="string">/js/wow_init.js</span> <span class="comment"># 之后可以自己换成CDN链接</span></span><br><span class="line">  <span class="attr">animate_css:</span> <span class="string">https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>找到主题配置文件<code>_config.butterfly.yml</code>，添加<code>wowjs</code>开关配置项。</p>
<p>class 和 style 是必填项，其余四个是选填项。</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment">#wowjs动画效果</span></span><br><span class="line"><span class="attr">wowjs:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span> <span class="comment">#控制动画开关。true是打开，false是关闭</span></span><br><span class="line">  <span class="attr">animateitem:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">class:</span> <span class="string">recent-post-item</span> <span class="comment">#必填项，需要添加动画的元素的class </span></span><br><span class="line">      <span class="attr">style:</span> <span class="string">animate__fadeInLeft</span> <span class="comment">#必填项，需要添加的动画</span></span><br><span class="line">      <span class="attr">duration:</span> <span class="string">600ms</span> <span class="comment">#选填项，动画持续时间，单位可以是ms也可以是s。例如3s，700ms。</span></span><br><span class="line">      <span class="attr">delay:</span> <span class="string">200ms</span> <span class="comment">#选填项，动画开始的延迟时间，单位可以是ms也可以是s。例如3s，700ms。</span></span><br><span class="line">      <span class="attr">offset:</span> <span class="number">100</span> <span class="comment">#选填项，开始动画的距离（相对浏览器底部）</span></span><br><span class="line">      <span class="attr">iteration:</span> <span class="number">1</span> <span class="comment">#选填项，动画重复的次数</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">class:</span> <span class="string">card-widget</span></span><br><span class="line">      <span class="attr">style:</span> <span class="string">animate__fadeInRightBig</span> <span class="comment">#首页外挂卡片效果</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>至此配置完成，重新部署就可以看到效果了。</p>
</li>
</ol>
<h2 id="外挂标签配置方案">外挂标签配置方案</h2>
<p>如果想要给外挂标签添加同样的动画效果，可以参考<code>Akilarの糖果屋</code>，教程链接如下，里面有详细的配置教程和使用方法：</p>
<p>教程链接：<a href="https://akilar.top/posts/abab51cf/">Add Blog Animation – Wowjs | Akilarの糖果屋</a></p>
<hr>
<h1>后记</h1>
<p>查看更多动画样式见：<a href="https://animate.style/">animate.css 参考文档</a></p>
]]></content>
      <categories>
        <category>博客</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>Hexo站点加载动画修改（巫师、钢铁侠核心、稻草人、自定义效果）</title>
    <url>/2021/03/06/Hexo%E9%AD%94%E6%94%B9/Hexo%E7%AB%99%E7%82%B9%E5%8A%A0%E8%BD%BD%E5%8A%A8%E7%94%BB%E4%BF%AE%E6%94%B9%EF%BC%88%E5%B7%AB%E5%B8%88%E3%80%81%E9%92%A2%E9%93%81%E4%BE%A0%E6%A0%B8%E5%BF%83%E3%80%81%E7%A8%BB%E8%8D%89%E4%BA%BA%E3%80%81%E8%87%AA%E5%AE%9A%E4%B9%89%E6%95%88%E6%9E%9C%EF%BC%89/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\css\APlayer.min.css"><script src="\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\js\Meting.min.js"></script><p>效果见本站。</p>
<p>需要改动大量主题源码，谨慎修改。</p>
<blockquote>
<p>参考博客：<strong>Akilarの糖果屋</strong>（<a href="https://akilar.top/">https://akilar.top/</a> ）</p>
<p>参考文章：《Loading Animation》（<a href="https://akilar.top/posts/3d221bf2/">https://akilar.top/posts/3d221bf2/</a> ）</p>
</blockquote>
<hr>
<h1>后记</h1>
<p>Akilar大神帮助我了很多，在此特别鸣谢。🚀🚀🚀🚀</p>
]]></content>
      <categories>
        <category>博客</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>Hexo站点加载动画修改</title>
    <url>/2021/02/25/Hexo%E9%AD%94%E6%94%B9/Hexo%E7%AB%99%E7%82%B9%E5%8A%A0%E8%BD%BD%E5%8A%A8%E7%94%BB%E4%BF%AE%E6%94%B9/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\css\APlayer.min.css"><script src="\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\js\Meting.min.js"></script><h1>前言</h1>
<p>本文将介绍如何修改站点加载动画。</p>
<p>之前一直使用的是Butterfly主题默认的<code>魔方盒子</code>（姑且就这么称呼）加载动画，但是属实是不太喜欢。偶然看到了一个博客使用<code>转动齿轮</code>效果感觉很喜欢，就有了这篇文章。</p>
<p>（<strong>注意</strong>：该篇魔改教程会改动一些源文件，建议没把握的小盆友先自行做好备份，避免造成不可逆的错误）</p>
<blockquote>
<p>教程链接：<a href="https://www.paddylin.top/post/4f69.html">https://www.paddylin.top/post/4f69.html</a></p>
</blockquote>
<hr>
<h1>操作</h1>
<ol>
<li>
<p>在<code>themes\butterfly\layout\includes\loading</code>目录下创建一个名为<code>loaded.ejs</code>的文件，并将如下内容写入该文件：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;% if (theme.preloader.enable) &#123; %&gt;</span><br><span class="line">&lt;div id&#x3D;&#39;loader&#39;&gt;</span><br><span class="line">    &lt;% if(theme.preloader.layout &#x3D;&#x3D; &#39;gear&#39; ) &#123;%&gt;</span><br><span class="line">    &lt;div class&#x3D;&quot;outer_box&quot;&gt;</span><br><span class="line">    &lt;div class&#x3D;&#39;loader_overlay&#39;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">    &lt;div class&#x3D;&#39;loader_cogs&#39;&gt;</span><br><span class="line">        &lt;div class&#x3D;&#39;loader_cogs__top&#39;&gt;</span><br><span class="line">            &lt;div class&#x3D;&#39;top_part&#39;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">            &lt;div class&#x3D;&#39;top_part&#39;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">            &lt;div class&#x3D;&#39;top_part&#39;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">            &lt;div class&#x3D;&#39;top_hole&#39;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">        &lt;&#x2F;div&gt;</span><br><span class="line">        &lt;div class&#x3D;&#39;loader_cogs__left&#39;&gt;</span><br><span class="line">            &lt;div class&#x3D;&#39;left_part&#39;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">            &lt;div class&#x3D;&#39;left_part&#39;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">            &lt;div class&#x3D;&#39;left_part&#39;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">            &lt;div class&#x3D;&#39;left_hole&#39;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">        &lt;&#x2F;div&gt;</span><br><span class="line">        &lt;div class&#x3D;&#39;loader_cogs__bottom&#39;&gt;</span><br><span class="line">            &lt;div class&#x3D;&#39;bottom_part&#39;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">            &lt;div class&#x3D;&#39;bottom_part&#39;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">            &lt;div class&#x3D;&#39;bottom_part&#39;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">            &lt;div class&#x3D;&#39;bottom_hole&#39;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">        &lt;&#x2F;div&gt;</span><br><span class="line">        &lt;p style&#x3D;&quot;text-align:center&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;loading...&lt;&#x2F;p&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">    &lt;% &#125; else if(theme.preloader.layout &#x3D;&#x3D; &#39;spinner-box&#39;) &#123; %&gt;</span><br><span class="line">    &lt;div class&#x3D;&quot;loading-left-bg&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">    &lt;div class&#x3D;&quot;loading-right-bg&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">    &lt;div class&#x3D;&quot;spinner-box&quot;&gt;</span><br><span class="line">        &lt;div class&#x3D;&quot;configure-border-1&quot;&gt;</span><br><span class="line">            &lt;div class&#x3D;&quot;configure-core&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">        &lt;&#x2F;div&gt;</span><br><span class="line">        &lt;div class&#x3D;&quot;configure-border-2&quot;&gt;</span><br><span class="line">            &lt;div class&#x3D;&quot;configure-core&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">        &lt;&#x2F;div&gt;</span><br><span class="line">        &lt;div class&#x3D;&quot;loading-word&quot;&gt;加载中...&lt;&#x2F;div&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">    &lt;% &#125; %&gt;</span><br><span class="line">&lt;&#x2F;div&gt;</span><br><span class="line">    </span><br><span class="line">&lt;script&gt;</span><br><span class="line">    var endLoading &#x3D; function () &#123;</span><br><span class="line">    document.body.style.overflow &#x3D; &#39;auto&#39;;</span><br><span class="line">    document.getElementById(&#39;loader&#39;).classList.add(&quot;loading&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    window.addEventListener(&#39;load&#39;,endLoading);</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line">&lt;% &#125; %&gt;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>找到主题配置文件<code>_config.butterfly.yml</code>，在<code>inject</code>的<code>head</code>处引入如下两个css文件：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">inject:</span></span><br><span class="line">  <span class="attr">head:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&lt;link</span> <span class="string">rel=&quot;stylesheet&quot;</span> <span class="string">href=&quot;https://cdn.jsdelivr.net/gh/zyoushuo/Blog@latest/hexo/css/loading_style_1.css&quot;</span> <span class="string">&gt;</span> <span class="comment"># spinner-box风格样式文件</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&lt;link</span> <span class="string">rel=&quot;stylesheet&quot;</span> <span class="string">href=&quot;https://cdn.jsdelivr.net/gh/zyoushuo/Blog@latest/hexo/css/loading_style_2.css&quot;</span> <span class="string">&gt;</span> <span class="comment"># gear风格样式文件</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>在<code>\themes\butterfly\layout\includes</code>目录下，找到<code>layout.pug</code>文件。（版本为<code>3.6.0+</code>的请查看<a href="#notice"><strong>注意事项</strong></a>）</p>
<p>将代码（或释掉）：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">if theme.preloader</span><br><span class="line">      !&#x3D;partial(&#39;includes&#x2F;loading&#x2F;loading&#39;, &#123;&#125;, &#123;cache: true&#125;)</span><br></pre></td></tr></table></figure>
<p>修改为：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">if theme.preloader</span><br><span class="line">      !&#x3D;partial(&#39;includes&#x2F;loading&#x2F;loaded.ejs&#39;, &#123;&#125;, &#123;cache:theme.fragment_cache&#125;)</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/zdcode.png" alt=""></p>
</li>
<li>
<p>找到主题配置文件<code>_config.butterfly.yml</code>。</p>
<p>将代码：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">preloader:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>
<p>修改为：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">preloader:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">layout:</span> <span class="string">gear</span> <span class="comment"># gear, spinner-box 两种样式可选</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>保存，重新部署，启动，就可以看到效果啦。</p>
</li>
</ol>
<hr>
<h1><span id="notice">注意事项</span></h1>
<p>在<a href="https://akilar.top/">Akilar</a>博主的指导下，针对于第三步的修改，因为<code>butterfly_v3.6.0+</code>版本移除了<code>fragment_cache</code>的配置项，所以直接添加<code>cache:theme.fragment_cache</code>的做法存在隐患，应该保持原有的<code>cache: true</code>不动。</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/zdcode2.png" alt=""></p>
<p>感谢指导。</p>
<hr>
<h1>结尾</h1>
<p>慢慢改动源码的时候也在不断探索，学习其中的内容。之前看到过一篇文章提到，自己没事查看源码，有一些文件的语法根本没有学过，可以通过其中的一些常见的标记大概猜测每个代码块是什么作用，进而逐渐掌握其中的规律。确实是一种很好的自我探索的方法。</p>
]]></content>
      <categories>
        <category>博客</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>Hexo站点加载动画修改（齿轮效果）</title>
    <url>/2021/02/25/Hexo%E9%AD%94%E6%94%B9/Hexo%E7%AB%99%E7%82%B9%E5%8A%A0%E8%BD%BD%E5%8A%A8%E7%94%BB%E4%BF%AE%E6%94%B9%EF%BC%88%E9%BD%BF%E8%BD%AE%E6%95%88%E6%9E%9C%EF%BC%89/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\css\APlayer.min.css"><script src="\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\js\Meting.min.js"></script><h1>前言</h1>
<p>本文将介绍如何修改站点加载动画。</p>
<p>之前一直使用的是Butterfly主题默认的<code>魔方盒子</code>（姑且就这么称呼）加载动画，但是属实是不太喜欢。偶然看到了一个博客使用<code>转动齿轮</code>效果感觉很喜欢，就有了这篇文章。</p>
<p>效果展示如下：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/zdshow.png" alt=""></p>
<p>（<strong>注意</strong>：该篇魔改教程会改动一些源文件，建议没把握的小盆友先自行做好备份，避免造成不可逆的错误）</p>
<blockquote>
<p>教程链接：<a href="https://www.paddylin.top/post/4f69.html">https://www.paddylin.top/post/4f69.html</a></p>
</blockquote>
<hr>
<h1>操作</h1>
<ol>
<li>
<p>在<code>themes\butterfly\layout\includes\loading</code>目录下创建一个名为<code>loaded.ejs</code>的文件，并将如下内容写入该文件：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;% if (theme.preloader.enable) &#123; %&gt;</span><br><span class="line">&lt;div id&#x3D;&#39;loader&#39;&gt;</span><br><span class="line">    &lt;% if(theme.preloader.layout &#x3D;&#x3D; &#39;gear&#39; ) &#123;%&gt;</span><br><span class="line">    &lt;div class&#x3D;&quot;outer_box&quot;&gt;</span><br><span class="line">    &lt;div class&#x3D;&#39;loader_overlay&#39;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">    &lt;div class&#x3D;&#39;loader_cogs&#39;&gt;</span><br><span class="line">        &lt;div class&#x3D;&#39;loader_cogs__top&#39;&gt;</span><br><span class="line">            &lt;div class&#x3D;&#39;top_part&#39;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">            &lt;div class&#x3D;&#39;top_part&#39;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">            &lt;div class&#x3D;&#39;top_part&#39;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">            &lt;div class&#x3D;&#39;top_hole&#39;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">        &lt;&#x2F;div&gt;</span><br><span class="line">        &lt;div class&#x3D;&#39;loader_cogs__left&#39;&gt;</span><br><span class="line">            &lt;div class&#x3D;&#39;left_part&#39;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">            &lt;div class&#x3D;&#39;left_part&#39;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">            &lt;div class&#x3D;&#39;left_part&#39;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">            &lt;div class&#x3D;&#39;left_hole&#39;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">        &lt;&#x2F;div&gt;</span><br><span class="line">        &lt;div class&#x3D;&#39;loader_cogs__bottom&#39;&gt;</span><br><span class="line">            &lt;div class&#x3D;&#39;bottom_part&#39;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">            &lt;div class&#x3D;&#39;bottom_part&#39;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">            &lt;div class&#x3D;&#39;bottom_part&#39;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">            &lt;div class&#x3D;&#39;bottom_hole&#39;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">        &lt;&#x2F;div&gt;</span><br><span class="line">        &lt;p style&#x3D;&quot;text-align:center&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;loading...&lt;&#x2F;p&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">    &lt;% &#125; else if(theme.preloader.layout &#x3D;&#x3D; &#39;spinner-box&#39;) &#123; %&gt;</span><br><span class="line">    &lt;div class&#x3D;&quot;loading-left-bg&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">    &lt;div class&#x3D;&quot;loading-right-bg&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">    &lt;div class&#x3D;&quot;spinner-box&quot;&gt;</span><br><span class="line">        &lt;div class&#x3D;&quot;configure-border-1&quot;&gt;</span><br><span class="line">            &lt;div class&#x3D;&quot;configure-core&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">        &lt;&#x2F;div&gt;</span><br><span class="line">        &lt;div class&#x3D;&quot;configure-border-2&quot;&gt;</span><br><span class="line">            &lt;div class&#x3D;&quot;configure-core&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">        &lt;&#x2F;div&gt;</span><br><span class="line">        &lt;div class&#x3D;&quot;loading-word&quot;&gt;加载中...&lt;&#x2F;div&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">    &lt;% &#125; %&gt;</span><br><span class="line">&lt;&#x2F;div&gt;</span><br><span class="line">    </span><br><span class="line">&lt;script&gt;</span><br><span class="line">    var endLoading &#x3D; function () &#123;</span><br><span class="line">    document.body.style.overflow &#x3D; &#39;auto&#39;;</span><br><span class="line">    document.getElementById(&#39;loader&#39;).classList.add(&quot;loading&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    window.addEventListener(&#39;load&#39;,endLoading);</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line">&lt;% &#125; %&gt;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>找到主题配置文件<code>_config.butterfly.yml</code>，在<code>inject</code>的<code>head</code>处引入如下两个css文件：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">inject:</span></span><br><span class="line">  <span class="attr">head:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&lt;link</span> <span class="string">rel=&quot;stylesheet&quot;</span> <span class="string">href=&quot;https://cdn.jsdelivr.net/gh/zyoushuo/Blog@latest/hexo/css/loading_style_1.css&quot;</span> <span class="string">&gt;</span> <span class="comment"># spinner-box风格样式文件</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&lt;link</span> <span class="string">rel=&quot;stylesheet&quot;</span> <span class="string">href=&quot;https://cdn.jsdelivr.net/gh/zyoushuo/Blog@latest/hexo/css/loading_style_2.css&quot;</span> <span class="string">&gt;</span> <span class="comment"># gear风格样式文件</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>在<code>\themes\butterfly\layout\includes</code>目录下，找到<code>layout.pug</code>文件。（版本为<code>3.6.0+</code>的请查看<a href="#notice"><strong>注意事项</strong></a>）</p>
<p>将代码（或释掉）：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">if theme.preloader</span><br><span class="line">      !&#x3D;partial(&#39;includes&#x2F;loading&#x2F;loading&#39;, &#123;&#125;, &#123;cache: true&#125;)</span><br></pre></td></tr></table></figure>
<p>修改为：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">if theme.preloader</span><br><span class="line">      !&#x3D;partial(&#39;includes&#x2F;loading&#x2F;loaded.ejs&#39;, &#123;&#125;, &#123;cache:theme.fragment_cache&#125;)</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/zdcode.png" alt=""></p>
</li>
<li>
<p>找到主题配置文件<code>_config.butterfly.yml</code>。</p>
<p>将代码：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">preloader:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>
<p>修改为：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">preloader:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">layout:</span> <span class="string">gear</span> <span class="comment"># gear, spinner-box 两种样式可选</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>保存，重新部署，启动，就可以看到效果啦。</p>
</li>
</ol>
<hr>
<h1><span id="notice">注意事项</span></h1>
<p>在<a href="https://akilar.top/">Akilar</a>博主的指导下，针对于第三步的修改，因为<code>butterfly_v3.6.0+</code>版本移除了<code>fragment_cache</code>的配置项，所以直接添加<code>cache:theme.fragment_cache</code>的做法存在隐患，应该保持原有的<code>cache: true</code>不动。</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/zdcode2.png" alt=""></p>
<p>感谢指导。</p>
<hr>
<h1>结尾</h1>
<p>慢慢改动源码的时候也在不断探索，学习其中的内容。之前看到过一篇文章提到，自己没事查看源码，有一些文件的语法根本没有学过，可以通过其中的一些常见的标记大概猜测每个代码块是什么作用，进而逐渐掌握其中的规律。确实是一种很好的自我探索的方法。</p>
]]></content>
      <categories>
        <category>博客</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>Hexo页脚养鱼效果</title>
    <url>/2021/02/19/Hexo%E9%AD%94%E6%94%B9/Hexo%E9%A1%B5%E8%84%9A%E5%85%BB%E9%B1%BC%E6%95%88%E6%9E%9C/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\css\APlayer.min.css"><script src="\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\js\Meting.min.js"></script><h1>前言</h1>
<p><strong>页脚养鱼</strong>效果我也是折腾了蛮久的，奈何自己太菜，出现了一些问题也不知道怎么解决，查询一些博客，相关的描述也很简单。这里参考了<code>Ln</code>大佬的博客，总算是搞定了。</p>
<blockquote>
<p>Ln’s Blog ——《如何在页脚养鱼》：<a href="https://weilining.github.io/204.html">https://weilining.github.io/204.html</a></p>
</blockquote>
<p>最终效果在本站页脚，向下滑动即可看到。</p>
<hr>
<h1>操作方法</h1>
<p>参考文章一共介绍了两种方法，第一种是有针对于<code>Butterfly</code>主题的修改。第二种方法是通用方法（其他也主题可参考）</p>
<h2 id="方法一">方法一</h2>
<p>打开站点的主题配置文件<code>_config.butterfly.yml</code>，找到<code>inject</code>，在<code>bottom</code>处直接引入以下链接：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="string">&lt;script</span> <span class="string">src=&quot;https://cdn.jsdelivr.net/gh/xiabo2/CDN@latest/fishes.js&quot;&gt;&lt;/script&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="方法二">方法二</h2>
<ol>
<li>
<p>找到<code>footer.pug</code>文件：<code>\themes\butterfly\layout\includes\footer.pug</code>，写入以下内容：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment">#jsi-flying-fish-container.container</span></span><br><span class="line">   <span class="string">script(src=&#x27;js/fish.js&#x27;)</span></span><br><span class="line"><span class="string">style.</span></span><br><span class="line">   </span><br><span class="line">       <span class="string">@media</span> <span class="string">only</span> <span class="string">screen</span> <span class="string">and</span> <span class="string">(max-width:</span> <span class="string">767px)&#123;</span></span><br><span class="line">       <span class="comment">#sidebar_search_box input[type=text]&#123;width:calc(100% - 24px)&#125;</span></span><br><span class="line">    <span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>打开站点的主题配置文件<code>_config.butterfly.yml</code>，找到<code>inject</code>，在<code>bottom</code>处直接引入https://cdn.jsdelivr.net/gh/xiabo2/CDN@latest/fish.js</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="string">&lt;script</span> <span class="string">src=&quot;https://cdn.jsdelivr.net/gh/xiabo2/CDN@latest/fish.js&quot;&gt;&lt;/script&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>注意</strong>：引入的js文件需要依赖<code>jquery</code>，所以在之前如果没有引用过的就需要在<code>bottom</code>处的最开始引入：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="string">&lt;script</span> <span class="string">src=&quot;https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js&quot;&gt;&lt;/script&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>这样效果就出现了。但是引入之后页脚会过高，需要修改<code>footer.styl</code>文件：<code>\themes\butterfly\source\css\_layout\footer.styl</code>:</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment">#footer</span></span><br><span class="line">  <span class="attr">position:</span> <span class="string">relative</span></span><br><span class="line">  <span class="attr">background:</span> <span class="string">$light-blue</span></span><br><span class="line">  <span class="attr">background-attachment:</span> <span class="string">local</span></span><br><span class="line">  <span class="attr">background-position:</span> <span class="string">bottom</span></span><br><span class="line">  <span class="attr">background-size:</span> <span class="string">cover</span></span><br><span class="line"></span><br><span class="line">  <span class="string">if</span> <span class="string">hexo-config(&#x27;footer_bg&#x27;)</span> <span class="type">!=</span> <span class="literal">false</span></span><br><span class="line">    <span class="string">&amp;:before</span></span><br><span class="line">      <span class="attr">position:</span> <span class="string">absolute</span></span><br><span class="line">      <span class="attr">width:</span> <span class="number">100</span><span class="string">%</span></span><br><span class="line">      <span class="attr">height:</span> <span class="number">100</span><span class="string">%</span></span><br><span class="line">      <span class="attr">background-color:</span> <span class="string">alpha($dark-black,</span> <span class="number">.1</span><span class="string">)</span> </span><br><span class="line">      <span class="attr">content:</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#footer-wrap</span></span><br><span class="line">  <span class="attr">position:</span> <span class="string">absolute</span></span><br><span class="line">  <span class="attr">padding:</span> <span class="number">1.</span><span class="string">2rem</span> <span class="string">1rem</span> <span class="number">1.</span><span class="string">4rem</span></span><br><span class="line">  <span class="attr">color:</span> <span class="string">var(--light-grey)</span></span><br><span class="line">  <span class="attr">text-align:</span> <span class="string">center</span></span><br><span class="line">  <span class="attr">left:</span> <span class="number">0</span></span><br><span class="line">  <span class="attr">right:</span> <span class="number">0</span></span><br><span class="line">  <span class="attr">top:</span> <span class="number">0</span></span><br><span class="line">  <span class="attr">bottom:</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line">  <span class="string">a</span></span><br><span class="line">    <span class="attr">color:</span> <span class="string">var(--light-grey)</span></span><br><span class="line"></span><br><span class="line">    <span class="string">&amp;:hover</span></span><br><span class="line">      <span class="attr">text-decoration:</span> <span class="string">underline</span></span><br><span class="line"></span><br><span class="line">  <span class="string">.footer-separator</span></span><br><span class="line">    <span class="attr">margin:</span> <span class="number">0</span> <span class="string">.2rem</span></span><br><span class="line"></span><br><span class="line">  <span class="string">.icp-icon</span></span><br><span class="line">    <span class="attr">padding:</span> <span class="number">0</span> <span class="string">4px</span></span><br><span class="line">    <span class="attr">vertical-align:</span> <span class="string">text-bottom</span></span><br><span class="line">    <span class="attr">max-height:</span> <span class="number">1.</span><span class="string">4em</span></span><br><span class="line">    <span class="string">width</span> <span class="string">auto</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>参考文章的技术流程写到这里就结束了，如果还有页脚文字被遮挡的情况，可以修改页脚的透明度，在<code>\themes\butterfly\source\css</code>路径下创建一个<code>xxx.css</code>文件，在文件中添加如下代码：</p>
<ul>
<li>
<p>页脚半透明</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* 页脚半透明 */</span></span><br><span class="line"><span class="selector-id">#footer</span> &#123;</span><br><span class="line">    <span class="attribute">background</span>: <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#000</span>;</span><br><span class="line">    <span class="attribute">border-top-right-radius</span>: <span class="number">20px</span>;</span><br><span class="line">    <span class="attribute">border-top-left-radius</span>: <span class="number">20px</span>;</span><br><span class="line">    backdrop-<span class="attribute">filter</span>: <span class="built_in">saturate</span>(<span class="number">100%</span>) <span class="built_in">blur</span>(<span class="number">5px</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#footer</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">    <span class="attribute">background</span>: <span class="built_in">rgba</span>(<span class="number">255</span>,<span class="number">255</span>,<span class="number">255</span>,<span class="number">0</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#footer</span> <span class="selector-id">#footer-wrap</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">var</span>(--font-color);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#footer</span> <span class="selector-id">#footer-wrap</span> <span class="selector-tag">a</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">var</span>(--font-color);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>页脚全透明</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* 页脚透明 */</span></span><br><span class="line"><span class="selector-id">#footer</span> &#123;</span><br><span class="line">    <span class="attribute">background</span>: transparent <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>然后将该文件引入到<code>inject</code>的<code>head</code>处：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="string">&lt;link</span> <span class="string">rel=&quot;stylesheet&quot;</span> <span class="string">href=&quot;/css/xxx.css&quot;&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>至此操作结束，去看看你的页脚有没有发生变化吧。</p>
</li>
</ol>
<h2 id="补充">补充</h2>
<p>还有一个更为简单的方法，引入带有颜色的页脚养鱼，效果如下：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/fish.png" alt=""></p>
<p>只需要在<code>_config.butterfly.yml</code>文件中，找到<code>inject</code>，在<code>bottom</code>处直接引入：<a href="https://uuuuu.cf/js/fishes.js">https://uuuuu.cf/js/fishes.js</a></p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="string">&lt;script</span> <span class="string">defer</span> <span class="string">src=&quot;https://uuuuu.cf/js/fishes.js&quot;&gt;&lt;/script&gt;</span> <span class="comment"># 页脚养鱼(彩色)</span></span><br></pre></td></tr></table></figure>
<p><strong>注意</strong>：该操作同样需要在之前引入<code>jquery</code>。</p>
<hr>
<h1>结尾</h1>
<p>在魔改的道路上乐此不疲，虽然有时真的很“崩溃”。</p>
]]></content>
      <categories>
        <category>博客</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>Hexo页脚美化</title>
    <url>/2021/02/24/Hexo%E9%AD%94%E6%94%B9/Hexo%E9%A1%B5%E8%84%9A%E7%BE%8E%E5%8C%96/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\css\APlayer.min.css"><script src="\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\js\Meting.min.js"></script><h1>前言</h1>
<p>本文将介绍如何美化页脚，效果展示在最底部。</p>
<blockquote>
<p>教程链接：<a href="https://www.tqwba.com/x_d/jishu/298102.html">https://www.tqwba.com/x_d/jishu/298102.html</a></p>
</blockquote>
<hr>
<h1>操作</h1>
<ol>
<li>
<p>在<code>\themes\butterfly\source\js</code>目录下创建一个<code>js</code>文件，将如下代码写入该文件:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 动态心跳</span></span><br><span class="line">$(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line">    $(<span class="string">&#x27;.copyright&#x27;</span>).html(<span class="string">&#x27;©2021 &lt;i class=&quot;fa-fw fas fa-heartbeat card-announcement-animation cc_pointer&quot;&gt;&lt;/i&gt; By 花猪&#x27;</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">$(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line">    show_date_time();</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//本站运行时间</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">show_date_time</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">$(<span class="string">&#x27;.framework-info&#x27;</span>).html(<span class="string">&#x27;本站已运行&lt;span id=&quot;span_dt_dt&quot; style=&quot;color: #fff;&quot;&gt;&lt;/span&gt;&#x27;</span>);</span><br><span class="line"><span class="built_in">window</span>.setTimeout(<span class="string">&quot;show_date_time()&quot;</span>, <span class="number">1000</span>);</span><br><span class="line">BirthDay=<span class="keyword">new</span> <span class="built_in">Date</span>(<span class="string">&quot;1/20/2021 0:0:0&quot;</span>);</span><br><span class="line">today=<span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">timeold=(today.getTime()-BirthDay.getTime());</span><br><span class="line">sectimeold=timeold/<span class="number">1000</span></span><br><span class="line">secondsold=<span class="built_in">Math</span>.floor(sectimeold);</span><br><span class="line">msPerDay=<span class="number">24</span>*<span class="number">60</span>*<span class="number">60</span>*<span class="number">1000</span></span><br><span class="line">e_daysold=timeold/msPerDay</span><br><span class="line">daysold=<span class="built_in">Math</span>.floor(e_daysold);</span><br><span class="line">e_hrsold=(e_daysold-daysold)*<span class="number">24</span>;</span><br><span class="line">hrsold=<span class="built_in">Math</span>.floor(e_hrsold);</span><br><span class="line">e_minsold=(e_hrsold-hrsold)*<span class="number">60</span>;</span><br><span class="line">minsold=<span class="built_in">Math</span>.floor((e_hrsold-hrsold)*<span class="number">60</span>);</span><br><span class="line">seconds=<span class="built_in">Math</span>.floor((e_minsold-minsold)*<span class="number">60</span>);</span><br><span class="line">span_dt_dt.innerHTML=<span class="string">&#x27;&lt;font style=color:#afb4db&gt;&#x27;</span>+daysold+<span class="string">&#x27;&lt;/font&gt; 天 &lt;font style=color:#f391a9&gt;&#x27;</span>+hrsold+<span class="string">&#x27;&lt;/font&gt; 时 &lt;font style=color:#fdb933&gt;&#x27;</span>+minsold+<span class="string">&#x27;&lt;/font&gt; 分 &lt;font style=color:#a3cf62&gt;&#x27;</span>+seconds+<span class="string">&#x27;&lt;/font&gt; 秒&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>更多图标和动画效果可以查看<a href="https://fa5.dashgame.com/#/">FontAwesome5</a>的官网和文档</li>
<li>将代码中的new Date()修改成自己网站搭建的时间（月/日/年 时:分:秒）</li>
<li>时间数字可以自由更换颜色</li>
</ul>
</li>
<li>
<p>找到主题配置文件<code>_config.butterfly.yml</code>，在<code>inject</code>的<code>bottom</code>处引入该js文件：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">inject:</span></span><br><span class="line">  <span class="attr">bottom:</span></span><br><span class="line">  	<span class="bullet">-</span> <span class="string">&lt;script</span> <span class="string">src=&quot;/js/xxx.js&quot;&gt;&lt;/script&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>重新部署，启动，就可以看到效果啦。</p>
<hr>
<h1>结尾</h1>
<p>除了跳动的♥还可以有多种图案选择，可以到官网查看，自己DIY。</p>
]]></content>
      <categories>
        <category>博客</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>Hexo魔改记录</title>
    <url>/2021/03/28/Hexo%E9%AD%94%E6%94%B9/Hexo%E9%AD%94%E6%94%B9%E8%AE%B0%E5%BD%95/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\css\APlayer.min.css"><script src="\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\js\Meting.min.js"></script><p><em><strong>记录一下Hexo魔改过程，方便版本升级时快速恢复。</strong></em></p>
<hr>
<h1>页脚养鱼效果</h1>
<div class="btn-center">
<a class="btn-beautify button--animated block outline larger" href="/2021/02/19/Hexo%E9%AD%94%E6%94%B9/Hexo%E9%A1%B5%E8%84%9A%E5%85%BB%E9%B1%BC%E6%95%88%E6%9E%9C/" 
  title="点击跳转 至 《Hexo页脚养鱼效果》"><i class="far fa-hand-point-right"></i><span>点击跳转 至 《Hexo页脚养鱼效果》</span></a>
</div>
<h1>添加樱花动态效果背景</h1>
<div class="btn-center">
<a class="btn-beautify button--animated block outline blue larger" href="/2021/02/19/Hexo%E9%AD%94%E6%94%B9/Hexo%E6%B7%BB%E5%8A%A0%E6%A8%B1%E8%8A%B1%E5%8A%A8%E6%80%81%E6%95%88%E6%9E%9C%E8%83%8C%E6%99%AF/" 
  title="点击跳转 至 《Hexo添加樱花动态效果背景》"><i class="far fa-hand-point-right"></i><span>点击跳转 至 《Hexo添加樱花动态效果背景》</span></a>
</div>
<h1>添加动态线条效果背景</h1>
<div class="btn-center">
<a class="btn-beautify button--animated block outline pink larger" href="/2021/02/19/Hexo%E9%AD%94%E6%94%B9/Hexo%E6%B7%BB%E5%8A%A0%E5%8A%A8%E6%80%81%E7%BA%BF%E6%9D%A1%E6%95%88%E6%9E%9C%E8%83%8C%E6%99%AF/" 
  title="点击跳转 至 《Hexo添加动态线条效果背景》"><i class="far fa-hand-point-right"></i><span>点击跳转 至 《Hexo添加动态线条效果背景》</span></a>
</div>
<h1>文章页透明效果</h1>
<div class="btn-center">
<a class="btn-beautify button--animated block outline red larger" href="/2021/02/19/Hexo%E9%AD%94%E6%94%B9/Hexo%E6%96%87%E7%AB%A0%E9%A1%B5%E9%80%8F%E6%98%8E%E6%95%88%E6%9E%9C/" 
  title="点击跳转 至 《Hexo文章页透明效果》"><i class="far fa-hand-point-right"></i><span>点击跳转 至 《Hexo文章页透明效果》</span></a>
</div>
<h1>添加雪花动态效果背景</h1>
<div class="btn-center">
<a class="btn-beautify button--animated block outline purple larger" href="/2021/02/24/Hexo%E9%AD%94%E6%94%B9/Hexo%E6%B7%BB%E5%8A%A0%E9%9B%AA%E8%8A%B1%E5%8A%A8%E6%80%81%E6%95%88%E6%9E%9C%E8%83%8C%E6%99%AF/" 
  title="点击跳转 至 《Hexo添加雪花动态效果背景》"><i class="far fa-hand-point-right"></i><span>点击跳转 至 《Hexo添加雪花动态效果背景》</span></a>
</div>
<h1>小标题旋转风车设置</h1>
<div class="btn-center">
<a class="btn-beautify button--animated block outline orange larger" href="/2021/02/24/Hexo%E9%AD%94%E6%94%B9/Hexo%E5%B0%8F%E6%A0%87%E9%A2%98%E6%97%8B%E8%BD%AC%E9%A3%8E%E8%BD%A6%E8%AE%BE%E7%BD%AE/" 
  title="点击跳转 至 《Hexo小标题旋转风车设置》"><i class="far fa-hand-point-right"></i><span>点击跳转 至 《Hexo小标题旋转风车设置》</span></a>
</div>
<h1>在顶部增加天气小部件</h1>
<div class="btn-center">
<a class="btn-beautify button--animated block outline green larger" href="/2021/02/24/Hexo%E9%AD%94%E6%94%B9/Hexo%E5%9C%A8%E9%A1%B6%E9%83%A8%E5%A2%9E%E5%8A%A0%E5%A4%A9%E6%B0%94%E5%B0%8F%E9%83%A8%E4%BB%B6/" 
  title="点击跳转 至 《Hexo在顶部增加天气小部件》"><i class="far fa-hand-point-right"></i><span>点击跳转 至 《Hexo在顶部增加天气小部件》</span></a>
</div>
<h1>增添公告栏计时器小部件</h1>
<div class="btn-center">
<a class="btn-beautify button--animated block outline larger" href="/2021/02/24/Hexo%E9%AD%94%E6%94%B9/Hexo%E5%A2%9E%E6%B7%BB%E5%85%AC%E5%91%8A%E6%A0%8F%E8%AE%A1%E6%97%B6%E5%99%A8%E5%B0%8F%E9%83%A8%E4%BB%B6/" 
  title="点击跳转 至 《Hexo增添公告栏计时器小部件》"><i class="far fa-hand-point-right"></i><span>点击跳转 至 《Hexo增添公告栏计时器小部件》</span></a>
</div>
<h1>页脚美化</h1>
<div class="btn-center">
<a class="btn-beautify button--animated block outline blue larger" href="/2021/02/24/Hexo%E9%AD%94%E6%94%B9/Hexo%E9%A1%B5%E8%84%9A%E7%BE%8E%E5%8C%96/" 
  title="点击跳转 至 《Hexo页脚美化》"><i class="far fa-hand-point-right"></i><span>点击跳转 至 《Hexo页脚美化》</span></a>
</div>
<h1>增添头像卡片动态背景</h1>
<div class="btn-center">
<a class="btn-beautify button--animated block outline pink larger" href="/2021/02/24/Hexo%E9%AD%94%E6%94%B9/Hexo%E5%A2%9E%E6%B7%BB%E5%A4%B4%E5%83%8F%E5%8D%A1%E7%89%87%E5%8A%A8%E6%80%81%E8%83%8C%E6%99%AF/" 
  title="点击跳转 至 《Hexo增添头像卡片动态背景》"><i class="far fa-hand-point-right"></i><span>点击跳转 至 《Hexo增添头像卡片动态背景》</span></a>
</div>
<h1>增添水波荡漾效果</h1>
<div class="btn-center">
<a class="btn-beautify button--animated block outline red larger" href="/2021/02/24/Hexo%E9%AD%94%E6%94%B9/Hexo%E5%A2%9E%E6%B7%BB%E6%B0%B4%E6%B3%A2%E8%8D%A1%E6%BC%BE%E6%95%88%E6%9E%9C/" 
  title="点击跳转 至 《Hexo增添水波荡漾效果》"><i class="far fa-hand-point-right"></i><span>点击跳转 至 《Hexo增添水波荡漾效果》</span></a>
</div>
<h1>增添上升气泡效果</h1>
<div class="btn-center">
<a class="btn-beautify button--animated block outline purple larger" href="/2021/02/24/Hexo%E9%AD%94%E6%94%B9/Hexo%E5%A2%9E%E6%B7%BB%E4%B8%8A%E5%8D%87%E6%B0%94%E6%B3%A1%E6%95%88%E6%9E%9C/" 
  title="点击跳转 至 《Hexo增添上升气泡效果》"><i class="far fa-hand-point-right"></i><span>点击跳转 至 《Hexo增添上升气泡效果》</span></a>
</div>
<h1>站点加载动画修改（齿轮效果）</h1>
<div class="btn-center">
<a class="btn-beautify button--animated block outline orange larger" href="/2021/02/25/Hexo%E9%AD%94%E6%94%B9/Hexo%E7%AB%99%E7%82%B9%E5%8A%A0%E8%BD%BD%E5%8A%A8%E7%94%BB%E4%BF%AE%E6%94%B9%EF%BC%88%E9%BD%BF%E8%BD%AE%E6%95%88%E6%9E%9C%EF%BC%89/" 
  title="点击跳转 至 《Hexo站点加载动画修改（齿轮效果）》"><i class="far fa-hand-point-right"></i><span>点击跳转 至 《Hexo站点加载动画修改（齿轮效果）》</span></a>
</div>
<h1>修改友链界面</h1>
<div class="btn-center">
<a class="btn-beautify button--animated block outline green larger" href="/2021/02/25/Hexo%E9%AD%94%E6%94%B9/Hexo%E4%BF%AE%E6%94%B9%E5%8F%8B%E9%93%BE%E7%95%8C%E9%9D%A2/" 
  title="点击跳转 至 《Hexo修改友链界面》"><i class="far fa-hand-point-right"></i><span>点击跳转 至 《Hexo修改友链界面》</span></a>
</div>
<h1>站点加载动画修改（巫师、钢铁侠核心、稻草人、自定义效果）</h1>
<div class="btn-center">
<a class="btn-beautify button--animated block outline larger" href="/2021/03/06/Hexo%E9%AD%94%E6%94%B9/Hexo%E7%AB%99%E7%82%B9%E5%8A%A0%E8%BD%BD%E5%8A%A8%E7%94%BB%E4%BF%AE%E6%94%B9%EF%BC%88%E5%B7%AB%E5%B8%88%E3%80%81%E9%92%A2%E9%93%81%E4%BE%A0%E6%A0%B8%E5%BF%83%E3%80%81%E7%A8%BB%E8%8D%89%E4%BA%BA%E3%80%81%E8%87%AA%E5%AE%9A%E4%B9%89%E6%95%88%E6%9E%9C%EF%BC%89/" 
  title="点击跳转 至 《Hexo站点加载动画修改（巫师、钢铁侠核心、稻草人、自定义效果）》"><i class="far fa-hand-point-right"></i><span>点击跳转 至 《Hexo站点加载动画修改（巫师、钢铁侠核心、稻草人、自定义效果）》</span></a>
</div>
<h1>添加首页置顶轮播图</h1>
<div class="btn-center">
<a class="btn-beautify button--animated block outline blue larger" href="/2021/03/28/Hexo%E9%AD%94%E6%94%B9/Hexo%E6%B7%BB%E5%8A%A0%E9%A6%96%E9%A1%B5%E7%BD%AE%E9%A1%B6%E8%BD%AE%E6%92%AD%E5%9B%BE/" 
  title="点击跳转 至 《Hexo添加首页置顶轮播图》"><i class="far fa-hand-point-right"></i><span>点击跳转 至 《Hexo添加首页置顶轮播图》</span></a>
</div>
<h1>添加自定义静态网页</h1>
<div class="btn-center">
<a class="btn-beautify button--animated block outline pink larger" href="/2021/05/28/Hexo%E9%AD%94%E6%94%B9/Hexo%E6%B7%BB%E5%8A%A0%E8%87%AA%E5%AE%9A%E4%B9%89%E9%9D%99%E6%80%81%E7%BD%91%E9%A1%B5/" 
  title="点击跳转 至 《Hexo添加自定义静态网页》"><i class="far fa-hand-point-right"></i><span>点击跳转 至 《Hexo添加自定义静态网页》</span></a>
</div>
<h1>添加tag外挂标签</h1>
<div class="btn-center">
<a class="btn-beautify button--animated block outline red larger" href="/2021/05/28/Hexo%E9%AD%94%E6%94%B9/Hexotag-%E5%A4%96%E6%8C%82%E6%A0%87%E7%AD%BE/" 
  title="点击跳转 至 《Hexo tag 外挂标签》"><i class="far fa-hand-point-right"></i><span>点击跳转 至 《Hexo tag 外挂标签》</span></a>
</div>
<h1>添加当前访客信息</h1>
<div class="btn-center">
<a class="btn-beautify button--animated block outline purple larger" href="/2021/05/28/Hexo%E9%AD%94%E6%94%B9/Hexo%E6%B7%BB%E5%8A%A0%E5%BD%93%E5%89%8D%E8%AE%BF%E5%AE%A2%E4%BF%A1%E6%81%AF/" 
  title="点击跳转 至 《Hexo添加当前访客信息》"><i class="far fa-hand-point-right"></i><span>点击跳转 至 《Hexo添加当前访客信息》</span></a>
</div>
<h1>添加两句诗词</h1>
<div class="btn-center">
<a class="btn-beautify button--animated block outline orange larger" href="/2021/05/29/Hexo%E9%AD%94%E6%94%B9/Hexo%E6%B7%BB%E5%8A%A0%E4%B8%A4%E5%8F%A5%E8%AF%97%E8%AF%8D/" 
  title="点击跳转 至 《Hexo添加两句诗词》"><i class="far fa-hand-point-right"></i><span>点击跳转 至 《Hexo添加两句诗词》</span></a>
</div>
<h1>使用wowjs给博客添加动画效果</h1>
<div class="btn-center">
<a class="btn-beautify button--animated block outline green larger" href="/2021/05/30/Hexo%E9%AD%94%E6%94%B9/Hexo%E7%94%A8wowjs%E7%BB%99%E5%8D%9A%E5%AE%A2%E6%B7%BB%E5%8A%A0%E5%8A%A8%E7%94%BB%E6%95%88%E6%9E%9C/" 
  title="点击跳转 至 《Hexo用wowjs给博客添加动画效果》"><i class="far fa-hand-point-right"></i><span>点击跳转 至 《Hexo用wowjs给博客添加动画效果》</span></a>
</div>
<h1>鼠标样式修改</h1>
<div class="btn-center">
<a class="btn-beautify button--animated block outline larger" href="/2021/07/05/Hexo%E9%AD%94%E6%94%B9/Hexo%E9%BC%A0%E6%A0%87%E6%A0%B7%E5%BC%8F%E4%BF%AE%E6%94%B9/" 
  title="点击跳转 至 《Hexo鼠标样式修改》"><i class="far fa-hand-point-right"></i><span>点击跳转 至 《Hexo鼠标样式修改》</span></a>
</div>
<h1>MAC代码框样式美化</h1>
<div class="btn-center">
<a class="btn-beautify button--animated block outline blue larger" href="/2021/07/05/Hexo%E9%AD%94%E6%94%B9/HexoMAC%E4%BB%A3%E7%A0%81%E6%A1%86%E6%A0%B7%E5%BC%8F%E7%BE%8E%E5%8C%96/" 
  title="点击跳转 至 《HexoMAC代码框样式美化》"><i class="far fa-hand-point-right"></i><span>点击跳转 至 《HexoMAC代码框样式美化》</span></a>
</div>
<h1>建立分站</h1>
<div class="btn-center">
<a class="btn-beautify button--animated block outline pink larger" href="/2021/07/14/Hexo%E9%AD%94%E6%94%B9/Hexo%E5%BB%BA%E7%AB%8B%E5%88%86%E7%AB%99/" 
  title="点击跳转 至 《Hexo建立分站》"><i class="far fa-hand-point-right"></i><span>点击跳转 至 《Hexo建立分站》</span></a>
</div>
<h1>插入响应式Bilibili视频代码块</h1>
<div class="btn-center">
<a class="btn-beautify button--animated block outline red larger" href="/2021/07/30/Hexo%E9%AD%94%E6%94%B9/Hexo%E6%8F%92%E5%85%A5%E5%93%8D%E5%BA%94%E5%BC%8FBilibili%E8%A7%86%E9%A2%91%E4%BB%A3%E7%A0%81%E5%9D%97/" 
  title="点击跳转 至 《插入响应式Bilibili视频代码块》"><i class="far fa-hand-point-right"></i><span>点击跳转 至 《插入响应式Bilibili视频代码块》</span></a>
</div>
]]></content>
      <categories>
        <category>博客</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>Hexo鼠标样式修改</title>
    <url>/2021/07/05/Hexo%E9%AD%94%E6%94%B9/Hexo%E9%BC%A0%E6%A0%87%E6%A0%B7%E5%BC%8F%E4%BF%AE%E6%94%B9/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\css\APlayer.min.css"><script src="\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\js\Meting.min.js"></script><h1>前言</h1>
<p>本文将介绍如何修改站点同款鼠标样式。</p>
<blockquote>
<p>教程链接：<a href="https://blog.csdn.net/u012208219/article/details/106883001/">Hexo博客之butterfly主题优雅魔改系列（持续更新）_小康博客-CSDN博客</a></p>
</blockquote>
<hr>
<h1>正文</h1>
<ol>
<li>
<p>在<code>\themes\butterfly\source\css</code>路径下创建一个<code>mouse.css</code>文件，在文件中添加如下代码：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">    <span class="attribute">cursor</span>: <span class="built_in">url</span>(<span class="string">https://cdn.jsdelivr.net/gh/sviptzk/HexoStaticFile@latest/Hexo/img/default.cur</span>),</span><br><span class="line">        default;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">a</span>,</span><br><span class="line"><span class="selector-tag">img</span> &#123;</span><br><span class="line">    <span class="attribute">cursor</span>: <span class="built_in">url</span>(<span class="string">https://cdn.jsdelivr.net/gh/sviptzk/HexoStaticFile@latest/Hexo/img/pointer.cur</span>),</span><br><span class="line">        default;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>打开站点的主题配置文件<code>_config.butterfly.yml</code>，找到<code>inject</code>，在<code>head</code>处直接引入该文件：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">inject:</span></span><br><span class="line">  <span class="attr">head:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&lt;link</span> <span class="string">rel=&quot;stylesheet&quot;</span> <span class="string">href=&quot;/css/mouse.css&quot;&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>重新部署，即可看到效果</p>
</li>
</ol>
<hr>
<h1>后记</h1>
<p>重新记录一下，之前做的改动太乱。</p>
]]></content>
      <categories>
        <category>博客</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>Jupyter Notebook使用技巧</title>
    <url>/2021/02/08/Jupyter%20Notebook/Jupyter%20Notebook%E4%BD%BF%E7%94%A8%E6%8A%80%E5%B7%A7/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\css\APlayer.min.css"><script src="\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\js\Meting.min.js"></script><h1>前言</h1>
<p>为了更加方便快捷的使用<code>Jupyter Notebook</code>，本文将会介绍一些相关的使用技巧。</p>
<hr>
<h1>相关技巧</h1>
<h2 id="使用问号查看对象的相关信息">使用问号查看对象的相关信息</h2>
<p>对于代码中的所有对象，包括：变量、函数、方法、模块、等等，可以在某个对象的<strong>前面</strong>或<strong>后面</strong>添加<strong>一个</strong><code>?</code>，以查看该对象的相关信息。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">aaa</span>():</span></span><br><span class="line">	print(<span class="string">&#x27;Hello World&#x27;</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">?aaa</span><br></pre></td></tr></table></figure>
<p>效果如下图：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/%E6%9F%A5%E7%9C%8B%E5%AF%B9%E8%B1%A11.png" alt=""></p>
<p>对于我们<code>自定义</code>的函数，可以在函数名的<strong>前面</strong>或<strong>后面</strong>添加<strong>两个</strong><code>?</code>，这样，在显示出来的相关信息中会包含函数的<code>源代码</code>。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">aaa</span>():</span></span><br><span class="line">	print(<span class="string">&#x27;Hello World&#x27;</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">aaa??</span><br></pre></td></tr></table></figure>
<p>效果如下图：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/%E6%9F%A5%E7%9C%8B%E5%AF%B9%E8%B1%A12.png" alt=""></p>
<h2 id="使用叹号执行Shell命令">使用叹号执行Shell命令</h2>
<p>在使用Jupyter Notebook编写代码时，只需要在Shell命令前添加一个<code>!</code>，就可以在notebook中执行<code>Shell命令</code>，完全不用来回切换。</p>
<p>举例：查看当前本机网络状态：</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">!ipconfig</span><br></pre></td></tr></table></figure>
<p>效果如下图：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/shell%E5%91%BD%E4%BB%A4.png" alt=""></p>
<p>除了执行Shell命令之外，还可以将执行结果赋值给Python变量：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">a = !ipconfig</span><br><span class="line">print(a)</span><br><span class="line">print(<span class="built_in">type</span>(a))</span><br></pre></td></tr></table></figure>
<h2 id="关于输出">关于输出</h2>
<p>在notebook中运行单元格中的代码时，在默认情况下，单元格中<strong>最后一行</strong>的值会被自动输出：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">aaa</span>():</span></span><br><span class="line">	print(<span class="string">&#x27;Hello World&#x27;</span>)</span><br><span class="line"><span class="number">18</span></span><br></pre></td></tr></table></figure>
<p>输出效果如下图：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/%E8%BE%93%E5%87%BA1.png" alt=""></p>
<p>如果不想自动输出单元格中最后一行的值，可以在最后一行的行尾添加一个分号<code>;</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">aaa</span>():</span></span><br><span class="line">	print(<span class="string">&#x27;Hello World&#x27;</span>)</span><br><span class="line"><span class="number">18</span>;</span><br></pre></td></tr></table></figure>
<p>输出效果如下图：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/%E8%BE%93%E5%87%BA2.png" alt=""></p>
<p>在<strong>当前</strong>notebook中，如果希望单元格中<strong>每一行</strong>的值都被自动输出,可添加以下代码：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> IPython.core.interactiveshell <span class="keyword">import</span> InteractiveShell</span><br><span class="line">InteractiveShell.ast_node_interactivity = <span class="string">&#x27;all&#x27;</span></span><br></pre></td></tr></table></figure>
<p>输出效果如下图：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/%E8%BE%93%E5%87%BA3.png" alt=""></p>
<p>如果希望在<strong>所有</strong>的notebook中都自动输出单元格中<strong>每一行</strong>的值，可以修改或创建<code>ipython_config.py</code>配置文件。</p>
<p>文件路径：</p>
<ul>
<li>Windows：C:\Users\用户名.ipython/profile_default/ipython_config.py</li>
<li>MacOS：/Users/用户名/.ipython/profile_default/ipython_config.py</li>
<li>Linux：/home/用户名/.ipython/profile_default/ipython_config.py</li>
</ul>
<p>打开配置文件添加以下代码：</p>
<h2 id="code￼9"><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">c = get_config()</span><br><span class="line">c.InteractiveShell.ast_node_interactivity = <span class="string">&quot;all&quot;</span></span><br></pre></td></tr></table></figure></h2>
<h2 id="跨单元格编码">跨单元格编码</h2>
<p>需要注意的是，在notebook中：</p>
<ul>
<li>前面运行的单元格会将相关变量保存到<strong>内存</strong>中，从而后面运行的单元格可以<strong>继续使用</strong>这些变量</li>
<li>关闭notebook的页面后，内存中保存的变量<strong>不会丢失</strong></li>
<li>如果当前notebook<code>Shutdown</code>或<code>Restart</code>了，那么内存中保存的所有变量都会<strong>丢失</strong></li>
</ul>
<p>建议：按照单元格<strong>从上到下</strong>的顺序编写代码并<strong>依次运行</strong>代码，否则，不仅可读性不好，而且容易出错。</p>
<hr>
<h2 id="支持Markdown语法">支持Markdown语法</h2>
<p>Jupyter Notebook支持Markdown语法，在工具栏的下拉选项中将单元格调整为<code>Markdown</code>即可。</p>
<p>关于Markdown的相关介绍可以查看文章<code>《Markdown语法》</code></p>
<p>这里提醒一点，在插入图片时，可以直接点击菜单栏中的<code>Edit</code>，在打开的选项中点击<code>Insert Image</code>，这种操作方式<strong>优点</strong>是：将图片和notebook绑定在一起，在对notebook进行移动或其他操作时不用单独对图片进行处理；<strong>缺点</strong>是：notebook文件会变大，不能控制图片尺寸。</p>
<hr>
<h2 id="快捷键">快捷键</h2>
<p>在notebook中有<strong>两种单元格</strong>，分别为：</p>
<ul>
<li>Code单元格：用来编写代码</li>
<li>Markdown单元格：用来将纯文本格式化为富文本</li>
</ul>
<p>每种单元格都有<strong>两种模式</strong>，分别为：</p>
<ul>
<li>编辑模式：按<code>Esc</code>键或者<code>点击单元格的外部</code>，都可以切换到命令模式</li>
<li>命令模式：按<code>Enter</code>键或者<code>点击单元格的内部</code>，都可以切换到编辑模式（对于运行之后的Markdown单元格，要<code>双击单元格的内部</code>，才能切换到编辑模式）</li>
</ul>
<p><strong>编辑模式</strong>下的快捷键：</p>
<table>
<thead>
<tr>
<th>快捷键</th>
<th>功能</th>
</tr>
</thead>
<tbody>
<tr>
<td>Tab</td>
<td>增加缩进（4个空格）、代码自动补全</td>
</tr>
<tr>
<td>Shift+Tab</td>
<td>减少缩进（4个空格）、查看对象的相关信息</td>
</tr>
<tr>
<td>Ctrl+A（Command+A）</td>
<td>全选</td>
</tr>
<tr>
<td>Ctrl+Z（Command+Z）</td>
<td>撤销</td>
</tr>
<tr>
<td>Ctrl+Y（Shift+Command+Z）</td>
<td>恢复</td>
</tr>
<tr>
<td>Ctrl+/（Command+/）</td>
<td>注释、取消注释</td>
</tr>
<tr>
<td>Ctrl+D（Command+D）</td>
<td>删除行</td>
</tr>
<tr>
<td>Ctrl+Home（Command+Home）</td>
<td>跳转到单元格的开始处</td>
</tr>
<tr>
<td>Ctrl+End（Command+End）</td>
<td>跳转到单元格的结尾处</td>
</tr>
<tr>
<td>Esc</td>
<td>退出编辑模式并进入命令模式</td>
</tr>
<tr>
<td>Ctrl+S（Command+S）</td>
<td>保存并更新记录点文件</td>
</tr>
<tr>
<td>↑</td>
<td>向上移动光标</td>
</tr>
<tr>
<td>↓</td>
<td>向下移动光标</td>
</tr>
<tr>
<td>Ctrl+Enter</td>
<td>运行当前单元格</td>
</tr>
<tr>
<td>Shift+Enter</td>
<td>运行当前单元格，并选中下方的单元格（如果下方没有单元格，则在下方自动插入一个单元格并选中）</td>
</tr>
<tr>
<td>Alt+Enter（Option+Enter）</td>
<td>运行当前单元格，在下方自动插入一个单元格并选中</td>
</tr>
</tbody>
</table>
<p><strong>命令模式</strong>下的快捷键：</p>
<table>
<thead>
<tr>
<th>快捷键</th>
<th>功能</th>
</tr>
</thead>
<tbody>
<tr>
<td>↑</td>
<td>选中上方的单元格</td>
</tr>
<tr>
<td>↓</td>
<td>选中下方的单元格</td>
</tr>
<tr>
<td>Shift+↑</td>
<td>扩展选中上方的单元格</td>
</tr>
<tr>
<td>Shift+↓</td>
<td>扩展选中下方的单元格</td>
</tr>
<tr>
<td>A</td>
<td>在上方插入一个单元格</td>
</tr>
<tr>
<td>B</td>
<td>在下方插入一个单元格</td>
</tr>
<tr>
<td>M</td>
<td>将Code单元格转换为Markdown单元格</td>
</tr>
<tr>
<td>Y</td>
<td>将Markdown单元格转换为Code单元格</td>
</tr>
<tr>
<td>S</td>
<td>保存并更新记录点文件</td>
</tr>
<tr>
<td>连按两次D</td>
<td>删除选中的单元格</td>
</tr>
<tr>
<td>Z</td>
<td>撤销对单元格的删除</td>
</tr>
<tr>
<td>F</td>
<td>查找并替换</td>
</tr>
<tr>
<td>X</td>
<td>剪切选中的单元格</td>
</tr>
<tr>
<td>C</td>
<td>拷贝选中的单元格</td>
</tr>
<tr>
<td>V</td>
<td>在下方粘贴单元格</td>
</tr>
<tr>
<td>Shift+V</td>
<td>在上方粘贴单元格</td>
</tr>
<tr>
<td>Enter</td>
<td>退出命令模式并进入编辑模式</td>
</tr>
<tr>
<td>Ctrl+Enter</td>
<td>运行选中的单元格</td>
</tr>
<tr>
<td>Shift+Enter</td>
<td>运行选中的单元格，并选中下方的单元格（如果下方没有单元格，则在下方自动插入一个单元格并选中）</td>
</tr>
<tr>
<td>Alt+Enter（Option+Enter）</td>
<td>运行选中的单元格，在下方自动插入一个单元格并选中</td>
</tr>
</tbody>
</table>
<hr>
<h2 id="扩展插件集nbextensions">扩展插件集nbextensions</h2>
<p>扩展插件集<code>nbextensions</code>包含了一系列非常好用的插件，从而可以大大地扩展Jupyter Notebook的功能，并且增强Jupyter Notebook的交互式体验。</p>
<p>安装过程：</p>
<p><strong>1.安装第三方库jupyter_nbextensions_configurator</strong></p>
<p>它是jupyter notebook扩展插件集的配置器。</p>
<p>pip安装命令：</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">pip install jupyter_nbextensions_configurator</span><br></pre></td></tr></table></figure>
<p>conda安装命令：</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">conda install jupyter_nbextensions_configurator</span><br></pre></td></tr></table></figure>
<p><strong>2.启动配置器</strong></p>
<p>启动命令：</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">jupyter nbextensions_configurator enable -<span class="literal">-user</span></span><br></pre></td></tr></table></figure>
<p>此时启动jupyter notebook，会发现菜单多出来一个名为<code>Nbextensions</code>的选项卡。</p>
<p><strong>3.安装第三方库jupyter_contrib_nbextensions</strong></p>
<p>它就是jupyter notebook的扩展插件集。</p>
<p>pip安装命令：</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">pip install jupyter_contrib_nbextensions</span><br></pre></td></tr></table></figure>
<p>conda安装命令：</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">conda install jupyter_contrib_nbextensions</span><br></pre></td></tr></table></figure>
<p><strong>3.安装相关的文件</strong></p>
<p>以便可以通过第2步启用的配置器，对第3步安装的扩展插件集进行访问。</p>
<p>安装命令：</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">jupyter contrib nbextension install -<span class="literal">-user</span></span><br></pre></td></tr></table></figure>
<p>此时就会看到，在<code>Nbextensions</code>这个选项卡的配置器中就显示出了很多插件，点一下页面左上方这个小方框，把对勾勾掉，所有的插件都变为可用的了，可以按需使用。</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/%E6%89%A9%E5%B1%95%E6%8F%92%E4%BB%B6.png" alt=""></p>
<p>nbextensions中的<strong>常用插件</strong>：</p>
<table>
<thead>
<tr>
<th>插件名</th>
<th>功能</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>Hinterland（代码提示）</td>
<td>每输入一个字母，都会弹出代码自动补全的菜单</td>
<td></td>
</tr>
<tr>
<td>Codefolding（代码折叠）</td>
<td>对Code单元格中的代码添加折叠的功能</td>
<td></td>
</tr>
<tr>
<td>Collapsible Headings（可折叠的标题）</td>
<td>根据标题对单元格进行折叠</td>
<td></td>
</tr>
<tr>
<td>Table of Contents（目录表）</td>
<td>将所有的标题显示在一个浮动窗口和一个导航菜单中</td>
<td></td>
</tr>
<tr>
<td>Autopep8（自动pep8）</td>
<td>按照pep8的规范对Code单元格中的Python代码进行格式化</td>
<td>需要安装autopep8这个第三方库。  <strong>pip安装命令</strong>：<code>pip install autopep8</code>  <strong>conda安装命令</strong>：<code>conda install autopep8</code></td>
</tr>
<tr>
<td>Code prettify（代码美化）</td>
<td>格式化Jupyter Notebook支持的所有编程语言的代码</td>
<td>在格式化某种编程语言的代码之前，首先需要安装相应的第三方库或包，要想格式化Python代码，就需要安装yapf这个Google开源的第三方库。  <strong>pip安装命令</strong>：<code>pip install yapf</code>  <strong>conda安装命令</strong>：<code>conda install yapf</code></td>
</tr>
<tr>
<td>Code Font Size（代码字体大小）</td>
<td>在工具栏，提供<strong>增大</strong>以及<strong>减小</strong>代码字体的按钮</td>
<td></td>
</tr>
<tr>
<td>ExecuteTime（执行时间）</td>
<td>在执行的过程中，会显示在什么时刻开始执行；执行结束后，会显示执行时长和在什么时刻结束执行</td>
<td></td>
</tr>
<tr>
<td>AutoSaveTime（自动保存时间）</td>
<td>设置notebook自动保存的时间间隔</td>
<td>notebook被自动保存时，相应的记录点文件不会发生任何变化</td>
</tr>
<tr>
<td>highlighter（高亮显示工具）</td>
<td>对Markdown单元格中的文本进行高亮显示</td>
<td></td>
</tr>
<tr>
<td>Live Markdown Preview（实时Markdown预览）</td>
<td>在Markdown单元格的下方实时预览运行结果</td>
<td></td>
</tr>
<tr>
<td>Tree Filter（文件树过滤器）</td>
<td>在Files选项卡中，只需要输入关键字，就可以对下面的文件和文件夹进行过滤</td>
<td></td>
</tr>
</tbody>
</table>
<hr>
<h2 id="导出为pdf文件">导出为pdf文件</h2>
<p>这里介绍两种导出为<code>pdf文件</code>的方法：</p>
<p>**方法一：**使用菜单导出。</p>
<p>点击<code>File</code>选项卡，选择<code>Download as</code>，选择<code>Markdown(.md)</code>，将文件首先导出为<code>.md</code>格式，再使用<code>Typora</code>打开，并导出为<code>pdf文件</code>。</p>
<p>**方法二：**使用命令导出（需要<code>Pandoc</code>和<code>XeLatex</code>支持）。</p>
<p>首先安装<code>Pandoc</code>：</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">pip install pandoc</span><br></pre></td></tr></table></figure>
<p>安装<code>MikTex</code>：</p>
<p>这里抛出官网链接：<a href="https://miktex.org/download">https://miktex.org/download</a></p>
<p>安装过程很简单，一路Next，这里不再赘述。（安装之后在cmd测试一下<code>xelatex</code>能否使用）</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/xelatex.png" alt=""></p>
<p>点击<code>File</code>选项卡，选择<code>Download as</code>，选择LaTeX(.tex)，将文件首先导出为<code>.tex</code>格式，<strong>为了使导出文件正常显示中文</strong>，打开该文件（本人用的是<code>Sublime Text 3</code>），找到代码<code>\documentclass[11pt]&#123;article&#125;</code>，在其后添加如下代码：</p>
<figure class="highlight latex"><table><tr><td class="code"><pre><span class="line"><span class="keyword">\usepackage</span>&#123;fontspec, xunicode, xltxtra&#125;</span><br><span class="line"><span class="keyword">\setmainfont</span>&#123;Microsoft YaHei&#125;</span><br><span class="line"><span class="keyword">\usepackage</span>&#123;ctex&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/%E8%A7%A3%E5%86%B3%E4%B8%AD%E6%96%87%E6%98%BE%E7%A4%BA%E9%97%AE%E9%A2%98.png" alt=""></p>
<p>进入<code>.tex文件</code>所在目录，打开命令提示符窗口，输入：</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">xelatex yourNotebookName.tex</span><br></pre></td></tr></table></figure>
<p>如果是首次运行，则会安装大量的依赖文件，选择<code>Install</code>即可（过程比较漫长）。</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/%E5%AE%89%E8%A3%85%E4%BE%9D%E8%B5%96.png" alt=""></p>
<p>（可以取消勾选弹框，使其自动安装所有需要的依赖）</p>
<p>运行结束后，就会发现在该目录下已经生成了<code>pdf文件</code>。</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/%E7%94%9F%E6%88%90pdf.png" alt=""></p>
<p><em>第二种方法生成的pdf文件，要比方法一展示效果更加好。</em></p>
<hr>
<h1>结语</h1>
<p>还有很多实用性技巧，暂且现在用不上，就没有总结，以后有时间继续补充。</p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Jupyter</tag>
      </tags>
  </entry>
  <entry>
    <title>Jupyter Notebook基本配置及使用方法</title>
    <url>/2021/02/08/Jupyter%20Notebook/Jupyter%20Notebook%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE%E5%8F%8A%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\css\APlayer.min.css"><script src="\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\js\Meting.min.js"></script><h1>前言</h1>
<p>本文将介绍一款强大的轻量级集成开发环境：<code>Jupyter Notebook</code>的基本配置流程以及使用方法。</p>
<hr>
<h1>简介</h1>
<blockquote>
<p>Jupyter Notebook是基于网页的用于交互计算的应用程序。其可被应用于全过程计算：开发、文档编写、运行代码和展示结果。——<a href="https://jupyter-notebook.readthedocs.io/en/stable/notebook.html">Jupyter Notebook官方介绍</a></p>
</blockquote>
<p>简而言之，Jupyter Notebook是以网页的形式打开，可以在网页页面中<strong>直接</strong>编写代码和运行代码，代码的运行结果也会直接在代码块下显示。如在编程过程中需要编写说明文档，可在同一个页面中直接编写，便于作及时的说明和解释。</p>
<p><strong>Jupyter Notebook的主要特点：</strong></p>
<ol>
<li>编程时具有语法高亮、缩进、tab补全的功能。</li>
<li>可直接通过浏览器运行代码，同时在代码块下方展示运行结果。</li>
<li>以富媒体格式展示计算结果。富媒体格式包括：HTML，LaTeX，PNG，SVG等。</li>
<li>对代码编写说明文档或语句时，支持Markdown语法</li>
<li>支持使用LaTeX编写数学性说明。</li>
</ol>
<hr>
<h1>安装</h1>
<p><strong>1.使用如下pip命令安装</strong></p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">pip install jupyter</span><br></pre></td></tr></table></figure>
<p><strong>2.验证安装是否成功</strong></p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">jupyter notebook -<span class="literal">-no</span><span class="literal">-browser</span></span><br></pre></td></tr></table></figure>
<p>如果出现以下内容,则Jupyter Notebook已经在正常运行，按<code>Ctrl+c</code>结束运行</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">[<span class="type">I</span> <span class="number">00</span>:<span class="number">38</span>:<span class="number">58.788</span> <span class="type">NotebookApp</span>] Serving notebooks from local directory: G:/Jupyter Notebook</span><br><span class="line">[<span class="type">I</span> <span class="number">00</span>:<span class="number">38</span>:<span class="number">58.788</span> <span class="type">NotebookApp</span>] Jupyter Notebook <span class="number">6.2</span>.<span class="number">0</span> is running at:</span><br><span class="line">[<span class="type">I</span> <span class="number">00</span>:<span class="number">38</span>:<span class="number">58.788</span> <span class="type">NotebookApp</span>] http://localhost:<span class="number">8888</span>/?token=<span class="number">5</span>f376397a2519ea17b951e5968ed4621a7a254efd1b7807d</span><br><span class="line">[<span class="type">I</span> <span class="number">00</span>:<span class="number">38</span>:<span class="number">58.788</span> <span class="type">NotebookApp</span>]  or http://<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">8888</span>/?token=<span class="number">5</span>f376397a2519ea17b951e5968ed4621a7a254efd1b7807d</span><br><span class="line">[<span class="type">I</span> <span class="number">00</span>:<span class="number">38</span>:<span class="number">58.788</span> <span class="type">NotebookApp</span>] Use Control<span class="literal">-C</span> to stop this server and shut down all kernels (twice to skip confirmation).</span><br><span class="line">[<span class="type">C</span> <span class="number">00</span>:<span class="number">38</span>:<span class="number">58.788</span> <span class="type">NotebookApp</span>]</span><br><span class="line"></span><br><span class="line">    To access the notebook, open this file <span class="keyword">in</span> a browser:</span><br><span class="line">        file:///C:/Users/%E7%<span class="number">8</span>E%<span class="number">8</span>B%E9%B9%<span class="number">8</span>F%E5%AE%<span class="number">87</span>/AppData/Roaming/jupyter/runtime/nbserver<span class="literal">-31952</span><span class="literal">-open</span>.html</span><br><span class="line">    Or <span class="built_in">copy</span> and paste one of these URLs:</span><br><span class="line">        http://localhost:<span class="number">8888</span>/?token=<span class="number">5</span>f376397a2519ea17b951e5968ed4621a7a254efd1b7807d</span><br><span class="line">     or http://<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">8888</span>/?token=<span class="number">5</span>f376397a2519ea17b951e5968ed4621a7a254efd1b7807d</span><br></pre></td></tr></table></figure>
<p><strong>3.启动</strong></p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">jupyter notebook</span><br></pre></td></tr></table></figure>
<p>至此就可以正常使用Jupyter Notebook了。</p>
<p>**注意：**正常情况该命令会自动弹出浏览器，如果遇到<code>无法正常弹出</code>浏览器，<a href="#%E6%97%A0%E6%B3%95%E5%BC%B9%E5%87%BA%E6%B5%8F%E8%A7%88%E5%99%A8"><strong>点击此处</strong></a>查看解决办法。</p>
<p><strong>4.修改笔记路径</strong></p>
<p>Jupyter Notebook的文件默认存储路径在C盘，为了便于操作，建议修改路径。</p>
<p>输入以下命令找到<code>jupyter_notebook_config.py</code>配置文件的路径，并打开。</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">jupyter notebook -<span class="literal">-generate</span><span class="literal">-config</span></span><br></pre></td></tr></table></figure>
<p><code>Ctrl+f</code>搜索<code>c.NotebookApp.notebook_dir = ''</code>代码位置，将其注释去掉，并在单引号间添加想设置的路径，如下：</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">c.NotebookApp.notebook_dir = <span class="string">&#x27;G:/Jupyter Notebook&#x27;</span></span><br></pre></td></tr></table></figure>
<p><em>注意：路径要使用反斜杠</em></p>
<p>保存，退出。完成路径修改。</p>
<hr>
<h1>使用</h1>
<h2 id="新建笔记">新建笔记</h2>
<p>如下图，点击右侧<code>New</code>下拉按钮，选择<code>Python 3</code>，即创建了一个笔记。</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/%E6%96%B0%E5%BB%BA%E7%AC%94%E8%AE%B0.png" alt=""></p>
<h2 id="重命名">重命名</h2>
<p>新建的notebook默认名称为：<code>Untitled</code>。</p>
<p>这里推荐两种重命名方式：</p>
<ol>
<li>当notebook正在运行时：直接在<code>notebook</code>页面，点击文件名称，即可修改文件名。</li>
<li>当notebook停止运行时：进入<code>File</code>选项卡，选中将要修改名称的文件（在文件左侧打勾），点击<code>Rename</code>按钮，即可修改文件名。</li>
</ol>
<h2 id="编写代码并运行">编写代码并运行</h2>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/%E7%BC%96%E5%86%99%E4%BB%A3%E7%A0%81%E5%B9%B6%E8%BF%90%E8%A1%8C.png" alt=""></p>
<p>如图，说明：</p>
<ol>
<li>新建的notebook默认只有一个单元格，前面以<code>In []</code>作为标记，该单元格用来编写代码。</li>
<li>点击工具栏中的按钮<code>运行（Run）</code>运行单元格中的代码，运行结果显示在单元格下方。</li>
<li><code>In []</code>中添加的数字表示：该单元格在内核上运行的顺序。</li>
<li>代码运行中：标记中的<code>[]</code>中添加了一个<code>*</code>；页面右上角的小圆圈变为了实心。</li>
<li>代码运行结束：<code>[]</code>中的<code>*</code>变为数字；页面右上角的小圆圈变为了空心。</li>
</ol>
<h2 id="保存notebook">保存notebook</h2>
<p><strong>自动保存</strong>：对notebook进行修改后，默认情况下，在两分钟后notebook会被自动保存。</p>
<p><em>注意：notebook被自动保存时，相应的记录点文件不会发生任何变化</em></p>
<p><strong>手动保存</strong>：点击保存按钮即可手动保存。<em>（记录点文件会发生变化）</em></p>
<h2 id="回退记录点">回退记录点</h2>
<p>可以随时回退到上一次记录点，以撤销这期间做出的任何修改。</p>
<p>**记录点文件：**每当创建一个新的notebook时，都会自动创建一个记录点文件，用于记录该notebook在某个时刻的所有状态。</p>
<p>**位置：**在notebook的同级目录中，有一个名为<code>.ipynb_checkpoints</code>的目录，里面包含每个notebook的记录点文件。</p>
<p>**命名规则：**notebook的文件名-checkpoint.ipynb</p>
<p>**回退记录点：**点击菜单栏中的<code>File</code>，在弹出的菜单中点击<code>Revert to Checkpoint</code>中的日期和时间，以进行回退。</p>
<hr>
<h1>更改主题</h1>
<p>为了获得更好的体验，可以更改默认的主题。</p>
<p>安装第三方库<code>jupyterthemes</code>：</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">pip install jupyterthemes</span><br></pre></td></tr></table></figure>
<p>如果是使用Anaconda，则使用如下命令：</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">conda install jupyterthemes</span><br></pre></td></tr></table></figure>
<p>列出所有可用的主题：</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">jt <span class="literal">-l</span></span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/%E5%8F%AF%E7%94%A8%E4%B8%BB%E9%A2%98.png" alt=""></p>
<p>各种<a href="https://blog.csdn.net/DSTJWJW/article/details/85304390">主题展示</a>（图）</p>
<p>使用某个主题：</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">jt <span class="literal">-t</span> 某个可用主题的名称</span><br></pre></td></tr></table></figure>
<p>恢复默认：</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">jt <span class="literal">-r</span></span><br></pre></td></tr></table></figure>
<p>打印出命令<code>jt</code>的用法和所有可选参数：</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">jt <span class="literal">-h</span></span><br></pre></td></tr></table></figure>
<p>一些常用的可选参数：</p>
<table>
<thead>
<tr>
<th>可选参数</th>
<th>参数的含义</th>
<th>默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td>-T</td>
<td>Toolbar Visible（工具栏可见）</td>
<td>无</td>
</tr>
<tr>
<td>-N</td>
<td>Name Visible（名称可见）</td>
<td>无</td>
</tr>
<tr>
<td>-kl</td>
<td>Kernel Logo Visible（内核Logo可见）</td>
<td>无</td>
</tr>
<tr>
<td>-f</td>
<td>Code Font（代码的字体）</td>
<td>无</td>
</tr>
<tr>
<td>-fs</td>
<td>Code Font-Size（代码的字体大小）</td>
<td>11</td>
</tr>
<tr>
<td>-tf</td>
<td>Text Cell Font（文本单元格的字体）</td>
<td>无</td>
</tr>
<tr>
<td>-tfs</td>
<td>Text Cell Font-Size（文本单元格的字体大小）</td>
<td>13</td>
</tr>
<tr>
<td>-nf</td>
<td>Notebook Font（Notebook的字体）</td>
<td>无</td>
</tr>
<tr>
<td>-nfs</td>
<td>Notebook Font-Size（Notebook的字体大小）</td>
<td>13</td>
</tr>
<tr>
<td>-ofs</td>
<td>Output Area Font-Size（输出区域的字体大小）</td>
<td>8.5</td>
</tr>
</tbody>
</table>
<p>更多其他参数查看点击此链接：<a href="https://github.com/dunovank/jupyter-themes">https://github.com/dunovank/jupyter-themes</a></p>
<p>具体使用案例，本人比较喜欢<code>onedork</code>主题样式，因此在该主题上进行修改。</p>
<h2 id="code￼12"><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">jt <span class="literal">-t</span> onedork <span class="operator">-f</span> hasklig <span class="literal">-cellw</span> <span class="number">80</span>% <span class="literal">-T</span> <span class="literal">-N</span> <span class="literal">-kl</span> <span class="literal">-altmd</span> <span class="literal">-fs</span> <span class="number">16</span> <span class="literal">-ofs</span> <span class="number">14</span></span><br></pre></td></tr></table></figure></h2>
<h1>可能遇到的问题</h1>
<h2 id="span-id-无法弹出浏览器-输入jupyter-notebook命令无法正常弹出浏览器-span"><span id="无法弹出浏览器">输入<code>jupyter notebook</code>命令无法正常弹出浏览器</span></h2>
<p>输入以下命令找到<code>jupyter_notebook_config.py</code>配置文件的路径，并打开。</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">jupyter notebook -<span class="literal">-generate</span><span class="literal">-config</span></span><br></pre></td></tr></table></figure>
<p><code>Ctrl+f</code>搜索<code>c.NotebookApp.password =</code>代码位置，在其后（另起一行），输入：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> webbrowser</span><br><span class="line">webbrowser.register(<span class="string">&#x27;chrome&#x27;</span>, <span class="literal">None</span>, webbrowser.GenericBrowser(<span class="string">u&#x27;C:\\Program Files\\Google\\Chrome\\Application\\chrome.exe&#x27;</span>))</span><br><span class="line">c.NotebookApp.browser = <span class="string">&#x27;chrome&#x27;</span></span><br></pre></td></tr></table></figure>
<p>**注意：**这里使用的是<code>chrome</code>浏览器，注意要将<code>chrome.exe</code>路径填写正确，使用<code>双斜杠</code>。</p>
<p>保存，退出。完成修改。</p>
<hr>
<h1>结语</h1>
<p>遇到问题或用法再继续补充~</p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Jupyter</tag>
      </tags>
  </entry>
  <entry>
    <title>Java--HelloWorld</title>
    <url>/2021/03/08/Java/Java--HelloWorld/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\css\APlayer.min.css"><script src="\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\js\Meting.min.js"></script><h1>前言</h1>
<p>Java学习之后搁置了很长时间，有很多东西都记不住了，因此决定重新过一遍，并做好学习记录。</p>
<p>看看能做到什么程度吧（真的是唯爱Java）</p>
<hr>
<h1>打印 Hello World</h1>
<p>编写第一个程序：Hello World</p>
<h2 id="code￼0"><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">demo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Hello world!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></h2>
<h1>后记</h1>
<p>计划回头复习，竟连最基本的语法都忘记了。。。。</p>
]]></content>
      <categories>
        <category>学习笔记</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>Java--基本数据类型</title>
    <url>/2021/03/08/Java/Java-%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\css\APlayer.min.css"><script src="\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\js\Meting.min.js"></script><h1>前言</h1>
<p>本文将介绍Java的八大基本数据类型</p>
<hr>
<h1>Java八大基本数据类型</h1>
<table>
<thead>
<tr>
<th>Java基本数据类型</th>
<th>类型</th>
<th>封装器类</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>byte</td>
<td>整数类型</td>
<td>Byte</td>
<td>1字节，8位，最大存储数据量是255，存放的数据范围是-128~127之间。</td>
</tr>
<tr>
<td>short</td>
<td>整数类型</td>
<td>Short</td>
<td>2字节，16位，最大数据存储量是65536，数据范围是-32768~32767之间。</td>
</tr>
<tr>
<td>int</td>
<td>整数类型</td>
<td>Integer</td>
<td>4字节，32位，最大数据存储容量是2的32次方减1，数据范围是负的2的31次方到正的2的31次方减1。</td>
</tr>
<tr>
<td>long</td>
<td>整数类型</td>
<td>Long</td>
<td>8字节，64位，最大数据存储容量是2的64次方减1，数据范围为负的2的63次方到正的2的63次方减1。</td>
</tr>
<tr>
<td>float</td>
<td>浮点类型</td>
<td>Float</td>
<td>4字节，32位，数据范围在3.4e-45~1.4e38，直接赋值时必须在数字后加上<code>f</code>或<code>F</code>。</td>
</tr>
<tr>
<td>double</td>
<td>浮点类型</td>
<td>Double</td>
<td>8字节，64位，数据范围在4.9e-324~1.8e308，赋值时可以加<code>d</code>或<code>D</code>也可以不加。</td>
</tr>
<tr>
<td>char</td>
<td>字符型</td>
<td>Character</td>
<td>2字节，16位，存储<code>Unicode</code>码，用单引号赋值。</td>
</tr>
<tr>
<td>boolean</td>
<td>布尔型</td>
<td>Boolean</td>
<td>只有<code>true</code>和<code>false</code>两个取值</td>
</tr>
</tbody>
</table>
<h2 id="byte">byte</h2>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">byte</span> a = <span class="number">127</span>;</span><br><span class="line">System.out.println(a); <span class="comment">// 127</span></span><br><span class="line"><span class="keyword">byte</span> b = -<span class="number">128</span>;</span><br><span class="line">System.out.println(b); <span class="comment">// -128</span></span><br></pre></td></tr></table></figure>
<h2 id="short">short</h2>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">short</span> a = <span class="number">32767</span>;</span><br><span class="line">System.out.println(a); <span class="comment">// 32767</span></span><br><span class="line"><span class="keyword">short</span> b = -<span class="number">32768</span>;</span><br><span class="line">System.out.println(b); <span class="comment">// -32768</span></span><br></pre></td></tr></table></figure>
<h2 id="int">int</h2>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span> a = <span class="number">1</span>;</span><br><span class="line">System.out.println(a); <span class="comment">// 1</span></span><br></pre></td></tr></table></figure>
<h2 id="long">long</h2>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">long</span> a = <span class="number">2</span>;</span><br><span class="line">System.out.println(a); <span class="comment">// 2</span></span><br></pre></td></tr></table></figure>
<h2 id="float">float</h2>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">float</span> a = <span class="number">1.2f</span>;</span><br><span class="line">System.out.println(a); <span class="comment">// 1.2</span></span><br></pre></td></tr></table></figure>
<h2 id="double">double</h2>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">double</span> a = <span class="number">1.4d</span>;</span><br><span class="line">System.out.println(a); <span class="comment">// 1.4</span></span><br></pre></td></tr></table></figure>
<h2 id="char">char</h2>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">char</span> a = <span class="string">&#x27;c&#x27;</span>;</span><br><span class="line">System.out.println(a); <span class="comment">// c</span></span><br></pre></td></tr></table></figure>
<h2 id="boolean">boolean</h2>
<h2 id="code￼7"><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">boolean</span> a = <span class="keyword">true</span>;</span><br><span class="line">System.out.println(a); <span class="comment">// true</span></span><br></pre></td></tr></table></figure></h2>
<h1>数据类型转换</h1>
<p>合法的基本类型转换原则是指：从取值范围窄的类型向取值范围宽的类型转换。如果是从取值范围宽的类型向取值范围窄的类型转换，则会产生编译错误。</p>
<p>转换规则：</p>
<ul>
<li>布尔型和其它基本数据类型之间不能相互转换</li>
<li>byte型可以转换为short、int、、long、float和double</li>
<li>short可转换为int、long、float和double</li>
<li>char可转换为int、long、float和double</li>
<li>int可转换为long、float和double</li>
<li>long可转换为float和double</li>
<li>float可转换为double</li>
</ul>
<p><strong>注意：类型强转可能会导致数据精度降低</strong></p>
<p>举例：</p>
<h2 id="code￼8"><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">float</span> a = <span class="number">50.4f</span>;</span><br><span class="line"><span class="keyword">int</span> b = (<span class="keyword">int</span>) a;</span><br><span class="line">System.out.println(b); <span class="comment">// 50</span></span><br></pre></td></tr></table></figure></h2>
<h1>结尾</h1>
<p>在一般情况下不轻易使用数据类型转换，可能导致错误。</p>
]]></content>
      <categories>
        <category>学习笔记</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>Java--循环结构</title>
    <url>/2021/03/08/Java/Java-%E5%BE%AA%E7%8E%AF%E7%BB%93%E6%9E%84/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\css\APlayer.min.css"><script src="\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\js\Meting.min.js"></script><h1>前言</h1>
<p>本文将介绍Java循环结构的相关语法</p>
<hr>
<h1>Java循环结构</h1>
<h2 id="while循环">while循环</h2>
<p>语法：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">while</span>( 布尔表达式 )  &#123;</span><br><span class="line">	<span class="comment">//循环内容</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>示例：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">demo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> x = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>( x &lt; <span class="number">10</span> ) &#123;</span><br><span class="line">            System.out.print(<span class="string">&quot;value of x : &quot;</span> + x + <span class="string">&quot;\n&quot;</span>);</span><br><span class="line">            x++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出结果：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">value of x : 1</span><br><span class="line">value of x : 2</span><br><span class="line">value of x : 3</span><br><span class="line">value of x : 4</span><br><span class="line">value of x : 5</span><br><span class="line">value of x : 6</span><br><span class="line">value of x : 7</span><br><span class="line">value of x : 8</span><br><span class="line">value of x : 9</span><br></pre></td></tr></table></figure>
<h2 id="do…while循环">do…while循环</h2>
<p>语法：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">       <span class="comment">//代码语句,至少执行一次</span></span><br><span class="line">&#125;<span class="keyword">while</span>(布尔表达式);</span><br></pre></td></tr></table></figure>
<p>示例：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">demo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> x = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">do</span>&#123;</span><br><span class="line">            System.out.print(<span class="string">&quot;value of x : &quot;</span> + x +<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">            x++;</span><br><span class="line">        &#125;<span class="keyword">while</span>( x &lt; <span class="number">10</span> );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出结果：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">value of x : 1</span><br><span class="line">value of x : 2</span><br><span class="line">value of x : 3</span><br><span class="line">value of x : 4</span><br><span class="line">value of x : 5</span><br><span class="line">value of x : 6</span><br><span class="line">value of x : 7</span><br><span class="line">value of x : 8</span><br><span class="line">value of x : 9</span><br></pre></td></tr></table></figure>
<h2 id="for循环">for循环</h2>
<p>语法：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span>(初始化; 布尔表达式; 更新) &#123;</span><br><span class="line">    <span class="comment">//代码语句</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>说明：</p>
<ul>
<li>最先执行初始化步骤。可以声明一种类型，但可初始化一个或多个循环控制变量，也可以是空语句。</li>
<li>然后，检测布尔表达式的值。如果为 true，循环体被执行。如果为false，循环终止，开始执行循环体后面的语句。</li>
<li>执行一次循环后，更新循环控制变量。</li>
<li>再次检测布尔表达式。循环执行上面的过程。</li>
</ul>
<p>示例：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">demo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> x = <span class="number">1</span>, y = <span class="number">11</span>; x &lt; <span class="number">10</span>; x++, y++) &#123;</span><br><span class="line">            System.out.print(<span class="string">&quot;value of x : &quot;</span> + x +<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;value of y : &quot;</span> + y +<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出结果：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">value of x : 1</span><br><span class="line">value of y : 11</span><br><span class="line"></span><br><span class="line">value of x : 2</span><br><span class="line">value of y : 12</span><br><span class="line"></span><br><span class="line">value of x : 3</span><br><span class="line">value of y : 13</span><br><span class="line"></span><br><span class="line">value of x : 4</span><br><span class="line">value of y : 14</span><br><span class="line"></span><br><span class="line">value of x : 5</span><br><span class="line">value of y : 15</span><br><span class="line"></span><br><span class="line">value of x : 6</span><br><span class="line">value of y : 16</span><br><span class="line"></span><br><span class="line">value of x : 7</span><br><span class="line">value of y : 17</span><br><span class="line"></span><br><span class="line">value of x : 8</span><br><span class="line">value of y : 18</span><br><span class="line"></span><br><span class="line">value of x : 9</span><br><span class="line">value of y : 19</span><br></pre></td></tr></table></figure>
<h2 id="增强for循环">增强for循环</h2>
<p>语法：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span>(声明语句 : 表达式)&#123;</span><br><span class="line">   <span class="comment">//代码句子</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>示例：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">demo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> [] numbers = &#123;<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>, <span class="number">40</span>, <span class="number">50</span>&#125;;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> x : numbers )&#123;</span><br><span class="line">            System.out.print( x + <span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出结果：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">10</span><br><span class="line">20</span><br><span class="line">30</span><br><span class="line">40</span><br><span class="line">50</span><br></pre></td></tr></table></figure>
<h2 id="break关键字">break关键字</h2>
<blockquote>
<p>break 主要用在循环语句或者 switch 语句中，用来跳出整个语句块。<br>
break 跳出最里层的循环，并且继续执行该循环下面的语句。</p>
</blockquote>
<p>示例：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">demo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> [] numbers = &#123;<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>, <span class="number">40</span>, <span class="number">50</span>&#125;;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> x : numbers ) &#123;</span><br><span class="line">            <span class="comment">// x 等于 30 时跳出循环</span></span><br><span class="line">            <span class="keyword">if</span>( x == <span class="number">30</span> ) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.print( x + <span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出结果：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">10</span><br><span class="line">20</span><br></pre></td></tr></table></figure>
<h2 id="continue关键字">continue关键字</h2>
<blockquote>
<p>continue 适用于任何循环控制结构中。作用是让程序立刻跳转到下一次循环的迭代。<br>
在 for 循环中，continue 语句使程序立即跳转到更新语句。<br>
在 while 或者 do…while 循环中，程序立即跳转到布尔表达式的判断语句。</p>
</blockquote>
<p>示例：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">demo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> [] numbers = &#123;<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>, <span class="number">40</span>, <span class="number">50</span>&#125;;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> x : numbers ) &#123;</span><br><span class="line">            <span class="comment">// x 等于 30 时直接进入下一循环</span></span><br><span class="line">            <span class="keyword">if</span>( x == <span class="number">30</span> ) &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.print( x + <span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出结果:</p>
<h2 id="code￼15"><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">10</span><br><span class="line">20</span><br><span class="line">40</span><br><span class="line">50</span><br></pre></td></tr></table></figure></h2>
<h1>结尾</h1>
<blockquote>
<p>参考：<a href="https://blog.csdn.net/aiowang/article/details/114460730?ops_request_misc=&amp;request_id=&amp;biz_id=102&amp;utm_term=java%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-8-114460730.first_rank_v2_pc_rank_v29">《从零打造IT知识体系-Java基础-Java基本数据类型与算法》</a></p>
</blockquote>
]]></content>
      <categories>
        <category>学习笔记</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>Java--数组</title>
    <url>/2021/03/09/Java/Java-%E6%95%B0%E7%BB%84/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\css\APlayer.min.css"><script src="\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\js\Meting.min.js"></script><h1>前言</h1>
<p>本文将介绍Java数组的创建与使用。</p>
<hr>
<h2 id="数组的概念">数组的概念</h2>
<p>数组是相同类型数据的有序集合。<br>
数组描述的是相同类型的若干个数据，按照一定的先后次序排列组合而成。其中，每一个数据称作一个数组元素，每个数组元素可以通过一个下标来访问他们</p>
<h2 id="数组的初始化">数组的初始化</h2>
<h3 id="动态初始化">动态初始化</h3>
<p>语法：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span>[] arrayA = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">3</span>];</span><br></pre></td></tr></table></figure>
<p>可以拆分为两个步骤：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span>[] arrayA;</span><br><span class="line">arrayC = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">3</span>];</span><br></pre></td></tr></table></figure>
<h3 id="静态初始化">静态初始化</h3>
<p>语法：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span>[] arrayB = <span class="keyword">new</span> <span class="keyword">int</span>[] &#123;<span class="number">5</span>,<span class="number">15</span>,<span class="number">25</span>&#125;;</span><br></pre></td></tr></table></figure>
<p>可以拆分为两个步骤：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span>[] arrayB;</span><br><span class="line">arrayB = <span class="keyword">new</span> <span class="keyword">int</span>[] &#123;<span class="number">5</span>,<span class="number">15</span>,<span class="number">25</span>&#125;;</span><br></pre></td></tr></table></figure>
<p>静态初始化时可以简化书写：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span>[] arrayB = &#123;<span class="number">5</span>,<span class="number">15</span>,<span class="number">25</span>&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="内存分析">内存分析</h3>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/Javaarray1.png" alt=""></p>
<h2 id="数组的特点">数组的特点</h2>
<ul>
<li>
<p>其长度是确定的。数组一旦被创建，它的大小就是不可以改变的。</p>
</li>
<li>
<p>其元素必须是相同类型,不允许出现混合类型。</p>
</li>
<li>
<p>数组中的元素可以是任何数据类型，包括基本类型和引用类型。</p>
</li>
<li>
<p>数组变量属引用类型，数组也可以看成是对象，数组中的每个元素相当于该对象的成员变量。</p>
</li>
<li>
<p>数组本身就是对象，Java中对象是在堆中的，因此数组无论保存原始类型还是其他对象类型,数组对象本身是在堆中的。</p>
</li>
<li>
<p>关于数组边界：</p>
<p>下标的合法区间：<code>[0，length-1]</code>,如果越界就会报错。</p>
<p><code>ArraryIndexOutOfBoundsException</code>:数组下标越界异常！</p>
</li>
</ul>
<h2 id="数组的使用">数组的使用</h2>
<h3 id="for-Each-循环">for-Each 循环</h3>
<p>适用于打印输出，不适合修改元素。</p>
<p>语法：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span>(声明语句 : 表达式)&#123;</span><br><span class="line">   <span class="comment">//代码句子</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>示例：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">demo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> [] numbers = &#123;<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>, <span class="number">40</span>, <span class="number">50</span>&#125;;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> x : numbers )&#123;</span><br><span class="line">            System.out.print( x + <span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出结果：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">10</span><br><span class="line">20</span><br><span class="line">30</span><br><span class="line">40</span><br><span class="line">50</span><br></pre></td></tr></table></figure>
<h3 id="数组做方法参数">数组做方法参数</h3>
<p>数组可以作为参数传递给方法。</p>
<p>示例：求和传入数组（整形）的和</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">demo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">sum</span><span class="params">(<span class="keyword">int</span>[] array)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> s = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; array.length; i++) &#123;</span><br><span class="line">            s = s + array[i];</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(s); <span class="comment">//10</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        sum(<span class="keyword">new</span> <span class="keyword">int</span>[]&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出结果：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">10</span><br></pre></td></tr></table></figure>
<h3 id="数组做返回值">数组做返回值</h3>
<p>示例：实现数组翻转</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">demo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span>[] reverse(<span class="keyword">int</span>[] list) &#123;</span><br><span class="line">        <span class="keyword">int</span>[] result = <span class="keyword">new</span> <span class="keyword">int</span>[list.length];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, j = result.length - <span class="number">1</span>; i &lt; list.length; i++, j--) &#123;</span><br><span class="line">            result[j] = list[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span>[] result = reverse(<span class="keyword">new</span> <span class="keyword">int</span>[]&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>&#125;);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> x : result)&#123;</span><br><span class="line">            System.out.println(x);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出结果：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">4</span><br><span class="line">3</span><br><span class="line">2</span><br><span class="line">1</span><br></pre></td></tr></table></figure>
<h3 id="多维数组">多维数组</h3>
<p>示例：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span>[][] arrays = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">2</span>][<span class="number">2</span>];<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">demo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span>[][] arrays = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">2</span>][<span class="number">2</span>]; <span class="comment">//创建二维数组</span></span><br><span class="line">        arrays[<span class="number">0</span>][<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">        System.out.println(arrays[<span class="number">0</span>][<span class="number">0</span>]); <span class="comment">//1</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出结果：</p>
<h2 id="code￼13"><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1</span><br></pre></td></tr></table></figure></h2>
<h1>结尾</h1>
<blockquote>
<p>参考：<a href="https://blog.csdn.net/Monuomeng/article/details/114394469?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522161527709316780261922515%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=161527709316780261922515&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_click~default-1-114394469.first_rank_v2_pc_rank_v29&amp;utm_term=java%E6%95%B0%E7%BB%84">《Java数组详解》</a></p>
</blockquote>
]]></content>
      <categories>
        <category>学习笔记</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>Java--方法重载</title>
    <url>/2021/03/09/Java/Java-%E6%96%B9%E6%B3%95%E9%87%8D%E8%BD%BD/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\css\APlayer.min.css"><script src="\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\js\Meting.min.js"></script><h1>前言</h1>
<p>本文将介绍Java中方法重载的概念以及使用</p>
<hr>
<h1>方法重载</h1>
<h2 id="概念">概念</h2>
<p>在同一个类中，允许存在一个以上的同名方法，只要他们的参数个数或者参数的类型不同即可。</p>
<h2 id="特点">特点</h2>
<p>重载的方法与返回值类型无关，只看参数列表，且参数列表必须不同（参数个数或者参数类型）。调用时，根据方法参数列表的不同来区别。</p>
<h2 id="示例">示例</h2>
<p>写一个求和类：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">demo</span> </span>&#123;</span><br><span class="line">    <span class="comment">//两个整型数求和</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">sum</span><span class="params">(<span class="keyword">int</span> a,<span class="keyword">int</span> b)</span></span>&#123;</span><br><span class="line">        System.out.println(a+b);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//三个整形数求和</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">sum</span><span class="params">(<span class="keyword">int</span> a,<span class="keyword">int</span> b,<span class="keyword">int</span> c)</span></span>&#123;</span><br><span class="line">        System.out.println(a+b+c);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//两个浮点数求和</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">sum</span><span class="params">(<span class="keyword">double</span> a,<span class="keyword">double</span> b)</span></span>&#123;</span><br><span class="line">        System.out.print((<span class="keyword">int</span>) (a+b));</span><br><span class="line">        System.out.println(<span class="string">&quot;  (打印整数部分)&quot;</span>);</span><br><span class="line">        System.out.print(a+b);</span><br><span class="line">        System.out.println(<span class="string">&quot;  (打印浮点数)&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">int</span>) (a+b);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        sum(<span class="number">10</span>,<span class="number">20</span>); <span class="comment">//30</span></span><br><span class="line">        sum(<span class="number">10</span>,<span class="number">20</span>,<span class="number">30</span>); <span class="comment">//60</span></span><br><span class="line">        sum(<span class="number">11.1</span>,<span class="number">22.2</span>); <span class="comment">//33  (打印整数部分) 33.3  (打印浮点数)</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出结果：</p>
<h2 id="code￼1"><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">30</span><br><span class="line">60</span><br><span class="line">33  (打印整数部分)</span><br><span class="line">33.3  (打印浮点数)</span><br></pre></td></tr></table></figure></h2>
<h1>结尾</h1>
<p>在构建类的时候，一般默认会构建两个方法：</p>
<ul>
<li>无参数的构造方法（默认构造方法）</li>
<li>全参的构造方法</li>
</ul>
]]></content>
      <categories>
        <category>学习笔记</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>Java--类和对象</title>
    <url>/2021/03/11/Java/Java-%E7%B1%BB%E5%92%8C%E5%AF%B9%E8%B1%A1/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\css\APlayer.min.css"><script src="\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\js\Meting.min.js"></script><h1>前言</h1>
<p>本篇文章将介绍Java类和对象的相关内容。</p>
<hr>
<h1>关于面向对象</h1>
<p>传统的结构化程序设计通过设计一系列的过程（即算法）来求解问题。一旦确定了这些过程，就要考虑存储数据的方式（即：算法 + 数据结构 = 程序）。注意在这种设计模式中，算法是第一位的，数据结构是第二位的。但是**面向对象程序设计（OOP）**调换了这一顺序：将数据放在第一位，然后再考虑操作数据的算法。</p>
<p>面向对象与面向过程的区别：</p>
<table>
<thead>
<tr>
<th></th>
<th>面向对象程序设计</th>
<th>面向过程程序设计（结构化编程）</th>
</tr>
</thead>
<tbody>
<tr>
<td>定义</td>
<td>面向对象顾名思义就是把现实中的事务都抽象成为程序设计中的“对象”，其基本思想是一切皆对象，是一种“自下而上”的设计语言，先设计组件，再完成拼装。</td>
<td>面向过程是“自上而下”的设计语言，先定好框架，再增砖添瓦。通俗点，就是先定好main()函数，然后再逐步实现mian()函数中所要用到的其他方法。</td>
</tr>
<tr>
<td>特点</td>
<td>封装、继承、多态</td>
<td>算法 + 数据结构</td>
</tr>
<tr>
<td>优势</td>
<td>适用于大型复杂系统，方便复用</td>
<td>适用于简单系统，容易理解</td>
</tr>
<tr>
<td>劣势</td>
<td>比较抽象、性能比面向过程低</td>
<td>难以应对复杂系统，难以复用，不易维护、不易扩展</td>
</tr>
<tr>
<td>对比</td>
<td>易维护、易复用、易扩展，由于面向对象有封装、继承、多态性的特性，可以设计出低耦合的系统，使系统 更加灵活、更加易于维护</td>
<td>性能比面向对象高，因为类调用时需要实例化，开销比较大，比较消耗资源;比如单片机、嵌入式开发、 Linux/Unix等一般采用面向过程开发，性能是最重要的因素。</td>
</tr>
<tr>
<td>设计语言</td>
<td>Java、Smalltalk、EIFFEL、C++、Objective-、C#、Python等</td>
<td>C、Fortran</td>
</tr>
</tbody>
</table>
<p>面向对象的基本特征：</p>
<ul>
<li>封装：保护内部的操作不被破坏；</li>
<li>继承：在原本的基础之上继续进行扩充；</li>
<li>多态：在一个指定的范围之内进行概念的转换。</li>
</ul>
<h1>类与对象的基本概念</h1>
<p>把数据以及对数据的操作方法放在一起，作为一个相互依存的整体，这就是<strong>对象</strong>；对同类对象抽象出其共性，从而形成<strong>类</strong>。类与对象是整个面向对象中最基础的组成单元。</p>
<ul>
<li>类：是抽象的概念集合，表示的是一个共性的产物，类之中定义的是属性和行为（方法）；</li>
<li>对象：对象是一种个性的表示，表示一个独立的个体，每个对象拥有自己独立的属性，依靠属性来区分不同对象。</li>
</ul>
<h1>类与对象的定义和使用</h1>
<h2 id="定义标准类">定义标准类</h2>
<p>定义一个标准类，通常拥有以下四个组成部分：</p>
<ul>
<li>所有成员变量都要使用<code>private</code>关键字修饰</li>
<li>为每一个成员变量编写一对<code>Getter/Setter</code>方法</li>
<li>编写一个无参数的构造方法</li>
<li>编写一个全参数的构造方法</li>
</ul>
<p>这样标准的类也叫做<strong>Java Bean</strong>，定义语法如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> 类名称 </span>&#123;</span><br><span class="line">      <span class="keyword">private</span> 属性 (变量) ;</span><br><span class="line">      <span class="keyword">private</span> 行为 (方法) ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如下示例，定义一个<code>Student</code>类：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name; <span class="comment">// 姓名</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age; <span class="comment">// 年龄</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Student</span><span class="params">()</span> </span>&#123; <span class="comment">//无参数的构造方法</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Student</span><span class="params">(String name, <span class="keyword">int</span> age)</span> </span>&#123; <span class="comment">//全参数的构造方法</span></span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123; <span class="comment">//变量name的Getter方法</span></span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123; <span class="comment">//变量name的Setter方法</span></span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getAge</span><span class="params">()</span> </span>&#123; <span class="comment">//变量age的Getter方法</span></span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(<span class="keyword">int</span> age)</span> </span>&#123; <span class="comment">//变量age的Setter方法</span></span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="类的使用">类的使用</h2>
<p>类的定义完成之后，无法直接使用。如果要使用，首先需要<strong>导包</strong>（这不是必须的）：</p>
<ul>
<li>导包需要指出使用的类</li>
<li>对于和当前类属于同一个包的情况，可省略导包语句不写</li>
<li><code>java.lang</code>包下的内容不需要导包</li>
<li>导包格式：<code>import 包名称.类名称;</code>（举例：import java.lang）</li>
</ul>
<p>使用类必须依靠对象，实例化对象的方法有如下两种方式：</p>
<p>方式一：声明并实例化对象</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">类名称 对象名称 = <span class="keyword">new</span> 类名称 () ;</span><br></pre></td></tr></table></figure>
<p>方式二：先声明对象，然后实例化对象</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">类名称 对象名称 = <span class="keyword">null</span> ;</span><br><span class="line">对象名称 = <span class="keyword">new</span> 类名称 () ;</span><br></pre></td></tr></table></figure>
<p>示例，实例化一个<code>student</code>对象：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//方式一</span></span><br><span class="line">Student student = <span class="keyword">new</span> Student();</span><br><span class="line"></span><br><span class="line"><span class="comment">//方式二</span></span><br><span class="line">Student student = <span class="keyword">null</span></span><br><span class="line">student = <span class="keyword">new</span> Student();</span><br></pre></td></tr></table></figure>
<p>解释语句：实例化对象语句分为两个部分，<code>new Student()</code>构造了一个Student类型的对象，并且它的值是对新创建对象的引用。这个引用存储在变量<code>student</code>中。</p>
<blockquote>
<p>引用数据类型与基本数据类型最大的不同在于：引用数据类型需要内存的分配和使用。所以，关键字new的主要功能就是分配内存空间，也就是说，只要使用引用数据类型，就要使用关键字new来分配内存空间。</p>
</blockquote>
<p>实例化对象之后，可以按照如下方式进行类的操作：</p>
<ul>
<li>调用类中的属性（变量）：<code>对象名.成员变量名;</code>（前提是类中的属性没有被关键字<code>Private</code>修饰）</li>
<li>调用类中的方法：<code>对象名.成员方法名(参数);</code></li>
</ul>
<p>示例：操作Student类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Student stu1 = <span class="keyword">new</span> Student();  <span class="comment">//声明并实例化对象（调用一个无参的构造方法）</span></span><br><span class="line">        stu1.setName(<span class="string">&quot;张三&quot;</span>);</span><br><span class="line">        stu1.setAge(<span class="number">20</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;姓名：&quot;</span> + stu1.getName() + <span class="string">&quot;，年龄：&quot;</span> + stu1.getAge());</span><br><span class="line"></span><br><span class="line">        Student stu2 = <span class="keyword">null</span>; <span class="comment">//声明对象</span></span><br><span class="line">        stu2 = <span class="keyword">new</span> Student(<span class="string">&quot;李四&quot;</span>, <span class="number">21</span>); <span class="comment">//实例化对象（调用一个全参的构造方法）</span></span><br><span class="line">        System.out.println(<span class="string">&quot;姓名：&quot;</span> + stu2.getName() + <span class="string">&quot;，年龄：&quot;</span> + stu2.getAge());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出结果：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">姓名：张三，年龄：20</span><br><span class="line">姓名：李四，年龄：21</span><br></pre></td></tr></table></figure>
<h2 id="区分不同实例化的方式">区分不同实例化的方式</h2>
<p>从内存的角度分析。当然首先要给出两种内存空间的概念：</p>
<ul>
<li>堆内存：保存对象的属性内容。堆内存需要用new关键字来分配空间；</li>
<li>栈内存：保存的是堆内存的地址（在这里为了分析方便，可以简单理解为栈内存保存的是对象的名字）。</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/Javaprocess.png" alt=""></p>
<p>在任何情况下，只要看见关键字<code>new</code>，都表示要分配新的堆内存空间，一旦堆内存空间分配了，里面就会有类中定义的属性，并且属性内容都是其对应数据类型的默认值。</p>
<p>以上两种实例化对象方式内存表示如下：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/Javaprocess4.png" alt=""></p>
<p>两种方式的差别在于①②，第一种声明并实例化的方式实际就是①②组合在一起，而第二种先声明然后实例化是把①和②分步骤来。</p>
<p>如果没有实例化对象的过程，直接使用类，如下（则会报错）：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Student stu1 = <span class="keyword">null</span>; <span class="comment">//声明对象</span></span><br><span class="line">        <span class="comment">//stu1 = new Student(); //取消实例化对象步骤</span></span><br><span class="line">        stu1.setName(<span class="string">&quot;张三&quot;</span>);</span><br><span class="line">        stu1.setAge(<span class="number">20</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;姓名：&quot;</span> + stu1.getName() + <span class="string">&quot;，年龄：&quot;</span> + stu1.getAge());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行结果：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Exception in thread &quot;main&quot; java.lang.NullPointerException</span><br><span class="line">	at Demo.Demo.main(Demo.java:8)</span><br></pre></td></tr></table></figure>
<p>此时，程序只声明了Student对象，但并没有实例化Student对象（只有了栈内存，并没有对应的堆内存空间），则程序在编译的时候不会出现任何的错误，但是在执行的时候出现了上面的错误信息。这个错误信息表示的是“NullPointerException（空指向异常）”，这种异常只要是应用数据类型都有可能出现。</p>
<h1>对象引用传递分析</h1>
<p>同一块堆内存空间，可以同时被多个栈内存所指向，不同的栈可以修改同一块堆内存的内容。</p>
<p>引用传递代码示例：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Student stu1 = <span class="keyword">new</span> Student(); <span class="comment">//声明并实例化对象stu1</span></span><br><span class="line">        stu1.setName(<span class="string">&quot;张三&quot;</span>);</span><br><span class="line">        stu1.setAge(<span class="number">20</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;姓名：&quot;</span> + stu1.getName() + <span class="string">&quot;，年龄：&quot;</span> + stu1.getAge());</span><br><span class="line"></span><br><span class="line">        Student stu2 = stu1; <span class="comment">//引用传递</span></span><br><span class="line">        stu2.setName(<span class="string">&quot;李四&quot;</span>);</span><br><span class="line">        stu1.setAge(<span class="number">21</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;姓名：&quot;</span> + stu2.getName() + <span class="string">&quot;，年龄：&quot;</span> + stu2.getAge());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出结果：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">姓名：张三，年龄：20</span><br><span class="line">姓名：李四，年龄：21</span><br></pre></td></tr></table></figure>
<p>对应的内存分配图如下：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/Javaprocess6.png" alt=""></p>
<p>我们来看另一种情况：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Student stu1 = <span class="keyword">new</span> Student(); <span class="comment">//声明并实例化对象stu1</span></span><br><span class="line">        Student stu2 = <span class="keyword">new</span> Student(); <span class="comment">//声明并实例化对象stu2</span></span><br><span class="line">        stu1.setName(<span class="string">&quot;张三&quot;</span>);</span><br><span class="line">        stu1.setAge(<span class="number">20</span>);</span><br><span class="line">        stu2.setName(<span class="string">&quot;李四&quot;</span>);</span><br><span class="line">        stu2.setAge(<span class="number">21</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;姓名：&quot;</span> + stu1.getName() + <span class="string">&quot;，年龄：&quot;</span> + stu1.getAge());</span><br><span class="line">        System.out.println(<span class="string">&quot;姓名：&quot;</span> + stu2.getName() + <span class="string">&quot;，年龄：&quot;</span> + stu2.getAge());</span><br><span class="line"></span><br><span class="line">        stu2 = stu1; <span class="comment">//引用传递</span></span><br><span class="line">        stu2.setName(<span class="string">&quot;王五&quot;</span>);</span><br><span class="line">        stu2.setAge(<span class="number">22</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;姓名：&quot;</span> + stu2.getName() + <span class="string">&quot;，年龄：&quot;</span> + stu2.getAge());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出结果：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">姓名：张三，年龄：20</span><br><span class="line">姓名：李四，年龄：21</span><br><span class="line">姓名：王五，年龄：22</span><br></pre></td></tr></table></figure>
<p>对应的内存分配图如下：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/Javaprocess7.png" alt=""></p>
<blockquote>
<p>垃圾：指的是在程序开发之中没有任何对象所指向的一块堆内存空间，这块空间就成为垃圾，所有的垃圾将等待GC（垃圾收集器）不定期的进行回收与空间的释放。</p>
</blockquote>
<h1>关于封装性</h1>
<p>前文提到面向对象的程序设计具有<strong>封装性</strong>。通俗的理解就是外部在调用类使用时，无法直接访问其内部属性，相当于对外不可见。举例如下代码：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Student stu = <span class="keyword">new</span> Student(); <span class="comment">//声明并实例化对象stu</span></span><br><span class="line">        stu.name = <span class="string">&quot;张三&quot;</span>; <span class="comment">//直接访问name属性</span></span><br><span class="line">        stu.age = <span class="number">20</span>; <span class="comment">//直接访问age属性</span></span><br><span class="line">        System.out.println(<span class="string">&quot;姓名：&quot;</span> + stu.getName() + <span class="string">&quot;，年龄：&quot;</span> + stu.getAge());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>实际上在该段代码编写阶段就会直接提示错误信息，运行后可以也可以看到错误提示，name与age变量在Student类中是private访问控制。这就是封装性的具体体现，在Student类中，变量受到private关键字修饰，致使外部无法通过直接调用其属性并修改或访问。但是我们可以在定义类中增添对应属性的Setter/Getter方法来修改、访问。这就是具有封装性的标准类的一般创建方式。</p>
<h1>关于构造方法</h1>
<p>构造方法是在对象使用关键字new实例化的时候被调用。</p>
<p>构造方法与普通方法最大的区别在于：构造方法在实例化对象（new）的时候只调用一次，而普通方法是在实例化对象之后可以随意调用多次。</p>
<p>在创建类中会默认生成一个无参数的构造方法，但是一旦定义了一个构造方法，无参构造方法将不会自动生成。一个类中至少存在一个构造方法。</p>
<p>同样的，构造方法也属于方法，同样可以重载，一般在构建类的时候，会创建一个无参数的构造的方法以及一个全参数的构造方法。（如有需要，可以自行创建其他参数形式的构造方法）：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name; <span class="comment">// 姓名</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age; <span class="comment">// 年龄</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Student</span><span class="params">()</span> </span>&#123; <span class="comment">//无参数的构造方法</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Student</span><span class="params">(String name, <span class="keyword">int</span> age)</span> </span>&#123; <span class="comment">//全参数的构造方法</span></span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>在进行构造方法重载时有一个编写建议：所有重载的构造方法按照参数的个数由多到少，或者是由少到多排列。</p>
</blockquote>
<h1>关于匿名对象</h1>
<p>没名字的对象称为匿名对象，对象的名字按照之前的内存关系来讲，在栈内存之中，而对象的具体内容在堆内存之中保存，这样，没有栈内存指向堆内存空间，就是一个匿名对象。</p>
<p>先定义一个<code>Book</code>类：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Book</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">double</span> price;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Book</span><span class="params">()</span> </span>&#123; <span class="comment">//无参的构造方法</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Book</span><span class="params">(String name, <span class="keyword">double</span> price)</span> </span>&#123; <span class="comment">//全参的构造方法</span></span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.price = price;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getInfo</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;书名：&quot;</span> + name + <span class="string">&quot;，价格：&quot;</span> + price);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>创建并使用匿名对象：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">         <span class="keyword">new</span> Book(<span class="string">&quot;Java核心技术 卷Ⅰ&quot;</span>,<span class="number">149.00</span>).getInfo(); <span class="comment">//创建并使用匿名对象</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出结果：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">书名：Java核心技术 卷Ⅰ，价格：149.0</span><br></pre></td></tr></table></figure>
<blockquote>
<p>匿名对象由于没有对应的栈内存指向，所以只能使用一次，一次之后就将成为垃圾，并且等待被GC回收释放。</p>
</blockquote>
<hr>
<h1>结尾</h1>
<p>参考资料：</p>
<blockquote>
<p><a href="https://blog.csdn.net/wei_zhi/article/details/52745268?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522161542246216780357270501%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=161542246216780357270501&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-2-52745268.first_rank_v2_pc_rank_v29&amp;utm_term=java%E7%B1%BB">《Java类和对象 详解（一）》</a></p>
<p><a href="https://blog.csdn.net/wei_zhi/article/details/52750933?spm=1001.2014.3001.5501">《Java类和对象 详解（二）》</a></p>
<p>《Java核心技术·卷 I Core Java Volume Ⅰ-Fundamentls（Eleven Edition）》</p>
</blockquote>
]]></content>
      <categories>
        <category>学习笔记</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>Java--运算符</title>
    <url>/2021/03/08/Java/Java-%E8%BF%90%E7%AE%97%E7%AC%A6/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\css\APlayer.min.css"><script src="\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\js\Meting.min.js"></script><h1>前言</h1>
<p>本文将介绍Java运算符的类型及其使用方法</p>
<hr>
<h1>运算符</h1>
<h2 id="算数运算符">算数运算符</h2>
<table>
<thead>
<tr>
<th>算数运算符</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>+</td>
<td>加法运算；字符串连接运算</td>
</tr>
<tr>
<td>-</td>
<td>减法运算</td>
</tr>
<tr>
<td>*</td>
<td>乘法运算</td>
</tr>
<tr>
<td>/</td>
<td>除法运算</td>
</tr>
<tr>
<td>%</td>
<td>取模运算（两数相除取余数）</td>
</tr>
<tr>
<td>++ / –</td>
<td>自增 / 自减运算</td>
</tr>
</tbody>
</table>
<h2 id="赋值运算符">赋值运算符</h2>
<table>
<thead>
<tr>
<th>赋值运算符</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>=</td>
<td></td>
</tr>
<tr>
<td>+=</td>
<td>a += 3    相当于       a = a + 3</td>
</tr>
<tr>
<td>-=</td>
<td>b -= 4     相当于       b = b - 4</td>
</tr>
<tr>
<td>*=</td>
<td>c *= 5     相当于       c = c * 5</td>
</tr>
<tr>
<td>/=</td>
<td>d /= 6     相当于       d = d / 6</td>
</tr>
<tr>
<td>%=</td>
<td>e %= 7     相当于       e = e % 7</td>
</tr>
</tbody>
</table>
<h2 id="比较运算符">比较运算符</h2>
<table>
<thead>
<tr>
<th>比较运算符</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>==</td>
<td>是否相等</td>
</tr>
<tr>
<td>&lt;</td>
<td>是否小于</td>
</tr>
<tr>
<td>&gt;</td>
<td>是否大于</td>
</tr>
<tr>
<td>&lt;=</td>
<td>是否小于等于</td>
</tr>
<tr>
<td>&gt;=</td>
<td>是否大于等于</td>
</tr>
<tr>
<td>!=</td>
<td>是否不等</td>
</tr>
</tbody>
</table>
<h2 id="逻辑运算符">逻辑运算符</h2>
<table>
<thead>
<tr>
<th>逻辑运算符</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>&amp;&amp;</td>
<td>与（并且）==&gt;   &amp;&amp; 全都是true，才是true；否则就是false</td>
</tr>
<tr>
<td>||</td>
<td>或（或者） ==&gt;  || 至少一个是true，就是true；全都是false，才是false</td>
</tr>
<tr>
<td>！</td>
<td>非（取反） ==&gt;  !  本来是true，变成false；本来是false，变成true</td>
</tr>
</tbody>
</table>
<h2 id="三元运算符">三元运算符</h2>
<p>格式：<code>数据类型 变量名称 = 条件判断 ? 表达式A : 表达式B;</code></p>
<p>判断条件是否成立：</p>
<ul>
<li>
<p>如果成立为true，那么将表达式A的值赋值给左侧的变量；</p>
</li>
<li>
<p>如果不成立为false，那么将表达式B的值赋值给左侧的变量；</p>
</li>
</ul>
<p>举例：</p>
<h2 id="code￼0"><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span> a , b;</span><br><span class="line">a = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果 a 等于 1 成立，则设置 b 为 20，否则为 30</span></span><br><span class="line">b = (a == <span class="number">1</span>) ? <span class="number">20</span> : <span class="number">30</span>;</span><br><span class="line">System.out.println( <span class="string">&quot;Value of b is : &quot;</span> +  b ); <span class="comment">//Value of b is : 30</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果 a 等于 10 成立，则设置 b 为 20，否则为 30</span></span><br><span class="line">b = (a == <span class="number">10</span>) ? <span class="number">20</span> : <span class="number">30</span>;</span><br><span class="line">System.out.println( <span class="string">&quot;Value of b is : &quot;</span> + b ); <span class="comment">//Value of b is : 20</span></span><br></pre></td></tr></table></figure></h2>
<h1>运算符优先级</h1>
<table>
<thead>
<tr>
<th>优先级</th>
<th>运算符</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>（）</td>
</tr>
<tr>
<td>2</td>
<td>!    +(正)    -(负)    ++    –</td>
</tr>
<tr>
<td>3</td>
<td>*    /    %</td>
</tr>
<tr>
<td>4</td>
<td>+(加)    -(减)</td>
</tr>
<tr>
<td>5</td>
<td>&lt;    &lt;=    &gt;    &gt;=</td>
</tr>
<tr>
<td>6</td>
<td>==    !=</td>
</tr>
<tr>
<td>7</td>
<td>^</td>
</tr>
<tr>
<td>8</td>
<td>&amp;&amp;</td>
</tr>
<tr>
<td>9</td>
<td>||</td>
</tr>
<tr>
<td>10</td>
<td>?:</td>
</tr>
<tr>
<td>11</td>
<td>=    +=    -=    *=    /=    %=</td>
</tr>
</tbody>
</table>
<hr>
<h1>结尾</h1>
<blockquote>
<p>参考：<a href="https://blog.csdn.net/aiowang/article/details/114460730?ops_request_misc=&amp;request_id=&amp;biz_id=102&amp;utm_term=java%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-8-114460730.first_rank_v2_pc_rank_v29">《从零打造IT知识体系-Java基础-Java基本数据类型与算法》</a></p>
</blockquote>
]]></content>
      <categories>
        <category>学习笔记</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>Java--选择结构</title>
    <url>/2021/03/08/Java/Java-%E9%80%89%E6%8B%A9%E7%BB%93%E6%9E%84/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\css\APlayer.min.css"><script src="\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\js\Meting.min.js"></script><h1>前言</h1>
<p>本文将介绍Java选择结构的相关语法</p>
<hr>
<h1>Java选择结构</h1>
<h2 id="条件语句">条件语句</h2>
<h3 id="if语句">if语句</h3>
<p>语法：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(布尔表达式)&#123;</span><br><span class="line">   <span class="comment">//如果布尔表达式为true将执行的语句</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>示例：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">demo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> x = <span class="number">10</span>;</span><br><span class="line">        <span class="keyword">if</span>( x &lt; <span class="number">20</span> )&#123;</span><br><span class="line">            System.out.print(<span class="string">&quot;若满足条件，该语句打印&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出结果：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">若满足条件，该语句打印</span><br></pre></td></tr></table></figure>
<h3 id="if…else语句">if…else语句</h3>
<p>语法:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(布尔表达式)&#123;</span><br><span class="line">   <span class="comment">//如果布尔表达式的值为true</span></span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">   <span class="comment">//如果布尔表达式的值为false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>示例：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">demo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> x = <span class="number">30</span>;</span><br><span class="line">        <span class="keyword">if</span>( x &lt; <span class="number">20</span> )&#123;</span><br><span class="line">            System.out.print(<span class="string">&quot;若满足条件，该语句打印&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            System.out.print(<span class="string">&quot;若不满足条件，该语句打印&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出结果：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">若不满足条件，该语句打印</span><br></pre></td></tr></table></figure>
<h3 id="if…else-if…else语句">if…else if…else语句</h3>
<p>语法：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(布尔表达式 <span class="number">1</span>)&#123;</span><br><span class="line">   <span class="comment">//如果布尔表达式 1的值为true执行代码</span></span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(布尔表达式 <span class="number">2</span>)&#123;</span><br><span class="line">   <span class="comment">//如果布尔表达式 2的值为true执行代码</span></span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(布尔表达式 <span class="number">3</span>)&#123;</span><br><span class="line">   <span class="comment">//如果布尔表达式 3的值为true执行代码</span></span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">   <span class="comment">//如果以上布尔表达式都不为true执行代码</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>示例：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">demo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> x = <span class="number">40</span>;</span><br><span class="line">        <span class="keyword">if</span>( x == <span class="number">10</span> )&#123;</span><br><span class="line">            System.out.print(<span class="string">&quot;Value of X is 10&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>( x == <span class="number">20</span> )&#123;</span><br><span class="line">            System.out.print(<span class="string">&quot;Value of X is 20&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>( x == <span class="number">30</span> )&#123;</span><br><span class="line">            System.out.print(<span class="string">&quot;Value of X is 30&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            System.out.print(<span class="string">&quot;条件都不满足，该语句打印&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出结果：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">条件都不满足，该语句打印</span><br></pre></td></tr></table></figure>
<h2 id="switch-case-语句">switch case 语句</h2>
<blockquote>
<p>switch case 语句判断一个变量与一系列值中某个值是否相等，每个值称为一个分支。</p>
</blockquote>
<p>说明：</p>
<ul>
<li>switch 语句中的变量类型可以是： byte、short、int 或者 char。从 Java SE 7 开始，switch 支持字符串 String 类型，同时 case 标签必须为字符串常量或字面量。</li>
<li>switch 语句可以拥有多个 case 语句。每个 case 后面跟一个要比较的值和冒号。</li>
<li>case 语句中的值的数据类型必须与变量的数据类型相同，而且只能是常量或者字面常量。</li>
<li>当变量的值与 case 语句的值相等时，那么 case 语句之后的语句开始执行，直到 break 语句出现才会跳出 switch 语句。</li>
<li>当遇到 break 语句时，switch 语句终止。程序跳转到 switch 语句后面的语句执行。case 语句不必须要包含 break 语句。如果没有 break 语句出现，程序会继续执行下一条 case 语句，直到出现 break 语句。</li>
<li>switch 语句可以包含一个 default 分支，该分支一般是 switch 语句的最后一个分支（可以在任何位置，但建议在最后一个）。default 在没有 case 语句的值和变量值相等的时候执行。default 分支不需要 break 语句。</li>
</ul>
<p>语法：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">switch</span>(expression)&#123;</span><br><span class="line">    <span class="keyword">case</span> value :</span><br><span class="line">       <span class="comment">//语句</span></span><br><span class="line">       <span class="keyword">break</span>; <span class="comment">//可选</span></span><br><span class="line">    <span class="keyword">case</span> value :</span><br><span class="line">       <span class="comment">//语句</span></span><br><span class="line">       <span class="keyword">break</span>; <span class="comment">//可选</span></span><br><span class="line">    <span class="comment">//可以有任意数量的case语句</span></span><br><span class="line">    <span class="keyword">default</span> : <span class="comment">//可选</span></span><br><span class="line">       <span class="comment">//语句</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>示例：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">demo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">char</span> grade = <span class="string">&#x27;C&#x27;</span>;</span><br><span class="line">        <span class="keyword">switch</span>(grade)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;A&#x27;</span> :</span><br><span class="line">                System.out.println(<span class="string">&quot;优秀&quot;</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;B&#x27;</span> :</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;C&#x27;</span> :</span><br><span class="line">                System.out.println(<span class="string">&quot;良好&quot;</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;D&#x27;</span> :</span><br><span class="line">                System.out.println(<span class="string">&quot;及格&quot;</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;F&#x27;</span> :</span><br><span class="line">                System.out.println(<span class="string">&quot;你需要再努力努力&quot;</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span> :</span><br><span class="line">                System.out.println(<span class="string">&quot;未知等级&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;你的等级是 &quot;</span> + grade);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出结果:</p>
<h2 id="code￼11"><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">良好</span><br><span class="line">你的等级是 C</span><br></pre></td></tr></table></figure></h2>
<h1>结尾</h1>
<blockquote>
<p>参考：<a href="https://blog.csdn.net/aiowang/article/details/114460730?ops_request_misc=&amp;request_id=&amp;biz_id=102&amp;utm_term=java%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-8-114460730.first_rank_v2_pc_rank_v29">《从零打造IT知识体系-Java基础-Java基本数据类型与算法》</a></p>
</blockquote>
]]></content>
      <categories>
        <category>学习笔记</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>快速搭建一个express服务器</title>
    <url>/2021/11/02/NodeJS/%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AAexpress%E6%9C%8D%E5%8A%A1%E5%99%A8/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\css\APlayer.min.css"><script src="\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\js\Meting.min.js"></script><h1>前言</h1>
<p>无意间浏览到<a href="https://blog.juanertu.com/">二兔</a>的博客，看到一篇关于express服务器搭建的文章</p>
<p>原文指引 → <a href="https://blog.juanertu.com/archives/b3aa6458.html">一分钟搭建一个简单 express 服务器 | 你真是一个美好的人类 (juanertu.com)</a></p>
<p>正巧最近在学习前端的一些内容，在使用ajax时需要一些后台的数据处理，这不是巧了嘛</p>
<hr>
<h1>快速搭建express服务器</h1>
<ol>
<li>
<p>新建文件<code>server.js</code>，编写如下代码：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="keyword">let</span> app = express()</span><br><span class="line"></span><br><span class="line">app.all(<span class="string">&#x27;*&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//设置允许跨域的域名，*代表允许任意域名跨域</span></span><br><span class="line">  res.header(<span class="string">&#x27;Access-Control-Allow-Origin&#x27;</span>, <span class="string">&#x27;*&#x27;</span>)</span><br><span class="line">  <span class="comment">//允许的header类型</span></span><br><span class="line">  res.header(<span class="string">&#x27;Access-Control-Allow-Headers&#x27;</span>, <span class="string">&#x27;content-type&#x27;</span>)</span><br><span class="line">  <span class="comment">//跨域允许的请求方式</span></span><br><span class="line">  res.header(<span class="string">&#x27;Access-Control-Allow-Methods&#x27;</span>, <span class="string">&#x27;DELETE,PUT,POST,GET,OPTIONS&#x27;</span>)</span><br><span class="line">  <span class="keyword">if</span> (req.method.toLowerCase() == <span class="string">&#x27;options&#x27;</span>) res.send(<span class="number">200</span>)</span><br><span class="line">  <span class="comment">//让options尝试请求快速结束</span></span><br><span class="line">  <span class="keyword">else</span> next()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&#x27;/&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.json(&#123;</span><br><span class="line">    msg: <span class="string">&#x27;THIS IS INDEX&#x27;</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line">app.get(<span class="string">&#x27;/about&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.json(&#123;</span><br><span class="line">    msg: <span class="string">&#x27;THIS IS ABOUT&#x27;</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;http://localhost:3000&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>安装express，命令如下：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm install express --save</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>启动项目：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">node server.js</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>访问<code>localhost:3000</code>去看看结果吧</p>
</li>
</ol>
<hr>
<h1>加法计算器案例</h1>
<p>如此一来，就可以开始做一个简单的基于express的加法计算器案例。</p>
<p>（当然这个功能的实现完全用不到后端，这里单纯就是为了使用而使用）</p>
<p>首先给出案例Demo的目录结构：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">│  index.html</span><br><span class="line">│  </span><br><span class="line">└─js</span><br><span class="line">        ajax.js</span><br><span class="line">        server.js</span><br></pre></td></tr></table></figure>
<blockquote>
<p>说明：</p>
<ul>
<li>index.html：加法计算器的展示页面</li>
<li>ajax.js：利用ajax发送异步请求</li>
<li>server.js：express后台服务器</li>
</ul>
</blockquote>
<ol>
<li>
<p>index.html</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./js/ajax.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;task3&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>实验：AJAX操作<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>我们使用AJAX的方式来计算和<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;num1&quot;</span>&gt;</span>+</span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;num2&quot;</span>&gt;</span>=</span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">&quot;sum&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">&quot;cal()&quot;</span>&gt;</span>计算<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>ajax.js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">xhr.onreadystatechange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>((xhr.readyState==<span class="number">4</span>) &amp;&amp; (xhr.status==<span class="number">200</span>))&#123;</span><br><span class="line">    <span class="built_in">document</span>.getElementById(<span class="string">&quot;sum&quot;</span>).innerHTML=xhr.responseText;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">cal</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> num1 = <span class="built_in">document</span>.getElementById(<span class="string">&quot;num1&quot;</span>).value;</span><br><span class="line">  <span class="keyword">var</span> num2 = <span class="built_in">document</span>.getElementById(<span class="string">&quot;num2&quot;</span>).value;</span><br><span class="line">  xhr.open(<span class="string">&quot;GET&quot;</span>,<span class="string">&#x27;http://127.0.0.1:8081/ajax/?num1=&#x27;</span>+num1+<span class="string">&#x27;&amp;num2=&#x27;</span>+num2,<span class="literal">true</span>);</span><br><span class="line">  xhr.send();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>server.js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="keyword">let</span> app = express()</span><br><span class="line"></span><br><span class="line">app.all(<span class="string">&#x27;*&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//设置允许跨域的域名，*代表允许任意域名跨域</span></span><br><span class="line">  res.header(<span class="string">&#x27;Access-Control-Allow-Origin&#x27;</span>, <span class="string">&#x27;*&#x27;</span>)</span><br><span class="line">  <span class="comment">//允许的header类型</span></span><br><span class="line">  res.header(<span class="string">&#x27;Access-Control-Allow-Headers&#x27;</span>, <span class="string">&#x27;content-type&#x27;</span>)</span><br><span class="line">  <span class="comment">//跨域允许的请求方式</span></span><br><span class="line">  res.header(<span class="string">&#x27;Access-Control-Allow-Methods&#x27;</span>, <span class="string">&#x27;DELETE,PUT,POST,GET,OPTIONS&#x27;</span>)</span><br><span class="line">  <span class="keyword">if</span> (req.method.toLowerCase() == <span class="string">&#x27;options&#x27;</span>) res.send(<span class="number">200</span>)</span><br><span class="line">  <span class="comment">//让options尝试请求快速结束</span></span><br><span class="line">  <span class="keyword">else</span> next()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//计算</span></span><br><span class="line">app.get(<span class="string">&#x27;/ajax&#x27;</span>,<span class="function"><span class="keyword">function</span>(<span class="params">req,res</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> num1 = req.query.num1; <span class="comment">//接收为string类型</span></span><br><span class="line">  <span class="keyword">var</span> num2 = req.query.num2; <span class="comment">//接收为string类型</span></span><br><span class="line">  <span class="keyword">var</span> result = <span class="built_in">Number</span>(num1)+<span class="built_in">Number</span>(num2);  <span class="comment">//转化为数字类型计算</span></span><br><span class="line">  res.send(result.toString());  <span class="comment">//返回string类型</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">8081</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;http://localhost:8081&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>终端进入server.js的目录下，键入命令<code>node server.js</code>启动后台服务</p>
</li>
<li>
<p>点击进入<code>index.html</code>，就可以看到效果</p>
<p><img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Express%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E6%9C%8D%E5%8A%A1%E5%99%A8show.gif" alt=""></p>
</li>
</ol>
<hr>
<h1>后记</h1>
<blockquote>
<p>参考文章：<a href="https://blog.juanertu.com/archives/b3aa6458.html">一分钟搭建一个简单 express 服务器 | 你真是一个美好的人类 (juanertu.com)</a></p>
</blockquote>
]]></content>
      <categories>
        <category>Node</category>
      </categories>
      <tags>
        <tag>Node</tag>
        <tag>Express</tag>
        <tag>Ajax</tag>
      </tags>
  </entry>
  <entry>
    <title>Java学习记录</title>
    <url>/2021/03/28/Java/Java%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\css\APlayer.min.css"><script src="\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\js\Meting.min.js"></script><p><em><strong>写这篇算作目录，方便查询</strong></em></p>
<hr>
<h1>Hello World</h1>
<div class="btn-center">
<a class="btn-beautify button--animated block outline larger" href="/2021/03/08/Java/Java--HelloWorld/" 
  title="点击跳转 至 《HelloWorld》"><i class="far fa-hand-point-right"></i><span>点击跳转 至 《HelloWorld》</span></a>
</div>
<h1>基本数据类型</h1>
<div class="btn-center">
<a class="btn-beautify button--animated block outline blue larger" href="/2021/03/08/Java/Java-%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/" 
  title="点击跳转 至 《基本数据类型》"><i class="far fa-hand-point-right"></i><span>点击跳转 至 《基本数据类型》</span></a>
</div>
<h1>运算符</h1>
<div class="btn-center">
<a class="btn-beautify button--animated block outline pink larger" href="/2021/03/08/Java/Java-%E8%BF%90%E7%AE%97%E7%AC%A6/" 
  title="点击跳转 至 《运算符》"><i class="far fa-hand-point-right"></i><span>点击跳转 至 《运算符》</span></a>
</div>
<h1>循环结构</h1>
<div class="btn-center">
<a class="btn-beautify button--animated block outline red larger" href="/2021/03/08/Java/Java-%E5%BE%AA%E7%8E%AF%E7%BB%93%E6%9E%84/" 
  title="点击跳转 至 《循环结构》"><i class="far fa-hand-point-right"></i><span>点击跳转 至 《循环结构》</span></a>
</div>
<h1>选择结构</h1>
<div class="btn-center">
<a class="btn-beautify button--animated block outline purple larger" href="/2021/03/08/Java/Java-%E9%80%89%E6%8B%A9%E7%BB%93%E6%9E%84/" 
  title="点击跳转 至 《选择结构》"><i class="far fa-hand-point-right"></i><span>点击跳转 至 《选择结构》</span></a>
</div>
<h1>方法重载</h1>
<div class="btn-center">
<a class="btn-beautify button--animated block outline orange larger" href="/2021/03/09/Java/Java-%E6%96%B9%E6%B3%95%E9%87%8D%E8%BD%BD/" 
  title="点击跳转 至 《方法重载》"><i class="far fa-hand-point-right"></i><span>点击跳转 至 《方法重载》</span></a>
</div>
<h1>数组</h1>
<div class="btn-center">
<a class="btn-beautify button--animated block outline green larger" href="/2021/03/09/Java/Java-%E6%95%B0%E7%BB%84/" 
  title="点击跳转 至 《数组》"><i class="far fa-hand-point-right"></i><span>点击跳转 至 《数组》</span></a>
</div>
<h1>类和对象</h1>
<div class="btn-center">
<a class="btn-beautify button--animated block outline larger" href="/2021/03/11/Java/Java-%E7%B1%BB%E5%92%8C%E5%AF%B9%E8%B1%A1/" 
  title="点击跳转 至 《类和对象》"><i class="far fa-hand-point-right"></i><span>点击跳转 至 《类和对象》</span></a>
</div>]]></content>
      <categories>
        <category>学习笔记</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>Python OSError: [Errno 22] Invalid argument 错误解决</title>
    <url>/2021/02/06/Python/Python%20OSError-Errno-22-Invalid-argument%20%E9%94%99%E8%AF%AF%E8%A7%A3%E5%86%B3/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\css\APlayer.min.css"><script src="\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\js\Meting.min.js"></script><h1>问题描述</h1>
<p>在爬取视频数据并保存到本地时报错：<code>OSError: [Errno 22] Invalid argument</code></p>
<h2 id="code￼0"><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">OSError: [Errno <span class="number">22</span>] Invalid argument: <span class="string">&#x27;练习/汪涵与那些了不起的敦煌人|辗转千年，终其一生.mp4&#x27;</span></span><br></pre></td></tr></table></figure></h2>
<h1>解决思路</h1>
<p>在爬取其他视频时并没有报此错误，对比后发现是视频名称的问题：在调用<code>open</code>函数时，文件路径中含有字符<code>|</code>，导致报错。</p>
<h2 id="code￼1"><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(video_path+<span class="string">&#x27;.mp4&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> fp:</span><br><span class="line">	fp.write(video_data)</span><br></pre></td></tr></table></figure></h2>
<h1>问题解决</h1>
<p>在爬取文件名时，将符号<code>|</code>替换掉。这里直接将其删去。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">name = new_tree.xpath(<span class="string">&#x27;//*[@id=&quot;detailsbd&quot;]/div[1]/div[2]/div/div[1]/h1/text()&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">	name = name.replace(<span class="string">&quot;|&quot;</span>,<span class="string">&quot;&quot;</span>)  <span class="comment"># 将文件名中的“|”删去</span></span><br></pre></td></tr></table></figure>
<p>至此问题得以解决。</p>
]]></content>
      <categories>
        <category>Python</category>
        <category>错误</category>
      </categories>
      <tags>
        <tag>Python错误</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue学习-Promise</title>
    <url>/2021/08/17/Vue/Vue%E5%AD%A6%E4%B9%A0-Promise/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\css\APlayer.min.css"><script src="\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\js\Meting.min.js"></script><h1>前言</h1>
<p>本文将介绍Promise的使用。</p>
<p>由于没有后端代码，对于ajax异步请求事件的实现就用<code>setTimeout()</code>函数代替：</p>
<h2 id="code￼0"><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;Hello World&#x27;</span>);</span><br><span class="line">&#125;, <span class="number">1000</span>)</span><br></pre></td></tr></table></figure></h2>
<h1>Promise</h1>
<p>ES6提供了Promise对象。对于有异步请求的需求时，可以使用Promise对异步操作进行封装。其优势就是可以将异步操作以同步操作的流程表达出来，避免了层层嵌套的回调函数（“回调地狱”）。</p>
<h2 id="基本使用">基本使用</h2>
<h3 id="创建">创建</h3>
<p>可以直接使用new来调用Promise的构造器来进行实例化：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//异步处理代码</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>说明：</p>
<p>Promise的参数为一个函数，该函数又会调用<code>resolve</code>或者<code>reject</code>函数</p>
</blockquote>
<h3 id="三种状态">三种状态</h3>
<p>Promise 对象有三种状态：</p>
<ul>
<li>pending: 初始状态，不是成功或失败状态</li>
<li>fulfilled: 意味着操作成功完成</li>
<li>rejected: 意味着操作失败</li>
</ul>
<h3 id="使用">使用</h3>
<p>当异步请求成功时，会调用<code>resolve</code>函数，其中该函数的参数即为请求的数据，在<code>Promise</code>对象的末尾可以接<code>promise.then()</code>函数，其中请求的数据可以被<code>then()</code>接收，进行处理：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> data = <span class="number">1</span>  <span class="comment">//为请求的参数</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    resolve(data)  <span class="comment">//当请求成功时调用resolve，并将data进行传递</span></span><br><span class="line">  &#125;,<span class="number">1000</span>)</span><br><span class="line">&#125;).then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;  <span class="comment">//接收resolve传来的参数data</span></span><br><span class="line">  data = data + <span class="number">2</span>  <span class="comment">//对请求来的数据进行操作</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;参数接收并修改为：&#x27;</span> + data)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Promise-异步请求成功.png" style="zoom:80%;" />
<p>当异步请求失败时，会调用<code>reject</code>函数，该函数中的参数可以设置为一些错误信息，在<code>Promise</code>对象的末尾可以接<code>promise.catch()</code>函数，其中错误信息可以被<code>catch()</code>接收：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> data = <span class="number">1</span>  <span class="comment">//为请求的参数</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// resolve(data)  //当请求成功时调用resolve，并将data进行传递</span></span><br><span class="line"></span><br><span class="line">    reject(<span class="string">&#x27;未请求到数据&#x27;</span>)  <span class="comment">//当请求成功时调用reject，并将错误信息进行传递</span></span><br><span class="line">  &#125;,<span class="number">1000</span>)</span><br><span class="line">&#125;).then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;  <span class="comment">//接收resolve传来的参数data</span></span><br><span class="line">  data = data + <span class="number">2</span>  <span class="comment">//对请求来的数据进行操作</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;参数接收并修改为：&#x27;</span> + data)</span><br><span class="line">&#125;).catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;  <span class="comment">//接收reject传来的参数（错误信息）</span></span><br><span class="line">  <span class="built_in">console</span>.log(err)  <span class="comment">//可以对该参数进行操作</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>此外，<code>promise.then()</code>函数可以同时接收两个参数，即<code>resolve</code>传递的请求数据以及<code>reject</code>传递的错误信息，因此可以使用以下格式简写：</p>
<p><code>new Promise((*resolve*, *reject*) *=&gt;* &#123;&#125;).then(*data* *=&gt;* &#123;&#125;, *err* *=&gt;* &#123;&#125;)</code></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> data = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    resolve(data)</span><br><span class="line">    reject(<span class="string">&#x27;未请求到数据&#x27;</span>)</span><br><span class="line">  &#125;, <span class="number">1000</span>)</span><br><span class="line">&#125;).then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">  data = data + <span class="number">2</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;参数接收并修改为：&#x27;</span> + data)</span><br><span class="line">&#125;, <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(err)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="Promise的链式调用">Promise的链式调用</h2>
<h3 id="链式调用">链式调用</h3>
<p>无论是<code>promise.then()</code>函数还是<code>promise.catch()</code>函数，都可以返回一个<code>Promise</code>对象。基于此可以实现链式调用，以处理不同的异步请求。这便是Promise的优势，在实现层层嵌套的回调函数（请求）的同时又不失代码格式的整洁：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> data = <span class="number">1</span>  <span class="comment">//初次请求的数据</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    resolve(data)  <span class="comment">//第一次网络请求</span></span><br><span class="line">    <span class="comment">// reject(&#x27;请求数据失败&#x27;)</span></span><br><span class="line">  &#125;, <span class="number">1000</span>)</span><br><span class="line">&#125;).then(<span class="function">(<span class="params">data2</span>) =&gt;</span> &#123;  <span class="comment">//接收上层resolve传来的数据（data）</span></span><br><span class="line">  data2 = data2 + <span class="number">1</span>  <span class="comment">//第一次处理请求</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;处理第一次请求数据，将其改为：&#x27;</span> + data2)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;  <span class="comment">//返回一个新的Promise对象</span></span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      resolve(data2)  <span class="comment">//第二次网络请求</span></span><br><span class="line">      <span class="comment">// reject(&#x27;请求数据失败&#x27;)</span></span><br><span class="line">    &#125;, <span class="number">1000</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;).then(<span class="function">(<span class="params">data3</span>) =&gt;</span> &#123;  <span class="comment">//接收上层resolve传来的数据（data2）</span></span><br><span class="line">  data3 = data3 + <span class="number">1</span>  <span class="comment">//第二次处理请求</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;处理第二次请求数据，将其改为：&#x27;</span> + data3)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;  <span class="comment">//返回一个新的Promise对象</span></span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      resolve(data3)  <span class="comment">//第三次网络请求</span></span><br><span class="line">      <span class="comment">// reject(&#x27;请求数据失败&#x27;)</span></span><br><span class="line">    &#125;, <span class="number">1000</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;).then(<span class="function">(<span class="params">data4</span>) =&gt;</span> &#123;  <span class="comment">//接收上层resolve传来的数据（data3）</span></span><br><span class="line">  data4 = data4 + <span class="number">1</span>  <span class="comment">//第三次处理请求</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;处理第三次请求数据，将其改为：&#x27;</span> + data4)</span><br><span class="line">&#125;).catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(err)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>运行结果如下：</p>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Promise-链式编程.png" style="zoom:80%;" />
<blockquote>
<p>说明：</p>
<p>可以在任意位置调用<code>promise.catch()</code>函数进行错误捕获，一旦在这函数之前的“链”中有异步请求错误，都会捕捉到这一信息。</p>
</blockquote>
<h3 id="简写一">简写一</h3>
<p><code>new Promise(resolve =&gt; resolve(结果))</code>可以简写：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> data = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    resolve(data)</span><br><span class="line">  &#125;, <span class="number">1000</span>)</span><br><span class="line">&#125;).then(<span class="function">(<span class="params">data2</span>) =&gt;</span> &#123;</span><br><span class="line">  data2 = data2 + <span class="number">1</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;处理第一次请求数据，将其改为：&#x27;</span> + data2)</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Promise</span>.resolve(data2)</span><br><span class="line">  <span class="comment">// throw &#x27;请求异常&#x27;</span></span><br><span class="line">&#125;).then(<span class="function">(<span class="params">data3</span>) =&gt;</span> &#123;</span><br><span class="line">  data3 = data3 + <span class="number">1</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;处理第二次请求数据，将其改为：&#x27;</span> + data3)</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Promise</span>.resolve(data3)</span><br><span class="line">  <span class="comment">// throw &#x27;请求异常&#x27;</span></span><br><span class="line">&#125;).then(<span class="function">(<span class="params">data4</span>) =&gt;</span> &#123;</span><br><span class="line">  data4 = data4 + <span class="number">1</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;处理第三次请求数据，将其改为：&#x27;</span> + data4)</span><br><span class="line">  <span class="comment">// throw &#x27;请求异常&#x27;</span></span><br><span class="line">&#125;).catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(err)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>说明：</p>
<p>可以在新的请求后添加<code>throw</code>关键词，以将错误信息抛出，最后可以用<code>promise.catch()</code>函数进行捕获。</p>
</blockquote>
<h3 id="简写二">简写二</h3>
<p>可以进一步把<code>Promise.resolve()</code>省略：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> data = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    resolve(data)</span><br><span class="line">  &#125;, <span class="number">1000</span>)</span><br><span class="line">&#125;).then(<span class="function">(<span class="params">data2</span>) =&gt;</span> &#123;</span><br><span class="line">  data2 = data2 + <span class="number">1</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;处理第一次请求数据，将其改为：&#x27;</span> + data2)</span><br><span class="line">  <span class="keyword">return</span> data2</span><br><span class="line">  <span class="comment">// throw &#x27;请求异常&#x27;</span></span><br><span class="line">&#125;).then(<span class="function">(<span class="params">data3</span>) =&gt;</span> &#123;</span><br><span class="line">  data3 = data3 + <span class="number">1</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;处理第二次请求数据，将其改为：&#x27;</span> + data3)</span><br><span class="line">  <span class="keyword">return</span> data3</span><br><span class="line">  <span class="comment">// throw &#x27;请求异常&#x27;</span></span><br><span class="line">&#125;).then(<span class="function">(<span class="params">data4</span>) =&gt;</span> &#123;</span><br><span class="line">  data4 = data4 + <span class="number">1</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;处理第三次请求数据，将其改为：&#x27;</span> + data4)</span><br><span class="line">  <span class="comment">// throw &#x27;请求异常&#x27;</span></span><br><span class="line">&#125;).catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(err)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>说明：</p>
<p><code>return</code>默认返回的数据可以作为新的请求。</p>
</blockquote>
<hr>
<h1>后记</h1>
<p>为了更好的理解axios。</p>
]]></content>
      <categories>
        <category>学习笔记</category>
      </categories>
      <tags>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>Scrapy框架（一）：基本使用</title>
    <url>/2021/01/28/Scrapy%E6%A1%86%E6%9E%B6/Scrapy%E6%A1%86%E6%9E%B6%EF%BC%88%E4%B8%80%EF%BC%89%EF%BC%9A%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\css\APlayer.min.css"><script src="\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\js\Meting.min.js"></script><h1>前言</h1>
<p>本篇文章简单介绍一下Scrapy框架的基本使用方法，以及在使用过程中遇到的一些问题和解决方案。</p>
<hr>
<h1>Scrapy框架的基本使用</h1>
<h2 id="环境的安装">环境的安装</h2>
<p><strong>1.输入下述指令安装<code>wheel</code></strong></p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">pip install wheel</span><br></pre></td></tr></table></figure>
<p><strong>2.下载<code>twisted</code></strong></p>
<p>这里提供一个下载链接:<a href="http://www.lfd.uci.edu/~gohlke/pythonlibs/#twisted">http://www.lfd.uci.edu/~gohlke/pythonlibs/#twisted</a></p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/twisted.png" alt=""></p>
<blockquote>
<p>注：这里下载有两点需要注意：</p>
<ol>
<li>要下载与自己python版本相对应的文件，<code>cpxx</code>为版本号。（例如我的python版本为3.8.2，就下载cp38的文件）</li>
<li>根据操作系统位数下载对应文件。32位操作系统下载<code>win32</code>；64位操作系统下载win_amd64。</li>
</ol>
</blockquote>
<p><strong>3.安装<code>twisted</code></strong></p>
<p>在上一步下载好的twisted的目录下输入下面的命令：</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">pip install Twisted<span class="literal">-20</span>.<span class="number">3.0</span><span class="literal">-cp38</span><span class="literal">-cp38</span><span class="literal">-win_amd64</span>.whl</span><br></pre></td></tr></table></figure>
<p><strong>4.输入下述指令安装<code>pywin32</code></strong></p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">pip install pywin32</span><br></pre></td></tr></table></figure>
<p><strong>5.输入下述指令安装<code>scrapy</code></strong></p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">pip install scrapy</span><br></pre></td></tr></table></figure>
<p><strong>6.测试</strong></p>
<p>在终端里输入<code>scrapy</code>命令，没有报错即表示安装成功。</p>
<h2 id="创建scrapy工程">创建scrapy工程</h2>
<p>这里是在PyCharm中创建的scrapy工程</p>
<p><strong>1.打开<code>Terminal</code>面板，输入下述指令创建一个scrapy工程</strong></p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">scrapy startproject ProjectName</span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>ProjectName</code>为项目名称，自己定义。</p>
</blockquote>
<p><strong>2.自动生成如下目录</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/tree.png" alt=""></p>
<p><strong>3.创建一个爬虫文件</strong></p>
<p>首先进入刚刚创建的工程目录下：</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> ProjectName</span><br></pre></td></tr></table></figure>
<p>然后在spiders子目录中创建一个爬虫文件</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">scrapy genspider spiderName www.xxx.com</span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>spiderName</code>为爬虫文件名称，自己定义。</p>
</blockquote>
<p><strong>4.执行工程</strong></p>
<h2 id="code￼7"><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">scrapy crawl spiderName</span><br></pre></td></tr></table></figure></h2>
<h2 id="文件参数的修改">文件参数的修改</h2>
<p>为了能更好的执行爬虫项目，需要修改一些文件的参数。</p>
<p><strong>1.<code>spiderName.py</code></strong></p>
<p>该爬虫文件的内容如下：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> scrapy</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FirstSpider</span>(<span class="params">scrapy.Spider</span>):</span></span><br><span class="line">    <span class="comment"># 爬虫文件的名称：就是爬虫源文件的一个唯一标识</span></span><br><span class="line">    name = <span class="string">&#x27;spiderName&#x27;</span></span><br><span class="line">    <span class="comment"># 允许的域名：用来限定start_urls列表中哪些url可以进行请求发送</span></span><br><span class="line">    allowed_domains = [<span class="string">&#x27;www.baidu.com&#x27;</span>]</span><br><span class="line">    <span class="comment"># 起始的url列表：该列表中存放的url会被scrapy自动进行请求的发送</span></span><br><span class="line">    start_urls = [<span class="string">&#x27;http://www.baidu.com/&#x27;</span>,<span class="string">&#x27;https://www.douban.com&#x27;</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 用于数据解析：response参数表示的就是请求成功后对应的响应对象</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">parse</span>(<span class="params">self, response</span>):</span></span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>注：<code>allowed_domains</code>列表用来限定请求的url。一般情况不需要，将其注释掉即可。</p>
</blockquote>
<p><strong>2.<code>settings.py</code></strong></p>
<p>1). ROBOTSTXT_OBEY</p>
<p>找到<code>ROBOTSTXT_OBEY</code>关键字，此处默认参数为Ture。（即项目默认遵守<code>robots协议</code>）为了项目练习，可以暂时将其改为<code>False</code>。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Obey robots.txt rules</span></span><br><span class="line">ROBOTSTXT_OBEY = <span class="literal">False</span></span><br></pre></td></tr></table></figure>
<p>2). USER_AGENT</p>
<p>找到<code>USER_AGENT</code>关键字，此处默认注释掉了。修改其内容，以避免UA反爬。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Crawl responsibly by identifying yourself (and your website) on the user-agent</span></span><br><span class="line">USER_AGENT = <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4324.96 Safari/537.36 Edg/88.0.705.50&#x27;</span></span><br></pre></td></tr></table></figure>
<p>3). LOG_LEVEL</p>
<p>为了更清晰的查看项目运行结果（项目默认运行结果会打印大量的日志信息），可以手动添加<code>LOG_LEVEL</code>关键字。</p>
<h2 id="code￼11"><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 显示指定类型的日志信息</span></span><br><span class="line">LOG_LEVEL = <span class="string">&#x27;ERROR&#x27;</span> <span class="comment"># 只显示错误信息</span></span><br></pre></td></tr></table></figure></h2>
<h1>可能遇到的问题</h1>
<p><strong>1.成功安装完<code>scrapy</code>，但是在创建爬虫文件后依然显示<code>import scrapy</code>有误。</strong></p>
<p>本人练习时用的环境都是基于Python3.8创建的各种虚拟环境，然而在搭建scrapy项目时<code>pip install scrapy</code>始终报错。</p>
<p>最初手动在官网：<a href="https://scrapy.org/">https://scrapy.org/</a> 下载scrapy库，然后安装到虚拟环境的<code>site-packages</code>目录下，果然回头看<code>import scrapy</code>显示正常了，程序也可以跑。但是依然打印大量的错误信息，通过PyCharm的<code>Python Interpreter</code>查看并没有<code>Scrapy</code>库在内。</p>
<p>无奈又尝试了一些解决方案，无果…</p>
<p>最后发现<code>Anaconda</code>自带<code>Scrapy</code>库，于是又基于<code>Anaconda</code>创建了一个虚拟环境，完美运行~~~~</p>
<hr>
<h1>结尾</h1>
<p><em><strong>好好学习</strong></em></p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Scrapy</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue学习-Vue CLI</title>
    <url>/2021/08/13/Vue/Vue%E5%AD%A6%E4%B9%A0-Vue-cli/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\css\APlayer.min.css"><script src="\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\js\Meting.min.js"></script><h1>前言</h1>
<p>本文将介绍Vue-CLI的使用。</p>
<hr>
<h1>Vue-CLI</h1>
<h2 id="介绍">介绍</h2>
<p>CLI：Command-Line Interface，俗称<code>脚手架</code>。</p>
<p>使用Vue-CLI可以快速搭建Vue开发环境以及对应的webpack配置。</p>
<blockquote>
<p>注意：以下内容主要介绍CLI2和CLI3.</p>
</blockquote>
<p>使用前提：需要<code>NodeJS</code>和<code>Webpack</code></p>
<h2 id="基本使用（CLI2）">基本使用（CLI2）</h2>
<h3 id="安装">安装</h3>
<p>在终端键入如下命令（注意指定版本号）进行全局安装：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm install @vue&#x2F;cli -g</span><br></pre></td></tr></table></figure>
<p>如果想按照Vue-CLI2的方式初始化项目需要安装2.x的模板，在终端键入如下命令（注意指定版本号）：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm install @vue&#x2F;cli-init -g</span><br></pre></td></tr></table></figure>
<h3 id="初始化项目">初始化项目</h3>
<p>在终端键入命令：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">vue init webpack projectname</span><br></pre></td></tr></table></figure>
<p>这里进行Vue-CLI2的项目展示：</p>
<p>创建项目时会遇到如下选项：</p>
<ul>
<li>
<p><code>创建时的项目名称</code>：会根据该名称创建项目文件夹，存放之后的项目内容。不能包含大写字母等。</p>
</li>
<li>
<p><code>Project name</code>：可以设置，默认为创建时的项目名称。</p>
</li>
<li>
<p><code>Project description</code>：默认为<code>A Vue.js project</code>。</p>
</li>
<li>
<p><code>Author</code>：作者的信息，默认从<code>.gitconfig</code>文件中读取。</p>
</li>
<li>
<p><code>Vue build</code>：有两种构建版本可选择（<code>runtime-compiler</code>和<code>runtime-only</code>）。</p>
</li>
<li>
<p><code>Install vue-router</code>：选择是否创建路由。</p>
</li>
<li>
<p><code>Use ESLint to lint your code</code>：是否选择ESLint检测代码规范。</p>
<blockquote>
<p>如果安装了之后想取消规范检测，在<code>config</code>文件夹下的<code>index.js</code>中，找到<code>uesEslint</code>选项，将其设置为false。</p>
</blockquote>
</li>
<li>
<p><code>Set up unit tests</code>：是否添加单元测试。</p>
</li>
<li>
<p><code>Setup e2e test with Nightwatch</code>：e2e（end-to-end）测试。</p>
<blockquote>
<p>安装Nightwatch，是一个利用<code>selenium</code>或<code>webdriver</code>或<code>phantomjs</code>等进行自动化测试的框架。</p>
</blockquote>
</li>
<li>
<p><code>Should we run 'npm install' ...</code>：选择两种安装方式。</p>
</li>
</ul>
<p>最后敲击回车，自动开始创建项目。</p>
<h3 id="项目目录结构">项目目录结构</h3>
<ul>
<li>
<p><code>package.json</code>文件</p>
<p><img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/VueCLI-%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84.png" alt=""></p>
<p>如之前配置一样：</p>
<p>执行<code>npm run dev/start</code>运行服务器，执行<code>npm run build</code>进行项目打包</p>
</li>
<li>
<p><code>build</code>和<code>config</code>文件夹定义了一些变量，包括开发时和打包发布时的不同配置。</p>
</li>
<li>
<p><code>node_modules</code>文件夹存放的就是项目依赖的一些模块。</p>
</li>
<li>
<p><code>src</code>文件夹存放的就是项目的代码。</p>
</li>
<li>
<p><code>static</code>文件夹存放一些静态资源，打包后该文件夹的内容会“原封不动”地复制到输出文件夹<code>dist</code>中。</p>
<blockquote>
<p>以图片资源为例，不会重命名，不会转为base64编码。</p>
</blockquote>
</li>
<li>
<p><code>.babelrc</code>文件：ES代码相关转化配置。</p>
</li>
<li>
<p><code>.editorconfig</code>文件：项目文本相关配置。</p>
</li>
<li>
<p><code>.eslintignore</code>文件：对指定文件夹下的代码做<code>ESLint</code>检测的忽略。</p>
</li>
<li>
<p><code>.gitignore</code>文件：Git仓库忽略的文件夹配置。</p>
</li>
<li>
<p><code>.eslintrc.js</code>文件：代码检测配置的内容（如果安装了<code>ESLint</code>）。</p>
</li>
<li>
<p><code>.postcssrc.js</code>文件：进行css转化时的一些配置。</p>
</li>
<li>
<p><code>index.html</code>文件：模板。</p>
</li>
</ul>
<h3 id="项目运行">项目运行</h3>
<p>启动服务器：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm run dev&#x2F;start</span><br></pre></td></tr></table></figure>
<p>项目打包：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm run build</span><br></pre></td></tr></table></figure>
<h3 id="runtime-compiler与runtime-only的区别">runtime-compiler与runtime-only的区别</h3>
<h4 id="main-js">main.js</h4>
<p>直接看两种不同构建版本项目的<code>main.js</code>文件。</p>
<p><code>runtime-compiler</code>：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">&#x27;./App&#x27;</span></span><br><span class="line"></span><br><span class="line">Vue.config.productionTip = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  el: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">  components: &#123; App &#125;,</span><br><span class="line">  template: <span class="string">&#x27;&lt;App/&gt;&#x27;</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><code>runtime-only</code>：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">&#x27;./App&#x27;</span></span><br><span class="line"></span><br><span class="line">Vue.config.productionTip = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  el: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">  render: <span class="function"><span class="params">h</span> =&gt;</span> h(App)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>很明显可以看到二者<code>App</code>的使用方式不同：</p>
<ul>
<li><code>runtime-compiler</code>：首先在<code>components</code>中注册组件，然后<code>template</code>使用模板</li>
<li><code>runtime-only</code>：并没有注册<code>App</code>，直接利用render属性（本质是一个函数），利用一个“箭头函数”进行使用。</li>
</ul>
<p>首先要理解Vue程序运行过程：</p>
<ol>
<li>当把一个模板（template）传入Vue实例中，Vue会将其保存至Vue实例下的一个<code>options</code>中</li>
<li>然后将其进行解析（parse）称为<code>ast</code>（abstract syntax tree，抽象语法树）</li>
<li>对ast进行编译（compile）成一个render函数</li>
<li>通过render函数把对应的模板翻译成虚拟DOM树（virtual dom）</li>
<li>最后把虚拟DOM树渲染成真实的DOM（UI）</li>
</ol>
<p><code>runtime-compiler</code>会经历上述的一系列步骤：</p>
<p><strong>template → ast → render → 虚拟DOM → UI</strong></p>
<p>而<code>runtime-only</code>只经历三步：</p>
<p><strong>render → 虚拟DOM → UI</strong></p>
<p>由此分析得出结论：</p>
<ol>
<li>
<p><code>runtime-only</code>的性能更优</p>
</li>
<li>
<p><code>runtime-only</code>的代码量更少</p>
<p><img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/VueCLI-%E5%AF%B9%E6%AF%94%E4%B8%8D%E5%90%8C%E6%9E%84%E5%BB%BA%E7%89%88%E6%9C%AC.png" alt=""></p>
</li>
</ol>
<h4 id="render函数">render函数</h4>
<p>下面来介绍一下render函数究竟是为何物。</p>
<p>实际上render属性的写法如下，这里会涉及到<code>createElement</code>函数（就是<code>h</code>）：</p>
<p>用法一：</p>
<p><code>createElement('标签', &#123;标签的属性&#125;, [标签的内容])</code></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">render: <span class="function"><span class="keyword">function</span> (<span class="params">createElement</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> createElement(<span class="string">&#x27;h2&#x27;</span>, &#123;<span class="attr">class</span>: <span class="string">&#x27;box&#x27;</span>&#125;, [<span class="string">&#x27;Hello CLI&#x27;</span>])</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意：标签内容的数组可以嵌套新的<code>createElement</code>函数。</p>
</blockquote>
<p>运行效果如下：</p>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/VueCLI-对比不同构建版本-render1.png" style="zoom:80%;" />
<p>用法二：传入组件对象</p>
<p>例如创建如下<code>cpn</code>组件：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> cpn = &#123;</span><br><span class="line">  template: <span class="string">`&lt;div&gt;&#123;&#123;message&#125;&#125;&lt;/div&gt;`</span>,</span><br><span class="line">  <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      message: <span class="string">&#x27;我是组件的信息&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在<code>createElement</code>函数中直接传入该组件对象：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">render: <span class="function"><span class="keyword">function</span> (<span class="params">createElement</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> createElement(cpn)</span><br></pre></td></tr></table></figure>
<p>运行效果如下：</p>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/VueCLI-对比不同构建版本-render2.png" style="zoom:80%;" />
<p>如此一来就不难理解，最初可以直接传参<code>App</code>了：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">render: <span class="function"><span class="keyword">function</span> (<span class="params">h</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> h(App)</span><br></pre></td></tr></table></figure>
<p>等同于：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">render: <span class="function"><span class="params">h</span> =&gt;</span> h(App)</span><br></pre></td></tr></table></figure>
<h2 id="Vue-CLI3">Vue CLI3</h2>
<p>Vue CLI3与2版本的区别：</p>
<ul>
<li>vue-cli3是基于webpack4打造，vue-cli2是webapck3</li>
<li>vue-cli3的设计原则是“0配置”，移除的配置文件根目录下的<code>build</code>和<code>config</code>等目录（做了隐藏设计）</li>
<li>vue-cli3提供了<code>vue ui</code>命令，提供了可视化配置</li>
<li>移除了<code>static</code>文件夹，新增了<code>public</code>文件夹，并且<code>index.html</code>文件移动到其中</li>
</ul>
<h3 id="初始化项目-2">初始化项目</h3>
<p>在终端键入命令：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">vue create projectname</span><br></pre></td></tr></table></figure>
<p>创建项目时会遇到如下选项：</p>
<ul>
<li>
<p><code>Please pick a preset</code>：有两个选项（默认（babel、eslint）和手动）</p>
<blockquote>
<p>如果选择手动配置，会出现诸多选项，按<code>空格键</code>选择/取消。</p>
<p><img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/VueCLI-CLI3-%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE.png" alt=""></p>
</blockquote>
</li>
<li>
<p>针对于Babel、PostCSS、ESLint等配置选择新建配置文件存放或是存放至<code>package.json</code>文件</p>
<blockquote>
<p>一般情况选择前者，单独创建新的配置文件。</p>
</blockquote>
</li>
<li>
<p>是否将刚刚手动配置创建一个新的preset</p>
<blockquote>
<p>如果选择Yes会让你起一个名字，并且选择<code>Yarn</code>或者<code>NPM</code>。</p>
<p>如果想要删除手动创建的<code>preset</code>，找到<code>.vuerc</code>文件中的<code>presets</code>属性，在其中进行删除，保存。</p>
</blockquote>
</li>
</ul>
<h3 id="项目目录结构-2">项目目录结构</h3>
<p>Vue CLI3的目录结构交Vue CLI2要简单许多，需要注意的就是<code>public</code>文件夹，可以把它类比为2版本中的<code>static</code>文件夹。</p>
<h3 id="项目运行-2">项目运行</h3>
<p>启动服务器：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm run serve</span><br></pre></td></tr></table></figure>
<p>项目打包：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm run build</span><br></pre></td></tr></table></figure>
<h3 id="main-js-2">main.js</h3>
<p>Vue CLI3中的<code>main.js</code>文件内容如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">&#x27;./App.vue&#x27;</span></span><br><span class="line"></span><br><span class="line">Vue.config.productionTip = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  render: <span class="function"><span class="params">h</span> =&gt;</span> h(App),</span><br><span class="line">&#125;).$mount(<span class="string">&#x27;#app&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>实际上跟之前的<code>el: '#app'</code>挂载没有区别，el挂载也会执行<code>mount('#app')</code>。</p>
<h3 id="Vue项目管理器（UI）">Vue项目管理器（UI）</h3>
<p>在终端键入如下命令：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">vue ui</span><br></pre></td></tr></table></figure>
<p>则会启动一个本地服务，运行在8000端口，展示Vue项目管理器（如下图）：</p>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/VueCLI-CLI3-ui1.png" style="zoom:80%;" />
<p>导入一个项目：</p>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/VueCLI-CLI3-ui2.png" style="zoom:80%;" />
<p>这里就可以利用可视化界面安装插件和依赖，还可以进行项目配置信息的修改。</p>
<h3 id="修改配置">修改配置</h3>
<p>如果需要手动修改一些配置信息，由于<code>build</code>和<code>config</code>文件夹被取消，因此需要手动在项目根目录创建文件：</p>
<p><code>vue.config.js</code>（固定文件名，不得修改），在其中手动添加配置信息：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>添加的配置信息会自动与原有的进行合并，作为整体的配置。</p>
<hr>
<h1>后记</h1>
<p>基本很少使用图形化界面。</p>
<p>Vue CLI3中会在项目根目录下自动创建git，方便项目管理。</p>
]]></content>
      <categories>
        <category>学习笔记</category>
      </categories>
      <tags>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue学习-ES6的模块化实现</title>
    <url>/2021/08/08/Vue/Vue%E5%AD%A6%E4%B9%A0-ES6%E7%9A%84%E6%A8%A1%E5%9D%97%E5%8C%96%E5%AE%9E%E7%8E%B0/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\css\APlayer.min.css"><script src="\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\js\Meting.min.js"></script><h1>前言</h1>
<p>本文将介绍ES6的模块化实现。</p>
<hr>
<h1>模块化实现</h1>
<p>在实际编写js脚本时，可能会遇到多个js脚本中变量或函数重复命名的情况，如果全部为全局变量，则在使用的时候会产生很多麻烦。因此出现了模块化的概念，即可以把每一个js脚本当作一个独立的模块，不同模块间的内容互不干扰，这样在实际使用起来的时候会避免很多不必要的麻烦。</p>
<p>模块化有两个核心部分：即<strong>导入(import)<strong>和</strong>导出(export)</strong>。（下面会结合两者一起说明）</p>
<h2 id="代码文件">代码文件</h2>
<p>首先有一个<code>index.html</code>文件，在此分别引入以下两个js文件：</p>
<ul>
<li><code>module.js</code></li>
<li><code>use.js</code></li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- index.html --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;module.js&quot;</span> <span class="attr">type</span>=<span class="string">&quot;module&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;use.js&quot;</span> <span class="attr">type</span>=<span class="string">&quot;module&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>说明：</p>
<p>在ES6中，使不同js脚本模块化的方法就是就是在引入时，在<code>&lt;script&gt;</code>标签中添加<code>module</code>属性。一旦添加，js内部的数据默认不再为全局可引用，需要以<strong>导入</strong>和<strong>导出</strong>的方式引用。</p>
</blockquote>
<p><code>module.js</code>中定义如下内容：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//定义变量</span></span><br><span class="line"><span class="keyword">var</span> message = <span class="string">&#x27;我是Module中的message变量&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//定义函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">show</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;我是Module中的show函数&#x27;</span>,value)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//定义类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">run</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;奔跑中....&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="导出、导入方式一">导出、导入方式一</h2>
<p>直接使用<code>export &#123;变量名, 方法名, 类名&#125;</code>格式导出：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//导出方式一</span></span><br><span class="line"><span class="keyword">export</span> &#123;message, show, Person&#125;</span><br></pre></td></tr></table></figure>
<p><code>use.js</code>使用：</p>
<p>使用<code>import &#123; 变量名, 方法名, 类名 &#125; from &quot;xxx.js&quot;;</code>的格式导入：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//导入</span></span><br><span class="line"><span class="keyword">import</span> &#123; message, show, Person &#125; <span class="keyword">from</span> <span class="string">&quot;./module1.js&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//使用</span></span><br><span class="line"><span class="built_in">console</span>.log(message)</span><br><span class="line"></span><br><span class="line">show(<span class="number">123</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> person = <span class="keyword">new</span> Person</span><br><span class="line">person.run()</span><br></pre></td></tr></table></figure>
<h2 id="导出、导入方式二">导出、导入方式二</h2>
<p>在定义变量之前添加<code>export</code>关键字直接导出：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//导出方式二</span></span><br><span class="line"><span class="comment">//定义并导出变量</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">var</span> message = <span class="string">&#x27;我是Module中的message变量&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//定义并导出函数</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">show</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;我是Module中的show函数&#x27;</span>,value)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//定义并导出类</span></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">run</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;奔跑中....&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>use.js</code>使用：</p>
<p>使用<code>import * as xxx from &quot;xxx.js&quot;;</code>的格式统一导入：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//导入</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> use <span class="keyword">from</span> <span class="string">&quot;./module1.js&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//使用</span></span><br><span class="line"><span class="built_in">console</span>.log(use.message)</span><br><span class="line"></span><br><span class="line">use.show(<span class="number">123</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> person = <span class="keyword">new</span> use.Person</span><br><span class="line">person.run()</span><br></pre></td></tr></table></figure>
<h2 id="导出、导入方式三">导出、导入方式三</h2>
<p>使用<code>default</code>关键字定义默认变量（这里以方法为例）：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//导出方式三</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> (<span class="params">value</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;我是Module中的默认函数&#x27;</span>,value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>use.js</code>使用：</p>
<p>使用<code>import 命名 from &quot;xxx.js&quot;;</code>的格式导入（注意在导入的时候需要默认函数命名）：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//导入并命名</span></span><br><span class="line"><span class="keyword">import</span> def <span class="keyword">from</span> <span class="string">&quot;./module1.js&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//使用</span></span><br><span class="line">def(<span class="number">456</span>)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意：</p>
<p>这种默认变量的定义在一个模块中只能唯一定义一个，并且在导入使用的时候需要为其命名。</p>
</blockquote>
<hr>
<h1>后记</h1>
<p>先了解模块化的概念，为了后面更好地学习<code>Webpack</code>的内容。</p>
]]></content>
      <categories>
        <category>学习笔记</category>
      </categories>
      <tags>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue学习-axios</title>
    <url>/2021/08/19/Vue/Vue%E5%AD%A6%E4%B9%A0-axios/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\css\APlayer.min.css"><script src="\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\js\Meting.min.js"></script><h1>前言</h1>
<p>本文将介绍axios的相关操作。</p>
<p>相关的后端服务器是用Flask搭建的，仅用于演示：</p>
<p><code>web.py</code>：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask,request</span><br><span class="line"><span class="keyword">from</span> flask_cors <span class="keyword">import</span> CORS  <span class="comment">#引入CORS库</span></span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">CORS(app, supports_credentials=<span class="literal">True</span>)  <span class="comment">#用于解决跨域问题</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run()</span><br></pre></td></tr></table></figure>
<blockquote>
<p>说明：引入CORS库用于解决跨域问题。</p>
</blockquote>
<p>以下的axios网络请求的代码都在Vue项目<code>src</code>文件夹下的<code>main.js</code>中完成。</p>
<p>这里也介绍一个网站，可以用于网络请求的测试：<a href="http://httpbin.org/">httpbin.org</a></p>
<hr>
<h1>axios</h1>
<h2 id="介绍">介绍</h2>
<blockquote>
<p>以下内容来自官网：<a href="http://www.axios-js.com/zh-cn/docs/">axios中文文档|axios中文网 | axios (axios-js.com)</a></p>
</blockquote>
<p>Axios 是一个基于 promise 的 HTTP 库，可以用在浏览器和 node.js 中。</p>
<div class="btn-center">
<a class="btn-beautify button--animated block outline green larger" href="/2021/08/17/Vue/Vue%E5%AD%A6%E4%B9%A0-Promise/" 
  title="点击跳转 至 《Vue学习-Promise》"><i class="far fa-hand-point-right"></i><span>点击跳转 至 《Vue学习-Promise》</span></a>
</div>
<p>特性：</p>
<ul>
<li>从浏览器中创建 <a href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest">XMLHttpRequests</a></li>
<li>从 node.js 创建 <a href="http://nodejs.org/api/http.html">http</a> 请求</li>
<li>支持 <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">Promise</a> API</li>
<li>拦截请求和响应</li>
<li>转换请求数据和响应数据</li>
<li>取消请求</li>
<li>自动转换 JSON 数据</li>
<li>客户端支持防御 <a href="http://en.wikipedia.org/wiki/Cross-site_request_forgery">XSRF</a></li>
</ul>
<p>支持多种请求方式：</p>
<ul>
<li>axios.request(config)</li>
<li>axios.get(url[, config])</li>
<li>axios.delete(url[, config])</li>
<li>axios.head(url[, config])</li>
<li>axios.options(url[, config])</li>
<li>axios.post(url[, data[, config]])</li>
<li>axios.put(url[, data[, config]])</li>
<li>axios.patch(url[, data[, config]])</li>
</ul>
<h2 id="基本使用">基本使用</h2>
<h3 id="配置axios">配置axios</h3>
<p>打开终端，进入项目根目录，键入如下命令（注意版本号）：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm install axios --save</span><br></pre></td></tr></table></figure>
<h3 id="导入">导入</h3>
<p>在使用的文件头中导入：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span></span><br></pre></td></tr></table></figure>
<h3 id="发送GET-POST请求">发送GET/POST请求</h3>
<p><code>main.js</code>：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">&#x27;./App&#x27;</span></span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span></span><br><span class="line"></span><br><span class="line">Vue.config.productionTip = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  el: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">  render: <span class="function"><span class="params">h</span> =&gt;</span> h(App)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">axios(&#123;</span><br><span class="line">  url: <span class="string">&#x27;http://127.0.0.1:5000&#x27;</span>,</span><br><span class="line">  method: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">  params: &#123;</span><br><span class="line">    name: <span class="string">&#x27;HuaZhu&#x27;</span>,</span><br><span class="line">    age: <span class="number">18</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;).then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(res);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<blockquote>
<p>说明：</p>
<p>（类似于ajax的使用方式）</p>
<p>axios的参数需要传入一个对象，该对象有以下属性：</p>
<ul>
<li>url：用于指定请求的URL</li>
<li>method：用于指定请求方式（<code>get</code>、<code>post</code>），不写该参数默认使用get方式</li>
<li>params：用于附带参数信息</li>
</ul>
<p>值得注意的是axios已集成Promise，在发送请求后会自动执行<code>resolve()</code>函数，因此可以在后面直接链接<code>then()</code>函数，用于接收请求返回值。</p>
</blockquote>
<p><code>web.py</code>：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask,request</span><br><span class="line"><span class="keyword">from</span> flask_cors <span class="keyword">import</span> CORS</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">CORS(app, supports_credentials=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/&quot;</span>,methods=[<span class="string">&quot;GET&quot;</span>,<span class="string">&quot;POST&quot;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span>():</span></span><br><span class="line">    <span class="keyword">if</span> request.method==<span class="string">&quot;GET&quot;</span>:</span><br><span class="line">      name = request.args.get(<span class="string">&quot;name&quot;</span>)</span><br><span class="line">      age = request.args.get(<span class="string">&quot;age&quot;</span>)</span><br><span class="line">      print(name,age)</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;get请求已收到&quot;</span></span><br><span class="line">    <span class="keyword">elif</span> request.method==<span class="string">&quot;POST&quot;</span>:</span><br><span class="line">      name = request.values.get(<span class="string">&quot;name&quot;</span>)</span><br><span class="line">      age = request.values.get(<span class="string">&quot;age&quot;</span>)</span><br><span class="line">      print(name,age)</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;post请求已收到&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;网络请求方式不正确&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run()</span><br></pre></td></tr></table></figure>
<p>效果展示：</p>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Vueaxios-基本请求-show1.png" style="zoom:80%;" />
<p><img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Vueaxios-%E5%9F%BA%E6%9C%AC%E8%AF%B7%E6%B1%82-show2.png" alt=""></p>
<h3 id="发送并发请求">发送并发请求</h3>
<p>如果需要向服务器同时发送多个并发请求，并取回每个请求的结果，然后对这些返回结果操作。axios提供了<code>axios.all()</code>方法，使用格式如下：</p>
<p><code>axios.all([axios(), axios()], ...).then((results) =&gt; &#123;...&#125;)</code></p>
<blockquote>
<p>说明：</p>
<ul>
<li><code>axios.all()</code>的参数为列表，里面可以写任意个<code>axios()</code>方法</li>
<li>最后<code>then()</code>获得的返回值同为列表形式，里面存放了每一个请求的结果</li>
</ul>
</blockquote>
<p>现在假设要向服务器同时发送get和post请求，并拿到返回值：</p>
<p><code>main.js</code>：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">&#x27;./App&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span></span><br><span class="line"></span><br><span class="line">Vue.config.productionTip = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  el: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">  render: <span class="function"><span class="params">h</span> =&gt;</span> h(App)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">axios.all([axios(&#123;</span><br><span class="line">  url: <span class="string">&#x27;http://127.0.0.1:5000&#x27;</span>,</span><br><span class="line">  method: <span class="string">&#x27;get&#x27;</span>,  <span class="comment">//发送get请求</span></span><br><span class="line">  params: &#123;</span><br><span class="line">    name: <span class="string">&#x27;HuaZhu&#x27;</span>,</span><br><span class="line">    age: <span class="number">18</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;), axios(&#123;</span><br><span class="line">  url: <span class="string">&#x27;http://127.0.0.1:5000&#x27;</span>,</span><br><span class="line">  method: <span class="string">&#x27;post&#x27;</span>,  <span class="comment">//发送post请求</span></span><br><span class="line">  params: &#123;</span><br><span class="line">    name: <span class="string">&#x27;HuaZhu&#x27;</span>,</span><br><span class="line">    age: <span class="number">18</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)]).then(<span class="function"><span class="params">results</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(results)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><code>web.py</code>：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask,request</span><br><span class="line"><span class="keyword">from</span> flask_cors <span class="keyword">import</span> CORS</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">CORS(app, supports_credentials=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/&quot;</span>,methods=[<span class="string">&quot;GET&quot;</span>,<span class="string">&quot;POST&quot;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span>():</span></span><br><span class="line">    <span class="keyword">if</span> request.method==<span class="string">&quot;GET&quot;</span>:</span><br><span class="line">      name = request.args.get(<span class="string">&quot;name&quot;</span>)</span><br><span class="line">      age = request.args.get(<span class="string">&quot;age&quot;</span>)</span><br><span class="line">      print(name,age)</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;get请求已收到&quot;</span></span><br><span class="line">    <span class="keyword">elif</span> request.method==<span class="string">&quot;POST&quot;</span>:</span><br><span class="line">      name = request.values.get(<span class="string">&quot;name&quot;</span>)</span><br><span class="line">      age = request.values.get(<span class="string">&quot;age&quot;</span>)</span><br><span class="line">      print(name,age)</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;post请求已收到&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;网络请求方式不正确&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run()</span><br></pre></td></tr></table></figure>
<p>效果展示：</p>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Vueaxios-并发请求-show1.png" style="zoom:80%;" />
<p><img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Vueaxios-%E5%B9%B6%E5%8F%91%E8%AF%B7%E6%B1%82-show2.png" alt=""></p>
<p>返回结果列表拿到，如果要详细访问，可以通过列表的index下标值。但是axios还提供了<code>axios.spread()</code>方法可以直接拆分返回结果列表，拿到具体的结果：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">axios.all([axios(&#123;</span><br><span class="line">  url: <span class="string">&#x27;http://127.0.0.1:5000&#x27;</span>,</span><br><span class="line">  method: <span class="string">&#x27;get&#x27;</span>,</span><br><span class="line">  params: &#123;</span><br><span class="line">    name: <span class="string">&#x27;HuaZhu&#x27;</span>,</span><br><span class="line">    age: <span class="number">18</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;), axios(&#123;</span><br><span class="line">  url: <span class="string">&#x27;http://127.0.0.1:5000&#x27;</span>,</span><br><span class="line">  method: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">  params: &#123;</span><br><span class="line">    name: <span class="string">&#x27;HuaZhu&#x27;</span>,</span><br><span class="line">    age: <span class="number">18</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)]).then(axios.spread(<span class="function">(<span class="params">res1, res2</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(res1);</span><br><span class="line">  <span class="built_in">console</span>.log(res2);</span><br><span class="line">&#125;))</span><br></pre></td></tr></table></figure>
<p>效果如下：</p>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Vueaxios-并发请求-show3.png" style="zoom:80%;" />
<h3 id="配置信息">配置信息</h3>
<h4 id="基本配置">基本配置</h4>
<p>可以在axios对象中添加诸如<code>baseURL</code>、<code>timeout</code>等的配置信息：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">axios(&#123;</span><br><span class="line">  baseURL: <span class="string">&#x27;http://127.0.0.1:5000&#x27;</span>,</span><br><span class="line">  url: <span class="string">&#x27;/home&#x27;</span>,</span><br><span class="line">  timeout: <span class="number">5000</span>,  <span class="comment">//单位ms</span></span><br><span class="line">  method: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">  params: &#123;</span><br><span class="line">    name: <span class="string">&#x27;HuaZhu&#x27;</span>,</span><br><span class="line">    age: <span class="number">18</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;).then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(res);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="全局配置">全局配置</h4>
<p>如果想在多个请求中使用同一配置，可以将这些配置信息抽离出来，设置全局默认配置：<code>axios.defaults.xxx</code></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">axios.defaults.baseURL = <span class="string">&#x27;http://127.0.0.1:5000&#x27;</span></span><br><span class="line">axios.defaults.timeout = <span class="number">5000</span></span><br><span class="line"></span><br><span class="line">axios(&#123;</span><br><span class="line">  url: <span class="string">&#x27;/home&#x27;</span>,</span><br><span class="line">  method: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">  params: &#123;</span><br><span class="line">    name: <span class="string">&#x27;HuaZhu&#x27;</span>,</span><br><span class="line">    age: <span class="number">18</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;).then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(res);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="axios实例">axios实例</h4>
<p>全局默认配置在项目规模较小的情况下（请求配置基本一致）可以使用，一旦涉及到的请求量增加，面临的情况可能是一类请求需要一种配置，另一类请求需要另外一种配置，如果这时再设置全局默认配置就不是很合适了。为此可以使用axios实例：<code>axios.create()</code></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> instance1 = axios.create(&#123;  <span class="comment">//创建axios实例一</span></span><br><span class="line">  baseURL: <span class="string">&#x27;http://127.0.0.1:5000&#x27;</span>,</span><br><span class="line">  timeout: <span class="number">5000</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">instance1(&#123;  <span class="comment">//使用axios实例一</span></span><br><span class="line">  url: <span class="string">&#x27;/home&#x27;</span>,</span><br><span class="line">  method: <span class="string">&#x27;get&#x27;</span>,</span><br><span class="line">&#125;).then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(res);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">instance1(&#123;  <span class="comment">//使用axios实例一</span></span><br><span class="line">  url: <span class="string">&#x27;/about&#x27;</span>,</span><br><span class="line">  method: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">&#125;).then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(res);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> instance2 = axios.create(&#123;  <span class="comment">//创建axios实例二</span></span><br><span class="line">  baseURL: <span class="string">&#x27;http://127.0.0.1:8080&#x27;</span>,</span><br><span class="line">  timeout: <span class="number">10000</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">instance2(&#123;  <span class="comment">//使用axios实例二</span></span><br><span class="line">  url: <span class="string">&#x27;/home&#x27;</span>,</span><br><span class="line">  method: <span class="string">&#x27;get&#x27;</span>,</span><br><span class="line">&#125;).then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(res);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">instance2(&#123;  <span class="comment">//使用axios实例二</span></span><br><span class="line">  url: <span class="string">&#x27;/about&#x27;</span>,</span><br><span class="line">  method: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">&#125;).then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(res);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>常见的配置信息：</p>
<table>
<thead>
<tr>
<th>配置信息</th>
<th>格式</th>
</tr>
</thead>
<tbody>
<tr>
<td>请求地址</td>
<td>url: ‘/home’</td>
</tr>
<tr>
<td>请求类型</td>
<td>method: ‘get’</td>
</tr>
<tr>
<td>请求根路径</td>
<td>baseURL: ‘<a href="http://127.0.0.1:5000">http://127.0.0.1:5000</a>’</td>
</tr>
<tr>
<td>请求前的数据处理</td>
<td>transformRequest:[function(data){}]</td>
</tr>
<tr>
<td>请求后的数据处理</td>
<td>transformResponse: [function(data){}]</td>
</tr>
<tr>
<td>自定义的请求头</td>
<td>headers:{‘x-Requested-With’:‘XMLHttpRequest’}</td>
</tr>
<tr>
<td>URL查询对象</td>
<td>params:{ name: ‘HuaZhu’, age: 18 }</td>
</tr>
<tr>
<td>查询对象序列化函数</td>
<td>paramsSerializer: function(params){ }</td>
</tr>
<tr>
<td>request body</td>
<td>data: { key: ‘a’}</td>
</tr>
<tr>
<td>超时设置(ms)</td>
<td>timeout: 1000</td>
</tr>
<tr>
<td>跨域是否带Token</td>
<td>withCredentials: false</td>
</tr>
<tr>
<td>自定义请求处理</td>
<td>adapter: function(resolve, reject, config){}</td>
</tr>
<tr>
<td>身份验证信息</td>
<td>auth: { uname: ‘’, pwd: ‘12’}</td>
</tr>
<tr>
<td>响应的数据格式 json / blob /document /arraybuffer / text / stream</td>
<td>responseType: ‘json’</td>
</tr>
</tbody>
</table>
<h3 id="axios封装">axios封装</h3>
<p>在大型项目中，往往第三方库在大量使用的情况下最好进行封装，在调用的时候只使用自己封装的内容就好。原因：如果第三方库停止维护，方便改用其他的代替内容。修改起来仅需改动封装的部分代码就好。</p>
<p>在项目的<code>src</code>文件夹下新建一个<code>network</code>文件夹，用于存放网络相关的封装代码。在其中新建名为<code>axios-request.js</code>的文件：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">axios_request</span>(<span class="params">config</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 创建axios实例</span></span><br><span class="line">  <span class="keyword">const</span> instance = axios.create(&#123;</span><br><span class="line">    baseURL: <span class="string">&#x27;http://127.0.0.1:5000&#x27;</span>,</span><br><span class="line">    timeout: <span class="number">5000</span></span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 发送网络请求</span></span><br><span class="line">  <span class="keyword">return</span> instance(config)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>假设未来决定不再使用axios，改用其他的第三方库，如果该库也自动集成Promise，那调用格式同上，如果没有，那么就需要手动返回一个Promise对象：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> xxx_request <span class="keyword">from</span> <span class="string">&#x27;xxx&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">xxx_request</span>(<span class="params">config</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 1.调用xxx第三方库</span></span><br><span class="line">    <span class="comment">// 2.发送请求</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>在其他文件中就可以直接调用封装的<code>axios_request(config)</code>函数，其中config就是发送请求的配置信息：</p>
<p><code>main.js</code>：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">&#x27;./App&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123;axios_request&#125; <span class="keyword">from</span> <span class="string">&#x27;./network/axios-request&#x27;</span> <span class="comment">//导入封装函数</span></span><br><span class="line"></span><br><span class="line">Vue.config.productionTip = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  el: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">  render: <span class="function"><span class="params">h</span> =&gt;</span> h(App)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">axios_request(&#123;  <span class="comment">//使用封装函数</span></span><br><span class="line">  url: <span class="string">&#x27;/home&#x27;</span>,</span><br><span class="line">  method: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">  params: &#123;</span><br><span class="line">    name: <span class="string">&#x27;HuaZhu&#x27;</span>,</span><br><span class="line">    age: <span class="number">18</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;).then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(res);</span><br><span class="line">&#125;).catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(err);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>说明：</p>
<p>由于<code>axios.create()</code>实例对象集成Promise，在调用时会自动执行<code>resolve()</code>函数，因而可以在使用封装函数后直接调用<code>then()</code>和<code>catch()</code>函数。</p>
</blockquote>
<p><code>web.py</code>：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask,request</span><br><span class="line"><span class="keyword">from</span> flask_cors <span class="keyword">import</span> CORS</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">CORS(app, supports_credentials=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/home&quot;</span>,methods=[<span class="string">&quot;GET&quot;</span>,<span class="string">&quot;POST&quot;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span>():</span></span><br><span class="line">    <span class="keyword">if</span> request.method==<span class="string">&quot;GET&quot;</span>:</span><br><span class="line">      name = request.args.get(<span class="string">&quot;name&quot;</span>)</span><br><span class="line">      age = request.args.get(<span class="string">&quot;age&quot;</span>)</span><br><span class="line">      print(name,age)</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;get请求已收到&quot;</span></span><br><span class="line">    <span class="keyword">elif</span> request.method==<span class="string">&quot;POST&quot;</span>:</span><br><span class="line">      name = request.values.get(<span class="string">&quot;name&quot;</span>)</span><br><span class="line">      age = request.values.get(<span class="string">&quot;age&quot;</span>)</span><br><span class="line">      print(name,age)</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;post请求已收到&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;网络请求方式不正确&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run()</span><br></pre></td></tr></table></figure>
<h3 id="拦截器">拦截器</h3>
<p>axios提供了拦截器，用于在发送每次请求或者从服务器得到返回结果时，进行相应的处理。</p>
<h4 id="请求拦截">请求拦截</h4>
<p>作用：</p>
<ul>
<li>当发送网络请求时，在页面中添加一个loading组件，作为加载动画</li>
<li>某些请求要求用户必须登录，判断用户是否有token（令牌），如果没有则跳转到login页面</li>
<li>对请求的参数进行序列化</li>
<li>…</li>
</ul>
<blockquote>
<p>格式：</p>
<p>局部拦截器：<code>instance.interceptors.request.use(onFulfilled(), onRejected())</code></p>
<p>全局拦截器：<code>axios.interceptors.request.use(onFulfilled(), onRejected())</code></p>
</blockquote>
<p><code>axios-request.js</code>：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">axios_request</span>(<span class="params">config</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 创建axios实例</span></span><br><span class="line">  <span class="keyword">const</span> instance = axios.create(&#123;</span><br><span class="line">    baseURL: <span class="string">&#x27;http://127.0.0.1:5000&#x27;</span>,</span><br><span class="line">    timeout: <span class="number">5000</span></span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 请求拦截器</span></span><br><span class="line">  instance.interceptors.request.use(<span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;成功拦截到请求&#x27;</span>);  </span><br><span class="line">    <span class="built_in">console</span>.log(config.params)  <span class="comment">//拦截成功后可以在此对config请求执行操作</span></span><br><span class="line">    <span class="keyword">return</span> config  <span class="comment">//最后需要把拦截结果释放</span></span><br><span class="line">  &#125;, <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;拦截请求失败&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> err</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 发送网络请求</span></span><br><span class="line">  <span class="keyword">return</span> instance(config)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><code>main.js</code>：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">&#x27;./App&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123;axios_request&#125; <span class="keyword">from</span> <span class="string">&#x27;./network/axios-request&#x27;</span></span><br><span class="line"></span><br><span class="line">Vue.config.productionTip = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  el: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">  render: <span class="function"><span class="params">h</span> =&gt;</span> h(App)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">axios_request(&#123;</span><br><span class="line">  url: <span class="string">&#x27;/home&#x27;</span>,</span><br><span class="line">  method: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">  params: &#123;</span><br><span class="line">    name: <span class="string">&#x27;HuaZhu&#x27;</span>,</span><br><span class="line">    age: <span class="number">18</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;).then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(res);</span><br><span class="line">&#125;).catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(err);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><code>web.py</code>：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask,request</span><br><span class="line"><span class="keyword">from</span> flask_cors <span class="keyword">import</span> CORS</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">CORS(app, supports_credentials=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/home&quot;</span>,methods=[<span class="string">&quot;GET&quot;</span>,<span class="string">&quot;POST&quot;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span>():</span></span><br><span class="line">    <span class="keyword">if</span> request.method==<span class="string">&quot;GET&quot;</span>:</span><br><span class="line">      name = request.args.get(<span class="string">&quot;name&quot;</span>)</span><br><span class="line">      age = request.args.get(<span class="string">&quot;age&quot;</span>)</span><br><span class="line">      print(name,age)</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;get请求已收到&quot;</span></span><br><span class="line">    <span class="keyword">elif</span> request.method==<span class="string">&quot;POST&quot;</span>:</span><br><span class="line">      name = request.values.get(<span class="string">&quot;name&quot;</span>)</span><br><span class="line">      age = request.values.get(<span class="string">&quot;age&quot;</span>)</span><br><span class="line">      print(name,age)</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;post请求已收到&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;网络请求方式不正确&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run()</span><br></pre></td></tr></table></figure>
<p>效果展示：</p>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Vueaxios-拦截器-show1.png" style="zoom:80%;" />
<h4 id="返回结果拦截">返回结果拦截</h4>
<p>作用：</p>
<ul>
<li>主要是对返回的结果进行过滤</li>
<li>相应失败后根据错误信息做出不同的响应</li>
<li>…</li>
</ul>
<blockquote>
<p>格式：</p>
<p>局部拦截器：<code>instance.interceptors.response.use(onFulfilled(), onRejected())</code></p>
<p>全局拦截器：<code>axios.interceptors.response.use(onFulfilled(), onRejected())</code></p>
</blockquote>
<p><code>axios-request.js</code>：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">axios_request</span>(<span class="params">config</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 创建axios实例</span></span><br><span class="line">  <span class="keyword">const</span> instance = axios.create(&#123;</span><br><span class="line">    baseURL: <span class="string">&#x27;http://127.0.0.1:5000&#x27;</span>,</span><br><span class="line">    timeout: <span class="number">5000</span></span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 响应拦截器</span></span><br><span class="line">  instance.interceptors.response.use(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;成功拦截到响应&#x27;</span>);  </span><br><span class="line">    <span class="built_in">console</span>.log(response)  <span class="comment">//拦截成功后可以在此对response响应执行操作</span></span><br><span class="line">    <span class="keyword">return</span> response.data  <span class="comment">//最后需要把拦截结果释放</span></span><br><span class="line">  &#125;, <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;拦截响应失败&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> err</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 发送网络请求</span></span><br><span class="line">  <span class="keyword">return</span> instance(config)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>效果展示：</p>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Vueaxios-拦截器-show2.png" style="zoom:80%;" />
<hr>
<h1>后记</h1>
<p>要在项目实战中多运用练习以加深印象。</p>
]]></content>
      <categories>
        <category>学习笔记</category>
      </categories>
      <tags>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue学习笔记</title>
    <url>/2021/08/02/Vue/Vue%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\css\APlayer.min.css"><script src="\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\js\Meting.min.js"></script><p><em><strong>Vue学习记录</strong></em></p>
<hr>
<h1>基础语法</h1>
<div class="btn-center">
<a class="btn-beautify button--animated block outline larger" href="/2021/08/02/Vue/Vue%E5%AD%A6%E4%B9%A0-%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/" 
  title="点击跳转 至 《Vue学习-基础语法》"><i class="far fa-hand-point-right"></i><span>点击跳转 至 《Vue学习-基础语法》</span></a>
</div>
<h1>组件化开发</h1>
<div class="btn-center">
<a class="btn-beautify button--animated block outline blue larger" href="/2021/08/04/Vue/Vue%E5%AD%A6%E4%B9%A0-%E7%BB%84%E4%BB%B6%E5%8C%96%E5%BC%80%E5%8F%91/" 
  title="点击跳转 至 《Vue学习-组件化开发》"><i class="far fa-hand-point-right"></i><span>点击跳转 至 《Vue学习-组件化开发》</span></a>
</div>
<h1>ES6的模块化实现</h1>
<div class="btn-center">
<a class="btn-beautify button--animated block outline pink larger" href="/2021/08/08/Vue/Vue%E5%AD%A6%E4%B9%A0-ES6%E7%9A%84%E6%A8%A1%E5%9D%97%E5%8C%96%E5%AE%9E%E7%8E%B0/" 
  title="点击跳转 至 《Vue学习-ES6的模块化实现》"><i class="far fa-hand-point-right"></i><span>点击跳转 至 《Vue学习-ES6的模块化实现》</span></a>
</div>
<h1>Webpack</h1>
<div class="btn-center">
<a class="btn-beautify button--animated block outline red larger" href="/2021/08/08/Vue/Vue%E5%AD%A6%E4%B9%A0-Webpack/" 
  title="点击跳转 至 《Vue学习-Webpack》"><i class="far fa-hand-point-right"></i><span>点击跳转 至 《Vue学习-Webpack》</span></a>
</div>
<h1>Vue CLI</h1>
<div class="btn-center">
<a class="btn-beautify button--animated block outline purple larger" href="/2021/08/13/Vue/Vue%E5%AD%A6%E4%B9%A0-Vue-cli/" 
  title="点击跳转 至 《Vue学习-Vue CLI》"><i class="far fa-hand-point-right"></i><span>点击跳转 至 《Vue学习-Vue CLI》</span></a>
</div>
<h1>Vue router</h1>
<div class="btn-center">
<a class="btn-beautify button--animated block outline orange larger" href="/2021/08/14/Vue/Vue%E5%AD%A6%E4%B9%A0-Vue-router/" 
  title="点击跳转 至 《Vue学习-Vue router》"><i class="far fa-hand-point-right"></i><span>点击跳转 至 《Vue学习-Vue router》</span></a>
</div>
<h1>Promise</h1>
<div class="btn-center">
<a class="btn-beautify button--animated block outline green larger" href="/2021/08/17/Vue/Vue%E5%AD%A6%E4%B9%A0-Promise/" 
  title="点击跳转 至 《Vue学习-Promise》"><i class="far fa-hand-point-right"></i><span>点击跳转 至 《Vue学习-Promise》</span></a>
</div>
<h1>Vuex</h1>
<div class="btn-center">
<a class="btn-beautify button--animated block outline larger" href="/2021/08/17/Vue/Vue%E5%AD%A6%E4%B9%A0-Vuex/" 
  title="点击跳转 至 《Vue学习-Vuex》"><i class="far fa-hand-point-right"></i><span>点击跳转 至 《Vue学习-Vuex》</span></a>
</div>
<h1>axios</h1>
<div class="btn-center">
<a class="btn-beautify button--animated block outline blue larger" href="/2021/08/19/Vue/Vue%E5%AD%A6%E4%B9%A0-axios/" 
  title="点击跳转 至 《Vue学习-axios》"><i class="far fa-hand-point-right"></i><span>点击跳转 至 《Vue学习-axios》</span></a>
</div>
]]></content>
      <categories>
        <category>学习笔记</category>
      </categories>
      <tags>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>操作系统学习笔记-计算机系统概述</title>
    <url>/2021/03/14/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%BF%B0/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\css\APlayer.min.css"><script src="\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\js\Meting.min.js"></script><h1>前言</h1>
<p><em>正在学习操作系统，记录笔记。</em></p>
<blockquote>
<p>参考资料：</p>
<p>《操作系统（精髓与设计原理 第6版） 》</p>
</blockquote>
<hr>
<h1>第一章：计算机系统概述</h1>
<h2 id="基本构成">基本构成</h2>
<p>从最顶层看，一台计算机由处理器（CPU，包含运算器、控制器）、存储器以及输入/输出部件组成。</p>
<blockquote>
<p>按照冯·诺依曼的结构表述：计算机组成为五个部分，即运算器、控制器、存储器、输入设备、输出设备。</p>
<p>冯·诺伊曼结构特点：</p>
<ul>
<li>五大组成</li>
<li>指令、数据存储于存储器中</li>
<li>数据以二进制方式存储</li>
<li>存储包括操作码以及操作数地址</li>
<li>指令按照存储器中的顺序执行</li>
<li>计算机以CPU为中心。I/O设备、存储器设备之间的通信必须经过CPU</li>
</ul>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E8%AE%A1%E7%AE%97%E6%9C%BA%E6%9E%84%E6%88%90.png" alt=""></p>
<ul>
<li>
<p><strong>Processor（处理器）</strong>：控制计算机的操作，执行数据处理功能。当只有一个处理器时，它通常指中央处理单元（CPU）。</p>
</li>
<li>
<p><strong>Main memory（内存）</strong>：存储数据和程序。具有<code>易失性（Volatile）</code>，即掉电数据丢失。通常也称为<strong>实存储器（real memory）<strong>或</strong>主存储器（primary memory）</strong>。</p>
</li>
<li>
<p><strong>I/O modules （输入/输出模块）</strong>：在计算机和外部环境之间移动数据。外部环境由各种外部设备组成，包括辅助存储器设备（如硬盘）、通信设备和终端（terminals）。</p>
</li>
<li>
<p><strong>System bus（系统总线）</strong>：为处理器、内存和输入/输出模块间提供通信的设施。</p>
<blockquote>
<p>注意：系统总线的概念是在冯·诺依曼结构定义之外的部分。有两种划分方式：</p>
<ul>
<li>
<p>第一种划分：数据总线、地址总线、控制总线、状态总线</p>
</li>
<li>
<p>第二种划分：串行总线、并行总线</p>
</li>
</ul>
</blockquote>
</li>
</ul>
<h2 id="寄存器（Processor-Registers）">寄存器（Processor Registers）</h2>
<p>寄存器可以理解为处理器中的一种内存（Memory inside CPU）。它的作用是为了使程序员能够尽量减少主内存引用。（Enable programmer to minimize main-memory references）</p>
<blockquote>
<p>寄存器最初诞生的原因：是为了解决CPU和内存速度不匹配的问题。</p>
<p>举例说明：假如我现在要做一道西红柿炒鸡蛋。点起炉灶就开始干活，等把油锅烧热了之后准备下鸡蛋，此时却发现我没有鸡蛋🥚，于是我就去菜市场买来鸡蛋，回家下到油锅里。等鸡蛋炒的差不多了之后我要开始下西红柿，但是我却发现没有西红柿🍅，于是我又去菜市场买来西红柿，回家继续做饭。这样的做饭过程实在是过于繁琐，于是乎出于方便考虑，我决定买一台冰箱。下次在做饭之前会提前从菜市场买来材料存放在冰箱里，等到做饭时就不会显得如此愚蠢了。</p>
<p>这个例子中菜市场就相当于内存，它可以从外地引进各种各样的蔬菜（我们可以理解为外存），油锅就相当于CPU，它在不停地做饭（处理数据），冰箱我们就可以理解为寄存器，它可以把从菜市场（内存）买来的蔬菜暂时存储起来，等到做饭时就可以快速取用。</p>
<p>所以数据、指令的传输流程如下：</p>
<p>内存数据 --&gt; 寄存器 --&gt; 处理器（CPU）</p>
</blockquote>
<p>寄存器可以分为两类：User-visible registers（用户可见寄存器）、Control and status registers（控制和状态寄存器）</p>
<ul>
<li>
<p>用户可见寄存器</p>
<p>可以被机器/汇编语言引用。（允许所有的程序访问，包括应用程序和系统程序）</p>
<blockquote>
<p>优先使用这些寄存器，可以减少使用机器语言或汇编语言的程序员对内存的访问次数。对高级语言而言，由优化编译器负责决定哪些变量应该分配给寄存器，哪些变量应该分配给内存。一些高级语言（如C语言）允许程序员建议编译器把哪些变量保存在寄存器中。</p>
</blockquote>
<p>该寄存器又可以分为两类：Data register（数据寄存器）、Address register（地址寄存器）</p>
<ul>
<li>
<p>数据寄存器：可以被程序员分配给各种函数。</p>
</li>
<li>
<p>地址寄存器：存放数据和指令的内存地址，或者存放用于计算完整地址或有效地址的部分地址。</p>
<p>地址寄存器又可以被划分为三个部分：</p>
<ul>
<li>Segment pointer（段指针）：当内存被分成若干段时，内存由一个段和一个偏移量来引用。</li>
<li>Index register（索引寄存器）：需要在一个基础值上添加一个索引，以获得一个地址。</li>
<li>Stack pointer（栈指针）：指向堆栈顶部。</li>
</ul>
</li>
</ul>
</li>
<li>
<p>控制和状态寄存器</p>
<p>用以控制处理器的操作，且主要被具有特权的操作系统例程使用，以控制程序的执行。（对用户不可见，可通过机器指令进行访问）</p>
<p>以下的寄存器是指令执行所必需的：</p>
<ul>
<li>Program Counter（PC）程序计数器：包含要获取的指令的地址。</li>
<li>Instruction Register（IR）指令寄存器：包含最近获取的指令。</li>
<li>Program Status Word（PSW）程序状态字：通常包含条件码和其他状态信息（如Interrupt enable/disable，Supervisor/user mode）。</li>
</ul>
</li>
</ul>
<h2 id="指令执行（Instruction-Execution-）">指令执行（Instruction Execution ）</h2>
<p>处理器执行的程序是由一组保存在存储器中的指令组成的。CPU是按照顺序执行一条条的指令。</p>
<blockquote>
<p>Program Execution = Instruction Execution （程序执行 = 指令执行）</p>
</blockquote>
<p>指令周期：一个单一的指令需要的处理称为一个指令周期。具体分为两个阶段：取指令阶段（指令加载到寄存器），执行阶段（解析指令）。</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E6%8C%87%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B1.png" alt=""></p>
<p>在每个指令周期开始时，处理器从存储器中取一条指令。在典型的处理器中，程序计数器（Program Counter，PC）保存下一次要取的指令地址。除非有其他情况，否则处理器在每次取指令后总是递增PC，使得它能够按顺序取得下一条指令（即位于下一个存储器地址的指令）。</p>
<blockquote>
<p>例如，考虑一个简化的计算机，每条指令占据存储器中一个16位的字，假设程序计数器PC被设置为地址300，处理器下一次将在地址为300的存储单元处取指令，在随后的指令周期中，它将从地址为301、302、303等的存储单元处取指令。（事实上这个顺序实可以改变的）</p>
</blockquote>
<p>取到的指令被放置在处理器的一个寄存器中，这个寄存器称做指令寄存器（Instruction Register，IR）。指令中包含确定处理器将要执行的操作的位，处理器解释指令并执行对应的操作。</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E6%8C%87%E4%BB%A4%E5%A4%84%E7%90%86%E6%B5%81%E7%A8%8B.png" alt=""></p>
<blockquote>
<p>注意：指令的组成包括两部分：Opcode（操作码），Opdata（操作数/操作数的地址）</p>
</blockquote>
<p>处理器收到指令后就会解释指令并执行对应操作，这些操作可分为4类：</p>
<ul>
<li>
<p>Processor-memory（处理器-存储器）：数据在处理器和存储器之间传输。</p>
</li>
<li>
<p>Processor-I/O（处理器-I/O）：数据可以传入或传出外部设备。</p>
</li>
<li>
<p>Data processing（数据处理）：处理器可以执行很多与数据相关的算术操作或逻辑操作。</p>
</li>
<li>
<p>Control（控制）：某些指令可以改变执行顺序。</p>
<blockquote>
<p>指令的执行可能涉及这些行为的组合。</p>
</blockquote>
</li>
</ul>
<p>如图是一个“计算3+2”程序的指令执行流程：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E6%8C%87%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B%E5%AE%9E%E4%BE%8B.png" alt=""></p>
<blockquote>
<p>解释：</p>
<ul>
<li>PC中包含第一条指令的地址为300，该指令内容（值为十六进制数1940）被送入指令寄存器IR中，PC增1。注意，此处理过程使用了存储器地址寄存器（MAR）和存储器缓冲寄存器（MBR）。为简单起见，这些中间寄存器没有显示。</li>
<li>IR中最初的4位（第一个十六进制数）表示需要加载AC，剩下的12位（后三个十六进制数）表示地址为940。</li>
<li>从地址为301的存储单元中取下一条指令（5941），PC增1。</li>
<li>AC中以前的内容和地址为941的存储单元中的内容相加，结果保存在AC中。</li>
<li>从地址为302的存储单元中取下一条指令（2941），PC增1。</li>
<li>AC中的内容被存储在地址为941的存储单元中。</li>
</ul>
</blockquote>
<h2 id="中断（Interrupt）">中断（Interrupt）</h2>
<p>其他模块（I/O、内存）可能中断处理器正常排序的机制。（例：一个I/O设备可以停止CPU正在进行的工作，以提供一些必要的服务。）（如下图是无中断机制下，调用外部I/O设备的情况）</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E6%97%A0%E4%B8%AD%E6%96%AD.png" alt=""></p>
<p>中断机制的引进最初是为了提高计算机系统的运行效率，但是实际使用中发现这种中断机制并不能从根本上解决问题（因为I/O设备的速度远远比处理器慢，这不是依靠中断就可以解决的，实际情况仍然符合上图），但是这带来一个新的思路：程序可以不必再顺序执行，可以利用中断机制实现多道程序的同时执行（Concurrent 并发）。</p>
<blockquote>
<p>大多数I/O设备比处理器慢得多，假设处理器使用一个指令周期方案给一台打印机传送数据，在每一次写操作后，处理器必须暂停并保持空闲，直到打印机完成工作。暂停的时间长度可能相当于成百上千个不涉及存储器的指令周期。显然，这对于处理器的使用来说是非常浪费的。</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E4%B8%AD%E6%96%AD%E5%AF%B9%E6%AF%94.png" alt=""></p>
<p>中断的三大特点：</p>
<ul>
<li>Unpredictable（不可预测性/随机性）</li>
<li>can be disable（可屏蔽性）</li>
<li>Can be nested（可嵌套性）</li>
</ul>
<p>中断的分类：</p>
<ul>
<li>Program（程序中断）</li>
<li>Timer（时钟中断）</li>
<li>I/O（I/O中断）</li>
<li>Hardware failure（硬件故障中断）</li>
</ul>
<p>有中断情况的指令周期：为了适应中断产生的情况，在指令周期中需要增加一个中断阶段。</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E6%8C%87%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B2.png" alt=""></p>
<blockquote>
<ul>
<li>如果没有中断，则获取当前程序的下一条指令。</li>
<li>如果一个中断正在等待，则暂停当前程序的执行，并执行中断处理程序.</li>
</ul>
</blockquote>
<p>多重中断（Multiple Interrupts）：当正在处理一个中断时，可以发生一个或多个中断。</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E5%A4%9A%E9%87%8D%E4%B8%AD%E6%96%AD1.png" alt=""></p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E5%A4%9A%E9%87%8D%E4%B8%AD%E6%96%AD2.png" alt=""></p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E5%A4%9A%E9%87%8D%E4%B8%AD%E6%96%AD3.png" alt=""></p>
<p>Multiprogramming（多道程序）：处理器有多个程序要执行。</p>
<p>即使有了中断机制，处理器也有可能未得到有效利用（如上图中展示的长时间I/O等待）。如果遇到长时间I/O设备等待的情况，处理器仍是空闲的。为了解决这种情况，可以允许多道用户程序同时处于活动状态。</p>
<blockquote>
<ul>
<li>程序的执行顺序取决于它们的相对优先级和是否在等待I/O</li>
<li>当程序被中断时，控制权转移给中断处理程序</li>
<li>中断处理程序完成，控制权有可能不返回到之前被中断的应用程序，而是转移到其他等待运行的具有更高优先级的程序</li>
<li>中断的处理方式：1.屏蔽中断 2.按优先级处理中断</li>
</ul>
</blockquote>
<h2 id="存储器的层次结构（The-Memory-Hierarchy）">存储器的层次结构（The Memory Hierarchy）</h2>
<p>计算机存储器的设计目标可以归纳成三个问题：多大的容量（Capacity）？多快的速度（Speed）？多贵的价格（Price）？而这三者是不可兼得的。</p>
<blockquote>
<p>各种技术间存在以下关系：</p>
<ul>
<li>存取时间越快，每一个“位”的价格越高。</li>
<li>容量越大，每一个“位”的价格越低。</li>
<li>容量越大，存取速度越慢。</li>
</ul>
</blockquote>
<p>解决不兼得的问题，需要不依赖于单一的存储组件或技术，而采用存储器的层次结构：具体可分为三层（Three Levels ）。</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E5%AD%98%E5%82%A8%E5%99%A8%E7%9A%84%E5%B1%82%E6%AC%A1%E7%BB%93%E6%9E%84.png" alt=""></p>
<ul>
<li>
<p>第一层（Inboard Memory板上存储器）：Registers（寄存器）+Cache（高速缓存）+Main Memory（主存）</p>
<p>特点：semiconductor（半导体技术）、Volatile（数据易失）、Bytes/words（表现形式为处理器可直接存取字节，容量小）</p>
</li>
<li>
<p>第二层（Outboard Storage板外存储体）：Magnetic Disk（磁盘）+ CD-ROM + CD-RW + DVD-RW + DVD-RAM</p>
<p>特点：Auxiliary memory（辅助存储）、Nonvolatile（数据非易失）、Files（表现形式为文件和记录）</p>
</li>
<li>
<p>第三层（Off-line Storage离线存储体）：Magnetic Tape（磁带）、MO、WORM</p>
</li>
</ul>
<blockquote>
<p>从上往下看会发现：</p>
<ul>
<li>每一个“位”的价格递减</li>
<li>容量递增</li>
<li>存取时间递增</li>
<li>处理器访问存储器的频率递减</li>
</ul>
</blockquote>
<h2 id="局部性原理">局部性原理</h2>
<p>在CPU访问寄存器时，无论是存取数据或存取指令，都趋于聚集在这一片连续的区域中，这就是局部性原理。</p>
<ul>
<li>Temporal locality（时间局部性）：被引用过一次的存储器位置在未来会被多次引用（通常在循环中）</li>
<li>Spatial locality（空间局部性）：如果一个存储器的位置被引用，那么将来他引用附近的位置也会被引用。</li>
</ul>
<h2 id="I-O通讯技术（I-O-Communication-Techniques）">I/O通讯技术（I/O Communication Techniques）</h2>
<p>对I/O操作有三种可能的技术：Programmed I/O（可编程I/O）、Interrupt-Driven I/O（中断驱动I/O）、Direct Memory Access / DMA（直接内存存取）</p>
<ul>
<li>
<p>Programmed I/O（可编程I/O）</p>
<ul>
<li>I/O模块执行动作，而不是处理器。</li>
<li>设置I/O状态寄存器的相应位</li>
<li>不发生中断</li>
<li>处理器执行I/O指令后定期检查状态，以确定I/O操作是否完成</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E5%8F%AF%E7%BC%96%E7%A8%8BIO.png" alt=""></p>
</li>
<li>
<p>Interrupt-Driven I/O（中断驱动I/O）</p>
<ul>
<li>
<p>当I/O模块准备交换数据时，处理器被中断</p>
</li>
<li>
<p>处理器保存程序执行的上下文，并开始执行中断处理程序。</p>
</li>
<li>
<p>不需要等待</p>
</li>
<li>
<p>消耗大量的处理器时间，因为每读或写一个字都要经过处理器。（缺点）</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E4%B8%AD%E6%96%AD%E9%A9%B1%E5%8A%A8IO.png" alt=""></p>
</li>
</ul>
</li>
<li>
<p>Direct Memory Access / DMA（直接内存存取）</p>
<ul>
<li>
<p>I/O与内存直接进行数据交换（缓解处理器的压力，DMA模块直接与存储器交互，传送数据块）。</p>
</li>
<li>
<p>流程：</p>
<p>处理器授予I/O模块读取或写入内存的权限。</p>
<p>当传输完成时，会发送一个中断。</p>
<p>处理器继续进行其他工作</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E7%9B%B4%E6%8E%A5%E5%86%85%E5%AD%98%E5%AD%98%E5%8F%96.png" alt=""></p>
</li>
</ul>
</li>
</ul>
<blockquote>
<p>为了更好的理解以上三种I/O通讯，这里再举一个例子：</p>
<p>假设现在在上一门名为“操作系统”的课程，但是同学们的教材都没有领到，为了让同学们拿到教材更有效地听讲，任课教师采取了以下三种方式：</p>
<ul>
<li>方式一：老师不断地打电话给教材发行处，询问教材有没有到位，如果没有到位就一直打电话确认，直到教材到位。然后派人到指定地点将书领回来，分发给同学们，开始上课。</li>
<li>方式二：老师给教材发行处打电话，并通知一旦教材到位就联系他，在这期间老师就开始给同学们上课。等到教材到位了发行处就会给老师打电话，通知老师领书，于是老师就暂停讲课，派人到指定地点领书，回来分发给同学们，继续上课。</li>
<li>方式三：老师给教材发行处打电话，并通知一旦教材到位就联系班长，在这期间老师开始给同学们上课。等到教材到位了发行处就会联系班长取书，于是班长就到指定地点领书，回来分发给同学们。这期间老师一直在给同学们上课，等到班长将教材全部发放完毕后，就向老师汇报“教材发放完毕”。老师收到汇报后继续给同学们讲课。</li>
</ul>
<p>方式一就可以类比为可编程I/O通讯；方式二则对应中断驱动I/O通讯；方式三对应直接内存存取通讯（其中班长担任了“DMA模块”的角色）</p>
</blockquote>
<hr>
<h1>结尾</h1>
<p>本篇结束（如有修改或补充欢迎评论）</p>
]]></content>
      <categories>
        <category>学习笔记</category>
      </categories>
      <tags>
        <tag>操作系统</tag>
      </tags>
  </entry>
  <entry>
    <title>数据库学习笔记-数据库简介</title>
    <url>/2021/03/13/%E6%95%B0%E6%8D%AE%E5%BA%93/%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AE%80%E4%BB%8B/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\css\APlayer.min.css"><script src="\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\js\Meting.min.js"></script><h1>前言</h1>
<p><em>学习数据库系统，记录笔记。</em></p>
<blockquote>
<p>参考资料：</p>
<p>《数据库系统（设计、实现与管理 第6版, Thomas M.Connolly, Carolyn E.Begg）》</p>
</blockquote>
<hr>
<h1>第一章：数据库简介</h1>
<h2 id="相关概念">相关概念</h2>
<ul>
<li>
<p><strong>数据（Data）</strong>：Data are raw facts that describe people, objects and events.（数据是描述人、物和事件的原始事实。）</p>
</li>
<li>
<p><strong>数据存储</strong>：计算机存储数据的方式可以分为两种：<strong>内存</strong>（暂时存储、掉电数据丢失），<strong>外存</strong>（永久存储，掉电数据不丢失）</p>
</li>
<li>
<p><strong>数据库（DB）</strong>：数据存储的仓库</p>
<p>数据的传递如下图：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/DB%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C%E6%B5%81%E7%A8%8B.png" alt=""></p>
<blockquote>
<p>信息系统包含：</p>
<ul>
<li>事务处理系统（TPS）</li>
<li>在线事务处理系统（OLTP）</li>
<li>供应链管理系统（SCM）</li>
<li>客户关系管理系统（CRM）</li>
<li>企业资源规划系统（ERP）</li>
</ul>
<p>运行数据库可以操作数据：</p>
<p>收集、存储、查看、查找、更新、整理、分类、移动、删除</p>
<p>分析数据库可以提取分析数据：</p>
<ul>
<li>数据挖掘（Data Mining）：找数据关系和模式</li>
<li>预测分析（Predictive Analytics）：分析历史和现在，预测未来</li>
<li>在线分析处理（OLAP）：复杂因素检测</li>
</ul>
</blockquote>
</li>
<li>
<p><strong>数据库系统（DBS）</strong>：由硬件系统、数据库、数据库管理系统、数据库应用程序、数据库用户等组成的系统。</p>
<p>数据库系统的结构层次如下图：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/DB%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%E7%9A%84%E7%BB%93%E6%9E%84%E5%B1%82%E6%AC%A1.png" alt=""></p>
<p>基于Web的数据库应用系统工作流程如下：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/DB%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B.png" alt=""></p>
</li>
<li>
<p><strong>数据库管理系统（DBMS）</strong>：A collection of programs that controls，create，maintain，and manipulate databases（一种控制、管理、创建、维护和使用数据库的大型软件）</p>
<blockquote>
<ul>
<li>合理管理和控制数据库中数据</li>
<li>保证数据库中数据的准确、安全、一致性，高效地利用数据</li>
<li>建立在操作系统之上</li>
<li>用户或应用程序发出操作数据库中数据的命令都要通过数据库管理系统来执行</li>
<li>数据的查询是通过数据库管理系统，而并非从数据库直接查询</li>
</ul>
</blockquote>
<p>数据库管理系统的功能：</p>
<ul>
<li>存储、检索、更新数据：用户通过数据库管理系统访问数据库</li>
<li>事务支持：把用户或应用程序的一系列动作看成一个事务</li>
<li>concurrency control under multiple users （多用户并发控制）：多用户并行更新数据库且更新正确</li>
<li>Integrity（完整性）：确保数据库中数据及其的更改遵循规则</li>
<li>Views（视图）：实现程序和数据的独立，隐藏数据的安全机制</li>
<li>Authorization（授权）：授权用户才可以访问</li>
<li>Access controls（访问控制）：Based on the granting and revoking of privileges.（基于权限的授予和回收）</li>
<li>Backup and recovery（备份和恢复）：数据库受到破坏后被恢复</li>
<li>Encryption（加密）：使用特殊算法对数据进行编码，使没有解密密钥的任何程序都无法读取数据。</li>
</ul>
</li>
</ul>
<h2 id="实现流程">实现流程</h2>
<p>数据库实现流程主要分为<strong>系统设计</strong>阶段以及<strong>系统实现</strong>两个部分：</p>
<ul>
<li>系统设计：又分为3个阶段
<ul>
<li>概念数据库设计：所用方法为<strong>E-R建模</strong>模型</li>
<li>逻辑数据库设计：所用方法为<strong>规范化</strong>模式</li>
<li>物理数据库设计</li>
</ul>
</li>
<li>系统实现：依靠数据库语言来实现
<ul>
<li>建立数据库的方法：<strong>数据库定义语言（DDL）</strong></li>
<li>操作数据库的方法：<strong>数据库操作语言（DML）</strong></li>
</ul>
</li>
</ul>
<h2 id="数据库设计">数据库设计</h2>
<p>数据库设计要分为三个层次（三层体系结构 The Three-level ANSI-SPARC Achitecture）：</p>
<ul>
<li><strong>外部层</strong>（用户级）（不唯一）：数据库中的部分信息，并非所有信息。
<ul>
<li>Users’view of the database.(用户视图)</li>
<li>Describes that part of database that is relevant to a particular user.(和用户相关的数据库部分)</li>
<li>子模式：从模式导出的一个子集</li>
</ul>
</li>
<li><strong>概念层</strong>（概念级）（唯一）：包含库中所有信息。
<ul>
<li>Community view of the database.（数据库整体视图）</li>
<li>Describes what data is stored in database and relationships among the data.（数据库的逻辑结构）：数据和数据之间的关系</li>
</ul>
</li>
<li><strong>内部层</strong>（物理级）（唯一）：
<ul>
<li>Physical representation of the database on the computer.（物理实现）</li>
<li>Describes how the data is stored in the database.（如何存）</li>
<li>内部表示或底层描述</li>
<li>数据库最低一级的逻辑描述</li>
<li>数据在存储介质上的存储方式和物理结构，对应着实际存储在外存储介质上的数据库</li>
</ul>
</li>
</ul>
<h2 id="数据模型">数据模型</h2>
<h3 id="数据结构">数据结构</h3>
<ul>
<li>
<p>结构化：统一的格式存储数据 （存储形式：关系型数据库）</p>
</li>
<li>
<p>半结构化：可理解的逻辑流程和格式，格式变化很大（存储形式：非关系型数据库）</p>
</li>
<li>
<p>非结构化：每份文件独特的格式，结构不规则或不完整，数据模型不固定（存储形式：非关系型数据库）</p>
</li>
</ul>
<h3 id="数据模型的分类">数据模型的分类</h3>
<p>不同的数据库结构，对应不同的数据库模型。</p>
<p>数据库按照数据模型可分为：</p>
<ul>
<li>Hierarchical Database（层次数据库）</li>
<li>Networked Database（网状数据库）</li>
<li>Relational Database（关系数据库）：现代大多数商业系统采用此模型</li>
<li>Object Database（对象数据库）</li>
<li>Object-Relational（对象关系数据库）</li>
<li>Multi Dimensional Database（多维数据库）</li>
</ul>
<h3 id="数据模型的特点">数据模型的特点</h3>
<p>数据模型包含3个部分：</p>
<ul>
<li>a structural part（结构部分）</li>
<li>a manipulative part（操作部分）</li>
<li>possibly a set of integrity constraints（完整性规则）</li>
</ul>
<blockquote>
<p>数据模型（Model）与数据模式（Schema）的区别：</p>
<ul>
<li>Schema（模式）：用某一具体的DBMS数据定义语言编写</li>
<li>Model（模型）：比模式更高层次，更抽象地描述数据库</li>
</ul>
</blockquote>
<h2 id="数据库语言">数据库语言</h2>
<p>数据库语言包含两个部分：</p>
<ul>
<li><strong>Data Definition Language（DDL）数据库定义语言</strong>：
<ul>
<li>Entities（实体）</li>
<li>Attributes（属性）</li>
<li>Relationships（联系）</li>
<li>Integrity constraints（完整性约束）</li>
<li>Security constraints（安全性约束）</li>
</ul>
</li>
<li><strong>Data Manipulation Language（DML）数据库操作语言</strong>：提供基本的数据处理操作。有两种类型。
<ul>
<li>Procedural DML（过程DML）：allows user to tell system exactly how to<br>
manipulate data.（需指定如何获得数据）</li>
<li>Non-Procedural DML（非过程DML）：allows user to state what data is needed<br>
rather than how it is to be retrieved.（说明需要什么数据）</li>
</ul>
</li>
</ul>
<h2 id="关系模型">关系模型</h2>
<p>关系模式/关系框架（Relation schema）：A named relation defined by a set of attribute<br>
and domain name pairs.（被属性和域定义的关系）</p>
<ul>
<li>
<p>定义：(A1:D1, A2:D2, … ,An:Dn)</p>
</li>
<li>
<p>An为属性名；Dn为属性的取值范围</p>
</li>
<li>
<p>实例：</p>
<table>
<thead>
<tr>
<th>属性（A）</th>
<th>域名</th>
<th>含义</th>
<th>域定义（D）</th>
</tr>
</thead>
<tbody>
<tr>
<td>branchNo</td>
<td>BranchNumbers</td>
<td>所有可能的分公司编号</td>
<td>4个字符，范围B001~B999</td>
</tr>
<tr>
<td>street</td>
<td>StreetNames</td>
<td>街道名称</td>
<td>25个字符</td>
</tr>
<tr>
<td>city</td>
<td>CityNames</td>
<td>城市名称</td>
<td>15个字符</td>
</tr>
<tr>
<td>postcode</td>
<td>Postcodes</td>
<td>邮编</td>
<td>8个字符</td>
</tr>
<tr>
<td>sex</td>
<td>Sex</td>
<td>性别</td>
<td>1个字符，取值为M或F</td>
</tr>
<tr>
<td>DOB</td>
<td>DatesOfBirth</td>
<td>员工的生日</td>
<td>日期类型，范围从1-1-20起，格式为dd-mmm-yy</td>
</tr>
<tr>
<td>salary</td>
<td>Salaries</td>
<td>员工的工资</td>
<td>7位数字，范围6000.00~40000.00</td>
</tr>
</tbody>
</table>
</li>
</ul>
<p>Relational database schema（关系数据库模式）：其实就是关系模式的集合</p>
<p>下面以Dreamhome（一个房产销售和租赁公司的数据库系统）案例来理解关系数据库模式：</p>
<blockquote>
<p>表名（属性）：</p>
<p>Branch分公司（branchNo, street, city, postcode）</p>
<p>Staff职员（staffNo, fName, IName, position sex, DOB, salary, branchNo）</p>
<p>PropertyForRent待租房产（propertyNo, street, city, postcode, type, rooms, rent, ownerNo, staffNo, branchNo）</p>
<p>Client客户（clientNo, fName, IName, telNo, prefType, maxRent, eMail）</p>
<p>PrivateOwner私人房产房主（ownerNo, fName, IName, address, telNo, eMail, password）</p>
<p>Viewing看房记录（clientNo, propertyNo, viewDate, comment）</p>
<p>Registration注册记录（clientNo, branchNo, staffNo, dateJoined）</p>
<p>Lease合同（leaseNo, propertyNo, clientNo, rent, paymentMethod, deposit, paid, rentStart, rentStart, rentFinish, duration）</p>
</blockquote>
<p>关系模型（Relational Model）：是一种特殊的数据模型。</p>
<p>包含三要素：</p>
<ul>
<li>Relational Data structure（数据结构）</li>
<li>Relational Data manipulation（数据操纵）</li>
<li>Constraints of data integrity（数据的完整性约束）</li>
</ul>
<p>关系数据模型的相关概念：</p>
<ul>
<li>Attribute（属性）：columns，field（列，字段）：An attribute is a named column of a relation.（属性是关系中命名的列）</li>
<li>Domain（域）：A domain is the set of allowable values for one or more attributes.（属性的取值范围，域是一个或多个属性的取值集合）</li>
<li>Tuple（元组）：row，record（行，记录）：A tuples is a row of relation.（关系中的每一行称为元组）</li>
<li>Degree（维，目，度）：属性的数目（列数）：The degree of a relation is the number of attributes it contains.（关系的维数是指关系所包含属性的个数）</li>
<li>Cardinality（基数）：元组的数目（行数）：The cardinality of a relation is the number of tuples it contains.（关系的基数是指它所包含元组的个数）</li>
<li>Super Key（超关键字）：One or more columns whose values are sufficient to identify a row.（一个属性或属性集合，它能唯一地标识出关系中的每个元组）</li>
<li>Candidate Key（候选关键字）：A super key but no proper subset is a super key.（本身是超关键字但其任何子集都不再是超关键字）：可能有多个</li>
<li>Primary Key（主关键字）：Select one of the candidate keys to use primarily as primary key.（被选用于唯一标识关系中各元组的候选关键字，多个候选关键字中选最合适的一个）</li>
<li>Foreign Key（外部关键字）：An attribute or a set of attributes within a relation that matches the candidate key of some relation。（当一个关系中的某个属性或属性集合与另一个关系（也可是自己）的候选关键字匹配时，就称这个属性或属性集合为外部关键字）</li>
</ul>
<p>下面以Dreamhome关系模式为例进行关键字说明：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/DB%E5%85%B3%E9%94%AE%E5%AD%97%E6%A1%88%E4%BE%8B.png" alt=""></p>
<p>关系完整性：</p>
<ul>
<li>
<p>Nulls（空）：Null represents a value for an attribute that is currently unknown or is not applicable for this tuple.（代表对一个元组当前取值还不知道或是不可用的属性值。）</p>
</li>
<li>
<p>Entity Integrity（实体完整性）：</p>
<p>（Candidate）keys must be unique.（关键字值唯一）</p>
<p>In a relation，no attribute of a primary key can be null.（基本表主关键字的诸属性均不能为空）</p>
</li>
<li>
<p>Referential Integrity （参照完整性）：If a foreign key exists in a relation，either the foreign value must match a candidate key value of some tuple in its home relation or the foreign key value must be wholly null.（外部关键字取参照候选关键字值或取空值）</p>
</li>
<li>
<p>Enterprise constraints（企业约束）：Additional rules specified by the users or database administrators of a database.（用户和管理员定义的附加规则）</p>
</li>
</ul>
]]></content>
      <categories>
        <category>学习笔记</category>
      </categories>
      <tags>
        <tag>数据库</tag>
      </tags>
  </entry>
  <entry>
    <title>操作系统学习笔记</title>
    <url>/2021/03/28/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\css\APlayer.min.css"><script src="\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\js\Meting.min.js"></script><p><em><strong>操作系统学习笔记</strong></em></p>
<blockquote>
<p>参考资料：</p>
<p>《操作系统（精髓与设计原理 第6版）</p>
</blockquote>
<hr>
<h1>第一章：计算机系统概述</h1>
<div class="btn-center">
<a class="btn-beautify button--animated block outline larger" href="/2021/03/14/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%BF%B0/" 
  title="点击跳转 至 《计算机系统概述》"><i class="far fa-hand-point-right"></i><span>点击跳转 至 《计算机系统概述》</span></a>
</div>
<h1>第二章：操作系统概述</h1>
<div class="btn-center">
<a class="btn-beautify button--animated block outline blue larger" href="/2021/03/22/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%BF%B0/" 
  title="点击跳转 至 《操作系统概述》"><i class="far fa-hand-point-right"></i><span>点击跳转 至 《操作系统概述》</span></a>
</div>
<h1>第三章：进程描述和控制</h1>
<div class="btn-center">
<a class="btn-beautify button--animated block outline pink larger" href="/2021/03/30/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E8%BF%9B%E7%A8%8B%E6%8F%8F%E8%BF%B0%E5%92%8C%E6%8E%A7%E5%88%B6/" 
  title="点击跳转 至 《进程描述和控制》"><i class="far fa-hand-point-right"></i><span>点击跳转 至 《进程描述和控制》</span></a>
</div>
<h1>第四章：线程、对称多处理（SMP）和微内核</h1>
<div class="btn-center">
<a class="btn-beautify button--animated block outline red larger" href="/2021/04/09/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E7%BA%BF%E7%A8%8B%E3%80%81%E5%AF%B9%E7%A7%B0%E5%A4%9A%E5%A4%84%E7%90%86%EF%BC%88SMP%EF%BC%89%E5%92%8C%E5%BE%AE%E5%86%85%E6%A0%B8/" 
  title="点击跳转 至 《线程、对称多处理（SMP）和微内核》"><i class="far fa-hand-point-right"></i><span>点击跳转 至 《线程、对称多处理（SMP）和微内核》</span></a>
</div>
<h1>第五章：并发性：互斥和同步</h1>
<div class="btn-center">
<a class="btn-beautify button--animated block outline purple larger" href="/2021/04/21/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E5%B9%B6%E5%8F%91%E6%80%A7%EF%BC%9A%E4%BA%92%E6%96%A5%E5%92%8C%E5%90%8C%E6%AD%A5/" 
  title="点击跳转 至 《并发性：互斥和同步》"><i class="far fa-hand-point-right"></i><span>点击跳转 至 《并发性：互斥和同步》</span></a>
</div>
<h2 id="信号量相关问题">信号量相关问题</h2>
<div class="btn-center">
<a class="btn-beautify button--animated block outline orange larger" href="/2021/04/25/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E4%BF%A1%E5%8F%B7%E9%87%8F%E7%9B%B8%E5%85%B3%E9%97%AE%E9%A2%98/" 
  title="点击跳转 至 《信号量相关问题》"><i class="far fa-hand-point-right"></i><span>点击跳转 至 《信号量相关问题》</span></a>
</div>
<h1>第六章：并发：死锁和饥饿</h1>
<div class="btn-center">
<a class="btn-beautify button--animated block outline green larger" href="/2021/05/04/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E5%B9%B6%E5%8F%91%EF%BC%9A%E6%AD%BB%E9%94%81%E5%92%8C%E9%A5%A5%E9%A5%BF/" 
  title="点击跳转 至 《并发：死锁和饥饿》"><i class="far fa-hand-point-right"></i><span>点击跳转 至 《并发：死锁和饥饿》</span></a>
</div>
<h1>第七章：内存管理</h1>
<div class="btn-center">
<a class="btn-beautify button--animated block outline larger" href="/2021/05/23/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/" 
  title="点击跳转 至 《内存管理》"><i class="far fa-hand-point-right"></i><span>点击跳转 至 《内存管理》</span></a>
</div>
<h1>第八章：虚拟内存</h1>
<div class="btn-center">
<a class="btn-beautify button--animated block outline blue larger" href="/2021/05/24/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98/" 
  title="点击跳转 至 《虚拟内存》"><i class="far fa-hand-point-right"></i><span>点击跳转 至 《虚拟内存》</span></a>
</div>
<h1>第九章：单处理器调度</h1>
<div class="btn-center">
<a class="btn-beautify button--animated block outline pink larger" href="/2021/05/30/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E5%8D%95%E5%A4%84%E7%90%86%E5%99%A8%E8%B0%83%E5%BA%A6/" 
  title="点击跳转 至 《单处理器调度》"><i class="far fa-hand-point-right"></i><span>点击跳转 至 《单处理器调度》</span></a>
</div>
<h1>第十一章：I/O管理和磁盘调度</h1>
<div class="btn-center">
<a class="btn-beautify button--animated block outline red larger" href="/2021/06/02/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-I-O%E7%AE%A1%E7%90%86%E5%92%8C%E7%A3%81%E7%9B%98%E8%B0%83%E5%BA%A6/" 
  title="点击跳转 至 《I/O管理和磁盘调度》"><i class="far fa-hand-point-right"></i><span>点击跳转 至 《I/O管理和磁盘调度》</span></a>
</div>
<h1>第十二章：文件管理</h1>
<div class="btn-center">
<a class="btn-beautify button--animated block outline purple larger" href="/2021/06/09/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E6%96%87%E4%BB%B6%E7%AE%A1%E7%90%86/" 
  title="点击跳转 至 《文件管理》"><i class="far fa-hand-point-right"></i><span>点击跳转 至 《文件管理》</span></a>
</div>
]]></content>
      <categories>
        <category>学习笔记</category>
      </categories>
      <tags>
        <tag>操作系统</tag>
      </tags>
  </entry>
  <entry>
    <title>数论基础（部分计算方法）</title>
    <url>/2021/06/19/%E6%95%B0%E8%AE%BA/%E6%95%B0%E8%AE%BA%E5%9F%BA%E7%A1%80%EF%BC%88%E9%83%A8%E5%88%86%E8%AE%A1%E7%AE%97%E6%96%B9%E6%B3%95%EF%BC%89/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\css\APlayer.min.css"><script src="\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\js\Meting.min.js"></script><h1>前言</h1>
<p>每写一次题就得翻翻笔记，总是忘记，太恼火了。故有此篇。</p>
<hr>
<h1>正文</h1>
<h2 id="模重复平方计算">模重复平方计算</h2>
<p>例1：计算 <strong>688<sup>79</sup> mod 3337</strong></p>
<img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/模重复平方计算法1.png" style="zoom:67%;" />
<p>例2：计算 <strong>9726<sup>3533</sup> mod 11413</strong></p>
<img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/模重复平方计算法2.png" style="zoom: 80%;" />
<p>所以 <strong>9726<sup>3533</sup> mod 11413 = 5761</strong></p>
<h2 id="扩展欧几里得计算">扩展欧几里得计算</h2>
<p>例：计算 <strong>79<sup>-1</sup> mod 3220</strong></p>
<img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/扩展欧几里得计算法1.png" style="zoom:67%;" />
<blockquote>
<p>当然也可以采用逆推的方法，这里不再介绍。</p>
</blockquote>
<hr>
<h1>后记</h1>
<p>结束</p>
]]></content>
      <categories>
        <category>学习笔记</category>
      </categories>
      <tags>
        <tag>数论</tag>
      </tags>
  </entry>
  <entry>
    <title>Hexo部署至服务器（Ubuntu 20.04）</title>
    <url>/2021/10/12/%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%88Ubuntu%EF%BC%89/Hexo%E9%83%A8%E7%BD%B2%E8%87%B3%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%88Ubuntu-20-04%EF%BC%89/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\css\APlayer.min.css"><script src="\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\js\Meting.min.js"></script><h1>前言</h1>
<p>本文将介绍如何从零开始，将Hexo项目部署到服务器（Ubuntu 20.04）上。</p>
<blockquote>
<p>注意：</p>
<p>本篇教程的服务器环境为虚拟机（Ubuntu 20.04），所有的操作均使用Xshell连接进行。对于购买的云服务器环境仍具有适用性。</p>
</blockquote>
<hr>
<h1>正文</h1>
<h2 id="环境">环境</h2>
<ul>
<li>
<p>服务器：虚拟机（Ubuntu 20.04）</p>
<p>IP：192.168.75.138</p>
</li>
<li>
<p>客户端：Windows 10</p>
</li>
</ul>
<p>客户端使用Xshell与服务器连接，进行操作。</p>
<h2 id="Ubuntu搭建Git服务器">Ubuntu搭建Git服务器</h2>
<p>首先使用Xshell连接服务器，并切换root用户，回退到根路径</p>
<p><img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Ubuntu%E6%90%AD%E5%BB%BAGit%E6%9C%8D%E5%8A%A1%E5%99%A8_step1.png" alt=""></p>
<h3 id="创建Git仓库">创建Git仓库</h3>
<ol>
<li>
<p>安装 openssh</p>
<p>命令如下：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo apt-get install openssh-server</span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Ubuntu%E6%90%AD%E5%BB%BAGit%E6%9C%8D%E5%8A%A1%E5%99%A8_step2.png" alt=""></p>
</li>
<li>
<p>安装完成之后，查看ssh服务是否启动</p>
<p>命令如下：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ps -e|grep ssh</span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Ubuntu%E6%90%AD%E5%BB%BAGit%E6%9C%8D%E5%8A%A1%E5%99%A8_step3.png" alt=""></p>
</li>
<li>
<p>创建一个名为<code>blog</code>的用户，用于管理Hexo项目</p>
<p>命令如下：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">adduser blog</span><br></pre></td></tr></table></figure>
<p>会提示输入密码，重复确认密码，后面的内容直接回车就好</p>
<p><img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Ubuntu%E6%90%AD%E5%BB%BAGit%E6%9C%8D%E5%8A%A1%E5%99%A8_step4.png" alt=""></p>
</li>
<li>
<p>给<code>blog</code>用户添加文件的写权限</p>
<p>使用vim编辑<code>/etc/sudoers</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim /etc/sudoers</span><br></pre></td></tr></table></figure>
<p>找到<code>User privilege specification</code>部分，添加如下内容：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">blog    ALL&#x3D;(ALL:ALL) ALL</span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Ubuntu%E6%90%AD%E5%BB%BAGit%E6%9C%8D%E5%8A%A1%E5%99%A8_step5.png" alt=""></p>
</li>
<li>
<p>切换至<code>blog</code>用户</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">su blog</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>安装git</p>
<p>命令如下：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo apt-get install git-core</span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Ubuntu%E6%90%AD%E5%BB%BAGit%E6%9C%8D%E5%8A%A1%E5%99%A8_step6.png" alt=""></p>
</li>
<li>
<p>退回到根路径（<code>cd /</code>），在<code>/var/repo</code>下创建名为<code>hexo_static</code>的裸仓库</p>
<p>命令如下：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo mkdir /var/repo/</span><br><span class="line">sudo chown -R $USER:$USER /var/repo/</span><br><span class="line">sudo chmod -R 755 /var/repo/</span><br><span class="line"></span><br><span class="line">cd /var/repo/</span><br><span class="line">git init --bare hexo_static.git</span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Ubuntu%E6%90%AD%E5%BB%BAGit%E6%9C%8D%E5%8A%A1%E5%99%A8_step8%E6%94%B9.png" alt=""></p>
</li>
<li>
<p>可以进到该目录进行查看</p>
<p><img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Ubuntu%E6%90%AD%E5%BB%BAGit%E6%9C%8D%E5%8A%A1%E5%99%A8_step9.png" alt=""></p>
</li>
</ol>
<h3 id="配置Nginx托管文件目录">配置Nginx托管文件目录</h3>
<ol>
<li>
<p>首先安装Nginx</p>
<p>命令如下：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo apt-get install nginx -y</span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/%E9%85%8D%E7%BD%AENginx%E6%89%98%E7%AE%A1%E6%96%87%E4%BB%B6%E7%9B%AE%E5%BD%95_step1.png" alt=""></p>
</li>
<li>
<p>创建<code>/var/www/hexo</code>目录，用于Nginx托管，修改目录所有权和权限</p>
<p>命令如下：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo mkdir -p /var/www/hexo</span><br><span class="line"></span><br><span class="line">sudo chown -R $USER:$USER /var/www/hexo</span><br><span class="line">sudo chmod -R 755 /var/www/hexo</span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/%E9%85%8D%E7%BD%AENginx%E6%89%98%E7%AE%A1%E6%96%87%E4%BB%B6%E7%9B%AE%E5%BD%95_step2.png" alt=""></p>
</li>
<li>
<p>使用vim修改<code>/etc/nginx/sites-enabled/default</code>，使<code>root</code>指向<code>hexo</code>目录</p>
<p>命令如下：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo vim /etc/nginx/sites-enabled/default</span><br></pre></td></tr></table></figure>
<p>找到<code>server</code>部分，修改如下内容</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">root &#x2F;var&#x2F;www&#x2F;hexo;</span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/%E9%85%8D%E7%BD%AENginx%E6%89%98%E7%AE%A1%E6%96%87%E4%BB%B6%E7%9B%AE%E5%BD%95_step3%E6%94%B92.png" alt=""></p>
<blockquote>
<p>该步骤将Nginx服务的默认路径修改为指定目录<code>hexo</code>。</p>
</blockquote>
</li>
<li>
<p>重启Nginx服务，使得改动生效</p>
<p>命令如下：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo service nginx restart</span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/%E9%85%8D%E7%BD%AENginx%E6%89%98%E7%AE%A1%E6%96%87%E4%BB%B6%E7%9B%AE%E5%BD%95_step4.png" alt=""></p>
</li>
</ol>
<h3 id="创建Git钩子">创建Git钩子</h3>
<ol>
<li>
<p>在之前创建的<code>hexo_static</code>裸仓库下有一个<code>hooks</code>文件夹，在其中创建一个名为<code>post-receive</code>的钩子文件：</p>
<p>命令如下：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim /var/repo/hexo_static.git/hooks/post-receive</span><br></pre></td></tr></table></figure>
<p>在其中写入如下内容：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line"></span><br><span class="line">git --work-tree&#x3D;&#x2F;var&#x2F;www&#x2F;hexo --git-dir&#x3D;&#x2F;var&#x2F;repo&#x2F;hexo_static.git checkout -f</span><br></pre></td></tr></table></figure>
<p>保存后退出</p>
</li>
<li>
<p>让该文件变为可执行文件</p>
<p>命令如下：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">chmod +x /var/repo/hexo_static.git/hooks/post-receive</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="Windows搭建客户端">Windows搭建客户端</h2>
<ol>
<li>
<p>首先安装git，这里不再过多赘述</p>
</li>
<li>
<p>使用命令<code>ssh-keygen -t rsa</code>在windons用户下/.ssh文件夹中生成密钥</p>
</li>
<li>
<p>将生成的公钥<code>id_rsa.pub</code>拷贝到ubuntu服务器的<code>/home/blog/.ssh/authorized_keys</code>上</p>
<p>首先创建<code>.ssh</code>目录，并进入该目录</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo mkdir .ssh</span><br><span class="line">cd .ssh/</span><br></pre></td></tr></table></figure>
<p>接着创建<code>authorized_keys</code>文件</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo touch authorized_keys</span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Windows%E5%AE%A2%E6%88%B7%E7%AB%AFgit%E9%85%8D%E7%BD%AE_step1.png" alt=""></p>
</li>
<li>
<p>将Windows下<code>id_rsa.pub</code>文件中的内容复制到Ubuntu下的<code>authorized_keys</code>文件</p>
<p>命令如下：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo vim .ssh/authorized_keys</span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Windows%E5%AE%A2%E6%88%B7%E7%AB%AFgit%E9%85%8D%E7%BD%AE_step2.png" alt=""></p>
</li>
</ol>
<h2 id="部署Hexo项目">部署Hexo项目</h2>
<p>编辑hexo的<code>config.yml</code>文件，在<code>deploy</code>处修改<code>repo</code>项：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">deploy:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">git</span></span><br><span class="line">  <span class="attr">repo:</span> <span class="string">blog@server_ip:/var/repo/hexo_static.git</span></span><br><span class="line">  <span class="attr">branch:</span> <span class="string">master</span></span><br></pre></td></tr></table></figure>
<p>执行命令<code>hexo deploy</code>，将静态文件上传至Ubuntu服务器</p>
<p><img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Hexo%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2%E8%87%B3Ubuntu_step1.png" alt=""></p>
<p>进入目录<code>var/www/hexo/</code>下，可以看到静态文件已全部上传</p>
<p><img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Hexo%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2%E8%87%B3Ubuntu_step2.png" alt=""></p>
<h2 id="访问测试">访问测试</h2>
<p>打开浏览器，输入Ubuntu服务器的IP地址，就可以看到博客页面啦</p>
<p><img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Hexo%E9%83%A8%E7%BD%B2%E8%87%B3%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BB%93%E6%9E%9C%E5%B1%95%E7%A4%BA3.png" alt=""></p>
<hr>
<h1>补充</h1>
<p>如果部署到购买的云服务器（阿里云）上，可能出现访问服务器IP没有响应的情况</p>
<p>点击<code>云服务器/ECS</code>，在<strong>安全组规则</strong>中手动添加一条80端口的规则：</p>
<p><img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/%E9%98%BF%E9%87%8C%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%AE%BE%E7%BD%AE%E5%AE%89%E5%85%A8%E7%BB%84%E8%A7%84%E5%88%99.png" alt=""></p>
<hr>
<h1>后记</h1>
<p>（后续补充域名的配置操作）</p>
<blockquote>
<p>参考文章：</p>
<ul>
<li><a href="https://www.jianshu.com/p/16b89f4f7136">用Hexo部署博客到Ubuntu服务器 - 简书 (jianshu.com)</a></li>
<li><a href="https://www.cnblogs.com/sxkgeek/p/9120742.html">Git版本控制之ubuntu搭建Git服务器 - StoneGeek - 博客园 (cnblogs.com)</a></li>
</ul>
</blockquote>
]]></content>
      <categories>
        <category>博客</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
        <tag>Ubuntu</tag>
      </tags>
  </entry>
  <entry>
    <title>Hexo部署至服务器（续）——建立引导页及分站</title>
    <url>/2021/10/13/%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%88Ubuntu%EF%BC%89/Hexo%E9%83%A8%E7%BD%B2%E8%87%B3%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%88%E7%BB%AD%EF%BC%89%E2%80%94%E2%80%94%E5%BB%BA%E7%AB%8B%E5%BC%95%E5%AF%BC%E9%A1%B5%E5%8F%8A%E5%88%86%E7%AB%99/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\css\APlayer.min.css"><script src="\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\js\Meting.min.js"></script><h1>前言</h1>
<p>接着上篇 👇</p>
<div class="btn-center">
<a class="btn-beautify button--animated block outline larger" href="/2021/10/12/Hexo%E9%83%A8%E7%BD%B2%E8%87%B3%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%88Ubuntu-20-04%EF%BC%89/" 
  title="点击跳转 至 《Hexo部署至服务器（Ubuntu-20-04）》"><i class="far fa-hand-point-right"></i><span>点击跳转 至 《Hexo部署至服务器（Ubuntu-20-04）》</span></a>
</div>
<p>之前的建立分站教程（<a href="https://cnhuazhu.top/2021/07/14/Hexo%E9%AD%94%E6%94%B9/Hexo%E5%BB%BA%E7%AB%8B%E5%88%86%E7%AB%99/">Hexo建立分站 | 花猪のBlog (cnhuazhu.top)</a>）是利用了Hexo纯静态的优势，将不同主题渲染后的<code>public</code>中的内容放在主站的<code>public</code>文件夹中。（所以称之为“主站”和“分站”，但其实这个结构用“父站”和“子站”形容更贴切。如下图所示）</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/%E5%BB%BA%E7%AB%8B%E5%88%86%E7%AB%99.png" alt=""></p>
<blockquote>
<p>受限于这种“简单粗暴”的方式，如果我仅仅是想更新“子站”的内容，那么我需要将子站的页面全部渲染完成之后，再将其内容复制到“父站”的相应目录中去，最后渲染“父站”的页面。</p>
<p>本来无后端写博客的步骤就够繁琐，如此一来更加麻烦。</p>
</blockquote>
<p>所以我在想</p>
<p>既然已经拥有了一个服务器，何不做一个真正意义上拥有<strong>引导页面</strong>和**平级“分站”**的结构。同样是利用Hexo，使两个不同主题的结构没有嵌套关系，之后如果想书写不同的内容也可以分别<code>deploy</code>，这才是理想的样子嘛。</p>
<p>所以开始干活吧↓↓↓↓</p>
<blockquote>
<p>本篇教程所使用的两个主题为<a href="https://butterfly.js.org/">Butterfly</a>和<a href="https://theme-next.js.org/">Next</a></p>
<p>设有站点引导页面，结构如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">blog-LeadPage</span><br><span class="line">    ├─butterfly</span><br><span class="line">    └─next</span><br></pre></td></tr></table></figure>
</blockquote>
<hr>
<h1>正文</h1>
<h2 id="配置服务器（Ubuntu-20-04）">配置服务器（Ubuntu 20.04）</h2>
<h3 id="搭建站点结构">搭建站点结构</h3>
<ol>
<li>
<p>创建<code>/var/www/blog-LeadPage</code>，作为站点的根目录，之后会在该目录下搭建网站结构。</p>
<p>命令如下：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo mkdir -p /var/www/blog-LeadPage</span><br><span class="line"></span><br><span class="line">sudo chown -R $USER:$USER /var/www/blog-LeadPage</span><br><span class="line">sudo chmod -R 755 /var/www/blog-LeadPage</span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Hexo%E9%83%A8%E7%BD%B2%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%88%E7%BB%AD%EF%BC%89_%E9%85%8D%E7%BD%AE%E6%9C%8D%E5%8A%A1%E5%99%A8_step1.png" alt=""></p>
<blockquote>
<p>这里也可以直接采用Nginx初始化的<code>html</code>文件夹作为站点根目录，在该文件夹中修改<code>index.html</code>用作博客的引导页，后续在该文件夹中搭建网站结构。</p>
</blockquote>
</li>
<li>
<p>使用vim修改<code>/etc/nginx/sites-enabled/default</code>，使root指向<code>blog-LeadPage</code>目录</p>
<p>命令如下：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo vim /etc/nginx/sites-enabled/default</span><br></pre></td></tr></table></figure>
<p>找到<code>server</code>部分，修改如下内容：</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">root <span class="regexp">/var/</span>www/blog-LeadPage;</span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Hexo%E9%83%A8%E7%BD%B2%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%88%E7%BB%AD%EF%BC%89_%E9%85%8D%E7%BD%AE%E6%9C%8D%E5%8A%A1%E5%99%A8_step2.png" alt=""></p>
</li>
<li>
<p>重启Nginx服务，使得改动生效</p>
<p>命令如下：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo service nginx restart</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>退回到根路径（<code>cd /</code>），在<code>/var/repo</code>下分别创建两个裸仓库：<code>hexo_butterfly.git</code>、<code>hexo_next.git</code></p>
<p>命令如下：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo mkdir /var/repo/</span><br><span class="line">sudo chown -R $USER:$USER /var/repo/</span><br><span class="line">sudo chmod -R 755 /var/repo/</span><br><span class="line"></span><br><span class="line">cd /var/repo/</span><br><span class="line">git init --bare hexo_butterfly.git</span><br><span class="line">git init --bare hexo_next.git</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>在<code>/var/www/blog-LeadPage</code>中创建两个目录：<code>hexo_butterfly</code>、<code>hexo_next</code>。并修改目录所有权和权限。</p>
<p>命令如下：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo mkdir -p /var/www/blog-LeadPage/butterfly</span><br><span class="line">sudo chown -R $USER:$USER /var/www/blog-LeadPage/butterfly</span><br><span class="line">sudo chmod -R 755 /var/www/blog-LeadPage/butterfly</span><br><span class="line"></span><br><span class="line">sudo mkdir -p /var/www/blog-LeadPage/next</span><br><span class="line">sudo chown -R $USER:$USER /var/www/blog-LeadPage/next</span><br><span class="line">sudo chmod -R 755 /var/www/blog-LeadPage/next</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="创建Git钩子">创建Git钩子</h3>
<ol>
<li>
<p>在之前创建的两个裸仓库中有有一个<code>hooks</code>文件夹，分别在其中创建名为<code>post-receive</code>的钩子文件：</p>
<p>命令如下：</p>
<p>butterfly仓库：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim /var/repo/hexo_butterfly.git/hooks/post-receive</span><br></pre></td></tr></table></figure>
<p>在其中写入如下内容：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line"></span><br><span class="line">git --work-tree&#x3D;&#x2F;var&#x2F;www&#x2F;blog-LeadPage&#x2F;butterfly --git-dir&#x3D;&#x2F;var&#x2F;repo&#x2F;hexo_butterfly.git checkout -f</span><br></pre></td></tr></table></figure>
<p>next仓库：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim /var/repo/hexo_next.git/hooks/post-receive</span><br></pre></td></tr></table></figure>
<p>在其中写入如下内容：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line"></span><br><span class="line">git --work-tree&#x3D;&#x2F;var&#x2F;www&#x2F;blog-LeadPage&#x2F;next --git-dir&#x3D;&#x2F;var&#x2F;repo&#x2F;hexo_next.git checkout -f</span><br></pre></td></tr></table></figure>
<p>保存后退出</p>
</li>
<li>
<p>让两个文件变为可执行文件</p>
<p>命令如下：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">chmod +x /var/repo/hexo_butterfly.git/hooks/post-receive</span><br><span class="line">chmod +x /var/repo/hexo_next.git/hooks/post-receive</span><br></pre></td></tr></table></figure>
<p>至此服务器结构搭建完成。</p>
</li>
</ol>
<h2 id="Windows客户端配置">Windows客户端配置</h2>
<p>（主要就是配置ssh，这里不再赘述，详情看上篇文章）</p>
<h2 id="部署Hexo项目">部署Hexo项目</h2>
<p>分别编辑<strong>butterfly</strong>和<strong>next</strong>两个主题项目的<code>config.yml</code>文件中的<code>deploy</code>部分：</p>
<ul>
<li>
<p>butterfly：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">deploy:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">git</span></span><br><span class="line">  <span class="attr">repo:</span> <span class="string">blog@server_ip:/var/repo/hexo_butterfly.git</span></span><br><span class="line">  <span class="attr">branch:</span> <span class="string">master</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>next：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">deploy:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">git</span></span><br><span class="line">  <span class="attr">repo:</span> <span class="string">blog@server_ip:/var/repo/hexo_next.git</span></span><br><span class="line">  <span class="attr">branch:</span> <span class="string">master</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>然后执行Hexo命令“三步骤”，上传静态文件至Ubuntu服务器。</p>
<p>可以查看服务器中的内容：</p>
<p><img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Hexo%E9%83%A8%E7%BD%B2%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%88%E7%BB%AD%EF%BC%89_%E9%85%8D%E7%BD%AE%E6%9C%8D%E5%8A%A1%E5%99%A8_step3.png" alt=""></p>
<h2 id="访问测试">访问测试</h2>
<ul>
<li>
<p>访问站点根目录（引导页）：</p>
<p><img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Hexo%E9%83%A8%E7%BD%B2%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%88%E7%BB%AD%EF%BC%89_%E6%95%88%E6%9E%9C%E5%B1%95%E7%A4%BA1.png" alt=""></p>
</li>
<li>
<p>访问butterfly主题分站</p>
<p><img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Hexo%E9%83%A8%E7%BD%B2%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%88%E7%BB%AD%EF%BC%89_%E6%95%88%E6%9E%9C%E5%B1%95%E7%A4%BA2%E6%94%B93.png" alt=""></p>
</li>
<li>
<p>访问next主题分站</p>
<p><img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Hexo%E9%83%A8%E7%BD%B2%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%88%E7%BB%AD%EF%BC%89_%E6%95%88%E6%9E%9C%E5%B1%95%E7%A4%BA3.png" alt=""></p>
</li>
</ul>
<p>完成</p>
<h2 id="可能遇到的问题">可能遇到的问题</h2>
<h3 id="Hexo的root设置">Hexo的root设置</h3>
<p>由于hexo被设计成了不同的分站，因此在<code>_config.yml</code>文件中的<code>root</code>处需要修改主题的根路径：</p>
<ul>
<li>
<p>butterfly</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># URL</span></span><br><span class="line"><span class="comment">## If your site is put in a subdirectory, set url as &#x27;http://example.com/child&#x27; and root as &#x27;/child/&#x27;</span></span><br><span class="line"><span class="attr">url:</span> <span class="string">xxx</span></span><br><span class="line"><span class="attr">root:</span> <span class="string">/butterfly/</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>next</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># URL</span></span><br><span class="line"><span class="comment">## Set your site url here. For example, if you use GitHub Page, set url as &#x27;https://username.github.io/project&#x27;</span></span><br><span class="line"><span class="attr">url:</span> <span class="string">xxx</span></span><br><span class="line"><span class="attr">root:</span> <span class="string">/next/</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="Inject">Inject</h3>
<p><code>butterfly</code>主题在修改了<code>root</code>路径后需要注意，在主题配置文件<code>_config.butterfly.yml</code>中的<code>Inject</code>部分，需要在引入本地<code>css</code>和<code>js</code>代码的路径前添加<code>root</code>路径。否则将无法把文件引入到html中</p>
<p><img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Hexo%E9%83%A8%E7%BD%B2%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%88%E7%BB%AD%EF%BC%89_%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B91.png" alt=""></p>
<hr>
<h1>后记</h1>
<p>操作中有时真的能被自己蠢哭，遇到某些问题上网查很多都没有得到解决，反而回过头看看官方的指导手册，明晃晃的就写在那里。</p>
<p>还是记录下来整个过程，对未来的自己好一些，哪怕也只是个小小的提醒。</p>
]]></content>
      <categories>
        <category>博客</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
        <tag>Ubuntu</tag>
      </tags>
  </entry>
  <entry>
    <title>Nginx+uWSGI+Flask部署至Ubuntu</title>
    <url>/2021/10/28/%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%88Ubuntu%EF%BC%89/Nginx-uWSGI-Flask%E9%83%A8%E7%BD%B2%E8%87%B3Ubuntu/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\css\APlayer.min.css"><script src="\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\js\Meting.min.js"></script><h1>前言</h1>
<p>最近在学习flask，想做一个简单的示例Demo，并将其部署在服务器上。</p>
<p>因为服务器的80端口已用于展示个人博客，所以会将本项目监听于其他端口，定为<code>8001</code>。</p>
<blockquote>
<p>服务器为Ubuntu 20.04（虚拟机），IP地址：192.168.75.138</p>
</blockquote>
<hr>
<h1>正文</h1>
<h2 id="项目环境搭建">项目环境搭建</h2>
<ol>
<li>
<p>首先创建虚拟环境，项目文件之后也要放到该环境中</p>
<p>创建目录<code>/home/flask_demo</code>，并进入该目录</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo mkdir home/flask_demo</span><br><span class="line">cd home/flask_demo</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>安装虚拟环境</p>
<p>命令如下：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo pip install virtualenv</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>生成文件夹<code>ENV_flask</code>，进入其中</p>
<p>命令如下：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo virtualenv ENV_flask</span><br><span class="line">cd ENV_flask</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>激活虚拟环境</p>
<p>命令如下：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">source bin/activate</span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Flask%E9%83%A8%E7%BD%B2Ubuntu-%E6%BF%80%E6%B4%BB%E8%99%9A%E6%8B%9F%E7%8E%AF%E5%A2%83.png" alt=""></p>
</li>
<li>
<p>在虚拟环境下安装flask</p>
<p>命令如下：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo pip install flask</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>将flask项目的<code>Demo</code>拷贝至<code>/home/flask_demo/ENV_flask</code>下</p>
<p>这里用到<strong>Xftp</strong>，也可以采用其他方式</p>
<p>最后<code>ENV_flask</code>目录的结构如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">│  .gitignore</span><br><span class="line">│  app.py</span><br><span class="line">│  pyvenv.cfg</span><br><span class="line">│  </span><br><span class="line">├─bin</span><br><span class="line">│      ...</span><br><span class="line">│      </span><br><span class="line">├─lib</span><br><span class="line">│  	   ...</span><br><span class="line">│                  </span><br><span class="line">├─static</span><br><span class="line">│  ├─css</span><br><span class="line">│  │       ...</span><br><span class="line">│  │      </span><br><span class="line">│  └─img</span><br><span class="line">│          ...</span><br><span class="line">│          </span><br><span class="line">├─templates</span><br><span class="line">│      404.html</span><br><span class="line">│      base.html</span><br><span class="line">│      index.html</span><br><span class="line">│      </span><br><span class="line">└─__pycache__</span><br><span class="line">        ....</span><br></pre></td></tr></table></figure>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Flask部署Ubuntu-虚拟环境目录结构.png" style="zoom:80%;" />
<blockquote>
<p>注意：如果拷贝文件不成功可能是目录权限的问题，需要修改</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo chmod 777 -R /home/flask_demo/ENV_flask/</span><br></pre></td></tr></table></figure>
</blockquote>
</li>
<li>
<p>测试</p>
<p>在该目录下执行命令：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">flask run</span><br></pre></td></tr></table></figure>
<p>在http://127.0.0.1:5000/访问（这里直接展示虚拟机中的浏览器效果）</p>
<p><img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Flask%E9%83%A8%E7%BD%B2Ubuntu-%E9%A1%B9%E7%9B%AE%E6%B5%8B%E8%AF%952.png" alt=""></p>
<p><img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Flask%E9%83%A8%E7%BD%B2Ubuntu-%E9%A1%B9%E7%9B%AE%E6%B5%8B%E8%AF%95.png" alt=""></p>
</li>
</ol>
<h2 id="uwsgi">uwsgi</h2>
<ol>
<li>
<p>在虚拟环境中安装uwsgi</p>
<p>命令如下：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo pip install uwsgi</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>在虚拟环境中编写uwsgi的配置文件<code>flask_uwsgi.ini</code>，文件名可随意</p>
<p>命令如下：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim flask_uwsgi.ini</span><br></pre></td></tr></table></figure>
<p>写入如下内容：</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="section">[uwsgi]</span></span><br><span class="line"><span class="attr">master</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">wsgi-file</span> = app.py</span><br><span class="line"><span class="attr">callable</span> = app</span><br><span class="line"><span class="attr">http</span> = :<span class="number">8001</span></span><br><span class="line"><span class="attr">processes</span> = <span class="number">4</span></span><br><span class="line"><span class="attr">threads</span> = <span class="number">2</span></span><br><span class="line"><span class="attr">buffer-size</span> = <span class="number">32768</span></span><br></pre></td></tr></table></figure>
<p>保存</p>
<blockquote>
<p>简要说明：</p>
<ul>
<li><code>http=:8001</code>：为了该阶段测试使用</li>
<li><code>callable = app</code>：中的<code>app</code>需要与flask的Demo中的<code>application变量名</code>一致</li>
</ul>
</blockquote>
</li>
<li>
<p>测试</p>
<p>在终端键入如下命令启动uwsgi服务：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">uwsgi --ini flask_uwsgi.ini</span><br><span class="line"></span><br><span class="line">nohup uwsgi --ini flask_uwsgi.ini  #利用nohup可以无日志打印启动</span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Flask%E9%83%A8%E7%BD%B2Ubuntu-uwsgi%E5%90%AF%E5%8A%A8%E6%B5%8B%E8%AF%951.png" alt=""></p>
<p>访问8001端口即可看到flask的Demo（这里依然直接用虚拟机的浏览器展示）</p>
<p><img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Flask%E9%83%A8%E7%BD%B2Ubuntu-uwsgi%E5%90%AF%E5%8A%A8%E6%B5%8B%E8%AF%952.png" alt=""></p>
<p>如此，便完成了用uwsgi接管flask的目的</p>
</li>
</ol>
<h2 id="Nginx">Nginx</h2>
<p>现在使用Nginx对Demo进行代理</p>
<ol>
<li>
<p>首先需要修改上一步在虚拟环境中创建的<code>flask_uwsgi.ini</code>配置文件</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim flask_uwsgi.ini</span><br></pre></td></tr></table></figure>
<p>对<code>http = :8001</code>条目进行修改</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="section">[uwsgi]</span></span><br><span class="line"><span class="attr">master</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">wsgi-file</span> = app.py</span><br><span class="line"><span class="attr">callable</span> = app</span><br><span class="line"><span class="attr">socket</span> = <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">8001</span></span><br><span class="line"><span class="attr">processes</span> = <span class="number">4</span></span><br><span class="line"><span class="attr">threads</span> = <span class="number">2</span></span><br><span class="line"><span class="attr">buffer-size</span> = <span class="number">32768</span></span><br></pre></td></tr></table></figure>
<p>如此，运行的uwsgi服务只能通过本地内部的8001端口进行访问，而不能通过浏览器使用http进行访问。所以下面就需要用nginx来做http代理。</p>
</li>
<li>
<p>返回根目录，安装Nginx</p>
<p>命令如下：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd /</span><br><span class="line">sudo apt-get install nginx</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>修改nginx的配置文件<code>/etc/nginx/sites-available/default</code></p>
<p>修改<code>server</code>部分</p>
<p>由于之前部署过<code>Hexo</code>的服务，所以直接另外添加一个<code>server</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">...</span><br><span class="line">server &#123;</span><br><span class="line">        # listen 80 default_server;</span><br><span class="line">        # listen [::]:80 default_server ipv6only&#x3D;on;</span><br><span class="line">        listen 8001;  # 监听端口，http默认80</span><br><span class="line"></span><br><span class="line">        # root &#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html;</span><br><span class="line">        root &#x2F;home&#x2F;flask_demo&#x2F;ENV_flask;      # flask项目根路径</span><br><span class="line">        # index index.html index.htm;</span><br><span class="line"></span><br><span class="line">        # Make site accessible from http:&#x2F;&#x2F;localhost&#x2F;</span><br><span class="line">        # server_name localhost;</span><br><span class="line">        server_name 192.168.75.138;    # 公网ip或已解析ip的域名</span><br><span class="line"></span><br><span class="line">        location &#x2F; &#123;</span><br><span class="line">                # First attempt to serve request as file, then</span><br><span class="line">                # as directory, then fall back to displaying a 404.</span><br><span class="line">                # try_files $uri $uri&#x2F; &#x3D;404;</span><br><span class="line">                # Uncomment to enable naxsi on this location</span><br><span class="line">                # include &#x2F;etc&#x2F;nginx&#x2F;naxsi.rules</span><br><span class="line"></span><br><span class="line">                include uwsgi_params;   # 使用nginx内置的uwsgi配置参数文件</span><br><span class="line">                uwsgi_pass 127.0.0.1:8001;   # 转发请求到该地址端口</span><br><span class="line">                uwsgi_param UWSGI_SCRIPT main:app;   # 调用的脚本名称和application变量名</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>所以完整的<code>default</code>配置文件内容如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">##</span><br><span class="line"># You should look at the following URL&#39;s in order to grasp a solid understanding</span><br><span class="line"># of Nginx configuration files in order to fully unleash the power of Nginx.</span><br><span class="line"># https:&#x2F;&#x2F;www.nginx.com&#x2F;resources&#x2F;wiki&#x2F;start&#x2F;</span><br><span class="line"># https:&#x2F;&#x2F;www.nginx.com&#x2F;resources&#x2F;wiki&#x2F;start&#x2F;topics&#x2F;tutorials&#x2F;config_pitfalls&#x2F;</span><br><span class="line"># https:&#x2F;&#x2F;wiki.debian.org&#x2F;Nginx&#x2F;DirectoryStructure</span><br><span class="line">#</span><br><span class="line"># In most cases, administrators will remove this file from sites-enabled&#x2F; and</span><br><span class="line"># leave it as reference inside of sites-available where it will continue to be</span><br><span class="line"># updated by the nginx packaging team.</span><br><span class="line">#</span><br><span class="line"># This file will automatically load configuration files provided by other</span><br><span class="line"># applications, such as Drupal or Wordpress. These applications will be made</span><br><span class="line"># available underneath a path with that package name, such as &#x2F;drupal8.</span><br><span class="line">#</span><br><span class="line"># Please see &#x2F;usr&#x2F;share&#x2F;doc&#x2F;nginx-doc&#x2F;examples&#x2F; for more detailed examples.</span><br><span class="line">##</span><br><span class="line"></span><br><span class="line"># Default server configuration</span><br><span class="line">#</span><br><span class="line"></span><br><span class="line"># Hexo</span><br><span class="line">server &#123;</span><br><span class="line">	listen 80 default_server;</span><br><span class="line">	listen [::]:80 default_server;</span><br><span class="line"></span><br><span class="line">	# SSL configuration</span><br><span class="line">	#</span><br><span class="line">	# listen 443 ssl default_server;</span><br><span class="line">	# listen [::]:443 ssl default_server;</span><br><span class="line">	#</span><br><span class="line">	# Note: You should disable gzip for SSL traffic.</span><br><span class="line">	# See: https:&#x2F;&#x2F;bugs.debian.org&#x2F;773332</span><br><span class="line">	#</span><br><span class="line">	# Read up on ssl_ciphers to ensure a secure configuration.</span><br><span class="line">	# See: https:&#x2F;&#x2F;bugs.debian.org&#x2F;765782</span><br><span class="line">	#</span><br><span class="line">	# Self signed certs generated by the ssl-cert package</span><br><span class="line">	# Don&#39;t use them in a production server!</span><br><span class="line">	#</span><br><span class="line">	# include snippets&#x2F;snakeoil.conf;</span><br><span class="line"></span><br><span class="line">	root &#x2F;var&#x2F;www&#x2F;hexo;</span><br><span class="line"></span><br><span class="line">	# Add index.php to the list if you are using PHP</span><br><span class="line">	index index.html index.htm index.nginx-debian.html;</span><br><span class="line"></span><br><span class="line">	server_name _;</span><br><span class="line"></span><br><span class="line">	location &#x2F; &#123;</span><br><span class="line">		# First attempt to serve request as file, then</span><br><span class="line">		# as directory, then fall back to displaying a 404.</span><br><span class="line">		try_files $uri $uri&#x2F; &#x3D;404;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	# pass PHP scripts to FastCGI server</span><br><span class="line">	#</span><br><span class="line">	#location ~ \.php$ &#123;</span><br><span class="line">	#	include snippets&#x2F;fastcgi-php.conf;</span><br><span class="line">	#</span><br><span class="line">	#	# With php-fpm (or other unix sockets):</span><br><span class="line">	#	fastcgi_pass unix:&#x2F;var&#x2F;run&#x2F;php&#x2F;php7.4-fpm.sock;</span><br><span class="line">	#	# With php-cgi (or other tcp sockets):</span><br><span class="line">	#	fastcgi_pass 127.0.0.1:9000;</span><br><span class="line">	#&#125;</span><br><span class="line"></span><br><span class="line">	# deny access to .htaccess files, if Apache&#39;s document root</span><br><span class="line">	# concurs with nginx&#39;s one</span><br><span class="line">	#</span><br><span class="line">	#location ~ &#x2F;\.ht &#123;</span><br><span class="line">	#	deny all;</span><br><span class="line">	#&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># Flask应用</span><br><span class="line">server &#123;</span><br><span class="line">        # listen 80 default_server;</span><br><span class="line">        # listen [::]:80 default_server ipv6only&#x3D;on;</span><br><span class="line">        listen 8001;  # 监听端口，http默认80</span><br><span class="line"></span><br><span class="line">        # root &#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html;</span><br><span class="line">        root &#x2F;home&#x2F;flask_demo&#x2F;ENV_flask;      # flask项目根路径</span><br><span class="line">        # index index.html index.htm;</span><br><span class="line"></span><br><span class="line">        # Make site accessible from http:&#x2F;&#x2F;localhost&#x2F;</span><br><span class="line">        # server_name localhost;</span><br><span class="line">        server_name 192.168.75.138;    # 公网ip或已解析ip的域名</span><br><span class="line"></span><br><span class="line">        location &#x2F; &#123;</span><br><span class="line">                # First attempt to serve request as file, then</span><br><span class="line">                # as directory, then fall back to displaying a 404.</span><br><span class="line">                # try_files $uri $uri&#x2F; &#x3D;404;</span><br><span class="line">                # Uncomment to enable naxsi on this location</span><br><span class="line">                # include &#x2F;etc&#x2F;nginx&#x2F;naxsi.rules</span><br><span class="line"></span><br><span class="line">                include uwsgi_params;   # 使用nginx内置的uwsgi配置参数文件</span><br><span class="line">                uwsgi_pass 127.0.0.1:8001;   # 转发请求到该地址端口</span><br><span class="line">                uwsgi_param UWSGI_SCRIPT main:app;   # 调用的脚本名称和application变量名</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># Virtual Host configuration for example.com</span><br><span class="line">#</span><br><span class="line"># You can move that to a different file under sites-available&#x2F; and symlink that</span><br><span class="line"># to sites-enabled&#x2F; to enable it.</span><br><span class="line">#</span><br><span class="line">#server &#123;</span><br><span class="line">#	listen 80;</span><br><span class="line">#	listen [::]:80;</span><br><span class="line">#</span><br><span class="line">#	server_name example.com;</span><br><span class="line">#</span><br><span class="line">#	root &#x2F;var&#x2F;www&#x2F;example.com;</span><br><span class="line">#	index index.html;</span><br><span class="line">#</span><br><span class="line">#	location &#x2F; &#123;</span><br><span class="line">#		try_files $uri $uri&#x2F; &#x3D;404;</span><br><span class="line">#	&#125;</span><br><span class="line">#&#125;</span><br></pre></td></tr></table></figure>
<p>保存退出</p>
</li>
<li>
<p>重新启动Nginx服务</p>
<p>命令如下：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo service nginx restart</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>最后回到虚拟环境（项目根目录）下，启动uwsgi服务</p>
<p>命令如下：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd home/flask_demo/ENV_flask/</span><br><span class="line"></span><br><span class="line">uwsgi --ini flask_uwsgi.ini</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>效果展示</p>
<p>通过宿主机浏览器，访问<code>服务器IP:8001</code>，就可以看到效果啦</p>
<p><img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Flask%E9%83%A8%E7%BD%B2Ubuntu-%E6%9C%80%E7%BB%88%E5%B1%95%E7%A4%BA1.png" alt=""></p>
</li>
</ol>
<h2 id="可能遇到的问题">可能遇到的问题</h2>
<h3 id="启动uwsgi服务时发现端口被占用">启动uwsgi服务时发现端口被占用</h3>
<p><code>probably another instance of uWSGI is running on the same address (:xxxx).</code></p>
<p><img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Flask%E9%83%A8%E7%BD%B2Ubuntu-%E9%97%AE%E9%A2%981.png" alt=""></p>
<p>可以使用如下命令关停该端口：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo fuser -k Port/tcp</span><br></pre></td></tr></table></figure>
<p>例如：关停8001端口：<code>sudo fuser -k 8001/tcp</code></p>
<p>再重新启动uwsgi服务就可以了</p>
<hr>
<h1>后记</h1>
<p>如果想要利用Nginx部署多个服务，直接在<code>default</code>配置文件中添加<code>server</code>项即可。</p>
<blockquote>
<p>参考资料：</p>
<p><a href="https://blog.csdn.net/glin_mk/article/details/86691009">ubuntu+nginx+uwsgi+flask的安装和配置_ReeseIMK的博客-CSDN博客</a></p>
<p><a href="https://blog.csdn.net/yvettre/article/details/81053166">Flask+uwsgi+Nginx的简易搭建(ubuntu)_Yvettre的博客-CSDN博客</a></p>
</blockquote>
]]></content>
      <categories>
        <category>博客</category>
      </categories>
      <tags>
        <tag>Flask</tag>
        <tag>Ubuntu</tag>
      </tags>
  </entry>
  <entry>
    <title>计算机网络学习笔记-链路层</title>
    <url>/2021/07/15/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E9%93%BE%E8%B7%AF%E5%B1%82/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\css\APlayer.min.css"><script src="\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\js\Meting.min.js"></script><h1>前言</h1>
<p><em>正在学习计算机网络这门课程，顺便做个笔记，记录一下知识点。</em></p>
<blockquote>
<p>参考资料：</p>
<p>中科大郑烇老师全套《计算机网络（自顶向下方法 第7版，James F.Kurose，Keith W.Ross）》课程：<a href="https://www.bilibili.com/video/BV1JV411t7ow?p=1">https://www.bilibili.com/video/BV1JV411t7ow?p=1</a></p>
<p>《计算机网络（自顶向下方法 第7版，James F.Kurose，Keith W.Ross）》</p>
</blockquote>
<hr>
<h1>第六章：链路层</h1>
<p>网络层解决了分组如何从一个网络到达另一个网络的路由问题（以子网为单位），但是分组如何在子网内部的相邻节点之间传输，链路层解决了这个问题。</p>
<p>网络节点的连接方式：</p>
<ul>
<li>
<p>点到点连接</p>
<blockquote>
<p>一般用于广域网（距离远）。举例：海底电缆将中国与其他国家的路由节点连接在一起。</p>
<p>点到点链路的链路层服务实现非常简单，封装和解封装</p>
</blockquote>
</li>
<li>
<p>多点连接</p>
<blockquote>
<p>一般用于局域网（距离近）。举例：在局域网中通过交换机将不同的多个节点连接起来。</p>
<p>那么这就会产生一个问题，如果多方同时发送分组，就会产生碰撞（存在多点接入的问题）。后续我们会详细讨论。</p>
</blockquote>
</li>
</ul>
<h2 id="导论">导论</h2>
<p>在开始前先规范一些术语：</p>
<table>
<thead>
<tr>
<th>术语</th>
<th>解释</th>
</tr>
</thead>
<tbody>
<tr>
<td>nodes（节点）</td>
<td>主机、路由器、网桥和交换机都是节点</td>
</tr>
<tr>
<td>links（链路）</td>
<td>沿着通信路径,连接相邻节点通信信道的是链路（包括：有线链路、无线链路、局域网（共享性链路））</td>
</tr>
<tr>
<td>frame（帧）</td>
<td>链路层的数据单元（PDU）</td>
</tr>
</tbody>
</table>
<blockquote>
<p>链路层负责从一个节点通过链路将（帧中的）数据报发送到相邻的物理节点。</p>
</blockquote>
<blockquote>
<p>下面我们举一个比较贴切的例子来分析分组在链路层的传输过程：</p>
<p>假设博主要从<strong>普林斯顿</strong>到<strong>洛桑</strong>，其中具体的路程规划如下：</p>
<ol>
<li>先坐轿车到肯尼迪国际机场</li>
<li>再乘坐飞机飞往日内瓦</li>
<li>最后乘火车到洛桑</li>
</ol>
<p>其中：</p>
<ul>
<li>博主本人 = 数据报/分组</li>
<li>交通段 = 通信链路（communication link）</li>
<li>交通模式 = 链路层协议（protocol）</li>
<li>票务代理 = 路由算法（routing algorithm）</li>
</ul>
<blockquote>
<ul>
<li>数据报/分组在不同的链路上以不同的链路协议传送</li>
<li>不同的链路协议提供不同的服务</li>
</ul>
</blockquote>
</blockquote>
<h3 id="链路层提供的服务">链路层提供的服务</h3>
<ul>
<li>
<p>成帧，链路接入：</p>
<ul>
<li>将数据报封装在帧中，加上帧头、帧尾部</li>
<li>如果采用的是共享性介质，信道接入获得信道访问权</li>
<li>在帧头部使用“MAC”（物理）地址来标示源和目的（注意：不同于IP地址）</li>
</ul>
</li>
<li>
<p>在相邻两个节点（一个网络内）完成可靠数据传递</p>
<ul>
<li>
<p>在低出错率的链路上（光纤和双绞线电缆）很少使用</p>
</li>
<li>
<p>在无线链路经常使用：出错率高</p>
<blockquote>
<p>注意：链路层也可以实现一定的可靠性</p>
<p>在无线链路的网络上，出错率高，如果在链路层不做差错控制工作，漏出去的错误比较高；到了上层如果需要可靠控制的数据传输代价会很大</p>
<ul>
<li>一般化的链路层服务，不是所有的链路层都提供这些服务</li>
<li>一个特定的链路层只是提供其中一部分的服务</li>
</ul>
</blockquote>
</li>
</ul>
</li>
<li>
<p>流量控制</p>
<p>使得相邻的发送和接收方节点的速度匹配</p>
</li>
<li>
<p>错误检测</p>
<ul>
<li>差错由信号衰减和噪声引起</li>
<li>当接收方检测出错误时，通知发送端进行重传或丢弃帧</li>
</ul>
</li>
<li>
<p>差错纠正</p>
<p>接收端检查和纠正bit错误，不通过重传来纠正错误</p>
</li>
<li>
<p>半双工和全双工</p>
<ul>
<li>半双工：链路可以双向传输，但一次只有一个方向</li>
<li>全双工：两个方向可以同时收发</li>
</ul>
</li>
</ul>
<h3 id="链路层的实现位置">链路层的实现位置</h3>
<ul>
<li>
<p>在每一个主机上</p>
<ul>
<li>包括路由器</li>
<li>交换机的每个端口</li>
</ul>
</li>
<li>
<p>链路层功能在“适配器”上实现（aka network interface card NIC)）或者在一个芯片组上</p>
<ul>
<li>
<p>以太网卡，802.11 网卡; 以太网芯片组</p>
</li>
<li>
<p>实现链路层和相应的物理层功能</p>
<blockquote>
<p>适配器通信</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CN%E9%80%82%E9%85%8D%E5%99%A8%E9%80%9A%E4%BF%A1.png" alt=""></p>
<ul>
<li>发送方
<ul>
<li>在帧中封装数据报</li>
<li>借助于物理层，把每个bit发送出去</li>
<li>加上差错控制编码，实现rdt（也可能不实现）和流量控制功能等</li>
</ul>
</li>
<li>接收方
<ul>
<li>把物理信号还原为数字信号，还原帧头、帧尾</li>
<li>检查有无出错，执行rdt和流量控制功能等</li>
<li>解封装数据报，将至交给上层</li>
</ul>
</li>
</ul>
</blockquote>
</li>
</ul>
</li>
<li>
<p>接到主机的系统总线上</p>
</li>
<li>
<p>硬件、软件和固件的综合体</p>
</li>
</ul>
<h2 id="差错检测和纠正">差错检测和纠正</h2>
<h3 id="错误检测">错误检测</h3>
<img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CN错误检测.png" style="zoom:80%;" />
<blockquote>
<p>说明：</p>
<ul>
<li>EDC：差错检测和纠正位（冗余位）</li>
<li>D：数据由差错检测保护，可以包含头部字段</li>
</ul>
<p>在数据传输的过程中数据有可能发生错误，这时接收方会检查EDC’以及D’是否符合约定的差错控制编码关系，如果不符合关系，那么数据一定出错。</p>
<p>此外，还存在一种情况，即EDC’以及D’都出错，且恰好又通过校验，这种情况被称为<code>残存错误</code>。</p>
<ul>
<li>错误检测不是100%可靠的</li>
<li>编码越长，残存错误越低。（更长的EDC字段可以得到更好的检测和纠正效果）</li>
</ul>
</blockquote>
<h3 id="奇偶校验">奇偶校验</h3>
<ul>
<li>
<p>单bit奇偶校验</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/%E5%8D%95bit%E5%A5%87%E5%81%B6%E6%A0%A1%E9%AA%8C.png" alt=""></p>
<ul>
<li>检测单个bit级错误（容易理解）</li>
</ul>
</li>
<li>
<p>二维奇偶校验</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CN%E4%BA%8C%E7%BB%B4%E5%A5%87%E5%81%B6%E6%A0%A1%E9%AA%8C.png" alt=""></p>
<ul>
<li>检测和纠正单个bit错误</li>
<li>不仅可以检测出错误，还可以检测出错误的位置</li>
<li>无法检测出对偶错误</li>
</ul>
</li>
</ul>
<h3 id="Checksum（校验和）">Checksum（校验和）</h3>
<p>目标: 检测在传输报文段时的错误（如位翻转），（仅仅用在传输层）</p>
<blockquote>
<p>具体可以看传输层章节，这里不再赘述</p>
</blockquote>
<h3 id="CRC（循环冗余校验）">CRC（循环冗余校验）</h3>
<ul>
<li>
<p>强大的差错检测码</p>
</li>
<li>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CNCRC%E5%BE%AA%E7%8E%AF%E5%86%97%E4%BD%99%E6%A0%A1%E9%AA%8C.png" alt=""></p>
<blockquote>
<p>（直接放一个过程，具体怎么操作自行搜索）</p>
<p>D：数据bit</p>
<p>G：生成多项式：双方协商r+1位模式（r次方）</p>
<p>目标：求R</p>
</blockquote>
</li>
<li>
<p>CRC性能分析</p>
<ul>
<li>能够检查出所有的1bit错误</li>
<li>能够检查出所有的双bit错误</li>
<li>能够检查出所有长度小于等于r位的错误</li>
<li>出现长度为 r+1的突发错误，检查不出的概率是1/2<sup>r-1</sup></li>
<li>出现长度大于r+1的突发错误，检查不出的概率是1/2<sup>r</sup></li>
</ul>
</li>
</ul>
<h2 id="多点访问协议">多点访问协议</h2>
]]></content>
      <categories>
        <category>学习笔记</category>
      </categories>
      <tags>
        <tag>计算机网络</tag>
      </tags>
  </entry>
  <entry>
    <title>计算机网络学习笔记</title>
    <url>/2021/03/28/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\css\APlayer.min.css"><script src="\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\js\Meting.min.js"></script><p><em><strong>计算机网络学习历程</strong></em></p>
<blockquote>
<p>参考资料：</p>
<p>中科大郑烇老师全套《计算机网络（自顶向下方法 第7版，James F.Kurose，Keith W.Ross）》课程：<a href="https://www.bilibili.com/video/BV1JV411t7ow?p=1">https://www.bilibili.com/video/BV1JV411t7ow?p=1</a></p>
<p>《计算机网络（自顶向下方法 第7版，James F.Kurose，Keith W.Ross）》</p>
</blockquote>
<hr>
<h1>第一章：计算机网络概述</h1>
<div class="btn-center">
<a class="btn-beautify button--animated block outline larger" href="/2021/03/09/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%A6%82%E8%BF%B0/" 
  title="点击跳转 至 《计算机网络概述》"><i class="far fa-hand-point-right"></i><span>点击跳转 至 《计算机网络概述》</span></a>
</div>
<h1>第二章：应用层</h1>
<div class="btn-center">
<a class="btn-beautify button--animated block outline blue larger" href="/2021/04/05/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E5%BA%94%E7%94%A8%E5%B1%82/" 
  title="点击跳转 至 《应用层》"><i class="far fa-hand-point-right"></i><span>点击跳转 至 《应用层》</span></a>
</div>
<h1>第三章：传输层</h1>
<div class="btn-center">
<a class="btn-beautify button--animated block outline pink larger" href="/2021/05/10/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E4%BC%A0%E8%BE%93%E5%B1%82/" 
  title="点击跳转 至 《传输层》"><i class="far fa-hand-point-right"></i><span>点击跳转 至 《传输层》</span></a>
</div>
<h1>第四章：网络层</h1>
<div class="btn-center">
<a class="btn-beautify button--animated block outline red larger" href="/2021/06/08/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E7%BD%91%E7%BB%9C%E5%B1%82/" 
  title="点击跳转 至 《网络层》"><i class="far fa-hand-point-right"></i><span>点击跳转 至 《网络层》</span></a>
</div>
<h1>第六章：链路层</h1>
<div class="btn-center">
<a class="btn-beautify button--animated block outline purple larger" href="/2021/07/15/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E9%93%BE%E8%B7%AF%E5%B1%82/" 
  title="点击跳转 至 《链路层》"><i class="far fa-hand-point-right"></i><span>点击跳转 至 《链路层》</span></a>
</div>
]]></content>
      <categories>
        <category>学习笔记</category>
      </categories>
      <tags>
        <tag>计算机网络</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue解决if-else切换显示标签而value值不变的问题</title>
    <url>/2021/08/03/Vue/%E9%97%AE%E9%A2%98/Vue%E8%A7%A3%E5%86%B3if-else%E5%88%87%E6%8D%A2%E6%98%BE%E7%A4%BA%E6%A0%87%E7%AD%BE%E8%80%8Cvalue%E5%80%BC%E4%B8%8D%E5%8F%98%E7%9A%84%E9%97%AE%E9%A2%98/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\css\APlayer.min.css"><script src="\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\js\Meting.min.js"></script><h1>问题描述</h1>
<p>如题，利用Vue中if-else切换显示标签而其中输入框的value值不改变：</p>
<p>代码如下：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">span</span> <span class="attr">v-if</span>=<span class="string">&quot;change&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;username&quot;</span>&gt;</span>用户账号<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;username&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;用户账号&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">span</span> <span class="attr">v-else</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;email&quot;</span>&gt;</span>用户邮箱<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;email&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;用户邮箱&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;change = !change&quot;</span>&gt;</span>切换类型<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    el: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">    data: &#123;</span><br><span class="line">      change: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>问题如下：</p>
<p><img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Vue-if-else%E5%88%87%E6%8D%A2%E6%A0%87%E7%AD%BEvalue%E5%80%BC%E4%B8%8D%E5%8F%98.gif" alt=""></p>
<p>可以看到在点击“切换类型”时候，输入框中的value值并不改变。</p>
<p>这关乎Vue底层的实现方式，出于性能考虑，会尽可能的复用已经存在的元素，而非重新创建新的元素，但是在某些场景中并不希望如此。</p>
<hr>
<h1>解决方案</h1>
<p>在不同的标签中赋予不同的<code>key</code>值，这样Vue在渲染的过程中就会判定为不同的内容，从而重新加载新的输入框。</p>
<h2 id="code￼2"><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">span</span> <span class="attr">v-if</span>=<span class="string">&quot;change&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;username&quot;</span>&gt;</span>用户账号<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;username&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;用户账号&quot;</span> <span class="attr">key</span>=<span class="string">&quot;username&quot;</span>&gt;</span> <span class="comment">&lt;!--在这里--&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">span</span> <span class="attr">v-else</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;email&quot;</span>&gt;</span>用户邮箱<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;email&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;用户邮箱&quot;</span> <span class="attr">key</span>=<span class="string">&quot;email&quot;</span>&gt;</span>  <span class="comment">&lt;!--在这里--&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;change = !change&quot;</span>&gt;</span>切换类型<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></h2>
<h1>后记</h1>
<p>快乐学前端</p>
]]></content>
      <categories>
        <category>Vue</category>
        <category>错误</category>
      </categories>
      <tags>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>Hexo tag 外挂标签</title>
    <url>/2021/05/28/Hexo%E9%AD%94%E6%94%B9/Hexotag-%E5%A4%96%E6%8C%82%E6%A0%87%E7%AD%BE/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\css\APlayer.min.css"><script src="\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\js\Meting.min.js"></script><h1>前言</h1>
<p>本文将介绍如何添加tag外挂标签样式</p>
<blockquote>
<p>教程链接：<a href="https://zykj.js.org/posts/e55bad60/">Hexo博客搭建 与 美化教程 | 卓越科技的Blog (zykj.js.org)</a></p>
</blockquote>
<div class="note info flat"><p>样式展示链接 <a href="https://zykj.js.org/posts/e297feab/">基于 Butterfly 主题魔改的样式查阅</a> 这里仅包括： 自定义标签、 文本段落、 复选框、 富文本按钮、 Folding、 密码样式的文本、 时间线 、 Link。</p>
</div>
<hr>
<h1>操作</h1>
<ol>
<li>
<p>在<code>themes\Butterfly\source\css</code>路径下创建<code>tag.css</code>文件，并写入以下内容：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">span</span><span class="selector-class">.btn</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: inline;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">span</span><span class="selector-class">.btn</span> &gt; <span class="selector-tag">a</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: inline-block;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#2196f3</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#fff</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">4px</span> <span class="number">4px</span> <span class="number">2px</span> <span class="number">4px</span>;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">2px</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">1.1</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">2px</span>;</span><br><span class="line">  <span class="attribute">transition</span>: all <span class="number">0.28s</span> ease;</span><br><span class="line">  -moz-<span class="attribute">transition</span>: all <span class="number">0.28s</span> ease;</span><br><span class="line">  -webkit-<span class="attribute">transition</span>: all <span class="number">0.28s</span> ease;</span><br><span class="line">  -o-<span class="attribute">transition</span>: all <span class="number">0.28s</span> ease;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">span</span><span class="selector-class">.btn</span> &gt; <span class="selector-tag">a</span> <span class="selector-tag">i</span> &#123;</span><br><span class="line">  <span class="attribute">margin-right</span>: <span class="number">2px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">span</span><span class="selector-class">.btn</span> &gt; <span class="selector-tag">a</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#fff</span>;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#ff5722</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">span</span><span class="selector-class">.btn</span> &gt; <span class="selector-tag">a</span><span class="selector-pseudo">:not</span>(<span class="selector-attr">[href]</span>) &#123;</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">0.5</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">span</span><span class="selector-class">.btn</span> &gt; <span class="selector-tag">a</span><span class="selector-pseudo">:not</span>(<span class="selector-attr">[href]</span>)<span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">  <span class="attribute">cursor</span>: not-allowed;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">span</span><span class="selector-class">.btn</span><span class="selector-class">.regular</span> &gt; <span class="selector-tag">a</span> &#123;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">8px</span> <span class="number">12px</span> <span class="number">6px</span> <span class="number">12px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">span</span><span class="selector-class">.btn</span><span class="selector-class">.regular</span> &gt; <span class="selector-tag">a</span> <span class="selector-tag">i</span> &#123;</span><br><span class="line">  <span class="attribute">margin-right</span>: <span class="number">4px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">span</span><span class="selector-class">.btn</span><span class="selector-class">.large</span> &gt; <span class="selector-tag">a</span> &#123;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">12px</span> <span class="number">36px</span> <span class="number">10px</span> <span class="number">36px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">span</span><span class="selector-class">.btn</span><span class="selector-class">.large</span> &gt; <span class="selector-tag">a</span> <span class="selector-tag">i</span> &#123;</span><br><span class="line">  <span class="attribute">margin-right</span>: <span class="number">8px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">span</span><span class="selector-class">.btn</span><span class="selector-class">.center</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: block;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-attr">[data-theme=<span class="string">&quot;dark&quot;</span>]</span> <span class="selector-tag">div</span><span class="selector-class">.btns</span> &#123;</span><br><span class="line">  <span class="attribute">filter</span>: <span class="built_in">brightness</span>(<span class="number">0.7</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-attr">[data-theme=<span class="string">&quot;dark&quot;</span>]</span> <span class="selector-tag">div</span><span class="selector-class">.btns</span> <span class="selector-tag">a</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">0</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.btns</span> &#123;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span> -<span class="number">8px</span>;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">flex-wrap</span>: wrap;</span><br><span class="line">  <span class="attribute">align-items</span>: flex-start;</span><br><span class="line">  <span class="attribute">overflow</span>: visible;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">1.8</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.btns</span>,</span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.btns</span> <span class="selector-tag">p</span>,</span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.btns</span> <span class="selector-tag">a</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">0.8125rem</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#555</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.btns</span> <span class="selector-tag">b</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">0.875rem</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.btns</span><span class="selector-class">.wide</span> &gt; <span class="selector-tag">a</span> &#123;</span><br><span class="line">  <span class="attribute">padding-left</span>: <span class="number">32px</span>;</span><br><span class="line">  <span class="attribute">padding-right</span>: <span class="number">32px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.btns</span><span class="selector-class">.fill</span> &gt; <span class="selector-tag">a</span> &#123;</span><br><span class="line">  <span class="attribute">flex-grow</span>: <span class="number">1</span>;</span><br><span class="line">  <span class="attribute">width</span>: auto;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.btns</span><span class="selector-class">.around</span> &#123;</span><br><span class="line">  <span class="attribute">justify-content</span>: space-around;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.btns</span><span class="selector-class">.center</span> &#123;</span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.btns</span><span class="selector-class">.grid2</span> &gt; <span class="selector-tag">a</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="built_in">calc</span>(<span class="number">100%</span> / <span class="number">2</span> - <span class="number">16px</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@media</span> screen <span class="keyword">and</span> (<span class="attribute">max-width</span>: <span class="number">1024px</span>) &#123;</span><br><span class="line">  <span class="selector-tag">div</span><span class="selector-class">.btns</span><span class="selector-class">.grid2</span> &gt; <span class="selector-tag">a</span> &#123;</span><br><span class="line">	<span class="attribute">width</span>: <span class="built_in">calc</span>(<span class="number">100%</span> / <span class="number">2</span> - <span class="number">16px</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@media</span> screen <span class="keyword">and</span> (<span class="attribute">max-width</span>: <span class="number">768px</span>) &#123;</span><br><span class="line">  <span class="selector-tag">div</span><span class="selector-class">.btns</span><span class="selector-class">.grid2</span> &gt; <span class="selector-tag">a</span> &#123;</span><br><span class="line">	<span class="attribute">width</span>: <span class="built_in">calc</span>(<span class="number">100%</span> / <span class="number">2</span> - <span class="number">16px</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@media</span> screen <span class="keyword">and</span> (<span class="attribute">max-width</span>: <span class="number">500px</span>) &#123;</span><br><span class="line">  <span class="selector-tag">div</span><span class="selector-class">.btns</span><span class="selector-class">.grid2</span> &gt; <span class="selector-tag">a</span> &#123;</span><br><span class="line">	<span class="attribute">width</span>: <span class="built_in">calc</span>(<span class="number">100%</span> / <span class="number">1</span> - <span class="number">16px</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.btns</span><span class="selector-class">.grid3</span> &gt; <span class="selector-tag">a</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="built_in">calc</span>(<span class="number">100%</span> / <span class="number">3</span> - <span class="number">16px</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@media</span> screen <span class="keyword">and</span> (<span class="attribute">max-width</span>: <span class="number">1024px</span>) &#123;</span><br><span class="line">  <span class="selector-tag">div</span><span class="selector-class">.btns</span><span class="selector-class">.grid3</span> &gt; <span class="selector-tag">a</span> &#123;</span><br><span class="line">	<span class="attribute">width</span>: <span class="built_in">calc</span>(<span class="number">100%</span> / <span class="number">3</span> - <span class="number">16px</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@media</span> screen <span class="keyword">and</span> (<span class="attribute">max-width</span>: <span class="number">768px</span>) &#123;</span><br><span class="line">  <span class="selector-tag">div</span><span class="selector-class">.btns</span><span class="selector-class">.grid3</span> &gt; <span class="selector-tag">a</span> &#123;</span><br><span class="line">	<span class="attribute">width</span>: <span class="built_in">calc</span>(<span class="number">100%</span> / <span class="number">3</span> - <span class="number">16px</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@media</span> screen <span class="keyword">and</span> (<span class="attribute">max-width</span>: <span class="number">500px</span>) &#123;</span><br><span class="line">  <span class="selector-tag">div</span><span class="selector-class">.btns</span><span class="selector-class">.grid3</span> &gt; <span class="selector-tag">a</span> &#123;</span><br><span class="line">	<span class="attribute">width</span>: <span class="built_in">calc</span>(<span class="number">100%</span> / <span class="number">1</span> - <span class="number">16px</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.btns</span><span class="selector-class">.grid4</span> &gt; <span class="selector-tag">a</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="built_in">calc</span>(<span class="number">100%</span> / <span class="number">4</span> - <span class="number">16px</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@media</span> screen <span class="keyword">and</span> (<span class="attribute">max-width</span>: <span class="number">1024px</span>) &#123;</span><br><span class="line">  <span class="selector-tag">div</span><span class="selector-class">.btns</span><span class="selector-class">.grid4</span> &gt; <span class="selector-tag">a</span> &#123;</span><br><span class="line">	<span class="attribute">width</span>: <span class="built_in">calc</span>(<span class="number">100%</span> / <span class="number">3</span> - <span class="number">16px</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@media</span> screen <span class="keyword">and</span> (<span class="attribute">max-width</span>: <span class="number">768px</span>) &#123;</span><br><span class="line">  <span class="selector-tag">div</span><span class="selector-class">.btns</span><span class="selector-class">.grid4</span> &gt; <span class="selector-tag">a</span> &#123;</span><br><span class="line">	<span class="attribute">width</span>: <span class="built_in">calc</span>(<span class="number">100%</span> / <span class="number">3</span> - <span class="number">16px</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@media</span> screen <span class="keyword">and</span> (<span class="attribute">max-width</span>: <span class="number">500px</span>) &#123;</span><br><span class="line">  <span class="selector-tag">div</span><span class="selector-class">.btns</span><span class="selector-class">.grid4</span> &gt; <span class="selector-tag">a</span> &#123;</span><br><span class="line">	<span class="attribute">width</span>: <span class="built_in">calc</span>(<span class="number">100%</span> / <span class="number">2</span> - <span class="number">16px</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.btns</span><span class="selector-class">.grid5</span> &gt; <span class="selector-tag">a</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="built_in">calc</span>(<span class="number">100%</span> / <span class="number">5</span> - <span class="number">16px</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@media</span> screen <span class="keyword">and</span> (<span class="attribute">max-width</span>: <span class="number">1024px</span>) &#123;</span><br><span class="line">  <span class="selector-tag">div</span><span class="selector-class">.btns</span><span class="selector-class">.grid5</span> &gt; <span class="selector-tag">a</span> &#123;</span><br><span class="line">	<span class="attribute">width</span>: <span class="built_in">calc</span>(<span class="number">100%</span> / <span class="number">4</span> - <span class="number">16px</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@media</span> screen <span class="keyword">and</span> (<span class="attribute">max-width</span>: <span class="number">768px</span>) &#123;</span><br><span class="line">  <span class="selector-tag">div</span><span class="selector-class">.btns</span><span class="selector-class">.grid5</span> &gt; <span class="selector-tag">a</span> &#123;</span><br><span class="line">	<span class="attribute">width</span>: <span class="built_in">calc</span>(<span class="number">100%</span> / <span class="number">3</span> - <span class="number">16px</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@media</span> screen <span class="keyword">and</span> (<span class="attribute">max-width</span>: <span class="number">500px</span>) &#123;</span><br><span class="line">  <span class="selector-tag">div</span><span class="selector-class">.btns</span><span class="selector-class">.grid5</span> &gt; <span class="selector-tag">a</span> &#123;</span><br><span class="line">	<span class="attribute">width</span>: <span class="built_in">calc</span>(<span class="number">100%</span> / <span class="number">2</span> - <span class="number">16px</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.btns</span> <span class="selector-tag">a</span> &#123;</span><br><span class="line">  <span class="attribute">transition</span>: all <span class="number">0.28s</span> ease;</span><br><span class="line">  -moz-<span class="attribute">transition</span>: all <span class="number">0.28s</span> ease;</span><br><span class="line">  -webkit-<span class="attribute">transition</span>: all <span class="number">0.28s</span> ease;</span><br><span class="line">  -o-<span class="attribute">transition</span>: all <span class="number">0.28s</span> ease;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">8px</span>;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="built_in">calc</span>(<span class="number">1.25</span> * <span class="number">16px</span> + <span class="number">32px</span>);</span><br><span class="line">  <span class="attribute">min-width</span>: <span class="number">120px</span>;</span><br><span class="line">  <span class="attribute">font-weight</span>: bold;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">justify-content</span>: flex-start;</span><br><span class="line">  <span class="attribute">align-content</span>: center;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">  <span class="attribute">flex-direction</span>: column;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">8px</span>;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#f6f6f6</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">4px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.btns</span> <span class="selector-tag">a</span> &gt; <span class="selector-tag">img</span><span class="selector-pseudo">:first</span>-child,</span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.btns</span> <span class="selector-tag">a</span> &gt; <span class="selector-tag">i</span><span class="selector-pseudo">:first</span>-child &#123;</span><br><span class="line">  <span class="attribute">transition</span>: all <span class="number">0.28s</span> ease;</span><br><span class="line">  -moz-<span class="attribute">transition</span>: all <span class="number">0.28s</span> ease;</span><br><span class="line">  -webkit-<span class="attribute">transition</span>: all <span class="number">0.28s</span> ease;</span><br><span class="line">  -o-<span class="attribute">transition</span>: all <span class="number">0.28s</span> ease;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">64px</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">64px</span>;</span><br><span class="line">  <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">1px</span> <span class="number">2px</span> <span class="number">0</span> <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.1</span>);</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">16px</span> <span class="number">8px</span> <span class="number">4px</span> <span class="number">8px</span>;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="built_in">calc</span>(-<span class="number">1.25</span> * <span class="number">16px</span> - <span class="number">32px</span>);</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">2px</span> solid <span class="number">#fff</span>;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#fff</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">60px</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">28px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.btns</span> <span class="selector-tag">a</span> &gt; <span class="selector-tag">img</span><span class="selector-pseudo">:first</span>-child<span class="selector-class">.auto</span>,</span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.btns</span> <span class="selector-tag">a</span> &gt; <span class="selector-tag">i</span><span class="selector-pseudo">:first</span>-child<span class="selector-class">.auto</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: auto;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.btns</span> <span class="selector-tag">a</span> &gt; <span class="selector-tag">i</span><span class="selector-pseudo">:first</span>-child &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#fff</span>;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#2196f3</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.btns</span> <span class="selector-tag">a</span> <span class="selector-tag">p</span>,</span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.btns</span> <span class="selector-tag">a</span> <span class="selector-tag">b</span> &#123;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0.25em</span>;</span><br><span class="line">  <span class="attribute">font-weight</span>: normal;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">1.25</span>;</span><br><span class="line">  <span class="attribute">word-wrap</span>: break-word;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.btns</span> <span class="selector-tag">a</span> <span class="selector-tag">b</span> &#123;</span><br><span class="line">  <span class="attribute">font-weight</span>: bold;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">1.3</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.btns</span> <span class="selector-tag">a</span> <span class="selector-tag">img</span> &#123;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0.4em</span> auto;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.btns</span> <span class="selector-tag">a</span><span class="selector-pseudo">:not</span>(<span class="selector-attr">[href]</span>) &#123;</span><br><span class="line">  <span class="attribute">cursor</span>: default;</span><br><span class="line">  <span class="attribute">color</span>: inherit;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.btns</span> <span class="selector-tag">a</span><span class="selector-attr">[href]</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">87</span>, <span class="number">34</span>, <span class="number">0.15</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.btns</span> <span class="selector-tag">a</span><span class="selector-attr">[href]</span><span class="selector-pseudo">:hover</span>,</span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.btns</span> <span class="selector-tag">a</span><span class="selector-attr">[href]</span><span class="selector-pseudo">:hover</span> <span class="selector-tag">b</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#ff5722</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.btns</span> <span class="selector-tag">a</span><span class="selector-attr">[href]</span><span class="selector-pseudo">:hover</span> &gt; <span class="selector-tag">img</span><span class="selector-pseudo">:first</span>-child,</span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.btns</span> <span class="selector-tag">a</span><span class="selector-attr">[href]</span><span class="selector-pseudo">:hover</span> &gt; <span class="selector-tag">i</span><span class="selector-pseudo">:first</span>-child &#123;</span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">scale</span>(<span class="number">1.1</span>) <span class="built_in">translateY</span>(-<span class="number">8px</span>);</span><br><span class="line">  <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">4px</span> <span class="number">8px</span> <span class="number">0</span> <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.btns</span> <span class="selector-tag">a</span><span class="selector-attr">[href]</span><span class="selector-pseudo">:hover</span> &gt; <span class="selector-tag">i</span><span class="selector-pseudo">:first</span>-child &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#ff5722</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.btns</span><span class="selector-class">.circle</span> <span class="selector-tag">a</span> &gt; <span class="selector-tag">img</span><span class="selector-pseudo">:first</span>-child,</span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.btns</span><span class="selector-class">.circle</span> <span class="selector-tag">a</span> &gt; <span class="selector-tag">i</span><span class="selector-pseudo">:first</span>-child &#123;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">32px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.btns</span><span class="selector-class">.rounded</span> <span class="selector-tag">a</span> &gt; <span class="selector-tag">img</span><span class="selector-pseudo">:first</span>-child,</span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.btns</span><span class="selector-class">.rounded</span> <span class="selector-tag">a</span> &gt; <span class="selector-tag">i</span><span class="selector-pseudo">:first</span>-child &#123;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">16px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-attr">[data-theme=<span class="string">&quot;dark&quot;</span>]</span> <span class="selector-class">.checkbox</span> &#123;</span><br><span class="line">  <span class="attribute">filter</span>: <span class="built_in">brightness</span>(<span class="number">0.7</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.checkbox</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.checkbox</span> <span class="selector-tag">input</span> &#123;</span><br><span class="line">  -webkit-appearance: none;</span><br><span class="line">  -moz-appearance: none;</span><br><span class="line">  -ms-appearance: none;</span><br><span class="line">  -o-appearance: none;</span><br><span class="line">  appearance: none;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">16px</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">16px</span>;</span><br><span class="line">  <span class="attribute">transition</span>: all <span class="number">0.15s</span> ease-out <span class="number">0s</span>;</span><br><span class="line">  <span class="attribute">cursor</span>: pointer;</span><br><span class="line">  <span class="attribute">display</span>: inline-block;</span><br><span class="line">  <span class="attribute">outline</span>: none;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">2px</span>;</span><br><span class="line">  <span class="attribute">flex-shrink</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">margin-right</span>: <span class="number">8px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.checkbox</span> <span class="selector-tag">input</span><span class="selector-attr">[type=<span class="string">&quot;checkbox&quot;</span>]</span>:before,</span><br><span class="line">.checkbox input[type=<span class="string">&quot;checkbox&quot;</span>]:after &#123;</span><br><span class="line">  position: absolute;</span><br><span class="line">  <span class="attribute">content</span>: <span class="string">&quot;&quot;</span>;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#fff</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.checkbox</span> <span class="selector-tag">input</span><span class="selector-attr">[type=<span class="string">&quot;checkbox&quot;</span>]</span>:before &#123;</span><br><span class="line">  left: <span class="number">1px</span>;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">5px</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">2px</span>;</span><br><span class="line">  <span class="attribute">transition</span>: all <span class="number">0.2s</span> ease-in;</span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">rotate</span>(<span class="number">45deg</span>);</span><br><span class="line">  -webkit-<span class="attribute">transform</span>: <span class="built_in">rotate</span>(<span class="number">45deg</span>);</span><br><span class="line">  -moz-<span class="attribute">transform</span>: <span class="built_in">rotate</span>(<span class="number">45deg</span>);</span><br><span class="line">  -ms-<span class="attribute">transform</span>: <span class="built_in">rotate</span>(<span class="number">45deg</span>);</span><br><span class="line">  -o-<span class="attribute">transform</span>: <span class="built_in">rotate</span>(<span class="number">45deg</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.checkbox</span> <span class="selector-tag">input</span><span class="selector-attr">[type=<span class="string">&quot;checkbox&quot;</span>]</span>:after &#123;</span><br><span class="line">  right: <span class="number">7px</span>;</span><br><span class="line">  <span class="attribute">bottom</span>: <span class="number">3px</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">2px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">transition</span>: all <span class="number">0.2s</span> ease-out;</span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">rotate</span>(<span class="number">40deg</span>);</span><br><span class="line">  -webkit-<span class="attribute">transform</span>: <span class="built_in">rotate</span>(<span class="number">40deg</span>);</span><br><span class="line">  -moz-<span class="attribute">transform</span>: <span class="built_in">rotate</span>(<span class="number">40deg</span>);</span><br><span class="line">  -ms-<span class="attribute">transform</span>: <span class="built_in">rotate</span>(<span class="number">40deg</span>);</span><br><span class="line">  -o-<span class="attribute">transform</span>: <span class="built_in">rotate</span>(<span class="number">40deg</span>);</span><br><span class="line">  <span class="attribute">transition-delay</span>: <span class="number">0.25s</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.checkbox</span> <span class="selector-tag">input</span><span class="selector-attr">[type=<span class="string">&quot;checkbox&quot;</span>]</span><span class="selector-pseudo">:checked</span>:before &#123;</span><br><span class="line">  left: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">7px</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">6px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">2px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.checkbox</span> <span class="selector-tag">input</span><span class="selector-attr">[type=<span class="string">&quot;checkbox&quot;</span>]</span><span class="selector-pseudo">:checked</span>:after &#123;</span><br><span class="line">  right: <span class="number">3px</span>;</span><br><span class="line">  <span class="attribute">bottom</span>: <span class="number">1px</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">2px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">10px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.checkbox</span><span class="selector-class">.minus</span> <span class="selector-tag">input</span><span class="selector-attr">[type=<span class="string">&quot;checkbox&quot;</span>]</span>:before &#123;</span><br><span class="line">  transform: <span class="built_in">rotate</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">1px</span>;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">5px</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">2px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.checkbox</span><span class="selector-class">.minus</span> <span class="selector-tag">input</span><span class="selector-attr">[type=<span class="string">&quot;checkbox&quot;</span>]</span>:after &#123;</span><br><span class="line">  transform: <span class="built_in">rotate</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">1px</span>;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">5px</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">2px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.checkbox</span><span class="selector-class">.minus</span> <span class="selector-tag">input</span><span class="selector-attr">[type=<span class="string">&quot;checkbox&quot;</span>]</span><span class="selector-pseudo">:checked</span>:before &#123;</span><br><span class="line">  left: <span class="number">1px</span>;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">5px</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">10px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">2px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.checkbox</span><span class="selector-class">.minus</span> <span class="selector-tag">input</span><span class="selector-attr">[type=<span class="string">&quot;checkbox&quot;</span>]</span><span class="selector-pseudo">:checked</span>:after &#123;</span><br><span class="line">  left: <span class="number">1px</span>;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">5px</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">10px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">2px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.checkbox</span><span class="selector-class">.plus</span> <span class="selector-tag">input</span><span class="selector-attr">[type=<span class="string">&quot;checkbox&quot;</span>]</span>:before &#123;</span><br><span class="line">  transform: <span class="built_in">rotate</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">1px</span>;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">5px</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">2px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.checkbox</span><span class="selector-class">.plus</span> <span class="selector-tag">input</span><span class="selector-attr">[type=<span class="string">&quot;checkbox&quot;</span>]</span>:after &#123;</span><br><span class="line">  transform: <span class="built_in">rotate</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">5px</span>;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">1px</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">2px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.checkbox</span><span class="selector-class">.plus</span> <span class="selector-tag">input</span><span class="selector-attr">[type=<span class="string">&quot;checkbox&quot;</span>]</span><span class="selector-pseudo">:checked</span>:before &#123;</span><br><span class="line">  left: <span class="number">1px</span>;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">5px</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">10px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">2px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.checkbox</span><span class="selector-class">.plus</span> <span class="selector-tag">input</span><span class="selector-attr">[type=<span class="string">&quot;checkbox&quot;</span>]</span><span class="selector-pseudo">:checked</span>:after &#123;</span><br><span class="line">  left: <span class="number">5px</span>;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">1px</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">2px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">10px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.checkbox</span><span class="selector-class">.times</span> <span class="selector-tag">input</span><span class="selector-attr">[type=<span class="string">&quot;checkbox&quot;</span>]</span>:before &#123;</span><br><span class="line">  transform: <span class="built_in">rotate</span>(<span class="number">45deg</span>);</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">3px</span>;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">1px</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">2px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.checkbox</span><span class="selector-class">.times</span> <span class="selector-tag">input</span><span class="selector-attr">[type=<span class="string">&quot;checkbox&quot;</span>]</span>:after &#123;</span><br><span class="line">  transform: <span class="built_in">rotate</span>(<span class="number">135deg</span>);</span><br><span class="line">  <span class="attribute">right</span>: <span class="number">3px</span>;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">1px</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">2px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.checkbox</span><span class="selector-class">.times</span> <span class="selector-tag">input</span><span class="selector-attr">[type=<span class="string">&quot;checkbox&quot;</span>]</span><span class="selector-pseudo">:checked</span>:before &#123;</span><br><span class="line">  left: <span class="number">1px</span>;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">5px</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">10px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">2px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.checkbox</span><span class="selector-class">.times</span> <span class="selector-tag">input</span><span class="selector-attr">[type=<span class="string">&quot;checkbox&quot;</span>]</span><span class="selector-pseudo">:checked</span>:after &#123;</span><br><span class="line">  right: <span class="number">1px</span>;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">5px</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">10px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">2px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.checkbox</span> <span class="selector-tag">input</span><span class="selector-attr">[type=<span class="string">&quot;radio&quot;</span>]</span> &#123;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">50%</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.checkbox</span> <span class="selector-tag">input</span><span class="selector-attr">[type=<span class="string">&quot;radio&quot;</span>]</span>:before &#123;</span><br><span class="line">  content: <span class="string">&quot;&quot;</span>;</span><br><span class="line">  <span class="attribute">display</span>: block;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">8px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">8px</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">50%</span>;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">2px</span>;</span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">scale</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="attribute">transition</span>: all <span class="number">0.25s</span> ease-out;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.checkbox</span> <span class="selector-tag">input</span><span class="selector-attr">[type=<span class="string">&quot;radio&quot;</span>]</span><span class="selector-pseudo">:checked</span>:before &#123;</span><br><span class="line">  transform: <span class="built_in">scale</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.checkbox</span> <span class="selector-tag">input</span> &#123;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">2px</span> solid <span class="number">#2196f3</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.checkbox</span> <span class="selector-tag">input</span><span class="selector-attr">[type=<span class="string">&quot;checkbox&quot;</span>]</span><span class="selector-pseudo">:checked</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#2196f3</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.checkbox</span> <span class="selector-tag">input</span><span class="selector-attr">[type=<span class="string">&quot;radio&quot;</span>]</span><span class="selector-pseudo">:checked</span>:before &#123;</span><br><span class="line">  background: <span class="number">#2196f3</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.checkbox</span><span class="selector-class">.red</span> <span class="selector-tag">input</span> &#123;</span><br><span class="line">  <span class="attribute">border-color</span>: <span class="number">#fe5f58</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.checkbox</span><span class="selector-class">.red</span> <span class="selector-tag">input</span><span class="selector-attr">[type=<span class="string">&quot;checkbox&quot;</span>]</span><span class="selector-pseudo">:checked</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#fe5f58</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.checkbox</span><span class="selector-class">.red</span> <span class="selector-tag">input</span><span class="selector-attr">[type=<span class="string">&quot;radio&quot;</span>]</span><span class="selector-pseudo">:checked</span>:before &#123;</span><br><span class="line">  background: <span class="number">#fe5f58</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.checkbox</span><span class="selector-class">.green</span> <span class="selector-tag">input</span> &#123;</span><br><span class="line">  <span class="attribute">border-color</span>: <span class="number">#3dc550</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.checkbox</span><span class="selector-class">.green</span> <span class="selector-tag">input</span><span class="selector-attr">[type=<span class="string">&quot;checkbox&quot;</span>]</span><span class="selector-pseudo">:checked</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#3dc550</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.checkbox</span><span class="selector-class">.green</span> <span class="selector-tag">input</span><span class="selector-attr">[type=<span class="string">&quot;radio&quot;</span>]</span><span class="selector-pseudo">:checked</span>:before &#123;</span><br><span class="line">  background: <span class="number">#3dc550</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.checkbox</span><span class="selector-class">.yellow</span> <span class="selector-tag">input</span> &#123;</span><br><span class="line">  <span class="attribute">border-color</span>: <span class="number">#ffbd2b</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.checkbox</span><span class="selector-class">.yellow</span> <span class="selector-tag">input</span><span class="selector-attr">[type=<span class="string">&quot;checkbox&quot;</span>]</span><span class="selector-pseudo">:checked</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#ffbd2b</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.checkbox</span><span class="selector-class">.yellow</span> <span class="selector-tag">input</span><span class="selector-attr">[type=<span class="string">&quot;radio&quot;</span>]</span><span class="selector-pseudo">:checked</span>:before &#123;</span><br><span class="line">  background: <span class="number">#ffbd2b</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.checkbox</span><span class="selector-class">.cyan</span> <span class="selector-tag">input</span> &#123;</span><br><span class="line">  <span class="attribute">border-color</span>: <span class="number">#1bcdfc</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.checkbox</span><span class="selector-class">.cyan</span> <span class="selector-tag">input</span><span class="selector-attr">[type=<span class="string">&quot;checkbox&quot;</span>]</span><span class="selector-pseudo">:checked</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#1bcdfc</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.checkbox</span><span class="selector-class">.cyan</span> <span class="selector-tag">input</span><span class="selector-attr">[type=<span class="string">&quot;radio&quot;</span>]</span><span class="selector-pseudo">:checked</span>:before &#123;</span><br><span class="line">  background: <span class="number">#1bcdfc</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.checkbox</span><span class="selector-class">.blue</span> <span class="selector-tag">input</span> &#123;</span><br><span class="line">  <span class="attribute">border-color</span>: <span class="number">#2196f3</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.checkbox</span><span class="selector-class">.blue</span> <span class="selector-tag">input</span><span class="selector-attr">[type=<span class="string">&quot;checkbox&quot;</span>]</span><span class="selector-pseudo">:checked</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#2196f3</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.checkbox</span><span class="selector-class">.blue</span> <span class="selector-tag">input</span><span class="selector-attr">[type=<span class="string">&quot;radio&quot;</span>]</span><span class="selector-pseudo">:checked</span>:before &#123;</span><br><span class="line">  background: <span class="number">#2196f3</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.checkbox</span> <span class="selector-tag">p</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: inline-block;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">2px</span> <span class="meta">!important</span>;</span><br><span class="line">  <span class="attribute">margin-bottom</span>: <span class="number">0</span> <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-attr">[data-theme=<span class="string">&quot;dark&quot;</span>]</span> <span class="selector-tag">details</span> &#123;</span><br><span class="line">  <span class="attribute">filter</span>: <span class="built_in">brightness</span>(<span class="number">0.7</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">details</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: block;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">16px</span>;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0.5rem</span> <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">4px</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">0.7375rem</span>;</span><br><span class="line">  <span class="attribute">transition</span>: all <span class="number">0.28s</span> ease;</span><br><span class="line">  -moz-<span class="attribute">transition</span>: all <span class="number">0.28s</span> ease;</span><br><span class="line">  -webkit-<span class="attribute">transition</span>: all <span class="number">0.28s</span> ease;</span><br><span class="line">  -o-<span class="attribute">transition</span>: all <span class="number">0.28s</span> ease;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#f6f6f6</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">details</span> <span class="selector-tag">summary</span> &#123;</span><br><span class="line">  <span class="attribute">cursor</span>: pointer;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">16px</span>;</span><br><span class="line">  <span class="attribute">margin</span>: -<span class="number">16px</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">4px</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">rgba</span>(<span class="number">85</span>, <span class="number">85</span>, <span class="number">85</span>, <span class="number">0.7</span>);</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">0.7375rem</span>;</span><br><span class="line">  <span class="attribute">font-weight</span>: bold;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">  <span class="attribute">line-height</span>: normal;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">details</span> <span class="selector-tag">summary</span> &gt; <span class="selector-tag">p</span>,</span><br><span class="line"><span class="selector-tag">details</span> <span class="selector-tag">summary</span> &gt; <span class="selector-tag">h1</span>,</span><br><span class="line"><span class="selector-tag">details</span> <span class="selector-tag">summary</span> &gt; <span class="selector-tag">h2</span>,</span><br><span class="line"><span class="selector-tag">details</span> <span class="selector-tag">summary</span> &gt; <span class="selector-tag">h3</span>,</span><br><span class="line"><span class="selector-tag">details</span> <span class="selector-tag">summary</span> &gt; <span class="selector-tag">h4</span>,</span><br><span class="line"><span class="selector-tag">details</span> <span class="selector-tag">summary</span> &gt; <span class="selector-tag">h5</span>,</span><br><span class="line"><span class="selector-tag">details</span> <span class="selector-tag">summary</span> &gt; <span class="selector-tag">h6</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: inline;</span><br><span class="line">  <span class="attribute">border-bottom</span>: none <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">details</span> <span class="selector-tag">summary</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#555</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">details</span> <span class="selector-tag">summary</span><span class="selector-pseudo">:hover</span>:after &#123;</span><br><span class="line">  position: absolute;</span><br><span class="line">  <span class="attribute">content</span>: <span class="string">&quot;+&quot;</span>;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">50%</span>;</span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">translateY</span>(-<span class="number">50%</span>);</span><br><span class="line">  <span class="attribute">right</span>: <span class="number">16px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">details</span> &gt; <span class="selector-tag">summary</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#f6f6f6</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">details</span><span class="selector-attr">[blue]</span> &#123;</span><br><span class="line">  <span class="attribute">border-color</span>: <span class="number">#e8f4fd</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">details</span><span class="selector-attr">[blue]</span> &gt; <span class="selector-tag">summary</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#e8f4fd</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">details</span><span class="selector-attr">[cyan]</span> &#123;</span><br><span class="line">  <span class="attribute">border-color</span>: <span class="number">#e8fafe</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">details</span><span class="selector-attr">[cyan]</span> &gt; <span class="selector-tag">summary</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#e8fafe</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">details</span><span class="selector-attr">[green]</span> &#123;</span><br><span class="line">  <span class="attribute">border-color</span>: <span class="number">#ebf9ed</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">details</span><span class="selector-attr">[green]</span> &gt; <span class="selector-tag">summary</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#ebf9ed</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">details</span><span class="selector-attr">[yellow]</span> &#123;</span><br><span class="line">  <span class="attribute">border-color</span>: <span class="number">#fff8e9</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">details</span><span class="selector-attr">[yellow]</span> &gt; <span class="selector-tag">summary</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#fff8e9</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">details</span><span class="selector-attr">[red]</span> &#123;</span><br><span class="line">  <span class="attribute">border-color</span>: <span class="number">#feefee</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">details</span><span class="selector-attr">[red]</span> &gt; <span class="selector-tag">summary</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#feefee</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">details</span><span class="selector-attr">[open]</span> &#123;</span><br><span class="line">  <span class="attribute">border-color</span>: <span class="built_in">rgba</span>(<span class="number">85</span>, <span class="number">85</span>, <span class="number">85</span>, <span class="number">0.2</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">details</span><span class="selector-attr">[open]</span> &gt; <span class="selector-tag">summary</span> &#123;</span><br><span class="line">  <span class="attribute">border-bottom</span>: <span class="number">1px</span> solid <span class="built_in">rgba</span>(<span class="number">85</span>, <span class="number">85</span>, <span class="number">85</span>, <span class="number">0.2</span>);</span><br><span class="line">  <span class="attribute">border-bottom-left-radius</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">border-bottom-right-radius</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">details</span><span class="selector-attr">[open]</span><span class="selector-attr">[blue]</span> &#123;</span><br><span class="line">  <span class="attribute">border-color</span>: <span class="built_in">rgba</span>(<span class="number">33</span>, <span class="number">150</span>, <span class="number">243</span>, <span class="number">0.3</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">details</span><span class="selector-attr">[open]</span><span class="selector-attr">[blue]</span> &gt; <span class="selector-tag">summary</span> &#123;</span><br><span class="line">  <span class="attribute">border-bottom-color</span>: <span class="built_in">rgba</span>(<span class="number">33</span>, <span class="number">150</span>, <span class="number">243</span>, <span class="number">0.3</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">details</span><span class="selector-attr">[open]</span><span class="selector-attr">[cyan]</span> &#123;</span><br><span class="line">  <span class="attribute">border-color</span>: <span class="built_in">rgba</span>(<span class="number">27</span>, <span class="number">205</span>, <span class="number">252</span>, <span class="number">0.3</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">details</span><span class="selector-attr">[open]</span><span class="selector-attr">[cyan]</span> &gt; <span class="selector-tag">summary</span> &#123;</span><br><span class="line">  <span class="attribute">border-bottom-color</span>: <span class="built_in">rgba</span>(<span class="number">27</span>, <span class="number">205</span>, <span class="number">252</span>, <span class="number">0.3</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">details</span><span class="selector-attr">[open]</span><span class="selector-attr">[green]</span> &#123;</span><br><span class="line">  <span class="attribute">border-color</span>: <span class="built_in">rgba</span>(<span class="number">61</span>, <span class="number">197</span>, <span class="number">80</span>, <span class="number">0.3</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">details</span><span class="selector-attr">[open]</span><span class="selector-attr">[green]</span> &gt; <span class="selector-tag">summary</span> &#123;</span><br><span class="line">  <span class="attribute">border-bottom-color</span>: <span class="built_in">rgba</span>(<span class="number">61</span>, <span class="number">197</span>, <span class="number">80</span>, <span class="number">0.3</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">details</span><span class="selector-attr">[open]</span><span class="selector-attr">[yellow]</span> &#123;</span><br><span class="line">  <span class="attribute">border-color</span>: <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">189</span>, <span class="number">43</span>, <span class="number">0.3</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">details</span><span class="selector-attr">[open]</span><span class="selector-attr">[yellow]</span> &gt; <span class="selector-tag">summary</span> &#123;</span><br><span class="line">  <span class="attribute">border-bottom-color</span>: <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">189</span>, <span class="number">43</span>, <span class="number">0.3</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">details</span><span class="selector-attr">[open]</span><span class="selector-attr">[red]</span> &#123;</span><br><span class="line">  <span class="attribute">border-color</span>: <span class="built_in">rgba</span>(<span class="number">254</span>, <span class="number">95</span>, <span class="number">88</span>, <span class="number">0.3</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">details</span><span class="selector-attr">[open]</span><span class="selector-attr">[red]</span> &gt; <span class="selector-tag">summary</span> &#123;</span><br><span class="line">  <span class="attribute">border-bottom-color</span>: <span class="built_in">rgba</span>(<span class="number">254</span>, <span class="number">95</span>, <span class="number">88</span>, <span class="number">0.3</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">details</span><span class="selector-attr">[open]</span> &gt; <span class="selector-tag">summary</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#555</span>;</span><br><span class="line">  <span class="attribute">margin-bottom</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">details</span><span class="selector-attr">[open]</span> &gt; <span class="selector-tag">summary</span><span class="selector-pseudo">:hover</span>:after &#123;</span><br><span class="line">  content: <span class="string">&quot;-&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">details</span><span class="selector-attr">[open]</span> &gt; <span class="selector-tag">div</span><span class="selector-class">.content</span> &#123;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">16px</span>;</span><br><span class="line">  <span class="attribute">margin</span>: -<span class="number">16px</span>;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">details</span><span class="selector-attr">[open]</span> &gt; <span class="selector-tag">div</span><span class="selector-class">.content</span> <span class="selector-tag">p</span> &gt; <span class="selector-tag">a</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">  <span class="attribute">text-decoration</span>: underline;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-attr">[data-theme=<span class="string">&quot;dark&quot;</span>]</span> <span class="selector-tag">span</span><span class="selector-class">.p</span> &#123;</span><br><span class="line">  <span class="attribute">filter</span>: <span class="built_in">brightness</span>(<span class="number">0.7</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">p</span><span class="selector-class">.p</span><span class="selector-class">.subtitle</span> &#123;</span><br><span class="line">  <span class="attribute">font-weight</span>: bold;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#2196f3</span>;</span><br><span class="line">  <span class="attribute">padding-top</span>: <span class="number">1rem</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">p</span><span class="selector-class">.p</span><span class="selector-class">.subtitle</span><span class="selector-pseudo">:first</span>-child &#123;</span><br><span class="line">  <span class="attribute">padding-top</span>: <span class="number">0.5rem</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">span</span><span class="selector-class">.p</span><span class="selector-class">.code</span>,</span><br><span class="line"><span class="selector-tag">p</span><span class="selector-class">.p</span><span class="selector-class">.code</span> &#123;</span><br><span class="line">  <span class="attribute">font-family</span>: Menlo, Monaco, monospace, courier, sans-serif;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">span</span><span class="selector-class">.p</span><span class="selector-class">.left</span>,</span><br><span class="line"><span class="selector-tag">p</span><span class="selector-class">.p</span><span class="selector-class">.left</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: block;</span><br><span class="line">  <span class="attribute">text-align</span>: left;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">span</span><span class="selector-class">.p</span><span class="selector-class">.center</span>,</span><br><span class="line"><span class="selector-tag">p</span><span class="selector-class">.p</span><span class="selector-class">.center</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: block;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">span</span><span class="selector-class">.p</span><span class="selector-class">.right</span>,</span><br><span class="line"><span class="selector-tag">p</span><span class="selector-class">.p</span><span class="selector-class">.right</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: block;</span><br><span class="line">  <span class="attribute">text-align</span>: right;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">span</span><span class="selector-class">.p</span><span class="selector-class">.small</span>,</span><br><span class="line"><span class="selector-tag">p</span><span class="selector-class">.p</span><span class="selector-class">.small</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">0.575rem</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">span</span><span class="selector-class">.p</span><span class="selector-class">.large</span>,</span><br><span class="line"><span class="selector-tag">p</span><span class="selector-class">.p</span><span class="selector-class">.large</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">2rem</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">1.4</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">span</span><span class="selector-class">.p</span><span class="selector-class">.huge</span>,</span><br><span class="line"><span class="selector-tag">p</span><span class="selector-class">.p</span><span class="selector-class">.huge</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">4rem</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">1.4</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">span</span><span class="selector-class">.p</span><span class="selector-class">.ultra</span>,</span><br><span class="line"><span class="selector-tag">p</span><span class="selector-class">.p</span><span class="selector-class">.ultra</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">6rem</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">1.4</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">span</span><span class="selector-class">.p</span><span class="selector-class">.small</span>,</span><br><span class="line"><span class="selector-tag">p</span><span class="selector-class">.p</span><span class="selector-class">.small</span>,</span><br><span class="line"><span class="selector-tag">span</span><span class="selector-class">.p</span><span class="selector-class">.large</span>,</span><br><span class="line"><span class="selector-tag">p</span><span class="selector-class">.p</span><span class="selector-class">.large</span>,</span><br><span class="line"><span class="selector-tag">span</span><span class="selector-class">.p</span><span class="selector-class">.huge</span>,</span><br><span class="line"><span class="selector-tag">p</span><span class="selector-class">.p</span><span class="selector-class">.huge</span>,</span><br><span class="line"><span class="selector-tag">span</span><span class="selector-class">.p</span><span class="selector-class">.ultra</span>,</span><br><span class="line"><span class="selector-tag">p</span><span class="selector-class">.p</span><span class="selector-class">.ultra</span> &#123;</span><br><span class="line">  <span class="attribute">font-family</span>: UbuntuMono, <span class="string">&quot;PingFang SC&quot;</span>, <span class="string">&quot;Microsoft YaHei&quot;</span>, Helvetica, Arial,</span><br><span class="line">	Menlo, Monaco, monospace, sans-serif;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">span</span><span class="selector-class">.p</span><span class="selector-class">.bold</span>,</span><br><span class="line"><span class="selector-tag">p</span><span class="selector-class">.p</span><span class="selector-class">.bold</span> &#123;</span><br><span class="line">  <span class="attribute">font-weight</span>: bold;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">span</span><span class="selector-class">.p</span><span class="selector-class">.h1</span>,</span><br><span class="line"><span class="selector-tag">p</span><span class="selector-class">.p</span><span class="selector-class">.h1</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">1.625rem</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#555</span>;</span><br><span class="line">  <span class="attribute">padding-top</span>: <span class="number">1rem</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">span</span><span class="selector-class">.p</span><span class="selector-class">.h2</span>,</span><br><span class="line"><span class="selector-tag">p</span><span class="selector-class">.p</span><span class="selector-class">.h2</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">1.375rem</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">var</span>(--font-color);</span><br><span class="line">  <span class="attribute">padding-top</span>: <span class="number">1rem</span>;</span><br><span class="line">  <span class="attribute">border-bottom</span>: <span class="number">1px</span> solid <span class="built_in">var</span>(--hr-border);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">span</span><span class="selector-class">.p</span><span class="selector-class">.h3</span>,</span><br><span class="line"><span class="selector-tag">p</span><span class="selector-class">.p</span><span class="selector-class">.h3</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">1.25rem</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#2196f3</span>;</span><br><span class="line">  <span class="attribute">padding-top</span>: <span class="number">1rem</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">span</span><span class="selector-class">.p</span><span class="selector-class">.h4</span>,</span><br><span class="line"><span class="selector-tag">p</span><span class="selector-class">.p</span><span class="selector-class">.h4</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">1.125rem</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#555</span>;</span><br><span class="line">  <span class="attribute">padding-top</span>: <span class="number">1rem</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">span</span><span class="selector-class">.p</span><span class="selector-class">.red</span>,</span><br><span class="line"><span class="selector-tag">p</span><span class="selector-class">.p</span><span class="selector-class">.red</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#fe5f58</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">span</span><span class="selector-class">.p</span><span class="selector-class">.yellow</span>,</span><br><span class="line"><span class="selector-tag">p</span><span class="selector-class">.p</span><span class="selector-class">.yellow</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#ffbd2b</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">span</span><span class="selector-class">.p</span><span class="selector-class">.green</span>,</span><br><span class="line"><span class="selector-tag">p</span><span class="selector-class">.p</span><span class="selector-class">.green</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#3dc550</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">span</span><span class="selector-class">.p</span><span class="selector-class">.cyan</span>,</span><br><span class="line"><span class="selector-tag">p</span><span class="selector-class">.p</span><span class="selector-class">.cyan</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#1bcdfc</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">span</span><span class="selector-class">.p</span><span class="selector-class">.blue</span>,</span><br><span class="line"><span class="selector-tag">p</span><span class="selector-class">.p</span><span class="selector-class">.blue</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#2196f3</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">span</span><span class="selector-class">.p</span><span class="selector-class">.gray</span>,</span><br><span class="line"><span class="selector-tag">p</span><span class="selector-class">.p</span><span class="selector-class">.gray</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#666</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*tag end*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*note标签 https://lovelijunyi.gitee.io/posts/c898.html*/</span></span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.note</span><span class="selector-class">.red</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">  <span class="attribute">content</span>: <span class="string">&quot;\f054&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.note</span><span class="selector-class">.quote</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#e8f4fd</span>;</span><br><span class="line">  <span class="attribute">border-color</span>: <span class="number">#2196f3</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.note</span><span class="selector-class">.quote</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#2196f3</span>;</span><br><span class="line">  <span class="attribute">content</span>: <span class="string">&quot;\f10d&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.note</span><span class="selector-class">.radiation</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">  <span class="attribute">content</span>: <span class="string">&quot;\f7b9&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.note</span><span class="selector-class">.bug</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">  <span class="attribute">content</span>: <span class="string">&quot;\f188&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.note</span><span class="selector-class">.idea</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">  <span class="attribute">content</span>: <span class="string">&quot;\f0eb&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.note</span><span class="selector-class">.link</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">  <span class="attribute">content</span>: <span class="string">&quot;\f0c1&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.note</span><span class="selector-class">.paperclip</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">  <span class="attribute">content</span>: <span class="string">&quot;\f0c6&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.note</span><span class="selector-class">.todo</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">  <span class="attribute">content</span>: <span class="string">&quot;\f0ae&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.note</span><span class="selector-class">.message</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">  <span class="attribute">content</span>: <span class="string">&quot;\f4ad&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.note</span><span class="selector-class">.guide</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">  <span class="attribute">content</span>: <span class="string">&quot;\f277&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.note</span><span class="selector-class">.download</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">  <span class="attribute">content</span>: <span class="string">&quot;\f019&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.note</span><span class="selector-class">.up</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">  <span class="attribute">content</span>: <span class="string">&quot;\f102&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.note</span><span class="selector-class">.undo</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">  <span class="attribute">content</span>: <span class="string">&quot;\f2ea&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.note</span><span class="selector-class">.play</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">  <span class="attribute">content</span>: <span class="string">&quot;\f144&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.note</span><span class="selector-class">.message</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">  <span class="attribute">content</span>: <span class="string">&#x27;\f4ad&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.note</span><span class="selector-class">.clear</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: none;</span><br><span class="line">  <span class="attribute">border-color</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.note</span><span class="selector-class">.light</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#f6f6f6</span>;</span><br><span class="line">  <span class="attribute">border-color</span>: <span class="number">#aaa</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.note</span><span class="selector-class">.light</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#aaa</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.note</span><span class="selector-class">.gray</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#f6f6f6</span>;</span><br><span class="line">  <span class="attribute">border-color</span>: <span class="number">#767676</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.note</span><span class="selector-class">.gray</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#767676</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.note</span><span class="selector-class">.red</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#feefee</span>;</span><br><span class="line">  <span class="attribute">border-color</span>: <span class="number">#fe5f58</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.note</span><span class="selector-class">.red</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#fe5f58</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.note</span><span class="selector-class">.yellow</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#fff8e9</span>;</span><br><span class="line">  <span class="attribute">border-color</span>: <span class="number">#ffbd2b</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.note</span><span class="selector-class">.yellow</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#ffbd2b</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.note</span><span class="selector-class">.green</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#ebf9ed</span>;</span><br><span class="line">  <span class="attribute">border-color</span>: <span class="number">#3dc550</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.note</span><span class="selector-class">.green</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#3dc550</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.note</span><span class="selector-class">.cyan</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#1bcdfc</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.note</span><span class="selector-class">.blue</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#2196f3</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.note</span><span class="selector-class">.blue</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#e8f4fd</span>;</span><br><span class="line">  <span class="attribute">border-color</span>: <span class="number">#2196f3</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-attr">[data-theme=<span class="string">&quot;dark&quot;</span>]</span> <span class="selector-class">.note</span> <span class="selector-tag">p</span>&#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#000</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*note标签结束*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 标签显影 */</span></span><br><span class="line"><span class="selector-id">#article-container</span> psw<span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#333</span>;</span><br><span class="line">  <span class="attribute">background</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#article-container</span> psw &#123;</span><br><span class="line">  <span class="attribute">color</span>: transparent;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#666</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">2px</span>;</span><br><span class="line">  <span class="attribute">transition</span>: all <span class="number">0.28s</span> ease;</span><br><span class="line">  -moz-<span class="attribute">transition</span>: all <span class="number">0.28s</span> ease;</span><br><span class="line">  -webkit-<span class="attribute">transition</span>: all <span class="number">0.28s</span> ease;</span><br><span class="line">  -o-<span class="attribute">transition</span>: all <span class="number">0.28s</span> ease;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-attr">[data-theme=<span class="string">&quot;dark&quot;</span>]</span> <span class="selector-id">#article-container</span> psw<span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#fff</span>;</span><br><span class="line">  <span class="attribute">filter</span>: <span class="built_in">brightness</span>(<span class="number">0.7</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 标签显影END */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 时间线 */</span></span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.timenode</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.timenode</span>:before,</span><br><span class="line">div.timenode:after &#123;</span><br><span class="line">  content: <span class="string">&quot;&quot;</span>;</span><br><span class="line">  <span class="attribute">z-index</span>: <span class="number">1</span>;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">rgba</span>(<span class="number">68</span>, <span class="number">215</span>, <span class="number">182</span>, <span class="number">0.5</span>);</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">2px</span>;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">7px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.timenode</span>:before &#123;</span><br><span class="line">  top: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">6px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.timenode</span>:after &#123;</span><br><span class="line">  top: <span class="number">26px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="built_in">calc</span>(<span class="number">100%</span> - <span class="number">26px</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.timenode</span><span class="selector-pseudo">:last-child</span>:after &#123;</span><br><span class="line">  height: <span class="built_in">calc</span>(<span class="number">100%</span> - <span class="number">26px</span> - <span class="number">16px</span>);</span><br><span class="line">  <span class="attribute">border-bottom-left-radius</span>: <span class="number">2px</span>;</span><br><span class="line">  <span class="attribute">border-bottom-right-radius</span>: <span class="number">2px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.timenode</span> <span class="selector-class">.meta</span>,</span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.timenode</span> <span class="selector-class">.body</span> &#123;</span><br><span class="line">  <span class="attribute">max-width</span>: <span class="built_in">calc</span>(<span class="number">100%</span> - <span class="number">24px</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.timenode</span> <span class="selector-class">.meta</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">var</span>(--tab-botton-color);</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">0.375rem</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">32px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">32px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.timenode</span> <span class="selector-class">.meta</span>:before,</span><br><span class="line">div.timenode .meta:after &#123;</span><br><span class="line">  content: <span class="string">&quot;&quot;</span>;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">8px</span>;</span><br><span class="line">  <span class="attribute">z-index</span>: <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.timenode</span> <span class="selector-class">.meta</span>:before &#123;</span><br><span class="line">  background: <span class="built_in">rgba</span>(<span class="number">68</span>, <span class="number">215</span>, <span class="number">182</span>, <span class="number">0.5</span>);</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">16px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">16px</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">8px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.timenode</span> <span class="selector-class">.meta</span>:after &#123;</span><br><span class="line">  background: <span class="number">#44d7b6</span>;</span><br><span class="line">  <span class="attribute">margin-left</span>: <span class="number">2px</span>;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">2px</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">12px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">12px</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">6px</span>;</span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">scale</span>(<span class="number">0.5</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.timenode</span> <span class="selector-class">.meta</span> <span class="selector-tag">p</span> &#123;</span><br><span class="line">  <span class="attribute">font-weight</span>: bold <span class="meta">!important</span>;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">24px</span> <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.timenode</span> <span class="selector-class">.body</span> &#123;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">4px</span> <span class="number">0</span> <span class="number">10px</span> <span class="number">24px</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">10px</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">12px</span>;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#efeded</span>;</span><br><span class="line">  <span class="attribute">display</span>: inline-block;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.timenode</span> <span class="selector-class">.body</span> <span class="selector-tag">p</span><span class="selector-pseudo">:first</span>-child &#123;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">0</span> <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.timenode</span> <span class="selector-class">.body</span> <span class="selector-tag">p</span><span class="selector-pseudo">:last-child</span> &#123;</span><br><span class="line">  <span class="attribute">margin-bottom</span>: <span class="number">0</span> <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.timenode</span> <span class="selector-class">.body</span> <span class="selector-class">.highlight</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#fff7ea</span>;</span><br><span class="line">  <span class="attribute">filter</span>: <span class="built_in">grayscale</span>(<span class="number">0%</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.timenode</span> <span class="selector-class">.body</span> <span class="selector-class">.highlight</span> <span class="selector-tag">figcaption</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#ffeed2</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.timenode</span> <span class="selector-class">.body</span> <span class="selector-class">.highlight</span> <span class="selector-class">.gutter</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#ffedd0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.timenode</span><span class="selector-pseudo">:hover</span> <span class="selector-class">.meta</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#444</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.timenode</span><span class="selector-pseudo">:hover</span> <span class="selector-class">.meta</span>:before &#123;</span><br><span class="line">  background: <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">87</span>, <span class="number">34</span>, <span class="number">0.5</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.timenode</span><span class="selector-pseudo">:hover</span> <span class="selector-class">.meta</span>:after &#123;</span><br><span class="line">  background: <span class="number">#ff5722</span>;</span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">scale</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-attr">[data-theme=<span class="string">&quot;dark&quot;</span>]</span> <span class="selector-tag">div</span><span class="selector-class">.timenode</span> <span class="selector-class">.body</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#2c2c2c</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-attr">[data-theme=<span class="string">&quot;dark&quot;</span>]</span> <span class="selector-tag">div</span><span class="selector-class">.timenode</span><span class="selector-pseudo">:hover</span> <span class="selector-class">.meta</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#ccd0d7</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-attr">[data-theme=<span class="string">&quot;dark&quot;</span>]</span> <span class="selector-tag">div</span><span class="selector-class">.timenode</span> <span class="selector-class">.meta</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0.6</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-attr">[data-theme=<span class="string">&quot;dark&quot;</span>]</span> <span class="selector-tag">div</span><span class="selector-class">.timeline</span> <span class="selector-tag">p</span><span class="selector-class">.p</span><span class="selector-class">.h2</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0.6</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* link */</span></span><br><span class="line"><span class="selector-id">#article-container</span> <span class="selector-tag">a</span><span class="selector-class">.link-card</span> &#123;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0.25rem</span> auto;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#f6f6f6</span>;</span><br><span class="line">  <span class="attribute">display</span>: inline-flex;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">  <span class="attribute">cursor</span>: pointer;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">  <span class="attribute">min-width</span>: <span class="number">200px</span>;</span><br><span class="line">  <span class="attribute">max-width</span>: <span class="number">361px</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#444</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">12px</span>;</span><br><span class="line">  <span class="attribute">text-decoration</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@media</span> screen <span class="keyword">and</span> (<span class="attribute">max-width</span>: <span class="number">425px</span>) &#123;</span><br><span class="line">  <span class="selector-id">#article-container</span> <span class="selector-tag">a</span><span class="selector-class">.link-card</span> &#123;</span><br><span class="line">	<span class="attribute">max-width</span>: <span class="number">100%</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@media</span> screen <span class="keyword">and</span> (<span class="attribute">max-width</span>: <span class="number">375px</span>) &#123;</span><br><span class="line">  <span class="selector-id">#article-container</span> <span class="selector-tag">a</span><span class="selector-class">.link-card</span> &#123;</span><br><span class="line">	<span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#article-container</span> <span class="selector-tag">a</span><span class="selector-class">.link-card</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">  <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">4px</span> <span class="number">8px</span> <span class="number">0</span> <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#article-container</span> <span class="selector-tag">a</span><span class="selector-class">.link-card</span> <span class="selector-tag">div</span><span class="selector-class">.left</span>,</span><br><span class="line"><span class="selector-id">#article-container</span> <span class="selector-tag">a</span><span class="selector-class">.link-card</span> <span class="selector-tag">div</span><span class="selector-class">.right</span> &#123;</span><br><span class="line">  <span class="attribute">pointer-events</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#article-container</span> <span class="selector-tag">a</span><span class="selector-class">.link-card</span> <span class="selector-tag">div</span><span class="selector-class">.left</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">48px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">48px</span>;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">12px</span>;</span><br><span class="line">  <span class="attribute">overflow</span>: hidden;</span><br><span class="line">  <span class="attribute">flex-shrink</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#article-container</span> <span class="selector-tag">a</span><span class="selector-class">.link-card</span> <span class="selector-tag">div</span><span class="selector-class">.left</span> <span class="selector-tag">i</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">32px</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">48px</span>;</span><br><span class="line">  <span class="attribute">margin-left</span>: <span class="number">4px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#article-container</span> <span class="selector-tag">a</span><span class="selector-class">.link-card</span> <span class="selector-tag">div</span><span class="selector-class">.left</span> <span class="selector-tag">img</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: block;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">8px</span> / <span class="number">4</span>;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">50%</span>;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">50%</span>;</span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">translate</span>(-<span class="number">50%</span>, -<span class="number">50%</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#article-container</span> <span class="selector-tag">a</span><span class="selector-class">.link-card</span> <span class="selector-tag">div</span><span class="selector-class">.right</span> &#123;</span><br><span class="line">  <span class="attribute">overflow</span>: hidden;</span><br><span class="line">  <span class="attribute">margin-right</span>: <span class="number">12px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#article-container</span> <span class="selector-tag">a</span><span class="selector-class">.link-card</span> <span class="selector-tag">p</span> &#123;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#article-container</span> <span class="selector-tag">a</span><span class="selector-class">.link-card</span> <span class="selector-tag">p</span><span class="selector-class">.text</span> &#123;</span><br><span class="line">  <span class="attribute">font-weight</span>: bold;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#article-container</span> <span class="selector-tag">a</span><span class="selector-class">.link-card</span> <span class="selector-tag">p</span><span class="selector-class">.url</span> &#123;</span><br><span class="line">  <span class="attribute">flex-shrink</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">rgba</span>(<span class="number">68</span>, <span class="number">68</span>, <span class="number">68</span>, <span class="number">0.65</span>);</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">13px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-attr">[data-theme=<span class="string">&quot;dark&quot;</span>]</span> <span class="selector-id">#article-container</span> <span class="selector-tag">a</span><span class="selector-class">.link-card</span> <span class="selector-tag">img</span> &#123;</span><br><span class="line">  <span class="attribute">filter</span>: <span class="built_in">brightness</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-attr">[data-theme=<span class="string">&quot;dark&quot;</span>]</span> <span class="selector-id">#article-container</span> <span class="selector-tag">a</span><span class="selector-class">.link-card</span> &#123;</span><br><span class="line">  <span class="attribute">filter</span>: <span class="built_in">brightness</span>(<span class="number">0.7</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>找到主题配置文件<code>_config.butterfly.yml</code>，在<code>inject</code>的<code>head</code>处引入上一步创建的css文件：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">inject:</span></span><br><span class="line">  <span class="attr">head:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&lt;link</span> <span class="string">rel=&quot;stylesheet&quot;</span> <span class="string">href=&quot;/css/tag.css&quot;&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>下载 <a href="https://github.com/volantis-x/hexo-theme-volantis/tree/master/scripts/tags">hexo-theme-volantis</a> 主题，复制 <code>scripts\tags</code> 下的主题到 <code>themes\Butterfly\scripts\tag</code> 中，仅复制以下内容即可：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">btns.js</span><br><span class="line">checkbox.js</span><br><span class="line">folding.js</span><br><span class="line">link.js</span><br><span class="line">span.js</span><br><span class="line">timeline.js</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>使用参考 <a href="https://zykj.js.org/posts/e297feab/">基于 Butterfly 主题魔改的样式查阅</a></p>
</li>
</ol>
<hr>
<h1>后记</h1>
<p>可以使用别样的外挂标签样式。</p>
]]></content>
      <categories>
        <category>博客</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue学习-Vue router</title>
    <url>/2021/08/14/Vue/Vue%E5%AD%A6%E4%B9%A0-Vue-router/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\css\APlayer.min.css"><script src="\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\js\Meting.min.js"></script><h1>前言</h1>
<p>本文将介绍Vue-router的使用。</p>
<hr>
<h1>Vue-router</h1>
<h2 id="前端路由">前端路由</h2>
<p>前端路由的核心就是改变URL，但是页面不进行整体的刷新。</p>
<p>在配置Vue-router时有两种模式，分别为：<code>hash</code>模式（默认）、<code>history</code>模式。</p>
<h3 id="hash模式">hash模式</h3>
<p>URL的hash也就是锚点(#), 本质上是改变<code>window.location</code>的<code>href</code>属性，但是可以通过直接赋值<code>location.hash</code>来改变<code>href</code>, 但是页面不发生刷新。</p>
<p>这里建立一个带路由的项目，启动服务，在控制台输入<code>location.hash = 'xxx'</code>来改变URL：</p>
<p><img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Vuerouter-hash-show.gif" alt=""></p>
<h3 id="history模式">history模式</h3>
<p>history接口有5种模式改变URL而不刷新页面。</p>
<ul>
<li>
<p>pushState：<code>history.pushState(&#123;&#125;,'','/foo')</code></p>
<blockquote>
<p>会有一个堆栈结构，意味着可返回上一页。</p>
</blockquote>
</li>
<li>
<p>replaceState：<code>history.replaceState(&#123;&#125;,'','/foo')</code></p>
<blockquote>
<p>不能回退上一页。</p>
</blockquote>
</li>
<li>
<p>back：<code>history.back()</code></p>
</li>
<li>
<p>forward：<code>history.forward()</code></p>
</li>
<li>
<p>go：<code>history.go(index)</code></p>
<blockquote>
<p>history.back() &lt;==&gt; history.go(-1)</p>
<p>history.forward() &lt;==&gt; history.go(1)</p>
</blockquote>
</li>
</ul>
<h2 id="安装">安装</h2>
<p>有两种安装方式：</p>
<ul>
<li>
<p>打开终端，键入如下命令（注意版本号）：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm install vue-router --save</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>在创建Vue CLI项目时选择安装Vue-router</p>
<blockquote>
<p>选择安装路由后，在项目的<code>src</code>文件夹下有一个<code>router</code>文件夹，其中有<code>index.js</code>文件。</p>
</blockquote>
</li>
</ul>
<h2 id="使用">使用</h2>
<h3 id="步骤">步骤</h3>
<p>路由的使用步骤如下：</p>
<ol>
<li>导入路由对象，并且调用<code>Vue.use(VueRouter)</code></li>
<li>创建路由实例，并且传入路由映射配置</li>
<li>在Vue实例中挂载创建的路由实例</li>
</ol>
<p>如果是手动创建，则首先安装vue-router，在<code>src</code>文件夹下创建一个<code>router</code>文件夹，在其中新建一个<code>index.js</code>文件：</p>
<p>基本框架如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 配置路由相关的信息</span></span><br><span class="line"><span class="keyword">import</span> VueRouter <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 1.通过Vue.use(插件), 安装插件</span></span><br><span class="line">Vue.use(VueRouter)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.创建VueRouter对象（将routes属性抽离出来写）</span></span><br><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line"></span><br><span class="line">]</span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> VueRouter(&#123;</span><br><span class="line">  <span class="comment">// 配置路由和组件之间的应用关系（用发同Vue对象）</span></span><br><span class="line">  routes,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.将router对象传入到Vue实例</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router</span><br></pre></td></tr></table></figure>
<p>当然在<code>main.js</code>文件中需要在Vue实例中注册router实例：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">&#x27;./App&#x27;</span></span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&#x27;./router&#x27;</span>  <span class="comment">//导入router对象</span></span><br><span class="line"></span><br><span class="line">Vue.config.productionTip = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  el: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">  router,  <span class="comment">//在Vue实例中注册router对象</span></span><br><span class="line">  render: <span class="function"><span class="params">h</span> =&gt;</span> h(App)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意：在导入的时候，如果路径末尾为一个文件夹，则会自动导入该文件夹下的<code>index.js</code>文件。</p>
</blockquote>
<p><code>App.vue</code>文件代码如下：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">  name: <span class="string">&#x27;App&#x27;</span></span></span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>下面就需要配置路由的映射关系：</p>
<p>首先在<code>components</code>文件夹（组件都定义在此）下新建<code>Home.vue</code>和<code>About.vue</code>文件：</p>
<p><code>Home.vue</code>文件：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>我是首页<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>我是首页内容<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">    name: <span class="string">&quot;Home&quot;</span></span></span><br><span class="line">  &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>About.vue</code>文件：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>我是关于页面<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>我是关于内容<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">    name: <span class="string">&quot;About&quot;</span></span></span><br><span class="line">  &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>下面在<code>index.js</code>文件的<code>routes</code>属性中配置映射关系（一个映射关系就是一个对象）：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Home <span class="keyword">from</span> <span class="string">&#x27;../components/Home.vue&#x27;</span>  <span class="comment">//导入Home组件（.vue扩展名可以省略）</span></span><br><span class="line"><span class="keyword">import</span> About <span class="keyword">from</span> <span class="string">&#x27;../components/About.vue&#x27;</span>  <span class="comment">//导入About组件（.vue扩展名可以省略）</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">&#x27;/home&#x27;</span>,  <span class="comment">//配置URL</span></span><br><span class="line">    component: Home  <span class="comment">//模板</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">&#x27;/about&#x27;</span>,</span><br><span class="line">    component: About</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<blockquote>
<p>说明：</p>
<p>每一个对象中：</p>
<ul>
<li><code>path</code>属性：用于配置URL</li>
<li><code>component</code>属性：用于注册模板</li>
</ul>
</blockquote>
<p>现在就可以使用这两个router组件了，在<code>App.vue</code>模板中利用<code>&lt;router-link&gt;</code>和<code>&lt;router-view&gt;</code>：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/home&quot;</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/about&quot;</span>&gt;</span>关于<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">router-view</span>&gt;</span><span class="tag">&lt;/<span class="name">router-view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">  name: <span class="string">&#x27;App&#x27;</span></span></span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>说明：</p>
<ul>
<li><code>&lt;router-link&gt;</code>标签：用于关联路由组件，利用<code>to</code>属性</li>
<li><code>&lt;router-view&gt;</code>标签：用于展示路由模板，运行时会自动渲染为<code>&lt;a&gt;</code>标签，并用router模板对其替换</li>
</ul>
</blockquote>
<p>效果如下：</p>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Vuerouter-基本使用-show1.gif" style="zoom:80%;" />
<h3 id="路由的默认路径">路由的默认路径</h3>
<p>如果想在最初进入页面时就加载一个默认路由（例：首页页面），则可以进行路由的默认路径配置：</p>
<p>在<code>index.js</code>文件中的<code>routes</code>属性中新增默认路径：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">&#x27;/&#x27;</span>,  <span class="comment">//  &#x27;/&#x27;表示默认路径</span></span><br><span class="line">    redirect: <span class="string">&#x27;/home&#x27;</span>  <span class="comment">//重定向至/home路由</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">&#x27;/home&#x27;</span>,</span><br><span class="line">    component: Home</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">&#x27;/about&#x27;</span>,</span><br><span class="line">    component: About</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<blockquote>
<p>说明：</p>
<ul>
<li><code>path</code>：配置的是<code>'/'</code>，表示根路径（默认路径）</li>
<li><code>redirect</code>：是重定向，可以选择设置过的路由</li>
</ul>
</blockquote>
<h3 id="hash模式和history模式">hash模式和history模式</h3>
<p>之前提到过，创建Vue项目时，默认的是hash模式，可以看到在URL处会有<code>#</code>：</p>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Vuerouter-hash-show2.png" style="zoom:80%;" />
<p>通过在<code>index.js</code>文件中的router对象中配置<code>mode</code>可以将其改为history模式：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> VueRouter(&#123;</span><br><span class="line">  routes,</span><br><span class="line">  mode: <span class="string">&#x27;history&#x27;</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Vuerouter-history-show.png" style="zoom:80%;" />
<p>html5中的history模式则在URL中去除了<code>#</code>。</p>
<h3 id="router-link标签补充">router-link标签补充</h3>
<ul>
<li>
<p><code>to</code>属性：用于链接跳转的路由</p>
</li>
<li>
<p><code>tag</code>属性：默认<code>&lt;router-link&gt;</code>标签会被渲染为<code>&lt;a&gt;</code>标签，如果想让其渲染为其他标签，可以设置<code>tag</code>属性，例：将其渲染为<code>button</code>按钮：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/home&quot;</span> <span class="attr">tag</span>=<span class="string">&quot;button&quot;</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/about&quot;</span> <span class="attr">tag</span>=<span class="string">&quot;button&quot;</span>&gt;</span>关于<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">router-view</span>&gt;</span><span class="tag">&lt;/<span class="name">router-view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p><code>replace</code>属性：在每一次点击路由跳转时默认为<code>pushState</code>，即可以点击<code>前/后</code>按钮实现历史页面的跳转，如果不希望如此，将其修改为<code>replaceState</code>模式，则只需在<code>&lt;router-link&gt;</code>标签中添加<code>replace</code>即可：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/home&quot;</span> <span class="attr">replace</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/about&quot;</span> <span class="attr">replace</span>&gt;</span>关于<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">router-view</span>&gt;</span><span class="tag">&lt;/<span class="name">router-view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p><code>active-class</code>属性：</p>
<p>开发者工具查看页面会发现在执行路由跳转的标签中存在两个<code>class</code>属性，其中<code>router-link-active</code>可以对其使用，链接css属性。</p>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Vuerouter-link-show1.png" style="zoom:80%;" />
<p>例如：实现点击后变红：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/home&quot;</span> &gt;</span>首页<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/about&quot;</span> &gt;</span>关于<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">router-view</span>&gt;</span><span class="tag">&lt;/<span class="name">router-view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">  name: <span class="string">&#x27;App&#x27;</span></span></span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line">  .router-link-active &#123;</span><br><span class="line"><span class="css">    <span class="attribute">color</span>: <span class="number">#f00</span>;</span></span><br><span class="line">  &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Vuerouter-link-show2.png" style="zoom:80%;" />
<p>当然，如果觉得该属性名字太长，想对其进行修改（一般不这么操作），可以有如下两种方式：</p>
<ul>
<li>
<p>在<code>&lt;router-link&gt;</code>标签设置<code>active-class</code>属性：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/home&quot;</span> <span class="attr">active-class</span>=<span class="string">&quot;active&quot;</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/about&quot;</span> <span class="attr">active-class</span>=<span class="string">&quot;active&quot;</span>&gt;</span>关于<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">router-view</span>&gt;</span><span class="tag">&lt;/<span class="name">router-view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">  name: <span class="string">&#x27;App&#x27;</span></span></span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="css">  <span class="selector-class">.active</span> &#123; <span class="comment">/* css也要随之变化 */</span></span></span><br><span class="line"><span class="css">    <span class="attribute">color</span>: <span class="number">#f00</span>;</span></span><br><span class="line">  &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Vuerouter-link-show3.png" style="zoom:80%;" />
</li>
<li>
<p>上述方法只适用于修改一个标签，如果想要让所有的<code>&lt;router-link&gt;</code>标签中的<code>router-link-active</code>发生改变，则需要在<code>index.js</code>文件中的router对象中添加<code>linkActiveClass</code>属性：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> VueRouter(&#123;</span><br><span class="line">  routes,</span><br><span class="line">  mode: <span class="string">&#x27;history&#x27;</span>,</span><br><span class="line">  linkActiveClass: <span class="string">&#x27;active&#x27;</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h3 id="路由代码跳转">路由代码跳转</h3>
<p>如果不想使用原有的<code>&lt;router-link&gt;</code>标签进行路由跳转，还可以在普通标签中添加方法，使其达到同样的效果，以<code>&lt;button&gt;</code>标签（按钮）为例：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;linkToHome&quot;</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;linkToAbout&quot;</span>&gt;</span>关于<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">router-view</span>&gt;</span><span class="tag">&lt;/<span class="name">router-view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">  name: <span class="string">&#x27;App&#x27;</span>,</span></span><br><span class="line">  methods: &#123;</span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">linkToHome</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">this</span>.$router.push(<span class="string">&#x27;/home&#x27;</span>),  <span class="comment">//利用router进行路由链接</span></span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">&quot;已跳转至首页&quot;</span>)  </span></span><br><span class="line">    &#125;,</span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">linkToAbout</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">this</span>.$router.push(<span class="string">&#x27;/about&#x27;</span>),  <span class="comment">//利用router进行路由链接</span></span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">&quot;已跳转至关于页面&quot;</span>)</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>说明：</p>
<p>在Vue-router的源码中默认给每一个组件都增加了一个<code>$router</code>属性，所以可以利用该属性进行路由的链接</p>
<p>同样的还有<code>$router.replace('xxx')</code>方法</p>
</blockquote>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Vuerouter-link-show4.gif" style="zoom:80%;" />
<h3 id="动态路由">动态路由</h3>
<p>还有一种十分常见的场景，即某些页面的path路径是不确定的，比如用户页面，通常情况下URL末尾会带有实际用户的ID，这种不确定的路由称为动态路由，下面以用户页面案例来说明：</p>
<p>首先需要创建一个用户路由，在<code>components</code>文件夹下新建一个<code>User.vue</code>文件：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>我是用户<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>我是用户页面内容<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">    name: <span class="string">&quot;User&quot;</span></span></span><br><span class="line">  &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>然后在<code>index.js</code>文件中的routes中添加该路由（注意先引用）</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">&#x27;/&#x27;</span>,  </span><br><span class="line">    redirect: <span class="string">&#x27;/home&#x27;</span>  </span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">&#x27;/home&#x27;</span>,</span><br><span class="line">    component: Home</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">&#x27;/about&#x27;</span>,</span><br><span class="line">    component: About</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">&#x27;/user/:id&#x27;</span>,  <span class="comment">//注意添加id的写法</span></span><br><span class="line">    component: User</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>最后在<code>App.vue</code>文件中的data属性中添加userID（之后实际项目中从后端动态获取），并且在模板中的<code>&lt;router-link&gt;</code>标签中链接该属性：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/home&quot;</span> &gt;</span>首页<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/about&quot;</span> &gt;</span>关于<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">v-bind:to</span>=<span class="string">&quot;&#x27;/user/&#x27;+userID&quot;</span> &gt;</span>用户<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span>  <span class="comment">&lt;!--注意要使用v-bind绑定data--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">router-view</span>&gt;</span><span class="tag">&lt;/<span class="name">router-view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">  name: <span class="string">&#x27;App&#x27;</span>,</span></span><br><span class="line"><span class="javascript">  <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">      userID: <span class="string">&#x27;张三&#x27;</span></span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>效果如下：</p>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Vuerouter-动态路由-show1.gif" style="zoom:80%;" />
<p>如果希望在跳转的路由页面中显示出用户信息，则需要在<code>User.vue</code>文件中使用<code>$route</code>属性：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>我是用户<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>我是用户页面内容<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>我是&#123;&#123;userID&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span>  <span class="comment">&lt;!--实现一：利用computed计算属性--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>我是&#123;&#123;$route.params.id&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span>  <span class="comment">&lt;!--实现二：直接使用$route.params.xxx--&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">    name: <span class="string">&quot;User&quot;</span>,</span></span><br><span class="line">    computed: &#123;</span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">userID</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> <span class="built_in">this</span>.$route.params.id</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>说明：</p>
<p>这里使用了<code>$route</code>属性，注意与<code>$router</code>属性的区别。</p>
<ul>
<li>
<p><code>$router</code>属性：会寻找<code>VueRouter</code>路由对象实例</p>
</li>
<li>
<p><code>$route</code>属性：会定位到路由对象中的<code>routes</code>属性，<code>routes</code>属性是一个关联各个路由的列表，在该列表中哪一个路由处于活跃状态，则<code>routes</code>属性就会定位到该活跃路由</p>
<p><code>params</code>即参数，<code>.</code>后面跟着的参数名对应于<code>index.js</code>文件中<code>routes</code>属性中关联的动态路由的参数名（本例中即：<code>path: '/user/:id'</code>）</p>
</li>
</ul>
</blockquote>
<p>效果如下：</p>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Vuerouter-动态路由-show2.gif" style="zoom:80%;" />
<h3 id="路由懒加载">路由懒加载</h3>
<p>当打包构建应用时，Javascript包会变得非常大，影响页面加载。如果能把不同路由对应的组件分割成不同的代码块，然后当路由被访问的时候才加载对应组件，这样就会更加高效。</p>
<blockquote>
<p>原先直接打包后，很多个路由页面会被打包在一个js文件中，当访问页面时就会一次加载全部的js代码，但是有些内容是暂且不需要的（不必加载）。</p>
</blockquote>
<p>实现路由懒加载的方式只需要在<code>index.js</code>文件中修改路由的导入方式：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> VueRouter <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Home = <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;../components/Home.vue&#x27;</span>)  <span class="comment">//看这里</span></span><br><span class="line"><span class="keyword">const</span> About = <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;../components/About.vue&#x27;</span>)  <span class="comment">//看这里</span></span><br><span class="line"><span class="keyword">const</span> User = <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;../components/User.vue&#x27;</span>)  <span class="comment">//看这里</span></span><br><span class="line"></span><br><span class="line">Vue.use(VueRouter)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">    redirect: <span class="string">&#x27;/home&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">&#x27;/home&#x27;</span>,</span><br><span class="line">    component: Home</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">&#x27;/about&#x27;</span>,</span><br><span class="line">    component: About</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">&#x27;/user/:id&#x27;</span>,</span><br><span class="line">    component: User</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> VueRouter(&#123;</span><br><span class="line">  routes,</span><br><span class="line">  mode: <span class="string">&#x27;history&#x27;</span>,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router</span><br></pre></td></tr></table></figure>
<p>当然也可以在<code>component</code>中直接导入（不建议这样写）：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">    redirect: <span class="string">&#x27;/home&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">&#x27;/home&#x27;</span>,</span><br><span class="line">    component: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;../components/Home.vue&#x27;</span>)  <span class="comment">//看这里</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">&#x27;/about&#x27;</span>,</span><br><span class="line">    component: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;../components/About.vue&#x27;</span>)  <span class="comment">//看这里</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">&#x27;/user/:id&#x27;</span>,</span><br><span class="line">    component: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;../components/User.vue&#x27;</span>)  <span class="comment">//看这里</span></span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h3 id="嵌套路由">嵌套路由</h3>
<p>实现在一个路由中细分出子路由。</p>
<p>下面以一个案例来说明，想要在home首页中添加新闻（/home/news）和消息（/home/message）内容：</p>
<p>首先新建两个组件：</p>
<p><code>HomeNews</code>:</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span>新闻一<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span>新闻二<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span>新闻三<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span>新闻四<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">    name: <span class="string">&quot;HomeNews&quot;</span>,</span></span><br><span class="line">  &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>HomeMessage</code>：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;ul&gt;</span><br><span class="line">      &lt;li&gt;消息一&lt;&#x2F;li&gt;</span><br><span class="line">      &lt;li&gt;消息二&lt;&#x2F;li&gt;</span><br><span class="line">      &lt;li&gt;消息三&lt;&#x2F;li&gt;</span><br><span class="line">      &lt;li&gt;消息四&lt;&#x2F;li&gt;</span><br><span class="line">    &lt;&#x2F;ul&gt;</span><br><span class="line">  &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">  export default &#123;</span><br><span class="line">    name: &quot;HomeMessage&quot;,</span><br><span class="line">  &#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;style&gt;</span><br></pre></td></tr></table></figure>
<p>然后在<code>index.js</code>文件中导入这两个组件，并在配置的home路由中添加<code>children</code>属性，该属性同样为一个列表，里面可以添加多个子路由对象：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">&#x27;/&#x27;</span>,  </span><br><span class="line">    redirect: <span class="string">&#x27;/home&#x27;</span>  </span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">&#x27;/home&#x27;</span>,</span><br><span class="line">    component: Home,</span><br><span class="line">    children: [</span><br><span class="line">      &#123;</span><br><span class="line">        path: <span class="string">&#x27;news&#x27;</span>,  <span class="comment">//新闻子路由</span></span><br><span class="line">        component: News</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        path: <span class="string">&#x27;message&#x27;</span>,  <span class="comment">//消息子路由</span></span><br><span class="line">        component: Message</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">&#x27;/about&#x27;</span>,</span><br><span class="line">    component: About</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">&#x27;/user/:id&#x27;</span>,</span><br><span class="line">    component: User</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>最后在<code>Home.vue</code>文件的模板中加入<code>&lt;router-link&gt;</code>和<code>&lt;router-view&gt;</code>的标签：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>我是首页<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>我是首页内容<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/home/news&quot;</span>&gt;</span>新闻<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/home/message&quot;</span>&gt;</span>消息<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">router-view</span>&gt;</span><span class="tag">&lt;/<span class="name">router-view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意<code>to</code>属性的子路由路径写法。</p>
</blockquote>
<p>如果想像home首页一样添加默认路由，利用同样的方法在<code>index.js</code>文件中的home路由中进行配置，添加默认路由并设置重定向：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">    redirect: <span class="string">&#x27;/home&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">&#x27;/home&#x27;</span>,</span><br><span class="line">    component: Home,</span><br><span class="line">    children: [</span><br><span class="line">      &#123;</span><br><span class="line">        path: <span class="string">&#x27;/&#x27;</span>,  <span class="comment">//设置默认路由</span></span><br><span class="line">    redirect: <span class="string">&#x27;news&#x27;</span>  </span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        path: <span class="string">&#x27;news&#x27;</span>,</span><br><span class="line">        component: News</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        path: <span class="string">&#x27;message&#x27;</span>,</span><br><span class="line">        component: Message</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">&#x27;/about&#x27;</span>,</span><br><span class="line">    component: About</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">&#x27;/user/:id&#x27;</span>,</span><br><span class="line">    component: User</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>效果如下：</p>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Vuerouter-嵌套路由-show.gif" style="zoom:80%;" />
<h3 id="参数传递">参数传递</h3>
<h4 id="利用router-link标签：">利用router-link标签：</h4>
<p>之前在动态路由的部分讲过利用<code>$route</code>属性和<code>params</code>关键词进行参数传递。</p>
<p>下面介绍利用<code>query</code>进行参数传递。</p>
<blockquote>
<p>URL格式：</p>
<p>协议类型://主机:端口/路径?查询</p>
<p>scheme://host:port/path?query#fragment</p>
</blockquote>
<p>首先创建一个<code>Profile.vue</code>文件：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>我是概述<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123;$route.query.name&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123;$route.query.age&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">    name: <span class="string">&quot;Profile&quot;</span></span></span><br><span class="line">  &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>说明：</p>
<p><code>$route.query.name</code>：获取URL中传来的<code>name</code>参数</p>
<p><code>$route.query.age</code>：获取URL中传来的<code>age</code>参数</p>
</blockquote>
<p>然后在<code>index.js</code>文件中导入，并在routes中添加Profile的路由（这里不做展示）。</p>
<p>在<code>App.vue</code>中使用<code>&lt;router-link&gt;</code>和<code>&lt;router-view&gt;</code>的标签进行路由链接和展示：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/home&quot;</span> &gt;</span>首页<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/about&quot;</span> &gt;</span>关于<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">v-bind:to</span>=<span class="string">&quot;&#x27;/user/&#x27;+userID&quot;</span> &gt;</span>用户<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">:to</span>=<span class="string">&quot;&#123;path: &#x27;/profile&#x27;, query: &#123;name: name, age: age&#125;&#125;&quot;</span>&gt;</span>概述<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">router-view</span>&gt;</span><span class="tag">&lt;/<span class="name">router-view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">  name: <span class="string">&#x27;App&#x27;</span>,</span></span><br><span class="line"><span class="javascript">  <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">      userID: <span class="string">&#x27;0000&#x27;</span>,</span></span><br><span class="line"><span class="javascript">      name: <span class="string">&#x27;花猪&#x27;</span>,</span></span><br><span class="line">      age: 18</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<blockquote>
<p>说明：</p>
<p>利用<code>v-bind</code>绑定<code>to</code>属性，其值可以为一个对象，对象中的<code>path</code>参数即为链接路由的路径，<code>query</code>即为要传递的参数，也是一个对象。</p>
</blockquote>
<p>效果如下：</p>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Vuerouter-参数传递-show1.gif" style="zoom:80%;" />
<h4 id="利用方法">利用方法</h4>
<p>如果想设计按钮跳转路由并进行参数传递，可以编写方法：</p>
<p>先介绍<code>params</code>的实现，在<code>App.vue</code>中编写如下代码：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/home&quot;</span> &gt;</span>首页<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/about&quot;</span> &gt;</span>关于<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;userClick&quot;</span>&gt;</span>用户<span class="tag">&lt;/<span class="name">button</span>&gt;</span>  <span class="comment">&lt;!--用户按钮--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">router-view</span>&gt;</span><span class="tag">&lt;/<span class="name">router-view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">  name: <span class="string">&#x27;App&#x27;</span>,</span></span><br><span class="line"><span class="javascript">  <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">      userID: <span class="string">&#x27;0000&#x27;</span>,</span></span><br><span class="line"><span class="javascript">      name: <span class="string">&#x27;花猪&#x27;</span>,</span></span><br><span class="line">      age: 18</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">userClick</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">this</span>.$router.push(<span class="string">&#x27;/user/&#x27;</span> + <span class="built_in">this</span>.userID)  <span class="comment">//点击后进行路由跳转并传递参数</span></span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>再介绍<code>query</code>的实现，在<code>App.vue</code>中编写如下代码：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/home&quot;</span> &gt;</span>首页<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/about&quot;</span> &gt;</span>关于<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;userClick&quot;</span>&gt;</span>用户<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;profileClick&quot;</span>&gt;</span>概述<span class="tag">&lt;/<span class="name">button</span>&gt;</span>  <span class="comment">&lt;!--概述按钮--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">router-view</span>&gt;</span><span class="tag">&lt;/<span class="name">router-view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">  name: <span class="string">&#x27;App&#x27;</span>,</span></span><br><span class="line"><span class="javascript">  <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">      userID: <span class="string">&#x27;0000&#x27;</span>,</span></span><br><span class="line"><span class="javascript">      name: <span class="string">&#x27;花猪&#x27;</span>,</span></span><br><span class="line">      age: 18</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">userClick</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">this</span>.$router.push(<span class="string">&#x27;/user/&#x27;</span> + <span class="built_in">this</span>.userID)</span></span><br><span class="line">    &#125;,</span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">profileClick</span>(<span class="params"></span>)</span> &#123;  <span class="comment">//参数的传递方法跟在router-link中的写法一样</span></span></span><br><span class="line"><span class="javascript">      <span class="built_in">this</span>.$router.push(&#123;  <span class="comment">//push中也可以写入一个对象</span></span></span><br><span class="line"><span class="javascript">        path: <span class="string">&#x27;/profile&#x27;</span>,</span></span><br><span class="line">        query: &#123;</span><br><span class="line"><span class="javascript">          name: <span class="built_in">this</span>.name,</span></span><br><span class="line"><span class="javascript">          age: <span class="built_in">this</span>.age,</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<blockquote>
<p>利用方法进行路由跳转和参数传递的实现跟在<code>&lt;router-link&gt;</code>标签中的写法一致。</p>
</blockquote>
<blockquote>
<p>一般有大量的数据传递的时候用query的方式（因为可以传递对象）</p>
</blockquote>
<h3 id="导航守卫">导航守卫</h3>
<p>现在考虑这样一个需求，在进行路由跳转的同时改变页面的标题，这就需要导航守卫：</p>
<p>首先需要在<code>index.js</code>文件中的routes里对各个路由添加<code>meta</code>对象，里面存放着网页<code>title</code>信息：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">    redirect: <span class="string">&#x27;/home&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">&#x27;/home&#x27;</span>,</span><br><span class="line">    component: Home,</span><br><span class="line">    children: [</span><br><span class="line">      &#123;</span><br><span class="line">        path: <span class="string">&#x27;/&#x27;</span>,  </span><br><span class="line">    redirect: <span class="string">&#x27;news&#x27;</span>  </span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        path: <span class="string">&#x27;news&#x27;</span>,</span><br><span class="line">        component: News</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        path: <span class="string">&#x27;message&#x27;</span>,</span><br><span class="line">        component: Message</span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    meta: &#123;</span><br><span class="line">      title: <span class="string">&#x27;首页&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">&#x27;/about&#x27;</span>,</span><br><span class="line">    component: About,</span><br><span class="line">    meta: &#123;</span><br><span class="line">      title: <span class="string">&#x27;关于&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">&#x27;/user/:id&#x27;</span>,</span><br><span class="line">    component: User,</span><br><span class="line">    meta: &#123;</span><br><span class="line">      title: <span class="string">&#x27;用户&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">&#x27;/profile&#x27;</span>,</span><br><span class="line">    component: Profile,</span><br><span class="line">    meta: &#123;</span><br><span class="line">      title: <span class="string">&#x27;概述&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>然后在<code>index.js</code>文件中直接调用router对象中的<code>beforeEach</code>方法，该方法的参数是调用另一个方法，有三个参数（当路由进行跳转时就会调用这个函数）：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> VueRouter(&#123;</span><br><span class="line">  routes,</span><br><span class="line">  mode: <span class="string">&#x27;history&#x27;</span>,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">router.beforeEach(<span class="function">(<span class="params">to, <span class="keyword">from</span>, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">window</span>.document.title = to.meta.title</span><br><span class="line">  next()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>说明：</p>
<ul>
<li>
<p><code>to</code>就是跳转的路由实例，通过调用上一步在每个路由实例中添加的meta对象，可以获取到页面title。</p>
</li>
<li>
<p><code>next()</code>必须调用，内部可以填写其他路由。</p>
<p>由此判断可以实现拦截器的效果。</p>
<blockquote>
<p>官网：<a href="https://router.vuejs.org/zh/guide/advanced/navigation-guards.html#%E5%85%A8%E5%B1%80%E5%89%8D%E7%BD%AE%E5%AE%88%E5%8D%AB">导航守卫 | Vue Router (vuejs.org)</a></p>
</blockquote>
</li>
</ul>
</blockquote>
<p>效果如下：</p>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Vuerouter-导航守卫-show.gif" style="zoom:80%;" />
<p>这时有一个问题，即默认页面的标题显示的是undefined，页面也没有报错，于是尝试在控制台打印输出一下<code>to</code>对象：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">router.beforeEach(<span class="function">(<span class="params">to, <span class="keyword">from</span>, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">window</span>.document.title = to.meta.title</span><br><span class="line">  <span class="built_in">console</span>.log(to);  <span class="comment">//在控制台打印to对象</span></span><br><span class="line">  next()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>可以看到在home（默认）页面下的meta为空</p>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Vuerouter-导航守卫-show2.png" style="zoom:80%;" />
<p>但是在matched（列表）中，可以看到在列表的第一个元素中有meta对象，里面存在页面title（查看后发现其他页面同样如此）</p>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Vuerouter-导航守卫-show3.png" style="zoom:80%;" />
<p>于是调用matched中的title就可以了：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">router.beforeEach(<span class="function">(<span class="params">to, <span class="keyword">from</span>, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">window</span>.document.title = to.matched[<span class="number">0</span>].meta.title</span><br><span class="line">  next()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="导航守卫的补充">导航守卫的补充</h4>
<p>主要的有：</p>
<ul>
<li>全局前置守卫</li>
<li>全局解析守卫</li>
<li>全局后置钩子</li>
<li>路由独享的守卫</li>
<li>组件内的守卫</li>
</ul>
<p>关键就是在路由进行跳转的时候，可以自动实现的回调函数。（这里不做详细说明）具体用法见官网：<a href="https://router.vuejs.org/zh/guide/advanced/navigation-guards.html#%E5%85%A8%E5%B1%80%E5%89%8D%E7%BD%AE%E5%AE%88%E5%8D%AB">导航守卫 | Vue Router (vuejs.org)</a></p>
<h3 id="keep-alive标签">keep-alive标签</h3>
<h4 id="生命周期">生命周期</h4>
<p>在介绍<code>&lt;keep-alive&gt;</code>标签之前先要了解一下Vue中关于生命周期的函数：</p>
<table>
<thead>
<tr>
<th>生命周期函数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>beforeCreate()</td>
<td>组件被创建,但处于组件属性计算之前的状态，如data属性还未被加载</td>
</tr>
<tr>
<td>created()</td>
<td>组件实例创建完成，组件属性也已经绑定</td>
</tr>
<tr>
<td>beforeMount()</td>
<td>模板编译/挂载之前</td>
</tr>
<tr>
<td>mounted()</td>
<td>模板编译/挂载之后</td>
</tr>
<tr>
<td>beforeUpdate()</td>
<td>组件更新之前</td>
</tr>
<tr>
<td>updated()</td>
<td>组件更新之后</td>
</tr>
<tr>
<td>beforeDestroy()</td>
<td>组件销毁前调用</td>
</tr>
<tr>
<td>destroyed()</td>
<td>组件销毁后调用</td>
</tr>
<tr>
<td>activated()</td>
<td>组件处于活跃状态时调用（依赖于keep-alive标签）</td>
</tr>
<tr>
<td>deactivated()</td>
<td>组件处于非活跃状态时调用（依赖于keep-alive标签）</td>
</tr>
</tbody>
</table>
<p>下面以home（首页）为例来说明（函数直接在vue对象中创建）：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>我是首页<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>我是首页内容<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/home/news&quot;</span>&gt;</span>新闻<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/home/message&quot;</span>&gt;</span>消息<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">router-view</span>&gt;</span><span class="tag">&lt;/<span class="name">router-view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">    name: <span class="string">&quot;Home&quot;</span>,</span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line"></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">beforeCreate</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">&#x27;组件被创建,但处于组件属性计算之前的状态，如data属性还未被加载&#x27;</span>);</span></span><br><span class="line">    &#125;,</span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">created</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">&#x27;组件实例创建完成，组件属性也已经绑定&#x27;</span>);</span></span><br><span class="line">    &#125;,</span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">beforeMount</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">&#x27;模板编译/挂载之前&#x27;</span>);</span></span><br><span class="line">    &#125;,</span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">mounted</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">&#x27;模板编译/挂载之后&#x27;</span>);</span></span><br><span class="line">    &#125;,</span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">beforeUpdate</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">&#x27;组件更新之前&#x27;</span>);</span></span><br><span class="line">    &#125;,</span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">updated</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">&#x27;组件更新之后&#x27;</span>);</span></span><br><span class="line">    &#125;,</span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">beforeDestroy</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">&#x27;组件销毁前调用&#x27;</span>);</span></span><br><span class="line">    &#125;,</span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">destroyed</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">&#x27;组件销毁后调用&#x27;</span>);</span></span><br><span class="line">    &#125;,</span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">activated</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">&#x27;组件处于活跃状态时调用（依赖于keep-alive标签）&#x27;</span>);</span></span><br><span class="line">    &#125;,</span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">deactivated</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">&#x27;组件处于非活跃状态时调用（依赖于keep-alive标签）&#x27;</span>);</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>效果如下：</p>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Vuerouter-生命周期-show.gif" style="zoom:80%;" />
<h4 id="keep-alive">keep-alive</h4>
<p>由上图看以看出，在每点击一次路由跳转，原来的组件就会被销毁，进而创建一个新的组件，而如果想实现路由跳转后仍保留原有的状态，就需要<code>&lt;keep-alive&gt;</code>标签：</p>
<p>使用方式：只需要包裹要展示的<code>&lt;router-view&gt;</code>标签。</p>
<p><code>App.vue</code>文件：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/home&quot;</span> &gt;</span>首页<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/about&quot;</span> &gt;</span>关于<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;userClick&quot;</span>&gt;</span>用户<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;profileClick&quot;</span>&gt;</span>概述<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">keep-alive</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">router-view</span>&gt;</span><span class="tag">&lt;/<span class="name">router-view</span>&gt;</span>  <span class="comment">&lt;!--被keep-alive标签包裹--&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">keep-alive</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>效果如下：</p>
<ul>
<li><code>activated()</code>、<code>deactivated()</code>方法生效</li>
<li>跳转至新路由时组件不会销毁</li>
<li>重新返回该路由时不会重新创建</li>
</ul>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Vuerouter-生命周期-show2.gif" style="zoom:80%;" />
<p>由上图可以看出<code>&lt;router-view&gt;</code>标签产生了作用，但是这里有一个问题：</p>
<p>在跳转user（用户）之前的首页是处于home/message（消息）子路由的，然而重新回到首页之后又自动换为了默认的home/news（新闻）子路由。为了解决这一问题需要<code>activated()</code>函数以及<code>beforeRouteLeave()</code>函数（组件内的守卫），在首页路由离开前获取当前path信息，并进行更新：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>我是首页<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>我是首页内容<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/home/news&quot;</span>&gt;</span>新闻<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/home/message&quot;</span>&gt;</span>消息<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">router-view</span>&gt;</span><span class="tag">&lt;/<span class="name">router-view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">    name: <span class="string">&quot;Home&quot;</span>,</span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">        path: <span class="built_in">this</span>.$route.path  <span class="comment">//在最初加载时获取当前（活跃）路由的路径</span></span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">activated</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">this</span>.$router.push(<span class="built_in">this</span>.path);  <span class="comment">//当该路由重新处于活跃状态时，获取当前路径</span></span></span><br><span class="line">    &#125;,</span><br><span class="line"><span class="javascript">    beforeRouteLeave (to, <span class="keyword">from</span>, next) &#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">this</span>.path = <span class="built_in">this</span>.$route.path;  <span class="comment">//在跳转到其他路由之前，把当前路径状态进行保存</span></span></span><br><span class="line">      next()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>问题得到解决：</p>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Vuerouter-keepalive-show.gif" style="zoom:80%;" />
<p>此外，如果有一些路由不想对其进行状态保留，可以在<code>&lt;keep-alive&gt;</code>标签中添加<code>exclude</code>属性，例如：跳过对user（用户）和profile（概述）路由的状态保存。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/home&quot;</span> &gt;</span>首页<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/about&quot;</span> &gt;</span>关于<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;userClick&quot;</span>&gt;</span>用户<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;profileClick&quot;</span>&gt;</span>概述<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">keep-alive</span> <span class="attr">exclude</span>=<span class="string">&quot;User,Profile&quot;</span>&gt;</span>  <span class="comment">&lt;!--对用户和概述路由的状态不予保存--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">router-view</span>/&gt;</span>  <span class="comment">&lt;!--被keep-alive标签包裹--&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">keep-alive</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意：</p>
<ul>
<li><code>exclude</code>属性：其值为每个路由在最初创建时的<code>name</code>属性</li>
<li>如果在该属性中添加多个路由信息，逗号之间不允许存在空格（否则会出错）</li>
</ul>
</blockquote>
<hr>
<h1>后记</h1>
<p>可以分担后端的一部分压力。</p>
]]></content>
      <categories>
        <category>学习笔记</category>
      </categories>
      <tags>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue学习-Webpack</title>
    <url>/2021/08/08/Vue/Vue%E5%AD%A6%E4%B9%A0-Webpack/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\css\APlayer.min.css"><script src="\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\js\Meting.min.js"></script><h1>前言</h1>
<p>本文将介绍Webpack的使用。</p>
<hr>
<h1>Webpack</h1>
<h2 id="介绍">介绍</h2>
<p>从本质上来讲，webpack是一个现代的JavaScript应用的静态模块打包工具。</p>
<p>目前使用前端模块化的方案有：AMD、CMD、CommonJS、ES6</p>
<p>浏览器可以直接处理的模块化方式只有ES6，如果想使用其他模块化方式，并且需要处理模块间（JavaScript、CSS、图片、json文件等都可以被当作模块）的各种依赖，最后进行整合打包。Webpack可以帮助完成这一系列工作。</p>
<blockquote>
<p>Webpack在打包的过程中，会对资源进行处理，比如：压缩图片，将scss转成css，将ES6语法转成ES5语法，将TypeScript转成JavaScript等操作。</p>
</blockquote>
<h2 id="Webpack的安装">Webpack的安装</h2>
<p>Webpack依赖于Node环境，因此需要先安装Node.js（这里不做说明）。</p>
<p>开启终端，使用如下命令安装：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm install webpack -g</span><br></pre></td></tr></table></figure>
<p><code>-g</code>表示全局安装，此外还可以指定版本号：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm install webpack@3.6.0 -g</span><br></pre></td></tr></table></figure>
<p>局部安装：</p>
<figure class="highlight q"><table><tr><td class="code"><pre><span class="line">npm install webpack --<span class="built_in">save</span>-<span class="built_in">dev</span></span><br></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>在终端直接执行webpack命令，使用的全局安装的webpack</li>
<li>当在package.json中定义了scripts时，其中包含了webpack命令，那么使用的是局部webpack</li>
<li>通常会指定版本号</li>
</ul>
</blockquote>
<h2 id="前期准备">前期准备</h2>
<p>项目目录结构（如下图）：</p>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/WebPack-基础-目录结构.png" style="zoom:80%;" />
<ul>
<li><code>dist</code>文件夹：用于存放打包文件</li>
<li><code>src</code>文件夹：用于存放编写的源文件
<ul>
<li><code>main.js</code>：项目的入口文件</li>
<li><code>mathUtils.js</code>：定义了一些数学工具函数，可以在其他地方引用，并且使用</li>
</ul>
</li>
<li><code>index.html</code>：浏览器打开展示的首页html</li>
<li><code>package.json</code>：通过<code>npm init</code>生成，npm包管理的文件</li>
</ul>
<h2 id="基本使用">基本使用</h2>
<p>下面使用CommonJS模块化方式编写一组代码，并用Webpack打包</p>
<p>首先在<code>mathUtils.js</code>编写两个数学函数：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//加法</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">num1, num2</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> num1 + num2</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//乘法</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mul</span>(<span class="params">num1, num2</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> num1 * num2</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//导出</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  add,</span><br><span class="line">  mul</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后在<code>main.js</code>中导入并使用：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 使用commonjs的模块化规范</span></span><br><span class="line"><span class="keyword">const</span> &#123;add, mul&#125; = <span class="built_in">require</span>(<span class="string">&#x27;./mathUtils.js&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(add(<span class="number">20</span>, <span class="number">30</span>));</span><br><span class="line"><span class="built_in">console</span>.log(mul(<span class="number">20</span>, <span class="number">30</span>));</span><br></pre></td></tr></table></figure>
<p>由于使用的是commonjs的模块化规范，因此不能直接放入<code>index.html</code>中使用，这时就需要Webpack打包。打开终端，进入项目路径，键入如下命令：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">webpack .\src\main.js .\dist\bundle.js</span><br></pre></td></tr></table></figure>
<blockquote>
<p>命令指明了入口文件和输出的文件名（后面会配置文件，简化打包的命令）。</p>
</blockquote>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/WebPack-基础-打包.png" style="zoom:80%;" />
<p>于是在<code>dist</code>目录下生成了<code>bundle.js</code>文件，可以在<code>index.html</code>中使用：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--index.html--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./dist/bundle.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>此外，后续项目中会用到Node的一些包，所以要在终端中键入如下命令：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm init</span><br></pre></td></tr></table></figure>
<p>之后会输入一些项目的信息，完成后会在项目路径下生成<code>package.json</code>文件。</p>
<h2 id="配置">配置</h2>
<p>在实际项目中一般不会直接用到<code>webpack</code>命令，这样会直接找全局的webpack，然而不同的项目可能会用到不同的版本，因此在使用的时候一般会在项目中下载一个本地的webpack（版本号与项目中的一致，否则不同版本有可能会报错）。因此就需要配置一些文件。</p>
<h3 id="webpack-config-js">webpack.config.js</h3>
<p>手动创建<code>webpack.config.js</code>文件：</p>
<p>利用webpack打包的时候在命令中需要指明入口以及输出文件名，这里会在<code>webpack.config.js</code>文件中做映射，以简化命令：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: <span class="string">&#x27;./src/main.js&#x27;</span>,</span><br><span class="line">  output: &#123;</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">&#x27;dist&#x27;</span>),</span><br><span class="line">    filename: <span class="string">&#x27;bundle.js&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>说明：</p>
<ul>
<li><code>const path = require('path')</code>是利用了node中的函数，用来获取项目路径</li>
<li><code>entry</code>：设置了项目打包的入口</li>
<li><code>output</code>：为一个对象类型。<code>path</code>参数利用<code>path.resolve(__dirname, 'dist')</code>指明了打包的输出路径（项目的绝对路径（<code>__dirname</code>）关联自定义路径<code>dist</code>）。<code>output</code>规定必须使用绝对路径</li>
<li><code>filename</code>：指明了打包的输出文件</li>
<li>由此在终端键入<code>webpack</code>命令（无需指定入口文件和输出的文件名）即可进行项目源码的打包</li>
</ul>
</blockquote>
<h3 id="package-json">package.json</h3>
<p>在终端键入命令<code>npm init</code>得到<code>package.json</code>文件：</p>
<p>其中的<code>scripts</code>参数及为终端命令<code>npm run xxx</code>的映射。</p>
<p>比如在其中设置<code>&quot;build&quot;: &quot;webpack&quot;</code>关联数据：</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&quot;scripts&quot;: &#123;</span><br><span class="line">    &quot;test&quot;: &quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;,</span><br><span class="line">    &quot;build&quot;: &quot;webpack&quot;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>即在终端键入<code>npm run build</code>就可以执行<code>webpack</code>命令（会优先寻找本地webpack）。</p>
<blockquote>
<p>之后都是使用<code>npm run xxx</code>格式的命令。</p>
</blockquote>
<h3 id="本地webpack">本地webpack</h3>
<p>在实际项目中通常会在项目根路径下下载本地webpack，其版本号应该同项目一致（否则会出错）。</p>
<p>打开终端，进入项目目录，键入如下命令：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm install webpack@版本号 --save-dev</span><br></pre></td></tr></table></figure>
<p>然后就会在项目的根目录下生成<code>node_modules</code>文件夹，里面是webpack的一些包。</p>
<p>在<code>package.json</code>文件中会自动生成<code>devDependencies</code>参数，里面是下载的webpack的版本号。</p>
<h2 id="loader的使用">loader的使用</h2>
<p>loader是webpack中一个非常核心的概念。</p>
<p>在实际项目开发中不仅有js代码的处理，还需要加载css、图片，也包括一些高级的将ES6转成ES5代码，将TypeScript转成ES5代码，将scss、less转成css，将.jsx、.vue文件转成js文件等等。然而对于webpackp本身的能力来说，对于这些转化是不支持的。</p>
<p>但是可以通过给webpack扩展对应的loader去实现。</p>
<p>loader的使用步骤：</p>
<ol>
<li>
<p>通过npm安装需要使用的loader</p>
<blockquote>
<p>官网：<a href="https://www.webpackjs.com/loaders/">loaders | webpack 中文网 (webpackjs.com)</a></p>
</blockquote>
</li>
<li>
<p>在<code>webpack.config.js</code>中的<code>module</code>关键字下进行配置</p>
</li>
</ol>
<h3 id="css文件处理">css文件处理</h3>
<p>需要同时配置<a href="https://www.webpackjs.com/loaders/css-loader"><code>css-loader</code></a> 和<a href="https://www.webpackjs.com/loaders/style-loader"><code>style-loader</code></a></p>
<p>假设在项目的根路径下创建一个名为<code>css</code>的文件夹，里面新建一个名为<code>normal.css</code>的文件。</p>
<p>要想使用该css样式，首先需要在<code>main.js</code>（打包的入口文件）中引用：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;./css/normal.css&#x27;</span>)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意： require是Commonjs的引入规范。</p>
</blockquote>
<p>接下来需要打开终端，到项目的根路径下，按照官网的命令键入：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm install --save-dev css-loader</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm install style-loader --save-dev</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意：</p>
<ul>
<li>
<p>只下载<code>css-loader</code>仅可以实现打包时对css文件的引用，但是具体的效果展示，还需要下载<code>style-loader</code></p>
</li>
<li>
<p>同样的，在下载的时候也可以在指定版本号，格式：<code>xxx-loader@版本号</code>，以2.0.2版本的<code>css-loader</code>为例：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm install --save-dev css-loader@2.0.2</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>键入命令，下载完成后，同样地会在<code>package.json</code>的<code>devDependencies</code>关键词下自动生成下载的依赖以及版本号</p>
</li>
</ul>
</blockquote>
<p>接下来需要手动在<code>webpack.config.js</code>中的<code>module</code>关键字下进行配置，官网会给出详细的配置：</p>
<p><img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/WebPack-loader-css.png" alt=""></p>
<p>把<code>rules</code>的部分粘贴到配置文件的相应位置即可。</p>
<blockquote>
<p>注意：</p>
<p>use列表的读取顺序是自右向左，正常顺序是先加载<code>css-loader</code>，后加载<code>style-loader</code>，这一顺序不可颠倒。</p>
</blockquote>
<p>最后就可以通过命令打包css文件了。</p>
<h3 id="less、scss、stylus等文件处理">less、scss、stylus等文件处理</h3>
<p>步骤同上一个css文件处理类似，只不过这里额外说明一点：在官网中的use列表中可以看到loader元素还可以为对象属性，以便于后面添加各种options选项。当然按照上面的方法（直接写<code>xxx-loader</code>）也是可以的。</p>
<p><img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/WebPack-loader-less.png" alt=""></p>
<h3 id="图片文件处理">图片文件处理</h3>
<h4 id="操作">操作</h4>
<blockquote>
<p>注意：图片文件的处理依然要用到<code>css-loader</code>和<code>style-loader</code>。</p>
</blockquote>
<p>前期准备：</p>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/WebPack-loader-pic1.png" style="zoom:80%;" />
<p>如上图，在src文件夹下分别创建<code>css</code>和<code>img</code>文件夹，其中<code>css</code>文件夹中创建一个名为<code>normal.css</code>的文件，里面是对图片的引用。img文件下有两张图片，其中<code>pic3k.jpg</code>图片大小为3kb，<code>pic15k.jpg</code>图片大小为15kb。</p>
<p><code>normal.css</code>的代码如下（先引用<code>pic3k.jpg</code>）：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">url</span>(<span class="string">&quot;../img/pic3k.jpg&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>main.js</code>引用<code>normal.css</code>文件：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;./css/normal.css&#x27;</span>)</span><br></pre></td></tr></table></figure>
</blockquote>
<p>根据官网，在终端键入如下命令下载<a href="https://www.webpackjs.com/loaders/url-loader"><code>url-loader</code></a>（注意版本号）：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm install --save-dev url-loader</span><br></pre></td></tr></table></figure>
<p>在<code>webpack.config.js</code>文件中手动配置规则</p>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/WebPack-loader-pic2gai.png" style="zoom:80%;" />
<blockquote>
<p>其中：</p>
<ul>
<li><code>test</code>可以配置图片后缀名</li>
<li><code>limit</code>为图片大小（默认为8kb（8192bit））</li>
</ul>
</blockquote>
<p>然后运行webpack打包，就可以看到效果（如下图）</p>
<p><img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/WebPack-loader-pic3.png" alt=""></p>
<p>查看背景图片样式可以看到，图片被自动转化为了base64编码的字符串，在打包文件夹内并未有图片<code>pic3k.jpg</code>，查看出口文件<code>bundle.js</code>可以看到该图片的base64编码。</p>
<p><img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/WebPack-loader-pic4.png" alt=""></p>
<p>当然上述图片转化的情况仅限于图片文件大小小于设定值（8kb），如果引入较大的图片效果则不一样。</p>
<p>如下代码所示，这次引入的图片大小为15kb（大于设定值大小）</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">url</span>(<span class="string">&quot;../img/pic15k.jpg&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>再次运行webpack打包，可以看到报错信息：找不到<code>file-loader</code></p>
<blockquote>
<ul>
<li>当加载的图片, 小于设置大小时, 会将图片编译成base64字符串形式</li>
<li>当加载的图片, 大于设置大小时, 需要使用<code>file-loader</code>模块进行加载</li>
</ul>
</blockquote>
<p><img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/WebPack-loader-pic5.png" alt=""></p>
<p>于是我们需要查看官网，在终端键入如下命令引入<a href="https://www.webpackjs.com/loaders/file-loader"><code>file-loader</code></a>（注意版本号）：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm install --save-dev file-loader</span><br></pre></td></tr></table></figure>
<p>在<code>webpack.config.js</code>文件中手动配置规则：</p>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/WebPack-loader-pic6.png" style="zoom:80%;" />
<blockquote>
<p>注意：这里的配置可以省略。</p>
</blockquote>
<p>然后运行webpack打包，执行成功。但是打开<code>index.html</code>，会发现并没有载入图片，查看后发现报错信息：图片找不到。</p>
<p><img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/WebPack-loader-pic7.png" alt=""></p>
<p>实际上，一旦图片大小超出设置格式，就不会转换为base64编码格式，可以在打包输出文件夹看到一个以hash编码命名（避免命名重复）的图片文件，即要引入的图片：</p>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/WebPack-loader-pic8.png" style="zoom:80%;" />
<p>实际上不加以设置，<code>index.html</code>引用的图片路径为同级目录（项目根目录），但是打包后的图片在输出文件夹<code>dist</code>中，自然无法找到，因此需要设置访问图片图片的路径。</p>
<p><img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Vue%E7%BB%84%E4%BB%B6%E5%8C%96-webpack-pic9.gif" alt=""></p>
<p>在<code>webpack.config.js</code>文件中的<code>output</code>项添加<code>publicPath</code>属性，内容为打包输出目录（这里的输出目录为<code>dist</code>）：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">output: &#123;</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">&#x27;dist&#x27;</span>),</span><br><span class="line">    filename: <span class="string">&#x27;bundle.js&#x27;</span>,</span><br><span class="line">    publicPath: <span class="string">&#x27;dist/&#x27;</span></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>最后再重新打包，成功。</p>
<blockquote>
<p>注意：</p>
<p>当然这只是在测试阶段添加的属性。一般在项目移植的时候会将<code>index.html</code>文件也移至打包输出文件夹中，这时图片的就同<code>index.html</code>文件在同一目录下，自然就需要将<code>publicPath</code>删除。</p>
</blockquote>
<h4 id="图片的命名">图片的命名</h4>
<p>默认打包后图片命名为32为的hash值（为了避免命名重复），但实际上在图片数量很多的时候我们希望能通过图片文件的命名一眼看出是哪一张，方便测试、维护。此外如果所有的图片都堆到输出文件夹（无子文件夹）会显得很乱，也不方便后期的维护。所以需要对图片进行命名和路径的规范。</p>
<p>在在<code>webpack.config.js</code>文件中的<code>url-loader</code>的<code>rules</code>规范中，在<code>options</code>中添加<code>name</code>属性：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">        test: <span class="regexp">/\.(png|jpg|gif|jpeg)$/</span>,</span><br><span class="line">        use: [</span><br><span class="line">          &#123;</span><br><span class="line">            loader: <span class="string">&#x27;url-loader&#x27;</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              limit: <span class="number">8192</span>,</span><br><span class="line">              name: <span class="string">&#x27;img/[name].[hash:8].[ext]&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>说明：</p>
<ul>
<li><code>img/</code>：图片文件会存放在输出目录下的<code>img</code>文件夹中</li>
<li><code>[name].[hash:8].[ext]</code>：文件的命名规范，表示<code>原文件名.8位hash值.原文件扩展名</code></li>
</ul>
</blockquote>
<h3 id="ES6语法处理">ES6语法处理</h3>
<p>在之前webpack打包的时候，用到的都是ES6的语法，为了获得更好的兼容性，有时需要ES5的语法（某些浏览器并不支持ES6），因此需要对其进行处理。</p>
<p>在官网下载<a href="https://www.webpackjs.com/loaders/babel-loader/"><code>babel-loader</code></a> ，由于已经有webpack，因此只需要下载：</p>
<ul>
<li>
<p><code>babel-loader</code></p>
</li>
<li>
<p><code>babel-core</code></p>
</li>
<li>
<p><code>babel-preset-es2015</code></p>
<blockquote>
<p>说明：官网下载的是<code>babel-preset-env</code>，它会寻找<code>.babelrc</code>文件（需要配置），这里暂时只需要es6相关的服务，因此下载<code>babel-preset-es2015</code>（同样注意指定版本）</p>
</blockquote>
</li>
</ul>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/WebPack-loader-bable1.png" style="zoom:80%;" />
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm install --save-dev babel-loader babel-core babel-preset-es2015</span><br></pre></td></tr></table></figure>
<p>在<code>webpack.config.js</code>文件中添加配置项：</p>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/WebPack-loader-bable2.png" style="zoom:80%;" />
<p>注意<code>presets</code>中指定的应该为<code>'es2015'</code></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">        test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">        exclude: <span class="regexp">/(node_modules|bower_components)/</span>,</span><br><span class="line">        use: &#123;</span><br><span class="line">          loader: <span class="string">&#x27;babel-loader&#x27;</span>,</span><br><span class="line">          options: &#123;</span><br><span class="line">            presets: [<span class="string">&#x27;es2015&#x27;</span>]</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>说明：<code>exclude</code>配置项指打包时不包含<code>node_modules</code>和<code>bower_components</code>文件夹下的内容。</p>
</blockquote>
<p>执行webpack打包，会发现打包文件中均为ES5的语法。</p>
<h2 id="引入Vue-js">引入Vue.js</h2>
<h3 id="基本使用-2">基本使用</h3>
<p>下面来介绍在webpack环境中集成Vue.js。</p>
<p>只需进入项目根目录，在终端键入如下命令：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm install vue --save</span><br></pre></td></tr></table></figure>
<blockquote>
<p>说明：</p>
<ul>
<li>因为后续在实际项目中也会使用vue的，所以并不是开发时依赖，因此没有<code>-dev</code></li>
<li>可以指定版本</li>
</ul>
</blockquote>
<p>然后在<code>index.html</code>写入Vue实例（模板）：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;cpn&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h2</span>&gt;</span>&#123;&#123;message&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>接下来在<code>main.js</code>文件中引入Vue并创建Vue对象：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> vue = <span class="keyword">new</span> Vue (&#123;</span><br><span class="line">  el: <span class="string">&#x27;#cpn&#x27;</span>,</span><br><span class="line">  data: &#123;</span><br><span class="line">    message: <span class="string">&#x27;Hello Webpack&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>说明：</p>
<p>实际上下载的Vue源码中其导出为：<code>export default Vue;</code>，因此直接使用<code>import Vue from &quot;vue&quot;;</code>导入语句即可。</p>
</blockquote>
<p>最后webpack打包，执行，打包过程并未有误，但是在实际<code>index.html</code>现实中会出现如下报错信息：</p>
<p><img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/WebPack-vue-%E5%AF%BC%E5%85%A51.png" alt=""></p>
<blockquote>
<p>说明：这里涉及到<a href="https://cn.vuejs.org/v2/guide/installation.html#%E5%AF%B9%E4%B8%8D%E5%90%8C%E6%9E%84%E5%BB%BA%E7%89%88%E6%9C%AC%E7%9A%84%E8%A7%A3%E9%87%8A">Vue不同版本构建</a></p>
<ul>
<li>
<p><code>runtime-only</code>：代码中，不可以有任何的template</p>
<blockquote>
<p>在之前<code>index.html</code>文件里编写的<code>&lt;div&gt;</code>标签就是Vue实例的template</p>
</blockquote>
</li>
<li>
<p><code>runtime-compiler</code>：代码中，可以有template，因为有compiler可以编译template</p>
</li>
</ul>
<p>现在的错误信息是使用了<code>runtime-only</code>，但是却想编译template，显然是不可以的。</p>
</blockquote>
<p>解决方案：</p>
<p>在<code>webpack.config.js</code>文件中添加<code>resolve</code>配置信息：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: <span class="string">&#x27;./src/main.js&#x27;</span>,</span><br><span class="line">  output: &#123;</span><br><span class="line">    ...</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    ...</span><br><span class="line">  &#125;,</span><br><span class="line">  resolve: &#123;</span><br><span class="line">    alias: &#123;</span><br><span class="line">      <span class="string">&#x27;vue$&#x27;</span>: <span class="string">&#x27;vue/dist/vue.esm.js&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>使得每次在使用vue的时候会查找指定的文件</p>
<p>（默认情况下使用的是<code>vue/dist/vue.runtime.js</code>）</p>
</blockquote>
<p>重新webpack打包，成功显示。</p>
<h3 id="el和template">el和template</h3>
<p>后期在重新调整显示样式时候，需要重新修改<code>index.html</code>文件中定义的模板，但是在之后的开发中，并不希望手动频繁的去修改html模板，因此在创建Vue对象时，可以定义<code>template</code>属性：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> Vue (&#123;</span><br><span class="line">  el: <span class="string">&#x27;#cpn&#x27;</span>,</span><br><span class="line">  template: <span class="string">`</span></span><br><span class="line"><span class="string">  &lt;div&gt;</span></span><br><span class="line"><span class="string">    &lt;h2&gt;&#123;&#123;message&#125;&#125;&lt;/h2&gt;</span></span><br><span class="line"><span class="string">  &lt;/div&gt;</span></span><br><span class="line"><span class="string">  `</span>,</span><br><span class="line">  data: &#123;</span><br><span class="line">    message: <span class="string">&#x27;Hello Webpack&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>说明：一般在使用的时候可以省略Vue对象的命名，可以直接new。</p>
</blockquote>
<p>在前端<code>index.html</code>代码中直接写<code>&lt;div&gt;</code>标签即可：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;cpn&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>在vue对象中的<code>el</code>属性用于绑定相应的标签，在打包的时候，vue会将<code>template</code>的内容自动替换至前端绑定的标签上。</p>
<p>使用webpack打包后，运行查看：</p>
<p><img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/WebPack-vue-%E5%AF%BC%E5%85%A52.png" alt=""></p>
<h2 id="Vue组件化引入">Vue组件化引入</h2>
<p>下面来介绍Vue组件化的引入，会把模板等单独抽离，使得项目结构看起来更为清晰。</p>
<p>首先在<code>index.html</code>文件中新建一个id为app的<code>&lt;div&gt;</code>标签，作为Vue实例</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>然后在<code>src</code>路径下新建一个名为<code>vue</code>的文件夹，用于存放vue文件</p>
<p>在其中新建一个名为<code>App.vue</code>的文件：</p>
<p>如果使用<code>WebStorm</code>编辑器，可以在新建文件中找到Vue类型：</p>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/WebPack-vue-组件化1.png" style="zoom:80%;" />
<p>点击创建后会自动生成如下模板：</p>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/WebPack-vue-组件化2.png" style="zoom:80%;" />
<blockquote>
<p>说明：</p>
<ul>
<li>
<p><code>&lt;template&gt;</code>：用于书写模板</p>
</li>
<li>
<p><code>&lt;script&gt;</code>：用于创建Vue对象，并通过<code>export default</code>默认导出</p>
</li>
<li>
<p><code>&lt;style&gt;</code>：可编写css代码</p>
<p><code>style</code>标签默认有<code>scoped</code>属性：该属性是一个布尔属性，如果使用该属性，则样式仅仅应用到 style 元素的父元素及其子元素。</p>
</li>
</ul>
</blockquote>
<p>为了更好的体现模块化的思想，我们再创建一个名为<code>Cpn.vue</code>的文件，为子组件。写入以下内容：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span> <span class="attr">class</span>=<span class="string">&quot;cpnTitle&quot;</span>&gt;</span>&#123;&#123;title&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123;message&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">    name: <span class="string">&quot;Cpn&quot;</span>,</span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">        name: <span class="string">&quot;Cpn&quot;</span>,</span></span><br><span class="line"><span class="javascript">        title: <span class="string">&quot;我是cpn子组件的标题&quot;</span>,</span></span><br><span class="line"><span class="javascript">        message: <span class="string">&quot;我是cpn子组件的内容&quot;</span>,</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span></span><br><span class="line">  .cpnTitle &#123;</span><br><span class="line"><span class="css">    <span class="attribute">color</span>: green;</span></span><br><span class="line">  &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>在<code>App.vue</code>中写入以下内容：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span> <span class="attr">class</span>=<span class="string">&quot;appTitle&quot;</span>&gt;</span>&#123;&#123;title&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123;message&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;btnClick&quot;</span>&gt;</span>点击弹框<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Cpn</span>/&gt;</span>  <span class="comment">&lt;!--子组件--&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="comment">//导入子组件</span></span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> Cpn <span class="keyword">from</span> <span class="string">&#x27;./Cpn.vue&#x27;</span></span></span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">    name: <span class="string">&quot;App&quot;</span>,</span></span><br><span class="line">    components: &#123;</span><br><span class="line"><span class="javascript">      Cpn: Cpn  <span class="comment">//注册子组件</span></span></span><br><span class="line">    &#125;,</span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">        name: <span class="string">&#x27;App&#x27;</span>,</span></span><br><span class="line"><span class="javascript">        title: <span class="string">&#x27;我是app父组件的标题&#x27;</span>,</span></span><br><span class="line"><span class="javascript">        message: <span class="string">&#x27;我是app父组件的内容&#x27;</span></span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">btnClick</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">        alert(<span class="string">&#x27;app父组件按钮&#x27;</span>)</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span></span><br><span class="line">  .appTitle &#123;</span><br><span class="line"><span class="css">    <span class="attribute">color</span>: brown;</span></span><br><span class="line">  &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>说明：</p>
<p>在<code>&lt;script&gt;</code>用<code>import Cpn from './Cpn.vue'</code>导入子组件，并在<code>components</code>中进行注册。</p>
</blockquote>
<p>在<code>main.js</code>中写入以下内容：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">&#x27;./vue/App.vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  el: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">  template: <span class="string">&#x27;&lt;App/&gt;&#x27;</span>,</span><br><span class="line">  components: &#123;</span><br><span class="line">    App: App</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>说明：</p>
<ul>
<li>
<p>在引入App.vue时可以省略扩展名，只需要在<code>webpack.config.js</code>文件中的<code>resolve</code>关键词中添加<code>extensions</code>配置（<code>.[ext]</code>表示可以在引入时省略的扩展名）：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">resolve: &#123;</span><br><span class="line">    extensions: [<span class="string">&#x27;.js&#x27;</span>, <span class="string">&#x27;.css&#x27;</span>, <span class="string">&#x27;.vue&#x27;</span>],</span><br><span class="line">    alias: &#123;</span><br><span class="line">      <span class="string">&#x27;vue$&#x27;</span>: <span class="string">&#x27;vue/dist/vue.esm.js&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><code>template</code>可以直接写标签以引用模板</p>
</li>
</ul>
</blockquote>
<p>这时vue组件在打包时还不能够被正确的解析加载，需要下载<code>vue-loader</code>和<code>vue-template-compiler</code>：<a href="https://vue-loader.vuejs.org/zh/#vue-loader-%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F">介绍 | Vue Loader (vuejs.org)</a></p>
<p>在终端键入如下命令（注意版本号）：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm install vue-loader vue-template-compiler --save-dev</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意：下载后在最后webpack打包的时候可能出现错误。</p>
<p>解决方案：</p>
<ul>
<li>在vue-loader14版本之后开始需要配置额外的插件</li>
<li>尝试使用较低的版本（可以尝试使用13的版本）</li>
</ul>
</blockquote>
<p>在<code>webpack.config.js</code>文件中配置信息：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">        test: <span class="regexp">/\.vue$/</span>,</span><br><span class="line">        use: [<span class="string">&#x27;vue-loader&#x27;</span>]</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>
<p>最后webpack打包，运行得到展示效果。</p>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/WebPack-vue-组件化3.png" style="zoom:80%;" />
<h2 id="Plugin使用">Plugin使用</h2>
<p>webpack中的插件，就是对webpack现有功能的各种扩展。</p>
<p>使用步骤：</p>
<ol>
<li>
<p>通过npm安装需要使用的plugins</p>
<blockquote>
<p>某些webpack已经内置的插件不需要安装</p>
</blockquote>
</li>
<li>
<p>在<code>webpack.config.js</code>中的plugins中配置插件</p>
</li>
</ol>
<h3 id="BannerPlugin">BannerPlugin</h3>
<p><code>BannerPlugin</code>属于webpack自带的插件，用于为打包文件做版权声明。</p>
<p>由于是webpack自带的插件，因此在<code>webpack.config.js</code>文件的首部引入webpack：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">&#x27;webpack&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>然后在<code>module.exports</code>模块中添加BannerPlugin的配置信息：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: <span class="string">&#x27;./src/main.js&#x27;</span>,</span><br><span class="line">  output: &#123;</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">&#x27;dist&#x27;</span>),</span><br><span class="line">    filename: <span class="string">&#x27;bundle.js&#x27;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  ...,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> webpack.BannerPlugin(<span class="string">&#x27;最终版权归花猪所有&#x27;</span>)</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意：plugins为列表。</p>
</blockquote>
<p>重新webpack打包，就可以在输出文件首部看到版权信息：</p>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/WebPack-plugin-banner.png" style="zoom:80%;" />
<h3 id="html-webpack-plugin">html-webpack-plugin</h3>
<p>目前，<code>index.html</code>文件是直接存放在项目根目录下的，但是项目发布时会发布之前设定的输出文件夹<code>dist</code>，所以希望该文件下可以自动生成<code>index.html</code>文件。</p>
<p>首先需要安装该插件，打开终端，进入项目目录，键入如下命令（注意版本号）：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm install html-webpack-plugin --save-dev</span><br></pre></td></tr></table></figure>
<p>下载完之后可以看到在打包输出文件夹<code>dist</code>中自动生成了<code>index.html</code>文件。</p>
<p>但是有些地方我们还需要做一些修改：</p>
<p>首先在项目根目录下的<code>index.html</code>文件中删去js文件的引入（这个在打包后会自动生成）：</p>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/WebPack-plugin-html1.png" style="zoom:80%;" />
<p>然后在<code>webpack.config.js</code>文件中的<code>output</code>模块中删除<code>publicPath</code>信息（如果有的话）：</p>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/WebPack-plugin-html2.png" style="zoom:80%;" />
<p>接着在<code>webpack.config.js</code>文件的首部引入<code>HtmlWebpackPlugin</code>：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">&#x27;html-webpack-plugin&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>最后在<code>module.exports</code>模块中添加该插件的配置信息：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: <span class="string">&#x27;./src/main.js&#x27;</span>,</span><br><span class="line">  output: &#123;</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">&#x27;dist&#x27;</span>),</span><br><span class="line">    filename: <span class="string">&#x27;bundle.js&#x27;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  ...,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">      template: <span class="string">&#x27;index.html&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>template</code>：寻找<code>webpack.config.js</code>文件同级目录下的<code>index.html</code>文件作为模板。</p>
</blockquote>
<p>重新webpack打包，就可以看到打包输出文件夹<code>dist</code>中的<code>index.html</code>文件，点击正常运行。</p>
<h3 id="uglifyjs-webpack-plugin">uglifyjs-webpack-plugin</h3>
<p>在打包时，对js文件进行压缩处理（删去注释、空格、换行等），以减少文件大小。</p>
<p>首先安装该插件，打开终端进入项目目录，键入如下命令（注意版本号）：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm install uglifyjs-webpack-plugin --save-dev</span><br></pre></td></tr></table></figure>
<p>接着在<code>webpack.config.js</code>文件的首部引入<code>UglifyjsWebpackPlugin</code>：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> UglifyjsWebpackPlugin = <span class="built_in">require</span>(<span class="string">&#x27;uglifyjs-webpack-plugin&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>然后在<code>module.exports</code>模块中添加该插件的配置信息：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: <span class="string">&#x27;./src/main.js&#x27;</span>,</span><br><span class="line">  output: &#123;</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">&#x27;dist&#x27;</span>),</span><br><span class="line">    filename: <span class="string">&#x27;bundle.js&#x27;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  ...,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> UglifyjsWebpackPlugin()</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>重新webpack打包，就可以看到打包输出文件<code>bundle.js</code>的内容已经被压缩。</p>
<blockquote>
<p>注意：在开发阶段不建议使用此插件，因为在调试的时候会很麻烦，到最终发布时可以使用。</p>
</blockquote>
<h2 id="搭建本地服务器">搭建本地服务器</h2>
<p>之前在调试的时候都需要打包，一旦文件很多的情况下，对于调试来说是非常费时的，所以需要搭建一个本地服务器，类似于热部署，在修改源码之后无需刷新自动更新页面。</p>
<p>webpack提供了一个可选的本地开发服务器，这个本地服务器基于node.js搭建，内部使用express框架。</p>
<p>在使用前需要安装，打开终端，进入项目目录，键入如下命令（注意版本号）：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm install --save-dev webpack-dev-server</span><br></pre></td></tr></table></figure>
<p>在<code>webpack.config.js</code>文件的<code>module.exports</code>模块中添加<code>devServer</code>配置信息：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: <span class="string">&#x27;./src/main.js&#x27;</span>,</span><br><span class="line">  output: &#123;</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">&#x27;dist&#x27;</span>),</span><br><span class="line">    filename: <span class="string">&#x27;bundle.js&#x27;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  ...,</span><br><span class="line">  devServer: &#123;</span><br><span class="line">    contentBase: <span class="string">&#x27;./dist&#x27;</span>,</span><br><span class="line">    inline: <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>可选参数：</p>
<ul>
<li><code>contentBase</code>：为哪一个文件夹提供本地服务，默认是根文件夹</li>
<li><code>port</code>：端口号，默认8080</li>
<li><code>inline</code>：页面实时刷新</li>
<li><code>historyApiFallback</code>：在SPA页面中，依赖HTML5的history模式</li>
</ul>
<p><code>devServer</code>配置信息仅在调试时使用，如果是发布版本，应该抹除。</p>
</blockquote>
<p>在<code>package.json</code>中的<code>scripts</code>模块下添加启动服务命令：</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&quot;scripts&quot;: &#123;</span><br><span class="line">    &quot;test&quot;: &quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;,</span><br><span class="line">    &quot;build&quot;: &quot;webpack&quot;,</span><br><span class="line">    &quot;dev&quot;: &quot;webpack-dev-server --open&quot;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>说明：</p>
<p><code>--open</code>选项使得在启动服务后自动打开浏览器，也可以不添加。</p>
</blockquote>
<p>如此，键入<code>npm run dev</code>便可启动本地服务器，在改动源码时，浏览器会自动刷新。</p>
<h2 id="配置文件的分离">配置文件的分离</h2>
<p>在之前所有的开发时和发布时依赖的配置都在<code>webpack.config.js</code>文件中进行，这样会需要不停地修改配置文件，比较繁琐。由此希望将开发时和发布时依赖的配置进行分离。</p>
<p>首先下载插件，打开终端，进入项目目录，键入如下命令（注意版本号）：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm install webpack-merge --save-dev</span><br></pre></td></tr></table></figure>
<p>接下来就是分离配置文件的操作，首先在项目根目录创建一个<code>build</code>的文件夹，用于存放配置文件。接着在其中建立如下三个文件：</p>
<ul>
<li><code>base.config.js</code>：公共配置文件部分</li>
<li><code>dev.config.js</code>：开发时独有的配置文件部分</li>
<li><code>prod.config.js</code>：发布时独有的配置文件部分</li>
</ul>
<p>然后将原来的<code>webpack.config.js</code>配置文件中的内容按如上三个新建立的配置文件的功能进行粘贴。举例：</p>
<p><code>base.config.js</code>：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">&#x27;webpack&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">&#x27;html-webpack-plugin&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: <span class="string">&#x27;./src/main.js&#x27;</span>,</span><br><span class="line">  output: &#123;</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">&#x27;../dist&#x27;</span>),</span><br><span class="line">    filename: <span class="string">&#x27;bundle.js&#x27;</span>,</span><br><span class="line">    <span class="comment">// publicPath: &#x27;dist/&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        use: [ <span class="string">&#x27;style-loader&#x27;</span>, <span class="string">&#x27;css-loader&#x27;</span> ]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.less$/</span>,</span><br><span class="line">        use: [&#123;</span><br><span class="line">          loader: <span class="string">&quot;style-loader&quot;</span>,</span><br><span class="line">        &#125;, &#123;</span><br><span class="line">          loader: <span class="string">&quot;css-loader&quot;</span>,</span><br><span class="line">        &#125;, &#123;</span><br><span class="line">          loader: <span class="string">&quot;less-loader&quot;</span>,</span><br><span class="line">        &#125;]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.(png|jpg|gif|jpeg)$/</span>,</span><br><span class="line">        use: [</span><br><span class="line">          &#123;</span><br><span class="line">            loader: <span class="string">&#x27;url-loader&#x27;</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              limit: <span class="number">8192</span>,</span><br><span class="line">              name: <span class="string">&#x27;img/[name].[hash:8].[ext]&#x27;</span></span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">        exclude: <span class="regexp">/(node_modules|bower_components)/</span>,</span><br><span class="line">        use: &#123;</span><br><span class="line">          loader: <span class="string">&#x27;babel-loader&#x27;</span>,</span><br><span class="line">          options: &#123;</span><br><span class="line">            presets: [<span class="string">&#x27;es2015&#x27;</span>]</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.vue$/</span>,</span><br><span class="line">        use: [<span class="string">&#x27;vue-loader&#x27;</span>]</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  resolve: &#123;</span><br><span class="line">    extensions: [<span class="string">&#x27;.js&#x27;</span>, <span class="string">&#x27;.css&#x27;</span>, <span class="string">&#x27;.vue&#x27;</span>],</span><br><span class="line">    alias: &#123;</span><br><span class="line">      <span class="string">&#x27;vue$&#x27;</span>: <span class="string">&#x27;vue/dist/vue.esm.js&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> webpack.BannerPlugin(<span class="string">&#x27;最终版权归花猪所有&#x27;</span>),</span><br><span class="line">    <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">      template: <span class="string">&#x27;index.html&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>dev.config.js</code>：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> webpackMerge = <span class="built_in">require</span>(<span class="string">&#x27;webpack-merge&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> baseConfig = <span class="built_in">require</span>(<span class="string">&#x27;./base.config.js&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = webpackMerge(baseConfig, &#123;</span><br><span class="line">  devServer: &#123;</span><br><span class="line">    contentBase: <span class="string">&#x27;./dist&#x27;</span>,</span><br><span class="line">    inline: <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><code>prod.config.js</code>：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> UglifyjsWebpackPlugin = <span class="built_in">require</span>(<span class="string">&#x27;uglifyjs-webpack-plugin&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> webpackMerge = <span class="built_in">require</span>(<span class="string">&#x27;webpack-merge&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> baseConfig = <span class="built_in">require</span>(<span class="string">&#x27;./base.config.js&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = webpackMerge(baseConfig, &#123;</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> UglifyjsWebpackPlugin()</span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>说明：</p>
<p>在<code>dev.config.js</code>和<code>prod.config.js</code>需要先在首部导入<code>webpackMerge</code>：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> webpackMerge = <span class="built_in">require</span>(<span class="string">&#x27;webpack-merge&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>以及导入<code>base.config.js</code>文件：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> baseConfig = <span class="built_in">require</span>(<span class="string">&#x27;./base.config.js&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>然后按照上述格式将基本配置信息（baseConfig）和其他配置信息做结合。</p>
</blockquote>
<p>然后就可以删除原<code>webpack.config.js</code>配置文件了。</p>
<p>注意：</p>
<ul>
<li>
<p>在<code>base.config.js</code>文件中需要将<code>output</code>模块中的<code>path</code>信息做修改：</p>
<p><code>path: path.resolve(__dirname, '../dist')</code></p>
<p>以将打包输出文件仍然在根目录下的<code>dist</code>文件夹中（注意原来可能是<code>'./dist'</code>，这样则会在<code>build</code>文件夹下新建一个<code>dist</code>输出文件夹）</p>
</li>
<li>
<p>在<code>package.json</code>中需要修改调试和打包命令（否则默认寻找<code>webpack.config.js</code>文件，会报错）</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&quot;build&quot;: &quot;webpack --config ./build/prod.config.js&quot;,</span><br><span class="line">&quot;dev&quot;: &quot;webpack-dev-server --open --config ./build/dev.config.js&quot;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>如此，便可在不用修改配置的情况下键入<code>npm run dev</code>和<code>npm run build</code>正常进行启动本地服务和打包功能。</p>
<hr>
<h1>后记</h1>
<p>掌握了webpack的一些基本原理，对之后学习脚手架会更好理解。</p>
]]></content>
      <categories>
        <category>学习笔记</category>
      </categories>
      <tags>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue学习-基础语法</title>
    <url>/2021/08/02/Vue/Vue%E5%AD%A6%E4%B9%A0-%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\css\APlayer.min.css"><script src="\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\js\Meting.min.js"></script><h1>前言</h1>
<p>本文将介绍Vue的基础语法</p>
<hr>
<h1>补充ES6新特性</h1>
<h2 id="对象字面量的增强写法">对象字面量的增强写法</h2>
<p>在引入外部属性时可以直接写属性名：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> name = <span class="string">&#x27;why&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> age = <span class="number">18</span>;</span><br><span class="line"><span class="keyword">const</span> height = <span class="number">1.88</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  name,</span><br><span class="line">  age,</span><br><span class="line">  height,</span><br><span class="line">    </span><br><span class="line">  <span class="comment">//等价于下面的写法</span></span><br><span class="line">  <span class="comment">//name: name,</span></span><br><span class="line">  <span class="comment">//age: age,</span></span><br><span class="line">  <span class="comment">//height: height,</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(obj)</span><br></pre></td></tr></table></figure>
<p>在定义方法时可省略<code>function()</code>：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  <span class="function"><span class="title">run</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;奔跑中&#x27;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="title">eat</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;吃饭中&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">    </span><br><span class="line">  <span class="comment">//等价于下面的写法</span></span><br><span class="line">  run: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;奔跑中&#x27;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">  eat: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;吃饭中&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="let和const">let和const</h2>
<p><em>见下方</em></p>
<h1>基础语法</h1>
<h2 id="插值语法">插值语法</h2>
<h3 id="Mustache语法">Mustache语法</h3>
<p>最基本的vue的使用实例：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">  &#123;&#123;message&#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    el: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">    data: &#123;</span><br><span class="line">      message: <span class="string">&#x27;Hello Vue！&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意声明：</p>
<ul>
<li>let：声明一个变量（含块级作用域）</li>
<li>const：声明一个常量（第一次赋值之后不可更改）
<ul>
<li>在使用const定义时，必须进行赋值</li>
<li>常量的含义是指向的对象不能修改，但是对象的内部属性可以修改</li>
</ul>
</li>
<li>var：变量声明（不含块级作用域）</li>
</ul>
<p>建议在ES6开发中，优先使用const，只有需要改变某一个标识符的时候才使用let。</p>
</blockquote>
<p>在Mustache语法中，不仅仅可以直接写变量,也可以写简单的表达式：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">  &#123;&#123;firstName + lastName&#125;&#125;  <span class="comment">&lt;!--姓名紧挨着--&gt;</span></span><br><span class="line">  &#123;&#123;firstName + &#x27; &#x27; + lastName&#125;&#125;  <span class="comment">&lt;!--姓名之间有空格--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    el: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">    data: &#123;</span><br><span class="line">      firstName: <span class="string">&#x27;Kobe&#x27;</span>,</span><br><span class="line">      lastName: <span class="string">&#x27;Bryant&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>包括计算：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">  &#123;&#123;Number * 2&#125;&#125;  <span class="comment">&lt;!--显示200--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    el: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">    data: &#123;</span><br><span class="line">      <span class="built_in">Number</span>: <span class="number">100</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h3 id="v-once指令">v-once指令</h3>
<p>在Mustache语法中，只要改变了Vue实例中data的数据，那么相应的双大括号中被渲染的数据就会发生改变，但是如果我们希望前端展示的数据在只显示一次后便固定，不由data中数据修改而变化，这时就需要<code>v-once</code>：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h2</span> <span class="attr">v-once</span>&gt;</span>&#123;&#123;message&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h2</span>&gt;</span>&#123;&#123;message&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    el: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">    data: &#123;</span><br><span class="line">      message: <span class="string">&#x27;你好哇&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>如果在浏览器中输入<code>app.message = '李银河'</code>，则只有第二个内容会发生改变，如下图：</p>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Vue基础语法-v-once.png" style="zoom:80%;" />
<h3 id="v-html指令">v-html指令</h3>
<p>在展示url链接时需要用到<code>v-html</code>指令：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h2</span>&gt;</span>&#123;&#123;url&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span>  <span class="comment">&lt;!-- 将显示完整的字符串，不具备超链接效果 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h2</span> <span class="attr">v-html</span>=<span class="string">&quot;url&quot;</span>&gt;</span>这里的内容不会显示<span class="tag">&lt;/<span class="name">h2</span>&gt;</span>  <span class="comment">&lt;!-- 将显示&lt;a&gt;标签中的text文本 --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    el: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">    data: &#123;</span><br><span class="line">      url: <span class="string">&#x27;&lt;a href=&quot;http://www.baidu.com&quot;&gt;百度一下&lt;/a&gt;&#x27;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>效果如下：</p>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Vue基础语法-v-html.png" style="zoom:80%;" />
<h3 id="v-text指令">v-text指令</h3>
<p>如果只希望展示实例化Vue对象中data的数据，而不显示被标签包裹的text文本，则使用<code>v-text</code>指令：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h2</span>&gt;</span>&#123;&#123;message&#125;&#125;，李银河！<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h2</span> <span class="attr">v-text</span>=<span class="string">&quot;message&quot;</span>&gt;</span>，李银河！<span class="tag">&lt;/<span class="name">h2</span>&gt;</span>  <span class="comment">&lt;!--此处的text文本信息不显示--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    el: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">    data: &#123;</span><br><span class="line">      message: <span class="string">&#x27;你好哇&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h3 id="v-pre指令">v-pre指令</h3>
<p>如果只想展示<code>&#123;&#123;内容&#125;&#125;</code>，而不被Vue渲染显示数据，则使用<code>v-pre</code>指令：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h2</span>&gt;</span>&#123;&#123;message&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span>  <span class="comment">&lt;!--显示：你好哇--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h2</span> <span class="attr">v-pre</span>&gt;</span>&#123;&#123;message&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span>  <span class="comment">&lt;!--显示：&#123;&#123;message&#125;&#125;--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    el: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">    data: &#123;</span><br><span class="line">      message: <span class="string">&#x27;你好哇&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h3 id="v-cloak">v-cloak</h3>
<p>这个指令保持在元素上直到关联实例结束编译。和 CSS 规则如 <code>[v-cloak] &#123; display: none &#125;</code> 一起用时，这个指令可以隐藏未编译的 Mustache 标签直到实例准备完毕。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span> <span class="attr">v-cloak</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h2</span>&gt;</span>&#123;&#123;message&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">&lt;style&gt;</span><br><span class="line">  <span class="selector-attr">[v-cloak]</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: none;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="comment">// 在vue解析之前, div中有一个属性v-cloak</span></span><br><span class="line"><span class="comment">// 在vue解析之后, div中没有属性v-cloak</span></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    el: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">    data: &#123;</span><br><span class="line">      message: <span class="string">&#x27;你好啊&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;, <span class="number">1000</span>)  <span class="comment">//一秒后显示</span></span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h2 id="动态绑定属性">动态绑定属性</h2>
<h3 id="v-bind使用">v-bind使用</h3>
<p><code>v-bind</code>用于绑定html属性。</p>
<h4 id="基本使用">基本使用</h4>
<p>可以绑定img标签中的src链接：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">img</span> <span class="attr">v-bind:src</span>=<span class="string">&quot;imgURL&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;头像&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意避免错误写法：<code>&lt;img src=&quot;&#123;&#123;imgURL&#125;&#125;&quot; alt=&quot;&quot;&gt;</code></p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    el: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">    data: &#123;</span><br><span class="line">      imgURL: <span class="string">&#x27;https://cdn.jsdelivr.net/gh/CNhuazhu/Image/avatar.jpg&#x27;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>可以绑定超文本链接中的href链接：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">a</span> <span class="attr">:href</span>=<span class="string">&quot;aHref&quot;</span>&gt;</span>百度一下<span class="tag">&lt;/<span class="name">a</span>&gt;</span>  <span class="comment">&lt;!--语法糖表示--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    el: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">    data: &#123;</span><br><span class="line">      aHref: <span class="string">&#x27;http://www.baidu.com&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意v-bind的语法糖：直接用冒号表示</p>
<p>v-bind:src=“xxx”  &lt;==&gt; :src=“xxx”</p>
</blockquote>
<h4 id="动态绑定class（对象语法）">动态绑定class（对象语法）</h4>
<p><code>v-bind:class=&quot;&#123;类名1: boolean, 类名2: boolean&#125;&quot;</code></p>
<blockquote>
<p>注意：这里的value的值只能是布尔类型。当为true值时，该class属性存在；当为false时</p>
</blockquote>
<p>下面展示一个简单的点击按钮切换颜色的案例：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h2</span> <span class="attr">v-bind:class</span>=<span class="string">&quot;&#123;active1: isActive1, active2: isActive2&#125;&quot;</span>&gt;</span>&#123;&#123;message&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h2</span> <span class="attr">v-bind:class</span>=<span class="string">&quot;getClass()&quot;</span>&gt;</span>&#123;&#123;message&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span>  <span class="comment">&lt;!--使用函数返回class属性（效果同上）--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">v-on:click</span>=<span class="string">&quot;btnClick&quot;</span>&gt;</span>点击<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">&lt;style&gt;</span><br><span class="line">  <span class="selector-class">.active1</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: red;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-class">.active2</span> &#123;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">100px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    el: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">    data: &#123;</span><br><span class="line">      isActive1: <span class="literal">true</span>,</span><br><span class="line">      isActive2: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">      btnClick: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.isActive1 = !<span class="built_in">this</span>.isActive1</span><br><span class="line">        <span class="built_in">this</span>.isActive2 = !<span class="built_in">this</span>.isActive2</span><br><span class="line">      &#125;,</span><br><span class="line">      getClass: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="attr">active1</span>: <span class="built_in">this</span>.isActive1, <span class="attr">active2</span>: <span class="built_in">this</span>.isActive2&#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h4 id="动态绑定class（数组语法）">动态绑定class（数组语法）</h4>
<p><code>v-bind:class=&quot;[active1, active2]&quot;</code></p>
<blockquote>
<p>注意：利用数组直接赋予标签多个class属性，如果再另写其他的class属性，会自动合并。</p>
<p>区别：直接书写的形式一旦写成就会固定，而采用vue的这种方式可以在控制台动态修改属性。</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h2</span> <span class="attr">class</span>=<span class="string">&quot;title&quot;</span> <span class="attr">:class</span>=<span class="string">&quot;[active1, active2]&quot;</span>&gt;</span>&#123;&#123;message&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h2</span> <span class="attr">class</span>=<span class="string">&quot;title&quot;</span> <span class="attr">:class</span>=<span class="string">&quot;getClasses()&quot;</span>&gt;</span>&#123;&#123;message&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span>  <span class="comment">&lt;!--使用函数返回class属性（效果同上）--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    el: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">    data: &#123;</span><br><span class="line">      active1: <span class="string">&#x27;first&#x27;</span>,</span><br><span class="line">      active1: <span class="string">&#x27;second&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">      getClasses: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> [<span class="built_in">this</span>.active1, <span class="built_in">this</span>.active1]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h4 id="动态绑定style（对象语法）">动态绑定style（对象语法）</h4>
<p><code>v-bind:style=&quot;&#123;key: value&#125;&quot;</code></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h2</span> <span class="attr">v-bind:style</span>=<span class="string">&quot;&#123;fontSize: &#x27;50px&#x27;&#125;&quot;</span>&gt;</span>&#123;&#123;message&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span> <span class="comment">&lt;!-- 使用font-size会报错（与css不同） --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h2</span> <span class="attr">v-bind:style</span>=<span class="string">&quot;&#123;fontSize: finaleSize1&#125;&quot;</span>&gt;</span>&#123;&#123;message&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h2</span> <span class="attr">v-bind:style</span>=<span class="string">&quot;&#123;fontSize: finaleSize2 + &#x27;px&#x27;, color: finalColor&#125;&quot;</span>&gt;</span>&#123;&#123;message&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h2</span> <span class="attr">v-bind:style</span>=<span class="string">&quot;getStyle()&quot;</span>&gt;</span>&#123;&#123;message&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span>  <span class="comment">&lt;!--使用函数返回class属性（效果同上）--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意：</p>
<ul>
<li>使用字体大小时，key值为<code>fontSize</code>，使用<code>font-size</code>会报错（这与css不同）</li>
<li>在第一种表示中，50px必须被单引号所包裹，否则会被认为是一个名“50px”的变量，会报错</li>
</ul>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    el: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">    data: &#123;</span><br><span class="line">      message: <span class="string">&#x27;你好哇&#x27;</span>,</span><br><span class="line">      finaleSize1: <span class="string">&#x27;100px&#x27;</span>,  <span class="comment">//正常的字体大小的值应该被引号包裹，且带px单位</span></span><br><span class="line">      finaleSize2: <span class="number">150</span>,  <span class="comment">//如果采用数字，则另外需要加px单位</span></span><br><span class="line">      finalColor: <span class="string">&#x27;red&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">      getStyle: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="attr">fontSize</span>: <span class="built_in">this</span>.finaleSize2 + <span class="string">&#x27;px&#x27;</span>, <span class="attr">color</span>: <span class="built_in">this</span>.finalColor&#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h4 id="动态绑定style（数组语法）">动态绑定style（数组语法）</h4>
<p><code>v-bind:style=&quot;[Style1, Style2]&quot;</code></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h2</span> <span class="attr">:style</span>=<span class="string">&quot;[bgColor, fontSize]&quot;</span>&gt;</span>&#123;&#123;message&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    el: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">    data: &#123;</span><br><span class="line">      message: <span class="string">&#x27;你好哇&#x27;</span>,</span><br><span class="line">      bgColor: &#123;<span class="attr">backgroundColor</span>: <span class="string">&#x27;red&#x27;</span>&#125;,</span><br><span class="line">      fontSize: &#123;<span class="attr">fontSize</span>: <span class="string">&#x27;100px&#x27;</span>&#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h2 id="计算属性">计算属性</h2>
<p>在Vue实例化对象中，还有一个<code>computed</code>参数，内部依然是书写函数，但是返回值可以被当作同data参数中的一个属性值一样被使用。</p>
<h3 id="基本使用-2">基本使用</h3>
<p>下面编写一个获取书籍总价格的实例：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h2</span>&gt;</span>总价格: &#123;&#123;totalPrice&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    el: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">    data: &#123;</span><br><span class="line">      books: [</span><br><span class="line">        &#123;<span class="attr">id</span>: <span class="number">110</span>, <span class="attr">name</span>: <span class="string">&#x27;Unix编程艺术&#x27;</span>, <span class="attr">price</span>: <span class="number">119</span>&#125;,</span><br><span class="line">        &#123;<span class="attr">id</span>: <span class="number">111</span>, <span class="attr">name</span>: <span class="string">&#x27;代码大全&#x27;</span>, <span class="attr">price</span>: <span class="number">105</span>&#125;,</span><br><span class="line">        &#123;<span class="attr">id</span>: <span class="number">112</span>, <span class="attr">name</span>: <span class="string">&#x27;深入理解计算机原理&#x27;</span>, <span class="attr">price</span>: <span class="number">98</span>&#125;,</span><br><span class="line">        &#123;<span class="attr">id</span>: <span class="number">113</span>, <span class="attr">name</span>: <span class="string">&#x27;现代操作系统&#x27;</span>, <span class="attr">price</span>: <span class="number">87</span>&#125;,</span><br><span class="line">      ]</span><br><span class="line">    &#125;,</span><br><span class="line">    computed: &#123;</span><br><span class="line">      totalPrice: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">let</span> result = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i=<span class="number">0</span>; i &lt; <span class="built_in">this</span>.books.length; i++) &#123;</span><br><span class="line">          result += <span class="built_in">this</span>.books[i].price</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意：</p>
<p>很显然书写methods方法也可以实现同样的效果，但是computed计算属性会进行缓存，如果多次使用时，计算属性只会调用一次。</p>
<p>计算属性是按照属性去使用的，因此同方法的使用方式不同，不需要加括号()</p>
</blockquote>
<h3 id="getter和setter方法">getter和setter方法</h3>
<p>实际上在上一案例中直接以方法形式书写的计算属性是一种简写，本质上是调用了其get方法。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h2</span>&gt;</span>&#123;&#123;fullName&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    el: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">    data: &#123;</span><br><span class="line">      firstName: <span class="string">&#x27;Kobe&#x27;</span>,</span><br><span class="line">      lastName: <span class="string">&#x27;Bryant&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    computed: &#123;</span><br><span class="line">      fullName: &#123;</span><br><span class="line">        get: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="built_in">this</span>.firstName + <span class="string">&#x27; &#x27;</span> + <span class="built_in">this</span>.lastName</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="comment">// 等价于下面的简写方式</span></span><br><span class="line">      <span class="comment">// fullName: function () &#123;</span></span><br><span class="line">      <span class="comment">//   return this.firstName + &#x27; &#x27; + this.lastName</span></span><br><span class="line">      <span class="comment">// &#125;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>计算属性一般是没有set方法，是只读属性。但是如果需要也可以加入set方法，用于修改值：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    el: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">    data: &#123;</span><br><span class="line">      firstName: <span class="string">&#x27;Kobe&#x27;</span>,</span><br><span class="line">      lastName: <span class="string">&#x27;Bryant&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    computed: &#123;</span><br><span class="line">      fullName: &#123;</span><br><span class="line">        set: <span class="function"><span class="keyword">function</span>(<span class="params">newValue</span>) </span>&#123;  <span class="comment">//参数可以为空，这里接收参数是为了在控制台打印出来</span></span><br><span class="line">          <span class="built_in">console</span>.log(<span class="string">&#x27;修改为：&#x27;</span>, newValue);</span><br><span class="line">          <span class="keyword">const</span> names = newValue.split(<span class="string">&#x27; &#x27;</span>);  <span class="comment">//字符串按照空格分割</span></span><br><span class="line">          <span class="built_in">this</span>.firstName = names[<span class="number">0</span>];</span><br><span class="line">          <span class="built_in">this</span>.lastName = names[<span class="number">1</span>];</span><br><span class="line">        &#125;,</span><br><span class="line">        get: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="built_in">this</span>.firstName + <span class="string">&#x27; &#x27;</span> + <span class="built_in">this</span>.lastName</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>当在控制台输入<code>app.fullName = 'Lebron James'</code>，可以看到计算属性fullName的值发生了改变。</p>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Vue基础语法-计算属性.png" style="zoom:80%;" />
<h2 id="事件监听">事件监听</h2>
<h3 id="v-on">v-on</h3>
<p>绑定事件监听器</p>
<h4 id="基本使用-3">基本使用</h4>
<p>下面以按钮计数器为例：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h2</span>&gt;</span>&#123;&#123;counter&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--&lt;button v-on:click=&quot;counter++&quot;&gt;+&lt;/button&gt;--&gt;</span>  <span class="comment">&lt;!--可以直接在双引号中写表达式--&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--&lt;button v-on:click=&quot;counter--&quot;&gt;-&lt;/button&gt;--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;increment()&quot;</span>&gt;</span>+<span class="tag">&lt;/<span class="name">button</span>&gt;</span>  <span class="comment">&lt;!--语法糖：@--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;decrement()&quot;</span>&gt;</span>-<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意v-on的语法糖：</p>
<p>@click=“xxx” &lt;==&gt; v-on:click=“xxx”</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    el: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">    data: &#123;</span><br><span class="line">      counter: <span class="number">0</span></span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">      <span class="function"><span class="title">increment</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.counter++</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="function"><span class="title">decrement</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.counter--</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h4 id="参数的使用">参数的使用</h4>
<p>如果在methods中定义的方法没有参数，则在使用的时候方法的括号<code>()</code>可以省略不写。（注意只有在监听事件中才有此规则）</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;btn1Click()&quot;</span>&gt;</span>按钮一<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;btn1Click&quot;</span>&gt;</span>按钮一<span class="tag">&lt;/<span class="name">button</span>&gt;</span>  <span class="comment">&lt;!-- 效果同上 --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    el: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">    data: &#123;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">      <span class="function"><span class="title">btn1Click</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;----按钮一被点击&#x27;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>如果在定义方法时需要一个参数：</p>
<ul>
<li>在使用时书写括号但没有往其中传参，则会显示<code>undefined</code></li>
<li>在使用时省略该方法的括号不写，则Vue会默认将浏览器生产的event事件对象作为参数传入到方法中</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;btn1Click()&quot;</span>&gt;</span>按钮一<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;btn2Click&quot;</span>&gt;</span>按钮二<span class="tag">&lt;/<span class="name">button</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    el: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">    data: &#123;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">      <span class="function"><span class="title">btn1Click</span>(<span class="params">event</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;----按钮一被点击&#x27;</span>,event);</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="function"><span class="title">btn2Click</span>(<span class="params">event</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;----按钮二被点击&#x27;</span>,event);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>效果如下图：</p>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Vue基础语法-v-on.png" style="zoom:80%;" />
<p>如果在方法定义时，即需要其它自定义参数，又需要event对象，则要使用<code>$event</code>获取（直接使用<code>event</code>会报错，被当做一个自定义参数）：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;btn1Click(&#x27;参数一&#x27;,$event)&quot;</span>&gt;</span>按钮一<span class="tag">&lt;/<span class="name">button</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    el: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">    data: &#123;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">      <span class="function"><span class="title">btn1Click</span>(<span class="params">parameter,event</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;----按钮一被点击&#x27;</span>,parameter,event);</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>效果如下图：</p>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Vue基础语法-v-on2.png" style="zoom:80%;" />
<h4 id="修饰符">修饰符</h4>
<p><code>.stop</code></p>
<p>调用 event.stopPropagation()，可以防止事件冒泡。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> @<span class="attr">click</span>=<span class="string">&quot;divClick&quot;</span>&gt;</span></span><br><span class="line">  点击触发div事件</span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click.stop</span>=<span class="string">&quot;btnClick&quot;</span>&gt;</span>按钮<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    el: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">    data: &#123;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">      divClick () &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;div事件被触发&#x27;</span>);</span><br><span class="line">      &#125;,</span><br><span class="line">      btnClick () &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;按钮事件被触发&#x27;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>说明：如果不加<code>.stop</code>，则点击按钮的时候两个事件会同时触发</p>
</blockquote>
<p><code>.prevent</code></p>
<p>调用 event.preventDefault()，可以防止默认事件的发生</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;http://www.baidu.com&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;提交&quot;</span> @<span class="attr">click.prevent</span>=<span class="string">&quot;submitClick&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    el: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">    data: &#123;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">      submitClick () &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;表单提交事件被触发&#x27;</span>);</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>说明：如果不加<code>.prevent</code>，则在点击表单提交按钮之后会执行<code>action</code>，跳转到百度页面</p>
</blockquote>
<p><code>.&#123;keyCode | keyAlias&#125;</code></p>
<p>只当事件是从特定键触发时才触发回调，这里以enter键为例：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> @<span class="attr">keyup.enter</span>=<span class="string">&quot;keyUp&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    el: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">    data: &#123;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">      keyUp () &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;enter键被释放&#x27;</span>);</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p><code>.once</code></p>
<p>只触发一次回调，这里不再代码展示</p>
<h2 id="条件判断">条件判断</h2>
<h3 id="v-if、v-else-if、v-else">v-if、v-else-if、v-else</h3>
<p>可以根据表达式的值在DOM中渲染或销毁元素或组件：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h2</span> <span class="attr">v-if</span>=<span class="string">&quot;score&gt;=90&quot;</span>&gt;</span>优秀<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h2</span> <span class="attr">v-else-if</span>=<span class="string">&quot;score&gt;=80&quot;</span>&gt;</span>良好<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h2</span> <span class="attr">v-else-if</span>=<span class="string">&quot;score&gt;=60&quot;</span>&gt;</span>合格<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h2</span> <span class="attr">v-else</span>&gt;</span>不及格<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    el: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">    data: &#123;</span><br><span class="line">      score: <span class="number">85</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>当然并不建议较为复杂的判断写在DOM中，一般会将其写入computed计算属性之中：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h2</span>&gt;</span>&#123;&#123;showScore&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    el: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">    data: &#123;</span><br><span class="line">      score: <span class="number">85</span></span><br><span class="line">    &#125;,</span><br><span class="line">    computed: &#123;</span><br><span class="line">      showScore () &#123;</span><br><span class="line">        <span class="keyword">let</span> show = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">this</span>.score&gt;=<span class="number">90</span>) &#123;</span><br><span class="line">          show = <span class="string">&#x27;优秀&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(<span class="built_in">this</span>.score&gt;=<span class="number">80</span>) &#123;</span><br><span class="line">          show = <span class="string">&#x27;良好&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(<span class="built_in">this</span>.score&gt;=<span class="number">60</span>) &#123;</span><br><span class="line">          show = <span class="string">&#x27;合格&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">          show = <span class="string">&#x27;不及格&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> show</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h3 id="v-if对比v-show">v-if对比v-show</h3>
<p>这里再介绍一个<code>v-show</code>，可以达到同样的效果：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h2</span> <span class="attr">v-if</span>=<span class="string">&quot;isShow&quot;</span> <span class="attr">id</span>=<span class="string">&quot;ifff&quot;</span>&gt;</span>&#123;&#123;message&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h2</span> <span class="attr">v-show</span>=<span class="string">&quot;isShow&quot;</span> <span class="attr">id</span>=<span class="string">&quot;shhh&quot;</span>&gt;</span>&#123;&#123;message&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    el: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">    data: &#123;</span><br><span class="line">      message: <span class="string">&#x27;你好哇&#x27;</span>,</span><br><span class="line">      isShow: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>二者的区别：</p>
<ul>
<li>
<p>v-if: 当条件为false时, 包含v-if指令的元素, 根本就不会存在dom中</p>
</li>
<li>
<p>v-show: 当条件为false时, v-show只是给我们的元素添加一个行内样式: <code>display: none</code></p>
<p>当 isShow 为<code>false</code>时（如下图所示）</p>
</li>
</ul>
<p><img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Vue%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95-v-show.png" alt=""></p>
<p>二者的选择：</p>
<ul>
<li>当需要在显示与隐藏之间进行频繁切换时，选择v-show</li>
<li>当只需要少量切换时，用v-if</li>
</ul>
</blockquote>
<h2 id="循环遍历">循环遍历</h2>
<h3 id="v-for遍历数组">v-for遍历数组</h3>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;item in movies&quot;</span>&gt;</span>&#123;&#123;item&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    el: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">    data: &#123;</span><br><span class="line">      movies: [<span class="string">&#x27;星际穿越&#x27;</span>,<span class="string">&#x27;蜘蛛侠&#x27;</span>,<span class="string">&#x27;复仇者联盟&#x27;</span>,<span class="string">&#x27;泰坦尼克号&#x27;</span>]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>如果想要显示出数组中每一个元素的索引，则使用<code>index</code>：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;(item, index) in movies&quot;</span>&gt;</span>&#123;&#123;index&#125;&#125;·&#123;&#123;item&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span>  <span class="comment">&lt;!--显示元素索引--&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="v-for遍历对象属性">v-for遍历对象属性</h3>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;item in info&quot;</span>&gt;</span>&#123;&#123;item&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    el: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">    data: &#123;</span><br><span class="line">      info: &#123;</span><br><span class="line">        name: <span class="string">&#x27;HuaZhu&#x27;</span>,</span><br><span class="line">        age: <span class="number">18</span>,</span><br><span class="line">        height: <span class="number">1.84</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>效果如下图：</p>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Vue基础语法-v-for1.png" style="zoom:80%;" />
<p>如果想获取<code>key</code>值以及<code>index</code>，可以参考下面的写法：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;(item, key, index) in info&quot;</span>&gt;</span>&#123;&#123;index&#125;&#125;-&#123;&#123;key&#125;&#125;-&#123;&#123;item&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;(index, key, item) in info&quot;</span>&gt;</span>&#123;&#123;index&#125;&#125;-&#123;&#123;key&#125;&#125;-&#123;&#123;item&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>效果如下图：</p>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Vue基础语法-v-for2.png" style="zoom:80%;" />
<blockquote>
<p>注意顺序：</p>
<p>一般按照<code>v-for=&quot;(item, key, index)</code>该顺序去编写。（不由关键字，而是与位置有关）</p>
</blockquote>
<h3 id="key属性">key属性</h3>
<p>一般在使用<code>v-for</code>时，会绑定一个<code>key</code>属性，以提高效率。</p>
<p>以上述列表展示为例，如果说在一个数组中插入一个元素，那么插入位置之后的<code>&lt;li&gt;</code>标签都会更新（向后推value值），但是一旦列表元素多了，这样的插入是很低效地，于是使用<code>key</code>去绑定<code>item</code>（注意：不可以绑定<code>index</code>，这样是无效的）。如此一来进行插值等更新列表的操作就只会在改动的列表元素对应的更新<code>&lt;li&gt;</code>标签。</p>
<p>另一方面，使用<code>key</code>去绑定<code>item</code>还可以保证数组元素的唯一性，如果添加重复数据会报错。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;item in letters&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;item&quot;</span>&gt;</span>&#123;&#123;item&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>建议使用此写法，以提高性能。</p>
</blockquote>
<h3 id="关于数组的响应式方法">关于数组的响应式方法</h3>
<p>首先明确什么是相应式方法：在数组调用该方法修改内部元素时，前端页面会实时更新。包含：</p>
<ul>
<li><code>push()</code>：在数组末尾增添元素（可以为多个）。</li>
<li><code>pop()</code>：在数组末尾删除元素。</li>
<li><code>shift()</code>：在数组头部增添元素。</li>
<li><code>unshift()</code>：在数组头部删除元素</li>
<li><code>splice()</code>：
<ul>
<li>删除元素：第二个参数传入你要删除几个元素（如果没有传,就删除后面所有的元素）</li>
<li>替换元素：第二个参数, 表示我们要替换几个元素, 后面是用于替换前面的元素</li>
<li>插入元素：第二个参数, 传入0, 并且后面跟上要插入的元素</li>
</ul>
</li>
<li><code>sort()</code>：给数组元素排序</li>
<li><code>reverse()</code>：反转数组元素</li>
</ul>
<p>这里以<code>push()</code>方法为例：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;item in letters&quot;</span>&gt;</span>&#123;&#123;item&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;btnClick&quot;</span>&gt;</span>按钮<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    el: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">    data: &#123;</span><br><span class="line">      letters: [<span class="string">&#x27;A&#x27;</span>,<span class="string">&#x27;B&#x27;</span>,<span class="string">&#x27;C&#x27;</span>,<span class="string">&#x27;D&#x27;</span>,<span class="string">&#x27;E&#x27;</span>]</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">      btnClick () &#123;</span><br><span class="line">        <span class="built_in">this</span>.letters.push(<span class="string">&#x27;Z&#x27;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>效果如下：</p>
<p><img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Vue-v-for-%E5%93%8D%E5%BA%94%E5%BC%8F%E6%96%B9%E6%B3%951.gif" alt=""></p>
<p>了解了响应式方法之后要说明：通过索引值修改数组中的元素页面是不会实时响应的（尽管数组元素会发生变化）</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    el: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">    data: &#123;</span><br><span class="line">      letters: [<span class="string">&#x27;A&#x27;</span>,<span class="string">&#x27;B&#x27;</span>,<span class="string">&#x27;C&#x27;</span>,<span class="string">&#x27;D&#x27;</span>,<span class="string">&#x27;E&#x27;</span>]</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">      btnClick () &#123;</span><br><span class="line">        <span class="built_in">this</span>.letters[<span class="number">0</span>] = <span class="string">&#x27;ZZZZ&#x27;</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>效果如下：</p>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Vue-v-for-响应式方法2.gif" style="zoom:80%;" />
<h2 id="表单绑定（v-model）">表单绑定（v-model）</h2>
<h3 id="表单元素和数据的双向绑定">表单元素和数据的双向绑定</h3>
<p>之前一直都是通过修改data中数据的值去改变前端页面展示的效果，现在通过<code>v-model</code>可以双向绑定，即在input输入框中键入字符，data中的数据也可以随之改变，具体效果如下：</p>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Vue-v-model-基础语法.gif" style="zoom:80%;" />
<p>代码如下，通过<code>v-model</code>绑定message：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;message&quot;</span>&gt;</span></span><br><span class="line">  &#123;&#123;message&#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    el: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">    data: &#123;</span><br><span class="line">      message: <span class="string">&#x27;你好哇&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>当然按照之前的学习内容我们也可以实现相同的效果，需要<code>v-on</code>绑定事件，以及<code>event</code>事件：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">:value</span>=<span class="string">&quot;message&quot;</span> @<span class="attr">input</span>=<span class="string">&quot;message = $event.target.value&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h2</span>&gt;</span>&#123;&#123;message&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    el: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">    data: &#123;</span><br><span class="line">      message: <span class="string">&#x27;你好哇&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>所以：</p>
<p><code>&lt;input type=&quot;text&quot; v-model=&quot;message&quot;&gt;</code></p>
<p>等同于</p>
<p><code>&lt;input type=&quot;text&quot; :value=&quot;message&quot; @input=&quot;message = $event.target.value&quot;&gt;</code></p>
</blockquote>
<h3 id="结合radio类型使用">结合radio类型使用</h3>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;male&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">id</span>=<span class="string">&quot;male&quot;</span> <span class="attr">value</span>=<span class="string">&quot;男&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;sex&quot;</span>&gt;</span>男</span><br><span class="line">  <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;female&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">id</span>=<span class="string">&quot;female&quot;</span> <span class="attr">value</span>=<span class="string">&quot;女&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;sex&quot;</span>&gt;</span>女</span><br><span class="line">  <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h2</span>&gt;</span>您选择的性别是: &#123;&#123;sex&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    el: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">    data: &#123;</span><br><span class="line">      sex: <span class="string">&#x27;&#x27;</span>  <span class="comment">//如果要设定初始默认选项，直接修改sex的值即可</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>
<p>之前为了实现选项间的互斥，还需要在每一个<code>input</code>标签中增添相同的<code>name</code>属性，而<code>v-model</code>本身就可以实现互斥。</p>
</li>
<li>
<p>如果要增添初始默认选项，直接在data中修改关键字即可。</p>
</li>
<li>
<p>在每一个<code>input</code>项外套一个<code>label</code>标签的好处就是，在点击文字的时候也可以进行选择，效果如下：</p>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Vue-v-model-radio.gif" style="zoom:80%;" />
</li>
</ul>
</blockquote>
<h3 id="结合checkbox类型使用">结合checkbox类型使用</h3>
<p>一般在单选框时，<code>v-model</code>绑定的值为布尔类型：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;license&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">id</span>=<span class="string">&quot;license&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;isAgree&quot;</span>&gt;</span>同意协议</span><br><span class="line">  <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h2</span>&gt;</span>您选择的是: &#123;&#123;isAgree&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">:disabled</span>=<span class="string">&quot;!isAgree&quot;</span>&gt;</span>下一步<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    el: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">    data: &#123;</span><br><span class="line">      isAgree: <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>效果如下：</p>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Vue-v-model-checkbox1.gif" style="zoom:80%;" />
<p>下面来看多选框的情况：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">value</span>=<span class="string">&quot;篮球&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;hobbies&quot;</span>&gt;</span>篮球</span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">value</span>=<span class="string">&quot;足球&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;hobbies&quot;</span>&gt;</span>足球</span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">value</span>=<span class="string">&quot;乒乓球&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;hobbies&quot;</span>&gt;</span>乒乓球</span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">value</span>=<span class="string">&quot;羽毛球&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;hobbies&quot;</span>&gt;</span>羽毛球</span><br><span class="line">  <span class="tag">&lt;<span class="name">h2</span>&gt;</span>您的爱好是: &#123;&#123;hobbies&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    el: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">    data: &#123;</span><br><span class="line">      hobbies: [],  <span class="comment">//如果默认选定项目，可以在列表中提前写入</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>效果如下：</p>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Vue-v-model-checkbox2.gif" style="zoom:80%;" />
<h3 id="结合select类型使用">结合select类型使用</h3>
<p>首先来看单选的情况：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">select</span> <span class="attr">name</span>=<span class="string">&quot;abc&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;fruit&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;苹果&quot;</span>&gt;</span>苹果<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;香蕉&quot;</span>&gt;</span>香蕉<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;榴莲&quot;</span>&gt;</span>榴莲<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;葡萄&quot;</span>&gt;</span>葡萄<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h2</span>&gt;</span>您选择的水果是: &#123;&#123;fruit&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    el: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">    data: &#123;</span><br><span class="line">      fruit: <span class="string">&#x27;&#x27;</span>  <span class="comment">//如果默认选中某一项，可在此处添加</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>效果如下：</p>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Vue-v-model-select1.gif" style="zoom:80%;" />
<p>下面再看多选的情况，利用<code>multiple</code>属性：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">select</span> <span class="attr">name</span>=<span class="string">&quot;abc&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;fruits&quot;</span> <span class="attr">multiple</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;苹果&quot;</span>&gt;</span>苹果<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;香蕉&quot;</span>&gt;</span>香蕉<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;榴莲&quot;</span>&gt;</span>榴莲<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;葡萄&quot;</span>&gt;</span>葡萄<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h2</span>&gt;</span>您选择的水果是: &#123;&#123;fruits&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    el: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">    data: &#123;</span><br><span class="line">      fruits: []  <span class="comment">//默认选中某些选项，可在此处添加</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>按住<code>Ctrl键</code>，就可以实现多选，效果如下：</p>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Vue-v-model-select2.gif" style="zoom:80%;" />
<h3 id="动态值绑定">动态值绑定</h3>
<p>前面的例子中所有的<code>input</code>或是<code>option</code>标签中的<code>value</code>属性都是写死在前端的，这样的话在后期修改的时候会很麻烦，因此在实际操作过程中建议使用动态值绑定，可以根据后端传来的数据动态更新选项列表：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">label</span> <span class="attr">v-for</span>=<span class="string">&quot;item in originHobbies&quot;</span> <span class="attr">:for</span>=<span class="string">&quot;item&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">:value</span>=<span class="string">&quot;item&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;hobbies&quot;</span> <span class="attr">:id</span>=<span class="string">&quot;item&quot;</span>&gt;</span>&#123;&#123;item&#125;&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h2</span>&gt;</span>您的爱好是: &#123;&#123;hobbies&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    el: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">    data: &#123;</span><br><span class="line">      hobbies: [],</span><br><span class="line">      originHobbies: [<span class="string">&#x27;篮球&#x27;</span>, <span class="string">&#x27;足球&#x27;</span>, <span class="string">&#x27;乒乓球&#x27;</span>, <span class="string">&#x27;羽毛球&#x27;</span>, <span class="string">&#x27;台球&#x27;</span>, <span class="string">&#x27;高尔夫球&#x27;</span>]  <span class="comment">//接收后端传来的数据</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h3 id="v-model的修饰符">v-model的修饰符</h3>
<h4 id="lazy修饰符">lazy修饰符</h4>
<p>在<code>v-model</code>双向绑定时会实时更新内容，但是在一些场景中我们并不需要如此，一方面会降低效率，另一方面也会影响观感。所以希望仅在敲击<code>Enter键</code>或<code>input</code>失去焦点时进行更新，由此使用<code>lazy</code>修饰符：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model.lazy</span>=<span class="string">&quot;message&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h2</span>&gt;</span>&#123;&#123;message&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    el: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">    data: &#123;</span><br><span class="line">      message: <span class="string">&#x27;你好哇&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>效果如下：</p>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Vue-v-model-lazy.gif" style="zoom:80%;" />
<h4 id="number修饰符">number修饰符</h4>
<p><code>v-model</code>默认输入的内容都为<code>string</code>类型，即便在一开始设初值为<code>number</code>类型，在绑定后输入任何字符都会改为<code>string</code>类型。因此想要输入<code>number</code>类型，就需要用到<code>number</code>修饰符。（不允许输入除数字以外的字符类型）</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;number&quot;</span> <span class="attr">v-model.number</span>=<span class="string">&quot;num&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h2</span>&gt;</span>&#123;&#123;num&#125;&#125;-&#123;&#123;typeof num&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    el: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">    data: &#123;</span><br><span class="line">      num: <span class="string">&#x27;&#x27;</span>  </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>效果如下：</p>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Vue-v-model-number.gif" style="zoom:80%;" />
<blockquote>
<p>注意：如果一开始赋初值为<code>空</code>或者<code>string</code>类型的字符串，那么最开始会显示为<code>string</code>类型，一旦输入了数字之后，原先默认的字符串会被清除。（且不允许输入除数字以外的字符类型）</p>
<p>在Mustache中可以利用<code>typeof</code>关键词去查看变量类型。</p>
</blockquote>
<h4 id="trim修饰符">trim修饰符</h4>
<p>如果不加以限制，在字符串首尾输入任意数量的空格将会被记录，如果想要去除首尾空格，则可以使用<code>trim</code>修饰符：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model.trim</span>=<span class="string">&quot;name&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h2</span>&gt;</span>您的名字为：&#123;&#123;name&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    el: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">    data: &#123;</span><br><span class="line">      name: <span class="string">&#x27;&#x27;</span>  </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>这里就不做演示了。</p>
<h2 id="箭头函数">箭头函数</h2>
<p>再补充一下ES6的箭头函数的使用方式。</p>
<p>箭头函数：一种定义函数的方式。一般在当一个函数作为另一个函数的参数时使用。</p>
<h3 id="基本使用-4">基本使用</h3>
<p>格式：<code>const 函数名 = (参数列表) =&gt; &#123;&#125;</code></p>
<p>例（加法函数）：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> sum = <span class="function">(<span class="params">num1, num2</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> num1 + num2</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意：</p>
<ul>
<li>
<p>如果参数只有一个的情况，则参数的小括号可以省略：</p>
<p>例（平方函数）：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> power = <span class="function"><span class="params">num</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> num * num</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>如果函数体只有一行，则可以省略<code>return</code>：</p>
<p>例（乘法函数）：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> mul = <span class="function">(<span class="params">num1, num2</span>) =&gt;</span> num1 * num2</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意：函数体大括号和return要么都写，要么都不写。只写一个会报错。</p>
</blockquote>
</li>
</ul>
</blockquote>
<h3 id="this的使用">this的使用</h3>
<p>结论：箭头函数中的<code>this</code>引用的是<strong>最近作用域</strong>中的this。（向外层查找this，直到有this的定义）</p>
<h2 id="code￼92"><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  <span class="function"><span class="title">fun</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="built_in">this</span>); <span class="comment">// Window</span></span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">      <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="built_in">this</span>); <span class="comment">// Window</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="built_in">this</span>); <span class="comment">// Window</span></span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">      <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="built_in">this</span>); <span class="comment">// Object（指向定义的fun()函数）</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">obj.fun()</span><br></pre></td></tr></table></figure></h2>
<h1>后记</h1>
<p>此篇结束。</p>
<p>（欢迎评论区留言指正）</p>
]]></content>
      <categories>
        <category>学习笔记</category>
      </categories>
      <tags>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue学习-组件化开发</title>
    <url>/2021/08/04/Vue/Vue%E5%AD%A6%E4%B9%A0-%E7%BB%84%E4%BB%B6%E5%8C%96%E5%BC%80%E5%8F%91/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\css\APlayer.min.css"><script src="\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\js\Meting.min.js"></script><h1>前言</h1>
<p>本文将介绍Vue的组件化开发。</p>
<p>将一个页面拆分成一个个小的功能块，每个功能块完成自己独立的功能，这样在之后的页面维护和管理就会方便许多。</p>
<hr>
<h1>组件化开发</h1>
<h2 id="基本使用">基本使用</h2>
<p>组件的使用可以分为以下三个步骤：</p>
<ul>
<li>创建组件构造器（<code>Vue.extend()</code>方法）</li>
<li>注册组件（<code>Vue.component()</code>方法）</li>
<li>使用组件</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 3.使用组件 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">my-cpn</span>&gt;</span><span class="tag">&lt;/<span class="name">my-cpn</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">my-cpn</span>&gt;</span><span class="tag">&lt;/<span class="name">my-cpn</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">my-cpn</span>&gt;</span><span class="tag">&lt;/<span class="name">my-cpn</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">my-cpn</span>&gt;</span><span class="tag">&lt;/<span class="name">my-cpn</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="comment">// 1.创建组件构造器对象</span></span><br><span class="line">  <span class="keyword">const</span> cpnC = Vue.extend(&#123;  <span class="comment">//template为模板，用``包裹，整体为字符串</span></span><br><span class="line">    template: <span class="string">`        </span></span><br><span class="line"><span class="string">      &lt;div&gt;</span></span><br><span class="line"><span class="string">        &lt;h2&gt;标题&lt;/h2&gt;</span></span><br><span class="line"><span class="string">        &lt;p&gt;内容一&lt;/p&gt;</span></span><br><span class="line"><span class="string">        &lt;p&gt;内容二&lt;/p&gt;</span></span><br><span class="line"><span class="string">        &lt;p&gt;内容三&lt;/p&gt;</span></span><br><span class="line"><span class="string">        &lt;p&gt;内容四&lt;/p&gt;</span></span><br><span class="line"><span class="string">      &lt;/div&gt;</span></span><br><span class="line"><span class="string">    `</span></span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">// 2.注册全局组件</span></span><br><span class="line">  Vue.component(<span class="string">&#x27;my-cpn&#x27;</span>, cpnC)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    el: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">    data: &#123;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意：在创建组件构造器对象时，需要使用<code>template</code>来创建模板，模板为html代码，为字符串。</p>
<p><code>Vue.component()</code>需要传入两个参数：第一个为希望使用的组件的标签名，第二个是组件构造器。</p>
<p>组件构造器对象的创建和组件注册的步骤都必须在Vue实例的同一个<code>&lt;script&gt;</code>标签下完成。</p>
<p>（后面会提到更为简便的创建方式）</p>
</blockquote>
<h2 id="全局组件和局部组件">全局组件和局部组件</h2>
<p>上述基本用法中，注册的组件为全局组件，即该组件可以在多个Vue实例中使用</p>
<p>下面介绍局部组件的注册方法：在Vue实例化对象中有一个<code>components</code>属性，在其中注册：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 3.使用组件 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mycpn</span>&gt;</span><span class="tag">&lt;/<span class="name">mycpn</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mycpn</span>&gt;</span><span class="tag">&lt;/<span class="name">mycpn</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mycpn</span>&gt;</span><span class="tag">&lt;/<span class="name">mycpn</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mycpn</span>&gt;</span><span class="tag">&lt;/<span class="name">mycpn</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="comment">// 1.创建组件构造器对象</span></span><br><span class="line">  <span class="keyword">const</span> cpnC = Vue.extend(&#123;</span><br><span class="line">    template: <span class="string">`</span></span><br><span class="line"><span class="string">      &lt;div&gt;</span></span><br><span class="line"><span class="string">        &lt;h2&gt;标题&lt;/h2&gt;</span></span><br><span class="line"><span class="string">        &lt;p&gt;内容一&lt;/p&gt;</span></span><br><span class="line"><span class="string">        &lt;p&gt;内容二&lt;/p&gt;</span></span><br><span class="line"><span class="string">        &lt;p&gt;内容三&lt;/p&gt;</span></span><br><span class="line"><span class="string">        &lt;p&gt;内容四&lt;/p&gt;</span></span><br><span class="line"><span class="string">      &lt;/div&gt;</span></span><br><span class="line"><span class="string">    `</span></span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    el: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">    data: &#123;</span><br><span class="line">    &#125;,</span><br><span class="line">    components: &#123;</span><br><span class="line">      mycpn: cpnC  <span class="comment">// 2.注册局部组件</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意：一般在使用中注册局部组件，更加方便，且只有一个Vue实例化对象。</p>
</blockquote>
<h3 id="语法糖">语法糖</h3>
<p>省去了调用<code>Vue.extend()</code>的步骤，而是直接使用一个对象来代替：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">cpn1</span>&gt;</span><span class="tag">&lt;/<span class="name">cpn1</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">cpn2</span>&gt;</span><span class="tag">&lt;/<span class="name">cpn2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="comment">//注册全局组件</span></span><br><span class="line">  Vue.component(<span class="string">&#x27;cpn1&#x27;</span>,&#123;</span><br><span class="line">    template: <span class="string">`</span></span><br><span class="line"><span class="string">      &lt;div&gt;</span></span><br><span class="line"><span class="string">        &lt;h2&gt;标题一&lt;/h2&gt;</span></span><br><span class="line"><span class="string">        &lt;p&gt;全局组件&lt;/p&gt;</span></span><br><span class="line"><span class="string">      &lt;/div&gt;</span></span><br><span class="line"><span class="string">    `</span></span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    el: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">    data: &#123;</span><br><span class="line">    &#125;,</span><br><span class="line">    components: &#123;  <span class="comment">//注册局部组件</span></span><br><span class="line">      cpn2: &#123;</span><br><span class="line">        template: <span class="string">`</span></span><br><span class="line"><span class="string">          &lt;div&gt;</span></span><br><span class="line"><span class="string">            &lt;h2&gt;标题二&lt;/h2&gt;</span></span><br><span class="line"><span class="string">            &lt;p&gt;局部组件&lt;/p&gt;</span></span><br><span class="line"><span class="string">          &lt;/div&gt;</span></span><br><span class="line"><span class="string">        `</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h3 id="模板分离写法">模板分离写法</h3>
<p>在创建组件的时候，将模板直接写入其中会使代码看起来特别复杂，因此建议将模板分离出去，这里会介绍两种写法：</p>
<h4 id="script-标签写法">&lt; script&gt;标签写法</h4>
<p>利用<code>&lt;script&gt;</code>标签中的<code>text/x-template</code>类型，利用id绑定模板：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">cpn</span>&gt;</span><span class="tag">&lt;/<span class="name">cpn</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;text/x-template&quot;</span> id=<span class="string">&quot;cpn&quot;</span>&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;h2&gt;标题一&lt;/h2&gt;</span><br><span class="line">    &lt;p&gt;内容一（script标签写法）&lt;/p&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">  Vue.component(<span class="string">&#x27;cpn&#x27;</span>, &#123;</span><br><span class="line">    template: <span class="string">&#x27;#cpn&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    el: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">    data: &#123;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h4 id="template-标签写法">&lt; template&gt;标签写法</h4>
<p>直接利用<code>&lt;template&gt;</code>标签书写模板，并利用id进行绑定：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;template id=<span class="string">&quot;cpn&quot;</span>&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;h2&gt;标题二&lt;/h2&gt;</span><br><span class="line">    &lt;p&gt;内容二（template标签写法）&lt;/p&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">  Vue.component(<span class="string">&#x27;cpn&#x27;</span>, &#123;</span><br><span class="line">    template: <span class="string">&#x27;#cpn&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    el: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">    data: &#123;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意：在定义模板的时候，必须要设置一个根元素（root element），即在模板内容外套一个<code>&lt;div&gt;</code>标签。</p>
</blockquote>
<h2 id="父组件和子组件">父组件和子组件</h2>
<p>组件可以被注册在其他组件构造器对象中，被称为子组件：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">cpn1</span>&gt;</span><span class="tag">&lt;/<span class="name">cpn1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="keyword">const</span> cpnC2 = Vue.extend (&#123;  <span class="comment">//子组件构造器</span></span><br><span class="line">    template: <span class="string">`</span></span><br><span class="line"><span class="string">    &lt;div&gt;</span></span><br><span class="line"><span class="string">      &lt;h2&gt;标题二&lt;/h2&gt;</span></span><br><span class="line"><span class="string">      &lt;p&gt;内容二（子组件）&lt;/p&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">  `</span></span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> cpnC1 = Vue.extend (&#123;  <span class="comment">//父组件构造器</span></span><br><span class="line">    template: <span class="string">`</span></span><br><span class="line"><span class="string">    &lt;div&gt;</span></span><br><span class="line"><span class="string">      &lt;h2&gt;标题一&lt;/h2&gt;</span></span><br><span class="line"><span class="string">      &lt;p&gt;内容一（父组件）&lt;/p&gt;</span></span><br><span class="line"><span class="string">      &lt;cpn2&gt;&lt;/cpn2&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">  `</span>,</span><br><span class="line">  components: &#123;</span><br><span class="line">    cpn2: cpnC2  <span class="comment">//子组件在父组件构造器中注册</span></span><br><span class="line">  &#125;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    el: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">    data: &#123;</span><br><span class="line">    &#125;,</span><br><span class="line">    components: &#123;</span><br><span class="line">      cpn1: cpnC1  <span class="comment">//父组件在Vue实例化对象中注册</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>效果如下：</p>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Vue组件化-父子组件.png" style="zoom:80%;" />
<blockquote>
<p>注意：创建父组件构造器一定要在子组件构造器之后，否则会出错。（如果父组件在前，顺序执行会找不到子组件构造器）</p>
<ul>
<li>子组件在父组件构造器中注册</li>
<li>父组件在Vue实例化对象中注册</li>
</ul>
</blockquote>
<h2 id="组件中的数据存放">组件中的数据存放</h2>
<p>如果想在组件中使用<code>Mustache</code>语法，我们需要考虑其中的数据应该如何存放。事实上，组件的创建是为了更好的复用，因此将数据存放在Vue实例中肯定是不符合要求的，应该把数据也存放到组件构造器中才符合理念。</p>
<p>值得注意的是，组件中的数据存放跟Vue实例中有所不同，组件构造器中的<code>data</code>参数要求必须是一个<strong>函数</strong>，且返回值得是一个<strong>对象</strong>，因此组件的数据就要存放于这个返回对象之中：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">cpn</span>&gt;</span><span class="tag">&lt;/<span class="name">cpn</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span> <span class="attr">id</span>=<span class="string">&quot;cpn&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>&#123;&#123;title&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    &#123;&#123;content&#125;&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  Vue.component(<span class="string">&#x27;cpn&#x27;</span>, &#123;</span><br><span class="line">    template: <span class="string">&#x27;#cpn&#x27;</span>,</span><br><span class="line">    <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;           <span class="comment">//data是一个函数</span></span><br><span class="line">      <span class="keyword">return</span> &#123;         <span class="comment">//返回值是一个对象</span></span><br><span class="line">        title: <span class="string">&#x27;标题&#x27;</span>,</span><br><span class="line">        content: <span class="string">&#x27;内容&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    el: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">    data: &#123;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>下面我们以计数器案例来说明为何组件中的<code>data</code>是一个函数，且返回值是一个对象：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">cpn</span>&gt;</span><span class="tag">&lt;/<span class="name">cpn</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">cpn</span>&gt;</span><span class="tag">&lt;/<span class="name">cpn</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">cpn</span>&gt;</span><span class="tag">&lt;/<span class="name">cpn</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span> <span class="attr">id</span>=<span class="string">&quot;cpn&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>当前计数: &#123;&#123;counter&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;increment&quot;</span>&gt;</span>+<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;decrement&quot;</span>&gt;</span>-<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  Vue.component(<span class="string">&#x27;cpn&#x27;</span>, &#123;</span><br><span class="line">    template: <span class="string">&#x27;#cpn&#x27;</span>,</span><br><span class="line">    <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        counter: <span class="number">0</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;         <span class="comment">//组件中的methods参数的类型跟Vue实例一样</span></span><br><span class="line">      <span class="function"><span class="title">increment</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.counter++</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="function"><span class="title">decrement</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.counter--</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    el: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">    data: &#123;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>效果如下：</p>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Vue组件化-数据存放.gif" style="zoom:80%;" />
<p>在前端的每一个<code>&lt;cpn&gt;</code>标签都相当于组件的实例化对象，我们希望方便快捷的调用，但同时需要考虑一个问题，这些实例化对象所访问的数据应该是不同的（否则在点击按钮的时候所有计数器的值都会发生改变），而函数恰好可以实现块级作用域，每次调用一个组件实例，<code>data</code>函数相应的就会被调用，同时会返回该实例组件所独有的一个对象。实现了每个实例组件的数据互不干扰。</p>
<h2 id="父、子组件间的通信">父、子组件间的通信</h2>
<h3 id="数据传递">数据传递</h3>
<p>之前提到子组件是不能引用父组件或者Vue实例中的数据的，但是在很多情况下又需要子组件对这些数据的访问。</p>
<p>父、子组件的数据传递依靠如下方式：</p>
<ul>
<li>父组件通过<code>props</code>向子组件传递数据</li>
<li>子组件通过<code>事件（$emit(Events)）</code>向父组件发送数据</li>
</ul>
<h4 id="父组件→子组件">父组件→子组件</h4>
<p>为了观看简洁，这里以Vue实例作为父组件，新构建一个子组件（在Vue实例中注册）</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--Vue实例化对象（父组件模板）--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">cpn</span> <span class="attr">:c-title</span>=<span class="string">&quot;title&quot;</span> <span class="attr">:cmovies</span>=<span class="string">&quot;movies&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">cpn</span>&gt;</span>  <span class="comment">&lt;!--将父子组件的对应数据做绑定--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--子组件模板--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span> <span class="attr">id</span>=<span class="string">&quot;cpn&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>&#123;&#123;cTitle&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;item in cmovies&quot;</span>&gt;</span>&#123;&#123;item&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="comment">//(子组件构造器)</span></span><br><span class="line">  <span class="keyword">const</span> cpn = &#123;</span><br><span class="line">    template: <span class="string">&#x27;#cpn&#x27;</span>,</span><br><span class="line">    props: &#123;</span><br><span class="line">      cTitle: &#123;  <span class="comment">//与父组件中的title数据对应</span></span><br><span class="line">        type: <span class="built_in">String</span>,  <span class="comment">//定义参数类型</span></span><br><span class="line">        <span class="keyword">default</span>: <span class="string">&#x27;无标题&#x27;</span>,  <span class="comment">//父组件不设值时的默认数据</span></span><br><span class="line">        required: <span class="literal">true</span>  <span class="comment">//父组件必须传递title数据</span></span><br><span class="line">      &#125;,</span><br><span class="line">      cmovies: &#123;  <span class="comment">//与父组件中的movies数据对应</span></span><br><span class="line">        type: <span class="built_in">Array</span>,</span><br><span class="line">        <span class="keyword">default</span>: [],</span><br><span class="line">        required: <span class="literal">false</span>  <span class="comment">//对父组件传递movie数据与否不加以限制</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//Vue实例（父组件）</span></span><br><span class="line">  <span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    el: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">    data: &#123;</span><br><span class="line">      title: <span class="string">&#x27;标题&#x27;</span>,</span><br><span class="line">      movies: [<span class="string">&#x27;泰坦尼克号&#x27;</span>,<span class="string">&#x27;蜘蛛侠&#x27;</span>,<span class="string">&#x27;复仇者联盟&#x27;</span>,<span class="string">&#x27;星际穿越&#x27;</span>],</span><br><span class="line">    &#125;,</span><br><span class="line">    components: &#123;</span><br><span class="line">      cpn  <span class="comment">//ES6特性：增强写法，相当于 cpn: &#x27;cpn&#x27;（注册子组件）</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>在组件构造器中有一个<code>props</code>参数，<code>props</code>的选项可以是：</p>
<ul>
<li>
<p>数组：内部存放引用父组件的数据</p>
</li>
<li>
<p>对象（推荐写法），可以对数据进行类型检验，设置默认值等操作。支持的数据类型有：</p>
<p><code>String</code>、<code>Number</code>、<code>Boolean</code>、<code>Array</code>、<code>Object</code>、<code>Date</code>、<code>Function</code>、<code>Symbol</code>、<code>自定义类型</code>（当有自定义构造函数时）</p>
<p>（如果数据类型为<code>Object</code>（对象），则在设置<code>default</code>默认值时必须也得是对象，有返回值：<code>default() &#123; ...  return &#123;&#125; &#125;</code>）</p>
</li>
</ul>
<blockquote>
<p>为了避免不必要的错误，建议在父子组件数据传递时命名采用全小写：即不采用驼峰命名</p>
<p>如果要采用驼峰命名，需要采用<code>-</code>连接的格式，以上述代码中的<code>cTitle</code>为例：</p>
<p>在子组件的数据中采用驼峰命名的<code>cTitle</code>，在<code>&lt;cpn&gt;</code>标签中需要修改为<code>c-title</code></p>
</blockquote>
</blockquote>
<h4 id="子组件→父组件">子组件→父组件</h4>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--Vue实例化对象（父组件模板）--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">cpn</span> @<span class="attr">item-click</span>=<span class="string">&quot;cpnClick&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">cpn</span>&gt;</span>  <span class="comment">&lt;!--注意cpnClick不可以携带参数，它已经默认将参数item进行了传递--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--子组件模板--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span> <span class="attr">id</span>=<span class="string">&quot;cpn&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">v-for</span>=<span class="string">&quot;item in movies&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;btnClick(item)&quot;</span>&gt;</span></span><br><span class="line">      &#123;&#123;item.name&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="comment">//（子组件）</span></span><br><span class="line">  <span class="keyword">const</span> cpn = &#123;</span><br><span class="line">    template: <span class="string">&#x27;#cpn&#x27;</span>,</span><br><span class="line">    <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        movies: [</span><br><span class="line">          &#123;<span class="attr">id</span>: <span class="string">&#x27;01&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;泰坦尼克号&#x27;</span>&#125;,</span><br><span class="line">          &#123;<span class="attr">id</span>: <span class="string">&#x27;02&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;蜘蛛侠&#x27;</span>&#125;,</span><br><span class="line">          &#123;<span class="attr">id</span>: <span class="string">&#x27;03&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;复仇者联盟&#x27;</span>&#125;,</span><br><span class="line">          &#123;<span class="attr">id</span>: <span class="string">&#x27;04&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;星际穿越&#x27;</span>&#125;,</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">      <span class="function"><span class="title">btnClick</span>(<span class="params">item</span>)</span> &#123;</span><br><span class="line">        <span class="comment">//通过this.$emit传递自定义事件以及参数至父组件</span></span><br><span class="line">        <span class="built_in">this</span>.$emit(<span class="string">&#x27;item-click&#x27;</span>,item)  <span class="comment">//第一个参数为自定义的事件名称，第二个参数为传递的数据</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Vue实例（父组件）</span></span><br><span class="line">  <span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    el: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">    data: &#123;</span><br><span class="line">    &#125;,</span><br><span class="line">    components: &#123;</span><br><span class="line">      cpn</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">      <span class="function"><span class="title">cpnClick</span>(<span class="params">item</span>)</span> &#123;  <span class="comment">//前端绑定了cpnClick事件，并将参数传递至此</span></span><br><span class="line">        <span class="built_in">console</span>.log(item, item.name);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  &lt;/script&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>关键：前端通过<code>$emit()</code>方法将自定义事件以及数组传递给父组件，前端父组件模板可以通过事件绑定接收数据。</p>
<p>需要注意：</p>
<ul>
<li>子组件自定义事件命名不要采用驼峰式，尽量用全小写或者<code>-</code>连接（后面脚手架可以采用驼峰命名）</li>
<li>在前端父模板绑定事件的时候父组件方法不要写<code>(参数)</code>，之前提到过默认事件如果不传参则默认为系统event事件，而自定义事件如果不传参则默认传递自定义的参数</li>
</ul>
</blockquote>
<blockquote>
<p>在实际操作的过程中是可以实现父、子数据的双向绑定。但不建议这么使用：违反了组件独立性（包括数据）的原则。</p>
</blockquote>
<h3 id="组件访问">组件访问</h3>
<p>在某些场景下需要父组件直接访问子组件或者子组件直接访问父组件的内容。</p>
<ul>
<li>父组件访问子组件：使用<code>$children</code>（一般不用）或<code>$refs </code>（常用）</li>
<li>子组件访问父组件：使用<code>$parent</code></li>
</ul>
<h4 id="父组件访问子组件">父组件访问子组件</h4>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--Vue实例化对象（父组件模板）--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">cpn</span> <span class="attr">ref</span>=<span class="string">&quot;child&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">cpn</span>&gt;</span>  <span class="comment">&lt;!--利用ref标定子组件--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;btnClick1&quot;</span>&gt;</span>按钮1（属性）<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;btnClick2&quot;</span>&gt;</span>按钮2（方法）<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--子组件模板--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span> <span class="attr">id</span>=<span class="string">&quot;cpn&quot;</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>我是子组件<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="comment">//子组件构造器</span></span><br><span class="line">  <span class="keyword">const</span> cpn = Vue.extend(&#123;</span><br><span class="line">    template: <span class="string">&#x27;#cpn&#x27;</span>,</span><br><span class="line">      <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">          name: <span class="string">&#x27;我是子组件的name变量&#x27;</span>  <span class="comment">//子组件变量</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      methods: &#123;</span><br><span class="line">        <span class="function"><span class="title">show</span>(<span class="params">value</span>)</span> &#123;  <span class="comment">//子组件方法</span></span><br><span class="line">          <span class="built_in">console</span>.log(<span class="string">&#x27;我是子组件的show方法&#x27;</span>,value);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Vue实例（父组件）</span></span><br><span class="line">  <span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    el: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">    data: &#123;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">      <span class="function"><span class="title">btnClick1</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="built_in">this</span>.$refs.child.name);  <span class="comment">//访问子组件变量（通过ref标识）</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="function"><span class="title">btnClick2</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.$refs.child.show(<span class="number">123</span>);  <span class="comment">//访问子组件方法（通过ref标识）</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    components: &#123;</span><br><span class="line">      cpn: cpn  <span class="comment">//注册子组件</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意：</p>
<ul>
<li>使用<code>$refs </code>时，前端的子组件实例化对象要用<code>ref</code>做唯一标识，父组件通过该标识调用对应的子组件</li>
<li>使用<code>$children</code>时，前端的子组件实例化对象无需标识：
<ul>
<li>后端使用<code>this.$children</code>：会返回一个数组，数组内部是全部的子组件对象</li>
<li>后端使用<code>this.$children(index)</code>：会返回对应索引的子组件对象</li>
</ul>
</li>
</ul>
</blockquote>
<h4 id="子组件访问父组件">子组件访问父组件</h4>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--Vue实例化对象（根组件模板）--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">fcpn</span>&gt;</span><span class="tag">&lt;/<span class="name">fcpn</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--父组件模板--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span> <span class="attr">id</span>=<span class="string">&quot;fcpn&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>我是父组件<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ccpn</span>&gt;</span><span class="tag">&lt;/<span class="name">ccpn</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--子组件模板--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span> <span class="attr">id</span>=<span class="string">&quot;ccpn&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>我是子组件<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;btnClick1&quot;</span>&gt;</span>按钮（属性）<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;btnClick2&quot;</span>&gt;</span>按钮（方法）<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="comment">//子组件构造器</span></span><br><span class="line">  <span class="keyword">const</span> ccpn = Vue.extend(&#123;</span><br><span class="line">    template: <span class="string">&#x27;#ccpn&#x27;</span>,</span><br><span class="line">    methods: &#123;</span><br><span class="line">      <span class="function"><span class="title">btnClick1</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="built_in">this</span>.$parent.message);  <span class="comment">//调用父组件数据</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="built_in">this</span>.$root.message);  <span class="comment">//调用根组件（Vue实例）数据</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="function"><span class="title">btnClick2</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.$parent.fshow(<span class="number">123</span>);  <span class="comment">//调用父组件方法</span></span><br><span class="line">        <span class="built_in">this</span>.$root.rshow(<span class="number">456</span>);  <span class="comment">//调用根组件（Vue实例）方法</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">//父组件构造器</span></span><br><span class="line">  <span class="keyword">const</span> fcpn = Vue.extend(&#123;</span><br><span class="line">    template: <span class="string">&#x27;#fcpn&#x27;</span>,</span><br><span class="line">    <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        message: <span class="string">&#x27;我是父组件的消息&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">      <span class="function"><span class="title">fshow</span>(<span class="params">value</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;这里是父组件的方法调用&#x27;</span>,value);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    components: &#123;</span><br><span class="line">      ccpn: ccpn  <span class="comment">//在父组件中注册子组件</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">//根组件（Vue实例）</span></span><br><span class="line">  <span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    el: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">    data: &#123;</span><br><span class="line">      message: <span class="string">&#x27;我是根组件（Vue实例）的消息&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">      <span class="function"><span class="title">rshow</span>(<span class="params">value</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;这里是根组件（Vue实例）的方法调用&#x27;</span>,value);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    components: &#123;</span><br><span class="line">      fcpn: fcpn  <span class="comment">//在根组件（Vue实例）中注册父组件</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h2 id="slot（插槽）">slot（插槽）</h2>
<p>组件的使用带来了模块化变成的好处，但是在多数场景下，组件中的具体内容并非一成不变的，如果仅为了组件有不同的样式或内容（其结构是一样的）而去另外再编写组件，则违背了这种模块化的思想。为此可以使用<code>slot（插槽）</code>来解决问题，可以在使用组件的时候插入不同的元素以应对各类场景。</p>
<h3 id="基本使用-2">基本使用</h3>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">cpn</span>&gt;</span><span class="tag">&lt;<span class="name">button</span>&gt;</span>按钮<span class="tag">&lt;/<span class="name">button</span>&gt;</span><span class="tag">&lt;/<span class="name">cpn</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">cpn</span>&gt;</span><span class="tag">&lt;<span class="name">i</span>&gt;</span>字体倾斜<span class="tag">&lt;/<span class="name">i</span>&gt;</span><span class="tag">&lt;/<span class="name">cpn</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">cpn</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">value</span>=<span class="string">&quot;输入框&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">cpn</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">cpn</span>&gt;</span><span class="tag">&lt;<span class="name">b</span>&gt;</span>字体加粗<span class="tag">&lt;/<span class="name">b</span>&gt;</span><span class="tag">&lt;/<span class="name">cpn</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span> <span class="attr">id</span>=<span class="string">&quot;cpn&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>↓↓↓↓利用插槽实现不同功能<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">slot</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span>  <span class="comment">&lt;!--加入插槽（可以添加默认元素）--&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    el: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">    data: &#123;</span><br><span class="line">    &#125;,</span><br><span class="line">    components: &#123;</span><br><span class="line">      cpn: &#123;</span><br><span class="line">        template: <span class="string">&#x27;#cpn&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>效果如下：</p>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Vue组件化-slot-基本使用.png" style="zoom:80%;" />
<blockquote>
<p>注意：</p>
<ul>
<li>在组件模板中直接添加<code>&lt;slot&gt;</code>标签，即该位置就可以在组件具体使用时添加新的元素</li>
<li>在<code>&lt;slot&gt;</code>标签内部可以加入默认元素，如果在使用组件时未在<code>&lt;slot&gt;</code>标签位置处添加任何元素，则会显示默认值</li>
<li>如果仅有一个<code>&lt;slot&gt;</code>标签，而在使用时添加了多个元素，则添加的元素都会显示到<code>&lt;slot&gt;</code>标签位置处</li>
</ul>
</blockquote>
<h3 id="具名插槽">具名插槽</h3>
<p>在正常使用的时候都会给每一个<code>&lt;slot&gt;</code>标签添加<code>name</code>属性，以方便对应插槽添加相应的元素。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">cpn</span>&gt;</span><span class="tag">&lt;/<span class="name">cpn</span>&gt;</span>  <span class="comment">&lt;!--默认情况--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">cpn</span>&gt;</span>        <span class="comment">&lt;!--添加属性--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span>  <span class="attr">slot</span>=<span class="string">&quot;left&quot;</span>&gt;</span>左边按钮<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span>  <span class="attr">slot</span>=<span class="string">&quot;center&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">value</span>=<span class="string">&quot;中间输入框&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">i</span>  <span class="attr">slot</span>=<span class="string">&quot;right&quot;</span>&gt;</span>右边倾斜文字<span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">cpn</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span> <span class="attr">id</span>=<span class="string">&quot;cpn&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">slot</span> <span class="attr">name</span>=<span class="string">&quot;left&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>这是左边的插槽<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">slot</span> <span class="attr">name</span>=<span class="string">&quot;center&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>这是中间的插槽<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">slot</span> <span class="attr">name</span>=<span class="string">&quot;right&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>这是右边的插槽<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    el: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">    data: &#123;</span><br><span class="line">    &#125;,</span><br><span class="line">    components: &#123;</span><br><span class="line">      cpn: &#123;</span><br><span class="line">        template: <span class="string">&#x27;#cpn&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意：</p>
<ul>
<li>组件模板中的<code>&lt;slot&gt;</code>标签添加<code>name</code>属性以做区分</li>
<li>使用时在不同的元素标签中添加<code>slot</code>属性以做对应</li>
</ul>
</blockquote>
<div class="note warning simple"><p>Vue官方：</p>
<p>在 2.6.0 中，我们为具名插槽和作用域插槽引入了一个新的统一的语法 (即 <code>v-slot</code> 指令)。它取代了<code>slot</code> 和 <code>slot-scope</code> 这两个目前已被废弃但未被移除且仍在<a href="https://cn.vuejs.org/v2/guide/components-slots.html#%E5%BA%9F%E5%BC%83%E4%BA%86%E7%9A%84%E8%AF%AD%E6%B3%95">文档中</a>的 attribute。</p>
<p>自 2.6.0 起被废弃。新推荐的语法请查阅<a href="https://cn.vuejs.org/v2/guide/components-slots.html#%E5%85%B7%E5%90%8D%E6%8F%92%E6%A7%BD">这里</a>。</p>
</div>
<blockquote>
<p>说明：</p>
<ul>
<li>新版本在使用的时候组件模板不变（依旧是使用<code>name</code>关键字进行标识），但是在实例使用时用<code>v-slot</code>代替了<code>slot</code>。</li>
<li><code>v-slot</code>的语法糖：<code>#</code></li>
</ul>
</blockquote>
<h3 id="编译的作用域">编译的作用域</h3>
<p>在掌握作用域插槽之前先来了解一下编译的作用域。</p>
<p>假设父、子组件中都有变量message，那么在父、子模板中同时使用<code>Mustache</code>语法去访问message变量。访问到数据的规则如下：</p>
<p>在哪个模板中进行访问，就在哪个构造器中寻找变量。（即父模板（本例为Vue实例）就去Vue构造对象中寻找，子组件模板就去子组件构造器中寻找）</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">  <span class="comment">&lt;!--Vue实例（父组件模板）--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h2</span>&gt;</span>我是父组件<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">  &#123;&#123;message&#125;&#125;  <span class="comment">&lt;!--访问的是Vue（父组件）中的message--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">cpn</span>&gt;</span><span class="tag">&lt;/<span class="name">cpn</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--子组件模板--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span> <span class="attr">id</span>=<span class="string">&quot;cpn&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>我是子组件<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    &#123;&#123;message&#125;&#125;  <span class="comment">&lt;!--访问的是子组件中的message--&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="comment">//子组件构造器</span></span><br><span class="line">  <span class="keyword">const</span> cpn = Vue.extend(&#123;</span><br><span class="line">    template: <span class="string">&#x27;#cpn&#x27;</span>,</span><br><span class="line">    <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">          message: <span class="string">&#x27;我是子组件的消息&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">//Vue（父组件）</span></span><br><span class="line">  <span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    el: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">    data: &#123;</span><br><span class="line">      message: <span class="string">&#x27;我是父组件的消息&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    components: &#123;</span><br><span class="line">      cpn: cpn</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>效果如下：</p>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Vue组件化-slot-作用域.png" style="zoom:80%;" />
<h3 id="作用域插槽">作用域插槽</h3>
<p>现在有这样一个需求：子组件有一组列表数据，并且子组件模板有默认的展示方式，但是前端在父组件实例中希望更换一种展示方式，因此要访问子组件的数据。由上一个知识点可以知道这是无法访问的，由此可以使用作用域插槽：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">cpn</span>&gt;</span><span class="tag">&lt;/<span class="name">cpn</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">cpn</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--Vue2.5.x的版本要求必须嵌套一个template模板，以获取子组件中传递来的数据--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">template</span> <span class="attr">slot-scope</span>=<span class="string">&quot;slotdata&quot;</span>&gt;</span>  <span class="comment">&lt;!--通过slot-scope属性访问，后面的名字随便起--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123;slotdata.data.join(&#x27; ---- &#x27;)&#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span>  <span class="comment">&lt;!--将列表元素以----分割展示--&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">cpn</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span> <span class="attr">id</span>=<span class="string">&quot;cpn&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--利用solt标签绑定数据，传递给父模板使用（data）--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">slot</span> <span class="attr">:data</span>=<span class="string">&quot;cpnlanguages&quot;</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;item in cpnlanguages&quot;</span>&gt;</span>&#123;&#123;item&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="comment">//子组件构造器</span></span><br><span class="line">  <span class="keyword">const</span> cpn = Vue.extend(&#123;</span><br><span class="line">    template: <span class="string">&#x27;#cpn&#x27;</span>,</span><br><span class="line">    <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        cpnlanguages: [<span class="string">&#x27;JavaScript&#x27;</span>, <span class="string">&#x27;C++&#x27;</span>, <span class="string">&#x27;Java&#x27;</span>, <span class="string">&#x27;C#&#x27;</span>, <span class="string">&#x27;Python&#x27;</span>, <span class="string">&#x27;Go&#x27;</span>, <span class="string">&#x27;Swift&#x27;</span>,<span class="string">&#x27;php&#x27;</span>]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    el: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">    data: &#123;</span><br><span class="line">    &#125;,</span><br><span class="line">    components: &#123;</span><br><span class="line">      cpn: cpn</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>效果如下：</p>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Vue组件化-slot-作用域插槽.png" style="zoom:80%;" />
<div class="note warning simple"><p>Vue官方：</p>
<p>在 2.6.0 中，我们为具名插槽和作用域插槽引入了一个新的统一的语法 (即 <code>v-slot</code> 指令)。它取代了 <code>slot</code> 和 <code>slot-scope</code> 这两个目前已被废弃但未被移除且仍在<a href="https://cn.vuejs.org/v2/guide/components-slots.html#%E5%BA%9F%E5%BC%83%E4%BA%86%E7%9A%84%E8%AF%AD%E6%B3%95">文档中</a>的 attribute。</p>
<p>自 2.6.0 起被废弃。新推荐的语法请查阅<a href="https://cn.vuejs.org/v2/guide/components-slots.html#%E4%BD%9C%E7%94%A8%E5%9F%9F%E6%8F%92%E6%A7%BD">这里</a>。</p>
</div>
<hr>
<h1>后记</h1>
<p>再看到Vue3版本的变动内容后回头补充。</p>
]]></content>
      <categories>
        <category>学习笔记</category>
      </categories>
      <tags>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>操作系统学习笔记-I/O管理和磁盘调度</title>
    <url>/2021/06/02/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-I-O%E7%AE%A1%E7%90%86%E5%92%8C%E7%A3%81%E7%9B%98%E8%B0%83%E5%BA%A6/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\css\APlayer.min.css"><script src="\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\js\Meting.min.js"></script><h1>前言</h1>
<p><em>正在学习操作系统，记录笔记。</em></p>
<blockquote>
<p>参考资料：</p>
<p>《操作系统（精髓与设计原理 第8版） 》</p>
</blockquote>
<hr>
<h1>第十一章：I/O管理和磁盘调度</h1>
<h2 id="I-O设备">I/O设备</h2>
<p>I/O设备大体上可以分为如下三类：</p>
<ul>
<li>人可读：顾名思义就是其面向的用户群体是人，具体有：
<ul>
<li>打印机</li>
<li>终端（包含：显示器、键盘、鼠标等）</li>
</ul>
</li>
<li>机器可读：面向电子设备通信，具体有：
<ul>
<li>磁盘、磁带驱动器</li>
<li>传感器</li>
<li>控制器</li>
</ul>
</li>
<li>通信：适用于与远程设备通信，如：
<ul>
<li>数字线路驱动器</li>
<li>调制解调器</li>
</ul>
</li>
</ul>
<p>数据传送速率：不同类型的I/O设备，数据传送速率可能会相差几个数量级，如下图：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E4%B8%8D%E5%90%8CIO%E8%AE%BE%E5%A4%87%E7%9A%84%E9%80%9F%E7%8E%87.png" alt=""></p>
<p>用途：设备用途对操作系统及其支撑设施中的软件和策略都有影响。</p>
<ul>
<li>用于存储文件的磁盘需要文件管理软件的支持</li>
<li>虚拟内存需要特殊硬件软件支持</li>
<li>终端既可被普通用户使用，也可被系统管理员使用。</li>
</ul>
<p>控制的复杂性：例如，打印机仅需要一个相对简单的控制接口，而磁盘的控制接口则要复杂得多。</p>
<p>传送单位：数据可按字节流或字符流的形式传送（如终端I/O），也可按更大的块传送（如磁盘I/O）。</p>
<p>错误条件：随着设备的不同，错误的性质、报告错误的方式、错误造成的后果及有效的响应范围，都各不相同。</p>
<blockquote>
<p>以上的差异使得不管是从操作系统的角度，还是从用户进程的角度，都很难找到一种统一的、一致的I/O解决方法。</p>
</blockquote>
<h2 id="I-O功能的组织">I/O功能的组织</h2>
<p>有三种执行I/O的技术（具体可以看<a href="https://cnhuazhu.gitee.io/2021/03/14/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%BF%B0/">第一章</a>的内容，这里不过多介绍）：</p>
<ul>
<li>
<p>可编程I/O：处理器代表一个进程给I/O模块发送一个I/O命令；该进程进入忙等待，直到操作完成才能继续执行。</p>
<blockquote>
<p>缺点：当执行I/O操作时，处理器容易进入忙等待状态（空闲），造成处理器资源浪费。</p>
</blockquote>
</li>
<li>
<p>中断驱动I/O：处理器代表进程向I/O模块发出一个I/O命令。有两种可能性：</p>
<ul>
<li>
<p>若来自进程的I/O指令是非阻塞的，则处理器继续执行发出I/O命令的进程的后续指令。</p>
</li>
<li>
<p>若I/O指令是阻塞的，则处理器执行的下一条指令来自操作系统，它将当前的进程设置为阻塞态并调度其他进程。</p>
<blockquote>
<p>引入中断机制。</p>
<p>缺点：虽然缓解了忙等待状况，但是最后数据在I/O设备与主存之间传输的过程要依赖于处理器。</p>
</blockquote>
</li>
</ul>
</li>
<li>
<p>直接存储器访问（Direct Memory Access，DMA）：一个DMA模块（作为“代理CPU”）控制内存和I/O模块之间的数据交换。为传送一块数据，处理器给DMA模块发请求，且只有在整个数据块传送结束后，它才被中断。</p>
<blockquote>
<p>数据在I/O设备与主存之间传输的整个过程只产生两次中断：</p>
<ul>
<li>在调用I/O设备前，处理器向I/O设备发出指令</li>
<li>数据传输完之后，DMA模块向I/O设备发出中断（告知“数据传输完毕”）</li>
</ul>
<p>优势：数据在I/O设备与主存之间传输不依赖于处理器。</p>
</blockquote>
</li>
</ul>
<p>小结I/O执行技术</p>
<table>
<thead>
<tr>
<th></th>
<th>无中断</th>
<th>使用中断</th>
</tr>
</thead>
<tbody>
<tr>
<td>通过处理器实现I/O和内存间的传送</td>
<td>可编程I/O</td>
<td>中断驱动I/O</td>
</tr>
<tr>
<td>I/O和内存间直接传送</td>
<td></td>
<td>直接存储器访问（DMA）</td>
</tr>
</tbody>
</table>
<h3 id="I-O功能的发展">I/O功能的发展</h3>
<ol>
<li>
<p>处理器直接控制外围设备：这在简单的微处理器控制设备中可以见到。</p>
</li>
<li>
<p>增加了控制器或I/O模块：引入无中断的可编程I/O。</p>
<blockquote>
<p>从该阶段开始，处理器无需处理外部设备的细节。</p>
</blockquote>
</li>
<li>
<p>同上一阶段基本相同，但是采用了中断的方式：处理器无须费时间等待执行一次I/O操作，因而提高了效率。</p>
</li>
<li>
<p>DMA模块的引入：数据块在I/O设备和内存中移动无需处理器参与，仅在传送开始和结束时才需要用到处理器。</p>
</li>
<li>
<p>I/O模块有一个独立处理器：有专门为I/O设计的指令集，中央处理器指导I/O处理器执行内存中的一个I/O程序。I/O处理器在没有中央处理器干涉的情况下取指令并执行这些指令。这就使得中央处理器可以指定一系列的I/O活动，且仅在整个序列执行完成后中央处理器才被中断。</p>
<blockquote>
<p>该阶段的I/O模块通常称为：I/O channel (I/O通道)</p>
</blockquote>
</li>
<li>
<p>I/O模块有自己的局部存储器，事实上其本身就是一台计算机：</p>
<ul>
<li>使用这种体系结构可以控制许多I/O设备，并使需要中央处理器参与的部分降到最小</li>
<li>这种结构通常用于控制与交互终端的通信，I/O处理器负责大多数控制终端的任务</li>
</ul>
<blockquote>
<p>该阶段的I/O模块通常称为：I/O processor (I/O处理器)</p>
</blockquote>
</li>
</ol>
<h3 id="直接存储器访问（DMA）">直接存储器访问（DMA）</h3>
<p>下图是典型的DMA框图</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OSDMA%E6%A1%86%E5%9B%BE.png" alt=""></p>
<blockquote>
<p>说明：</p>
<ul>
<li>Data Count：保存此次传输的数据的字节数</li>
<li>Data Register：存放正在传输的数据</li>
<li>Address Register：基址寄存器</li>
<li>Control Logic：其他的一些功能</li>
</ul>
<p>DMA工作流程：</p>
<ol>
<li>处理器和DMA模块之间有读写控制线，基于此处理器可以向DMA模块发送命令（请求I/O）</li>
<li>DMA模块直接负责I/O设备到内存之间的数据传输（不需要处理器）</li>
<li>在数据传输完之后，DMA模块向处理器发送一个中断信号</li>
</ol>
</blockquote>
<p>DMA机制的配置：</p>
<ul>
<li>
<p>所有模块共享同一个系统总线：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OSDMA%E6%9C%BA%E5%88%B6%E4%B8%80.png" alt=""></p>
<ul>
<li>DMA模块充当代理处理器</li>
<li>同一时刻只允许一个I/O设备和主存进行交互，否则会出现数据冲突</li>
<li>同一个时间段可以有多台I/O设备和主存进行交互——分时复用</li>
<li>排队的情况很严重，虽然这样的设计开销不大，但是效率很低</li>
</ul>
</li>
<li>
<p>集成DMA和I/O：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OSDMA%E6%9C%BA%E5%88%B6%E4%BA%8C.png" alt=""></p>
<ul>
<li>
<p>减少了I/O对DMA模块的竞争</p>
<blockquote>
<p>在DMA模块和一个或多个I/O模块之间还存在一条不包含系统总线的路径。DMA逻辑实际上可能就是I/O模块的一部分，或可能是控制一个或多个I/0模块的一个单独模块。</p>
</blockquote>
</li>
</ul>
</li>
<li>
<p>增加I/O局部总线：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OSDMA%E6%9C%BA%E5%88%B6%E4%B8%89.png" alt=""></p>
<ul>
<li>DMA模块中I/O接口的数量减少到1</li>
<li>易扩展</li>
</ul>
<blockquote>
<p>第二、三种方式：DMA和I/O模块之间的数据交换是脱离系统总线完成的。</p>
</blockquote>
</li>
</ul>
<h2 id="操作系统设计问题">操作系统设计问题</h2>
<h3 id="设计目标">设计目标</h3>
<p>在设计I/O机制时，最重要的两个目标就是：效率（Efficiency）、通用性（Generality）。</p>
<ul>
<li>
<p>效率：</p>
<ul>
<li>
<p>I/O操作通常是计算机系统的瓶颈。</p>
<blockquote>
<p>之前也提到过，大多数I/O设备都是机械运动，而处理器是电信号的处理，二者的速度差距在几个数量级。</p>
</blockquote>
</li>
<li>
<p>解决上述问题的一种方式是引入多道程序设计。这样可以缓解，但不能彻底解决问题。我们想象一种极端情况：在并发度达到最大时，所有的进程都在等待I/O设备，那么这时也会出现CPU空闲状态，效率并不能有效提高。</p>
</li>
<li>
<p>于是引入交换技术。用于将额外的就绪进程加载进内存，从而使处理器处于工作状态。（这本身就是一个I/O操作）</p>
</li>
</ul>
</li>
<li>
<p>通用性：处于简单和避免错误的考虑，希望能用一种统一的方式处理所有设备。</p>
<blockquote>
<p>注：有些版本将“通用性”翻译为“设备的独立性”。</p>
</blockquote>
<ul>
<li>
<p>处理器看待I/O设备的方式统一。</p>
</li>
<li>
<p>操作系统管理I/O设备和IVO操作的方式统一。</p>
<blockquote>
<p>由于设备特性的多样性，在实际中很难真正实现通用性。</p>
<p>目前所能做的就是用一种层次化、模块化的方法设计I/O功能。这种方法隐藏了大部分I/O设备低层例程中的细节，使得用户进程和操作系统高层可以通过如读、写、打开、关闭、加锁和解锁等通用的函数来操作I/O设备。</p>
</blockquote>
</li>
</ul>
</li>
</ul>
<h3 id="I-O功能的逻辑结构">I/O功能的逻辑结构</h3>
<p>分层的原理是：操作系统的功能可以根据其复杂性、特征时间尺度和抽象层次来分开。</p>
<p>将分层原理应用于I/O机制，具体如下图：</p>
<h3 id="img-src-https-cdn-jsdelivr-net-gh-CNhuazhu-Image-OSIO层次结构-png-style-zoom-80"><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OSIO层次结构.png" style="zoom:80%;" /></h3>
<blockquote>
<p>说明：</p>
<ul>
<li>逻辑I/O（Logical I/O）：逻辑I/O模块把设备当作一个逻辑资源来处理，它并不关心实际控制设备的细节。</li>
<li>设备I/O（Device I/O）：请求的操作和数据（缓冲的数据、记录等）被转换为适当的I/O指令序列、通道命令和控制器命令。</li>
<li>调度和控制（Scheduling &amp; control）：I/O操作的排队、调度实际上发生在这一层。</li>
<li>目录管理（Directory management）：在这一层，符号文件被转换为标识符，采用标识符时可通过文件描述符表或索引表直接或间接地访问文件。</li>
<li>文件系统（File system）：这一层处理文件的逻辑结构及用户指定的操作，如打开、关闭、读、写等。这一层还管理访问权限。</li>
<li>物理组织（Physical organization）：考虑到辅存设备的物理磁道和扇区结构，对于文件和记录的逻辑访问必须转换为物理外存地址。辅助存储空间和内存缓冲区的分配通常也在这一层处理。</li>
</ul>
</blockquote>
<h2 id="I-O缓冲">I/O缓冲</h2>
<p>缓存（buffering）的原因：</p>
<ul>
<li>处理器在I/O完成之前必须等待</li>
<li>在页交换的过程中，某些页必须驻留内存</li>
</ul>
<blockquote>
<p>缓存（buffer）：内存当中预留的一个区域，用来暂存I/O通讯的数据。</p>
<p>举例：</p>
<ul>
<li>printf函数：可能有时候会出现明明在程序中写了printf，但是并没有如期望般那样得到输出结果。这是因为printf是一个带缓冲的输出打印。printf本身会调用一个系统调用，会产生进程切换，如果仅为了打印一句“Hello World”就使用进程切换，可以认为这是没必要的。所以会当缓冲区满了的时候再一次性打印出来。（如果必要，我们也可以用fflush去强制清除缓存，将其打印出来）</li>
<li>打印机：在使用打印机的时候可以看到计算机屏幕上显示进度条（完成一页、两页…），待到进度条完成之后，打印机才开始工作。进度条展示的其实就是将数据存储到缓冲区的进度，当执行完成后，处理器就可以完成其他的任务去了，接下来才是打印机去访问缓冲区，将数据真实地打印出来。</li>
</ul>
<p>优点：</p>
<ul>
<li>可以让CPU和I/O并行操作</li>
<li>减少中断次数</li>
<li>提高CPU效率</li>
</ul>
</blockquote>
<p>缓冲的定义：在输入请求发出前就开始执行输入传送，并且在输出请求发出一段时间之后才开始执行输出传送。</p>
<blockquote>
<p>光看定义可能有些不知所云，往下看，慢慢体会。</p>
</blockquote>
<p>在讨论各种缓冲方法之前，首先要区分两类I/O设备：</p>
<ul>
<li>面向块（Block-oriented）的I/O设备：
<ul>
<li>将信息保存到固定大小的块中</li>
<li>传送过程中一次传输一块</li>
<li>通常可以通过块号访问数据</li>
<li>举例：磁盘、磁带、USB智能卡</li>
</ul>
</li>
<li>面向流（Stream-oriented）的I/O设备：
<ul>
<li>以字节流的方式输入\输出数据</li>
<li>举例：终端、打印机、通信端口、鼠标和其他指示设备及其他大多数非辅存设备</li>
</ul>
</li>
</ul>
<h3 id="单缓冲">单缓冲</h3>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E5%8D%95%E7%BC%93%E5%86%B2.png" alt=""></p>
<ul>
<li>I/O设备先将传送的数据移入到系统缓冲区中（I/O → 内存）</li>
<li>上一步传输完成时，进程把该块移动到用户空间（内存 → 内存）</li>
<li>紧接着，根据局部性原理，会预先请求另一个数据块，将其移入缓冲区（预读；或预先输入）</li>
</ul>
<p>优点：</p>
<ul>
<li>用户进程可在下一数据块读取的同时，处理已读入的数据块</li>
<li>输入发生在系统内存而非用户进程内存，因此操作系统可以将该进程换出</li>
</ul>
<p>缺点：</p>
<ul>
<li>
<p>操作系统必须记录给用户进程分配系统缓冲区的情况</p>
<blockquote>
<p>操作系统维护用户进程系统缓冲区。</p>
</blockquote>
</li>
<li>
<p>交换逻辑也受到影响</p>
<blockquote>
<p>I/O操作所涉及的磁盘和用于交换的磁盘是同一个磁盘时，磁盘写操作排队等待将进程换出到同一个设备上是没有任何意义的。若试图换出进程并释放内存，则要在I/O操作完成后才能开始，而在这时，把进程换出到磁盘已经不再合适。</p>
</blockquote>
</li>
</ul>
<p>面向流的单缓冲：</p>
<ul>
<li>每次传送一行的方式或每次传送一字节的方式</li>
<li>用户在终端每次输入一行，用回车表示到达行尾</li>
<li>输出到终端时也是类似地每次输出一行</li>
</ul>
<h3 id="双缓冲">双缓冲</h3>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E5%8F%8C%E7%BC%93%E5%86%B2.png" alt=""></p>
<ul>
<li>
<p>在内存中为操作系统分配两个系统缓冲区</p>
</li>
<li>
<p>输入输出交替使用</p>
<blockquote>
<p>在一个进程向一个缓冲区中传送数据（从这个缓冲区中取数据）的同时，操作系统正在清空（或填充）另一个缓冲区，这种技术称为双缓冲（double buffering）或缓冲交换（buffer swapping）。</p>
</blockquote>
</li>
</ul>
<h3 id="循环缓冲">循环缓冲</h3>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E5%BE%AA%E7%8E%AF%E7%BC%93%E5%86%B2.png" alt=""></p>
<ul>
<li>内存中有两个以上的缓冲区</li>
<li>每个单缓冲区是循环缓冲器的一个单元</li>
<li>平滑I/O操作和进程之间的数据流</li>
</ul>
<h2 id="磁盘调度">磁盘调度</h2>
<h3 id="磁盘性能">磁盘性能</h3>
<p>磁盘的内部结构如下图：</p>
<img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS磁盘模型1.png" style="zoom: 50%;" />
<blockquote>
<p>说明：为了读或写，磁头必须定位于指定的磁道和该磁道中指定扇区的开始处。</p>
</blockquote>
<p>磁盘性能参数：</p>
<ul>
<li>寻道时间（Seek time ）：磁头定位到磁道所需要的时间称为寻道时间。</li>
<li>旋转延迟（Rotational delay ）：磁头到达扇区开始位置的时间称为旋转延迟。</li>
<li>传输时间（transfer time）：磁头定位完成就开始读操作或写操作，这就是数据传输，传输的时间就是传输时间。</li>
</ul>
<p><strong>磁盘调度（重点）</strong>：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E7%A3%81%E7%9B%98%E7%9A%84%E6%80%A7%E8%83%BD.png" alt=""></p>
<p>上图为磁盘I/O传送的一般时序图：</p>
<p><strong>等待I/O设备 → 等待通道 → 寻道（确定磁道） → 旋转延迟（确定扇区） → 数据传输延迟</strong></p>
<blockquote>
<p>相关计算：</p>
<p>传输时间：</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>T</mi><mo>=</mo><mfrac><mi>b</mi><mrow><mi>r</mi><mi>N</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">T = \frac{b}{rN}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.05744em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.37144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">b</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<ul>
<li>T：传输时间</li>
<li>b：要传送的字节数</li>
<li>N：一个磁道中的字节数</li>
<li>r：旋转速度（单位：转/秒）</li>
</ul>
<p>总平均存取时间：</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>T</mi><mi>a</mi></msub><mo>=</mo><msub><mi>T</mi><mi>s</mi></msub><mo>+</mo><mfrac><mn>1</mn><mrow><mn>2</mn><mi>r</mi></mrow></mfrac><mo>+</mo><mfrac><mi>b</mi><mrow><mi>r</mi><mi>N</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">T_a = T_s + \frac{1}{2r} +\frac{b}{rN}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">a</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:2.00744em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:2.05744em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.37144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">b</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<ul>
<li>T<sub>s</sub>：平均寻道时间</li>
</ul>
</blockquote>
<h3 id="磁盘调度策略">磁盘调度策略</h3>
<p>不同磁盘调度的性能差异的原因可以追溯到寻道时间。因此为了提高性能，需要减少花费在寻道上的时间。</p>
<p>考虑多道程序环境中的一种典型情况：即操作系统为每个I/O设备维护一个请求队列。</p>
<ul>
<li>对于一个磁盘来说，队列中可能有来自多个进程的许多I/O请求（读和写）</li>
<li>随机调度（random scheduling）：随机访问磁道。该种方法性能最差，可用于评估其他技术。</li>
</ul>
<p>下面我们将会介绍八种磁盘调度策略，在介绍时会统一以一个例子进行：</p>
<blockquote>
<p>例子：</p>
<p>假设磁盘有200个磁道，磁盘请求队列中是一些随机请求。被请求的磁道，按照磁盘调度程序的接收顺序分别为：</p>
<p><strong>55、58、39、18、90、160、150、38、184</strong></p>
<p>说明：</p>
<p>假设以磁道号为100处开始寻道。</p>
<p>具体以折线图的形式展示：纵轴表示磁盘上的磁道；横轴表示时间（或跨越磁道的数量）。</p>
</blockquote>
<h4 id="优先级（Priority，PRI）">优先级（Priority，PRI）</h4>
<ul>
<li>此方法不会优化磁盘的利用率</li>
<li>通常较短的批作业和交互作业的优先级较高</li>
<li>可以提供较好的交互响应时间</li>
</ul>
<h4 id="先进先出（First-in-First-out，FIFO）">先进先出（First-in First-out，FIFO）</h4>
<p>处理请求的顺序（如下图）：<code>55、58、39、18、90、160、150、38、184</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E7%A3%81%E7%9B%98%E8%B0%83%E5%BA%A6%E5%85%88%E8%BF%9B%E5%85%88%E5%87%BA.png" alt=""></p>
<ul>
<li>这是最简单的调度策略</li>
<li>按照收到请求的顺序进行处理</li>
<li>优点：公平对待每个请求</li>
<li>缺点：并未对磁头的访问有任何优化，效率最差。在多进程环境中，性能接近随机调度。</li>
</ul>
<h4 id="后进先出（Last-in-First-out，LIFO）">后进先出（Last-in First-out，LIFO）</h4>
<p>处理请求的顺序：<code>184、38、150、160、90、18、39、58、55</code></p>
<ul>
<li>
<p>考虑到了局部性原理</p>
<blockquote>
<p>在事物处理系统中，由于顺序读取文件的缘故，把设备分配给最后到来的用户，可减少磁臂的运动，甚至没有磁臂运动。</p>
</blockquote>
</li>
<li>
<p>缺点：可能会产生饥饿</p>
<blockquote>
<p>假设队列中不停地有新的请求，那么最先进入队列的请求很可能饥饿。</p>
</blockquote>
</li>
</ul>
<h4 id="最短服务时间优先（Shortest-Service-Time-First-，SSTF）">最短服务时间优先（Shortest Service Time First ，SSTF）</h4>
<p>处理请求的顺序（如下图）：<code>90、58、55、39、38、18、150、160、184</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E7%A3%81%E7%9B%98%E8%B0%83%E5%BA%A6%E6%9C%80%E7%9F%AD%E6%9C%8D%E5%8A%A1%E6%97%B6%E9%97%B4%E4%BC%98%E5%85%88.png" alt=""></p>
<ul>
<li>
<p>策略：选择使磁头臂从当前位置开始移动最少的磁盘I/O请求（如果两个距离相等，随机选择方向）</p>
</li>
<li>
<p>总是选择最小寻道时间的请求</p>
<blockquote>
<p>考虑的指标太单一，并不能保证平均寻道时间最小</p>
</blockquote>
</li>
<li>
<p>可能会产生饥饿</p>
<blockquote>
<p>如果不停有新的请求，该请求距离磁头很近，那么距离磁头较远的请求可能饥饿。</p>
</blockquote>
</li>
</ul>
<h4 id="SCAN（扫描，电梯算法）">SCAN（扫描，电梯算法）</h4>
<p>处理请求的顺序（如下图）：<code>55、58、39、18、90、160、150、38、184</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OSSCAN.png" alt=""></p>
<ul>
<li>
<p>策略：磁头臂仅沿一个方向移动，并在途中满足所有未完成的请求，直到它达到这个方向上的最后一个磁道，或者在这个方向上没有其他请求为止，反转扫描方向。</p>
<p>考虑了局部性原理</p>
<blockquote>
<p>这种定向移动的形式类似于电梯，因此也被称为“电梯算法”。</p>
</blockquote>
</li>
<li>
<p>可以解决饥饿</p>
</li>
<li>
<p>问题：基于该例假设，假设在处理完184号磁道请求之后，磁头反向扫描，这时又有新的185号磁道访问请求，那么磁头会扫描一轮之后再回来处理，显然是不合理的。</p>
</li>
</ul>
<h4 id="C-SCAN（循环扫描）">C-SCAN（循环扫描）</h4>
<p>处理请求的顺序（如下图）：<code>55、58、39、18、90、160、150、38、184</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OSCSCAN.png" alt=""></p>
<ul>
<li>策略：将扫描方向固定。当访问到沿某个方向的最后一个磁道时，磁头臂返回到磁道相反方向末端的磁道。</li>
<li>可以解决SCAN的问题。减少了新请求的最大延迟。</li>
</ul>
<h4 id="N-step-SCAN">N-step-SCAN</h4>
<ul>
<li>将磁盘请求队列划分为长度为N的n个子队列</li>
<li>对于n个子队列采取FIFO算法</li>
<li>对于子队列中的N个请求，采取SCAN算法</li>
<li>如果有新的请求，将其添加到新的队列中去</li>
</ul>
<h4 id="FSCAN">FSCAN</h4>
<ul>
<li>使用两个子队列</li>
<li>扫描开始时，所有请求都在一个队列中，另一个队列为空。</li>
<li>在扫描过程中，所有新到的请求都放入另一个队列。</li>
</ul>
<h4 id="磁盘调度算法比较">磁盘调度算法比较</h4>
<p>比较FIFO、SSTF、SCANF、C-SCAN算法，如下图：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E7%A3%81%E7%9B%98%E8%B0%83%E5%BA%A6%E6%AF%94%E8%BE%83.png" alt=""></p>
<blockquote>
<p>注意：计算平均寻道时间时，注意分母的取值。</p>
<p>以FIFO为例</p>
<ul>
<li>从磁道100处开始：</li>
</ul>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>A</mi><mi>V</mi><mi>E</mi><mo>=</mo><mfrac><mrow><mn>45</mn><mo>+</mo><mn>3</mn><mo>+</mo><mn>19</mn><mo>+</mo><mn>21</mn><mo>+</mo><mn>72</mn><mo>+</mo><mn>70</mn><mo>+</mo><mn>10</mn><mo>+</mo><mn>112</mn><mo>+</mo><mn>146</mn></mrow><mn>9</mn></mfrac><mo>=</mo><mn>55.3</mn></mrow><annotation encoding="application/x-tex">AVE = \frac{45+3+19+21+72+70+10+112+146}{9} = 55.3
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.00744em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">9</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">45</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">3</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">19</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">21</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">72</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">70</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">10</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">112</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">146</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">55.3</span></span></span></span></span></p>
<ul>
<li>从磁道55处开始：<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>A</mi><mi>V</mi><mi>E</mi><mo>=</mo><mfrac><mrow><mn>0</mn><mo>+</mo><mn>3</mn><mo>+</mo><mn>19</mn><mo>+</mo><mn>21</mn><mo>+</mo><mn>72</mn><mo>+</mo><mn>70</mn><mo>+</mo><mn>10</mn><mo>+</mo><mn>112</mn><mo>+</mo><mn>146</mn></mrow><mrow><mn>9</mn><mo>−</mo><mn>1</mn></mrow></mfrac><mo>=</mo><mn>56.625</mn></mrow><annotation encoding="application/x-tex">AVE = \frac{0+3+19+21+72+70+10+112+146}{9-1} = 56.625
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.09077em;vertical-align:-0.7693300000000001em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">9</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">1</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">3</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">19</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">21</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">72</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">70</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">10</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">112</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">146</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.7693300000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">56.625</span></span></span></span></span></p>
</li>
</ul>
<p><strong>注意磁头开始的位置</strong></p>
</blockquote>
<h2 id="RAID">RAID</h2>
<p>受限于技术，磁盘存储器的大小并不能无限扩大，虽然技术在不断进步，其大小也在逐渐增大，但要意识到一个问题，现实中我们对于磁盘存储的需求可能要远远大于其实际容量。</p>
<p>设计人员认识到这个问题，并提出了并行使用多个磁盘的方案。</p>
<p>独立磁盘冗余阵列（Redundant Array of Independent Disks，RAID）：</p>
<ul>
<li>物理上通过多个磁盘组成一个磁盘组，在逻辑上这是一个大容量的磁盘</li>
<li>使用冗余磁盘容量保存奇偶检验信息，保证在一个磁盘失效时，数据具有可恢复性</li>
</ul>
<p>RAID包含0~6共七个级别，这里仅介绍RAID0、RAID1、RAID5</p>
<h4 id="RAID0">RAID0</h4>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OSRAID0.png" alt=""></p>
<ul>
<li>实现高数据传送能力</li>
<li>实现告诉I/O请求率</li>
</ul>
<h4 id="RAID1">RAID1</h4>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OSRAID1.png" alt=""></p>
<ul>
<li>读请求可由包含被请求数据的任何一个磁盘提供服务，而不管哪个磁盘拥有最小寻道时间和旋转延迟。</li>
<li>写请求需要对两个响应的条带进行更新，但这可并行完成。</li>
<li>从失效中恢复很简单：当一个驱动器失效时，仍然可以从第二个驱动器访问到数据。</li>
</ul>
<h4 id="RAID5">RAID5</h4>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OSRAID5.png" alt=""></p>
<ul>
<li>把奇偶校验条带分布在所有磁盘中。</li>
</ul>
<hr>
<h1>后记</h1>
<p>本篇已完结</p>
<p>（如有修改或补充欢迎评论）</p>
]]></content>
      <categories>
        <category>学习笔记</category>
      </categories>
      <tags>
        <tag>操作系统</tag>
      </tags>
  </entry>
  <entry>
    <title>操作系统学习笔记-内存管理</title>
    <url>/2021/05/23/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\css\APlayer.min.css"><script src="\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\js\Meting.min.js"></script><h1>前言</h1>
<p><em>正在学习操作系统，记录笔记。</em></p>
<blockquote>
<p>参考资料：</p>
<p>《操作系统（精髓与设计原理 第6版） 》</p>
</blockquote>
<hr>
<h1>第七章：内存管理</h1>
<p>我们已经知道，在单道程序设计系统中，内存被划分成两部分：</p>
<ul>
<li>一部分供操作系统使用（驻留监控程序、内核）；</li>
<li>一部分供当前正在执行的程序使用。</li>
</ul>
<p>在多道程序设计系统中（我们重点关注于此）：</p>
<ul>
<li>必须在内存中进一步细分出“用户”部分，以支持多道程序</li>
<li>内存需要管理已确保有适当数目的就绪进程使用处理器时间</li>
</ul>
<p>这就是内存管理。</p>
<blockquote>
<p>内存管理的主要操作是处理器把程序装入内存中执行。</p>
</blockquote>
<p>先介绍一下本章将要提到的术语：</p>
<table>
<thead>
<tr>
<th>术语</th>
<th>解释</th>
</tr>
</thead>
<tbody>
<tr>
<td>页框（Frame）</td>
<td>内存中一个固定长度的块</td>
</tr>
<tr>
<td>页（Page）</td>
<td>一个固定长度的数据块，储存在二级存储器中（如磁盘）。数据页可以临时复制入内存中的页框中</td>
</tr>
<tr>
<td>段（Segment）</td>
<td>一个变长的数据块，储存在二级存储器中。整个段可以临时复制到内存的一个可用区域内（分段），或者可以将一个段分为许多页，将每页单独复制到内存中（分段与分页相结合）</td>
</tr>
</tbody>
</table>
<blockquote>
<p>强调！强调！强调！</p>
<p>英文中 <code>Frame</code> 有些被翻译为 <code>帧</code>，有些被翻译为 <code>页框</code>，笔者认为“页框”更加形象：从磁盘中取得页，将其安置在内存的页框中。当然各位都有自己的理解，但这不妨碍阅读。（题外话：<code>socket</code>被翻译为<code>套接字</code>，我属实有点费解，我觉得本意<code>插座、插孔</code>真的还要比“套接字”来的更好理解到底“socket”是为何物）</p>
<p>只是强调一下后面的内容，笔者都选择“页框”的翻译，这与“帧”是等价的。</p>
</blockquote>
<h2 id="内存管理的需求">内存管理的需求</h2>
<p>对内存管理提出了五点需求：</p>
<ol>
<li>重定位（Relocation）</li>
<li>保护（Protection）</li>
<li>共享（Sharing）</li>
<li>逻辑组织（Logical Organization）</li>
<li>物理组织（Physical Organization）</li>
</ol>
<p>接下来将逐一介绍</p>
<h3 id="重定位">重定位</h3>
<ul>
<li>
<p>程序员事先并不知晓在某个程序执行期间会有其他哪些程序驻留在内存中</p>
</li>
<li>
<p>当程序执行的时候，它可能被交换到磁盘，并且在被重新换入内存中时，可能会与上一次内存区域不同（重定位）</p>
<blockquote>
<p>为了使处理器利用率最大化，之前提到过采用了交换技术。即活动的进程可以换出/换入内存。但是如果强调被重新换入的进程的位置需要和上一次的内存区域相同，这会是一个很大的限制，为了避免这种限制。我们需要把进程重定位到内存的不同区域。</p>
</blockquote>
</li>
<li>
<p>处理器硬件和操作系统软件必须能够通过某种方式把程序代码中的内存访问转换成实际的物理内存地址，并反映程序在内存中的当前位置。</p>
</li>
</ul>
<p>接下来介绍三类地址的概念：</p>
<ul>
<li>逻辑地址（Logical Address）：与当前数据在内存中的物理分配地址无关的访问地址。（在执行对内存的访问之前必须将其转换为物理地址）</li>
<li>相对地址（Relative Address）：相对于某些已知点（通常是程序的开始处）的存储单元。</li>
<li>物理地址（Physical Address）/绝对地址：数据在内存中的实际位置。</li>
</ul>
<p>当程序被加载进内存时，它在内存中实际的绝对位置是已经确定的。</p>
<ul>
<li>
<p>由于交换技术，可能会导致一个进程占据不同的分区，这意味着在程序执行的过程在内存中会有不同的绝对位置。</p>
</li>
<li>
<p>压缩（Compaction）也会导致一个进程占据不同的分区。</p>
<blockquote>
<p>（注：绿色部分表示内存空闲区域，红色表示已被进程占用的部分）</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E5%8E%8B%E7%BC%A9.png" alt=""></p>
<p>由于交换技术，可能导致内存中会出现某些小区域（空闲）是无法加载任何进程的。称之为<strong>零头（fragment）</strong>。</p>
<p>为了使得内存得以有效利用，采用一种称为压缩/紧凑的技术，动态调整进程在内存中的位置，以减少零头。如此便会导致一个进程占据不同的分区的情况出现。</p>
</blockquote>
</li>
</ul>
<p>下面介绍两种重定位的方式：静态重定位（Static Relocation）以及动态重定位（Dynamic Relocation）</p>
<ol>
<li>
<p>静态重定位</p>
<p>在逻辑地址转换为物理地址的过程中，地址变换是在进程装入内存时一次完成的，以后不再改变。</p>
<ul>
<li>优点：无需增加硬件地址转换机构，便于实现程序的静态连接。（在早期计算机系统中大多采用这种方案。）</li>
<li>缺点：内存空间不能移动；各个用户进程很难共享内存中同一程序的副本。</li>
</ul>
</li>
<li>
<p>动态重定位</p>
<p>动态运行的装入程序把转入模块装入内存之后，并不立即把装入模块的逻辑地址进行转换，而是把这种地址转换推迟到程序执行时才进行，装入内存后的所有地址都仍是逻辑地址。这种方式需要寄存器的支持，其中放有当前正在执行的程序在内存空间中的起始地址。</p>
<ul>
<li>优点：内存空间可以移动；各个用户进程可以共享内存中同一程序的副本。</li>
<li>缺点：增加了机器成本，而且实现存储管理的软件算法比较复杂。</li>
</ul>
</li>
</ol>
<p>下面介绍在进程执行过程中所用到的寄存器：</p>
<ul>
<li>
<p>基址寄存器（Base register）：存储进程的起始地址。</p>
</li>
<li>
<p>界限寄存器（Bounds register）：存储进程的结束位置。</p>
<blockquote>
<p>这些值是在进程被加载或者被换入时设置的。</p>
</blockquote>
</li>
</ul>
<blockquote>
<p>重定位的硬件支持（如下图）</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E9%87%8D%E5%AE%9A%E5%90%91%E7%9A%84%E7%A1%AC%E4%BB%B6%E6%94%AF%E6%8C%81.png" alt=""></p>
<ul>
<li>基址寄存器的值被添加到相对地址中，以产生一个绝对地址</li>
<li>得到的绝对地址与界限寄存器中的值进行比较
<ul>
<li>如果这个地址在界限范围内，则继续该指令的执行</li>
<li>如果地址不在范围内，就会产生一个中断给操作系统</li>
</ul>
</li>
</ul>
</blockquote>
<h3 id="保护">保护</h3>
<ul>
<li>
<p>进程不应该在未经允许的情况下引用另一进程中的内存位置（进行读操作或写操作）</p>
</li>
<li>
<p>在编译时不可能检查绝对地址来确保保护</p>
</li>
<li>
<p>必须在运行时检查进程产生的所有内存访问，以确保它们只访问分配给该进程的内存空间</p>
</li>
<li>
<p>内存保护需求必须由处理器（硬件）而非操作系统（软件）来满足</p>
<blockquote>
<p>操作系统不能预测程序可能产生的所有内存访问。即使可以预测，提前审查每个进程中可能存在的内存违法访问也非常费时。</p>
</blockquote>
</li>
</ul>
<h3 id="共享">共享</h3>
<ul>
<li>
<p>允许多个进程访问内存的同一部分。</p>
</li>
<li>
<p>当多个进程正在执行同一个程序时，允许每个进程访问该程序的同一个副本，要比让每个进程有自己单独的副本更有优势。</p>
<blockquote>
<p>内存管理系统在不损害基本保护的前提下，必须允许对内存共享区域进行受控访问。</p>
</blockquote>
</li>
</ul>
<h3 id="逻辑组织">逻辑组织</h3>
<p>计算机系统中的内存总是被组织成线性（或一维）的地址空间，且地址空间由一系列字节或字组成。外部存储器（简称外存）在物理层上也是按类似的方式组织的。这种组织方式类似实际的机器硬件，但它并不符合程序构造的典型方法。</p>
<p>程序是以模块形式编写的，如果操作系统和计算机硬件能够有效处理这种模块化的用户程序与数据，则会带来很多好处：</p>
<ul>
<li>
<p>可以独立地编写和编译模块，系统在运行时解析从一个模块到其他模块的所有引用。</p>
</li>
<li>
<p>通过适度的额外开销，可以为不同的模块提供不同的保护级别（只读、只执行）。</p>
</li>
<li>
<p>可以引入某种机制，使得模块可以被多个进程共享。</p>
<blockquote>
<p>模块级提供共享的优点是：它符合用户看待问题的方式，因此用户可很容易地指定需要的共享。</p>
</blockquote>
</li>
</ul>
<h3 id="物理组织">物理组织</h3>
<p>在之前提及过计算机存储器至少要组织成两级，即内存和外存。</p>
<ul>
<li>内存：提供快速访问，具有易失性，容量小。</li>
<li>外存：访问较慢，提供永久性存储，容量大。</li>
</ul>
<p>在这种两级方案中，系统主要关注的是内存和外存之间信息流的组织。如果让程序员来负责组织这一信息流，考虑以下原因就会发现这是不切实际的：</p>
<ul>
<li>
<p>供程序和数据使用的内存可能不足。这时程序员可以采用覆盖（overlaying）技术来组织程序和数据。</p>
<blockquote>
<p>覆盖：允许不同的模块被分配到内存中的同一块区域。</p>
<p>覆盖的目的：使大程序可以运行在小内存之上。</p>
<p>覆盖的实例（如下图）：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E8%A6%86%E7%9B%96%E7%9A%84%E4%BE%8B%E5%AD%90.png" alt=""></p>
<ul>
<li>
<p>假设一个程序全部大小为：</p>
<p>A(10KB) + B(40KB) + C(30KB) + D(30KB) + E(50KB) + F(40KB) = 200KB</p>
</li>
<li>
<p>而现在可用内存的容量仅有：150KB</p>
</li>
<li>
<p>显然直接将程序全部加载进内存是不可行的。</p>
</li>
<li>
<p>考虑到该程序有三个层次的进程（不同层次的进程是无法同时执行的），于是我们可以按照每个层次中的最大模块去分配内存。</p>
</li>
<li>
<p>即只需分配：A(10KB)  + B(40KB) + E(50KB) = 100KB 的内存就可以保证程序的正常运行。</p>
</li>
</ul>
<p>（即使有编译工具的帮助，覆盖技术的实现仍然非常浪费程序员的时间）</p>
</blockquote>
</li>
<li>
<p>在多道程序设计环境中，程序员在编写代码时并不知道可用空间的大小及位置。</p>
</li>
</ul>
<h2 id="内存分区">内存分区</h2>
<p>下表展示了后面（包括下一章：虚拟内存）要介绍的内存管理技术：</p>
<table>
<thead>
<tr>
<th>技术</th>
<th>说明</th>
<th>优势</th>
<th>弱点</th>
</tr>
</thead>
<tbody>
<tr>
<td>固定分区</td>
<td>在系统生成阶段，内存被划分成许多静态分区。进程可装入大于等于自身大小的分区中</td>
<td>实现简单，只需要极少的操作系统开销</td>
<td>由于有内部碎片，对内存的使用不充分：活动进程的最大数量是固定的</td>
</tr>
<tr>
<td>动态分区</td>
<td>分区是动态创建的，因而每个进程可装入与自身大小正好相等的分区中</td>
<td>没有内部碎片；可以更充分地使用内存</td>
<td>由于需要压缩外部碎片，处理器利用率低</td>
</tr>
<tr>
<td>简单分页</td>
<td>内存被划分成许多大小相等的页框；每个进程被划分成许多大小与页框相等的页；要装入一个进程，需要把进程包含的所有页都装入内存内不一定连续的某些页框中</td>
<td>没有外部碎片</td>
<td>有少量的内部碎片</td>
</tr>
<tr>
<td>简单分段</td>
<td>每个进程被划分成许多段；要装入一个进程，需要把进程包含的所有段都装入内存内不一定连续的某些动态分区中</td>
<td>没有内部碎片；相对于动态分区，提高了内存利用率，减少了开销</td>
<td>存在外部碎片</td>
</tr>
<tr>
<td>虚存分页</td>
<td>除了不需要装入一个进程的所有页外，与简单分页一样；非驻留页在以后需要时自动调入内存</td>
<td>没有外部碎片；支持更多道数的多道程序设计；巨大的虚拟地址空间</td>
<td>复杂的内存管理开销</td>
</tr>
<tr>
<td>虚存分段</td>
<td>除了不需要装入一个进程的所有段外，与简单分段一样；非驻留段在以后需要时自动调入内存</td>
<td>没有内部碎片；支持更多道数的多道程序设计；巨大的虚拟地址空间；支持保护和共享</td>
<td>复杂的内存管理开销</td>
</tr>
</tbody>
</table>
<blockquote>
<p>在几乎所有的现代多道程序设计系统中，内存管理涉及一种称为虚存（虚拟内存）的复杂方案。虚存基于分段和分页这两种基本技术，或基于这两种技术中的一种。</p>
<p>在考虑虚存技术之前，先考虑一些不涉及虚存的简单技术。</p>
</blockquote>
<p>在介绍分区之前还要明白一件事情，大多数内存管理方案都假定操作系统占据内存中的某些固定部分，而内存中的其余部分则供多个用户进程使用。我们考虑的仅仅是对用户内存空间的管理。</p>
<h3 id="固定分区">固定分区</h3>
<img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS固定分区的实例.png" style="zoom:80%;" />
<p>如图，有两种固定分区的方案：</p>
<ul>
<li>
<p>大小相等的分区（Equal-size partitions）</p>
<ul>
<li>
<p>任何小于等于分区大小的任何进程都可装入任何可用的分区中</p>
</li>
<li>
<p>若所有的分区都已满，且没有进程处于就绪态或运行态，则操作系统可以换出一个进程的所有分区，并装入另一个进程。</p>
</li>
<li>
<p>使用此方案有两个难点：</p>
<ul>
<li>
<p>程序可能太大而不能放到一个分区中。此时必须使用覆盖技术。</p>
</li>
<li>
<p>内存的利用率非常低。任何程序，即使很小，都需要占据一个完整的分区。</p>
<blockquote>
<p><strong>内部碎片/内部零头（internal fragmentation）</strong>：</p>
<p>假设存在一个长度小于2MB的程序，当它被换入时，仍占据一个8MB的分区。由于装入的数据块小于分区大小，因而导致分区内部存在空间浪费，这种现象就是内部碎片。</p>
</blockquote>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>大小不等的分区（Unequal-size partitions）</p>
<ul>
<li>
<p>可以使用大分区去存放较大的进程，从而省略覆盖技术；</p>
</li>
<li>
<p>可以使用小分区去存放较小的进程，以减小内部碎片。</p>
<blockquote>
<p>此方案可以缓解大小相等分区中的两个难点，但是无法彻底解决。</p>
</blockquote>
</li>
</ul>
</li>
</ul>
<p>放置算法（Placement Algorithm）：</p>
<ul>
<li>
<p>大小相等的分区</p>
<p>因为所有的分区都是同等大小，所以使用哪个分区并不重要。如果所有的分区都被处于不可运行状态的进程占据，那么这些进程中的一个必须被换出，以便为新进程让出空间。</p>
</li>
<li>
<p>大小不等的分区</p>
<p>对于大小不等的分区策略，有两种把进程分配到内存分区的方法（如下图）：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E5%9B%BA%E5%AE%9A%E5%88%86%E5%8C%BA%E7%9A%84%E5%AE%9E%E4%BE%8B2.png" alt=""></p>
<ul>
<li>
<p>最简单的方法是把每个进程分配到能够容纳它的最小分区中。</p>
<p>在这种情况下，每个分区都需要维护一个调度队列，用于保存从这个分区换出的进程。如果所有的进程都按照这种方式分配，则可使每个分区内部浪费的空间（内部碎片）最少。</p>
<blockquote>
<p>这里假定知道一个进程最多需要的内存大小。但这种假定很难得到保证。如果不知道一个进程将会变得多大，那么唯一可行的替代方案只能是使用覆盖技术或虚存技术。</p>
</blockquote>
</li>
<li>
<p>第二种方式是所有进程只提供一个队列，当需要把一个进程装入内存时，选择可以容纳该进程的最小可用分区。如果所有的分区都已被占据，则必须进行交换。一般优先考虑换出能容纳新进程的最小分区中的进程，或考虑一些诸如优先级之类的其他因素。也可以优先选择换出被阻塞的进程而非就绪进程。</p>
<blockquote>
<p>只提供一个队列的好处，被换出的进程可以依照某些规则分配到不同的分区去，而不仅仅是只分配在一个固定的分区。</p>
</blockquote>
</li>
</ul>
</li>
</ul>
<p>固定分区的缺点：</p>
<ul>
<li>限制并发度：分区的数量在系统生成阶段已经确定，因而限制了系统中活动（未挂起）进程的数量。</li>
<li>产生内部零头：由于分区的大小是在系统生成阶段事先设置的，因而小作业不能有效地利用分区空间。设计者无法设计出一个完美的调度方案。</li>
</ul>
<h3 id="动态分区">动态分区</h3>
<p>为了克服固定分区的缺点，提出了动态分区（如下图）：</p>
<ul>
<li>对于动态分区，分区长度和数量是可变的。</li>
<li>进程装入内存时，系统会给它分配一块与其所需容量完全相等的内存空间。</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E5%8A%A8%E6%80%81%E5%88%86%E5%8C%BA%E7%9A%84%E5%AE%9E%E4%BE%8B.png" alt=""></p>
<blockquote>
<p>说明：</p>
<p>该实例使用64MB的内存。最初，内存中只有操作系统（a）。从操作系统结束处开始，装入的前三个进程分别占据各自所需的空间大小（b、c、d），这样在内存末尾只剩下一个“空洞”，而这个“空洞”对第4个进程来说就太小。在某个时刻，内存中没有一个就绪进程。操作系统换出进程2（e），这为装入一个新进程（即进程4）腾出了足够的空间（f）。由于进程4比进程2小，因此形成了另一个小“空洞”。然后，在另一个时刻，内存中没有一个进程是就绪的，但处于就绪挂起状态的进程2可用。由于内存中没有足够的空间容纳进程2，操作系统换出进程1（g），然后换入进程2（h）。</p>
<p><strong>外部碎片/外部零头（external fragmentation）</strong>：</p>
<p>由上述分析可知，这种方案最终会在内存中形成许多小空洞，这就是外部碎片。</p>
<p>指所有分区外的存储空间变成了越来越多的碎片。（与前面提到的内部碎片相对应）</p>
<p>克服外部碎片的方法就是压缩（compaction）：操作系统不时地移动进程，使得进程占用的空间连续，并使所有空闲空间连成一片。</p>
</blockquote>
<p>放置算法（Placement Algorithm）：</p>
<p>此处介绍四种算法：最佳适配（Best-fit）、首次适配（First-fit）、邻近适配（Next-fit）、最差适配（Worst-fit）。</p>
<h4 id="最佳适配">最佳适配</h4>
<ul>
<li>选择与需求大小最接近的块</li>
<li>需要遍历整个内存空间</li>
<li>由于需要为进程找到最小的块，所以会留下最小的碎片</li>
<li>必须更频繁地进行内存压缩</li>
<li>整体性能最差</li>
</ul>
<h4 id="首次适配">首次适配</h4>
<ul>
<li>从头开始扫描内存，选择第大小足够的第一个可用块</li>
<li>可能有许多进程加载在内存的前端，所以当试图找到一个空闲块时，必须进行搜索</li>
<li>新能是最好的</li>
</ul>
<h4 id="邻近适配">邻近适配</h4>
<ul>
<li>从上一次放置的位置开始扫描内存，选择下一个大小足够的可用块</li>
<li>使最大的内存块被分解成更小的内存块</li>
<li>需要进行压缩，以便在内存的末尾获得一个大的区块</li>
<li>性能介于最佳适配和首次适配之间</li>
</ul>
<h4 id="最差适配">最差适配</h4>
<ul>
<li>从头遍历整个内存空间，选择最大的块</li>
<li>“均贫富”思想，把内存划分为基本上差不多大小的内存分区</li>
</ul>
<blockquote>
<p>实例：考虑分配一个大小为16M的新块</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E5%8A%A8%E6%80%81%E5%88%86%E5%8C%BA%E7%9A%84%E5%AE%9E%E4%BE%8B2.png" alt=""></p>
</blockquote>
<p>动态分区的缺点：</p>
<ul>
<li>维护特别复杂</li>
<li>会引入进行压缩的额外开销</li>
</ul>
<h3 id="伙伴系统">伙伴系统</h3>
<blockquote>
<p>先说个额外话题：计算机理论上支持多大的内存？</p>
<ul>
<li>
<p>如果是32位操作系统，则理论上最大支持的内存为：2<sup>32</sup>（相当于4GB）</p>
<p>即便计算机安装了8GB的内存条，它也只能识别4GB。</p>
</li>
<li>
<p>如果是64位操作系统，则理论上最大支持的内存为：2<sup>64</sup>（相当于128GB）</p>
</li>
<li>
<p>计算机理论支持最大内存 = 2<sup>操作系统位数</sup></p>
</li>
</ul>
</blockquote>
<p>伙伴系统中可用内存块的大小为2<sup>K</sup>个字，L ≤ K ≤ U，其中2<sup>L</sup>表示分配的最小块的尺寸，2<sup>U</sup>表示分配的最大块的尺寸；通常2<sup>U</sup>是可供分配的整个内存的大小。</p>
<p>内存分配过程如下：</p>
<ul>
<li>最初，可用于分配的整个空间被视为一个大小为2<sup>U</sup>的块</li>
<li>若请求的大小s满足：2<sup>U-1</sup> ＜ s ≤ 2<sup>U</sup>，则分配整个内存空间
<ul>
<li>否则，该块分成两个大小相等的伙伴，大小均为2<sup>U-1</sup></li>
<li>若有2<sup>U-2</sup> ＜ s ≤ 2<sup>U-1</sup>，则给该请求分配两个伙伴中的任何一个
<ul>
<li>否则，其中的一个伙伴又被分成两半。持续这一过程，直到产生大于或等于s的最小块为止。</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>内存的回收：</p>
<p>如果一个块的进程被释放，则判断该内存块相邻的伙伴（大小相同），如果伙伴块为空，则两个块合并为一个大块，如果合成的大块相邻的伙伴仍然为空，则继续合成，直到重新合成为最初的内存块。</p>
<blockquote>
<p>伙伴系统实例：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E4%BC%99%E4%BC%B4%E7%B3%BB%E7%BB%9F%E5%88%86%E9%85%8D.png" alt=""></p>
<p>上图给出了一个初始大小为1MB的块的例子。第一个请求A为100KB，需要一个128KB的块。最初的块被划分成两个512KB大小的伙伴，第一个伙伴又被划分成两个256KB大小的伙伴，其中的第一个又划分成两个128KB大小的伙伴，这两个128KB的伙伴中的一个分配给A。下一个请求B需要256KB的块，因为已有这样的一个块，随即分配给它。在需要时，继续进行这样的分裂和合并过程。注意当E被释放时，两个128KB的伙伴合并为一个256KB的块，这个256KB的块又立即与其伙伴合并成一个512KB的块。</p>
</blockquote>
<p>伙伴系统克服了固定分区和可变分区方案的缺陷。（既可以灵活地动态分配内存，又没有零头的产生）</p>
<h2 id="分页">分页</h2>
<p>为了减少零头，引入了分页技术。</p>
<blockquote>
<p>使用分页技术时，每个进程在内存中浪费的空间，仅是进程最后一页的一小部分形成的内部碎片。没有任何外部碎片。</p>
</blockquote>
<p>将内存划分为固定大小的小块（块远远小于分区），将每个进程也划分为相同大小的块：</p>
<ul>
<li>
<p>进程中的块被称为页（page）</p>
</li>
<li>
<p>内存中的块被称为帧/页帧/页框（frame）</p>
</li>
<li>
<p>操作系统会为每一个进程维护一个页表（page table）</p>
<ul>
<li>
<p>页表给出了该进程的每页所对应页框的位置</p>
</li>
<li>
<p>在程序中，每个逻辑地址包括一个页号（page number）和在该页中的偏移量（offset）</p>
</li>
<li>
<p>由处理器将逻辑地址转化为物理地址，物理地址包括页框号和偏移量</p>
<blockquote>
<p>注意区分</p>
</blockquote>
</li>
</ul>
</li>
</ul>
<blockquote>
<p>分页实例：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E5%88%86%E9%A1%B5%E7%9A%84%E5%AE%9E%E4%BE%8B.png" alt=""></p>
<p>在某个给定时刻，内存中的某些页框正被使用，某些页框是空闲的，操作系统维护空闲页框的列表。</p>
<ul>
<li>
<p>存储在磁盘上的进程A由4页组成。装入这个进程时，操作系统查找4个空闲页框，并将进程A的4页装入这4个页框中，如图（b）所示。</p>
</li>
<li>
<p>进程B包含3页，进程C包含4页，它们依次被装入。</p>
</li>
<li>
<p>然后进程B被挂起，并被换出内存。</p>
</li>
<li>
<p>此后，内存中的所有进程被阻塞，操作系统需要换入一个新进程，即进程D，它由5页组成。进程D的5页被装入页框4、5、6、11和12。</p>
<blockquote>
<p>进程在分页中可以不加载到内存连续的区域中，分区要求必须连续。</p>
</blockquote>
</li>
</ul>
<p>下图给出了各个进程的页表：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E8%BF%9B%E7%A8%8B%E9%A1%B5%E8%A1%A8.png" alt=""></p>
<p>值得注意的是：操作系统为当前内存中未被占用、可供使用的所有页框维护一个空闲页框列表。</p>
</blockquote>
<p>为了使分页方案更加方便，规定页和页框的大小必须是2的幂，以便容易地表示出相对地址。</p>
<blockquote>
<p>实例：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E5%88%86%E9%A1%B5%E7%9A%84%E9%80%BB%E8%BE%91%E5%9C%B0%E5%9D%802.png" alt=""></p>
<ul>
<li>上图中使用16位地址，规定页大小为1KB（即1024字节），以相对地址为1502的例子进行分析</li>
<li>相对地址 = 1502<sub>(10)</sub> = 0000010111011110<sub>(2)</sub></li>
<li>页大小 = 1KB = 2<sup>10</sup> → 偏移量 = 10位 → 页号 = 6位</li>
<li>所以该程序最多由 2<sup>6</sup> = 64页 组成（每页为1KB）</li>
<li>相对地址1502对应于页1（000001）中的偏移量478（0111011110）</li>
</ul>
<p><strong>考虑一个n+m位的地址 → 最左边的n位是页号，最右边的m位是偏移量</strong></p>
<p>相对地址 → 逻辑地址 → 物理地址：</p>
<ul>
<li>提取页号，即逻辑地址最左侧的n位</li>
<li>以这个页号为索引，查找进程页表中相应的页框号k</li>
<li>页框的起始物理地址为：k × 2<sup>m</sup> → 被访问字节的物理地址是这个数加上偏移量</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E5%88%86%E9%A1%B5%E7%9B%B8%E5%AF%B9%E5%9C%B0%E5%9D%80%E8%BD%AC%E7%89%A9%E7%90%86%E5%9C%B0%E5%9D%80.png" alt=""></p>
<p>仍然以逻辑地址1502为例：</p>
<ul>
<li>由上述分析已知：页号为1，偏移量为478</li>
<li>假设该页驻留在内存页框6中（6<sub>(10)</sub> = 000110<sub>(2)</sub>）</li>
<li>则物理地址为：页框号|偏移量 → 即：000110|0111011110<sub>(2)</sub> = 6622<sub>(10)</sub></li>
</ul>
</blockquote>
<h2 id="分段">分段</h2>
<p>为了满足用户的逻辑组织需求，引入了分段。</p>
<p>分段同样是将用户程序细分，与分页不同的是，尽管段有最大长度限制，但并不要求所有程序的所有段的长度都相等。</p>
<p>采用分段技术时的逻辑地址也由两部分组成：段号（segment number） + 偏移量（offset）</p>
<p>由于使用大小不等的段，分段类似于动态分区</p>
<blockquote>
<p>分段实例：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E5%88%86%E6%AE%B5%E7%9A%84%E9%80%BB%E8%BE%91%E5%9C%B0%E5%9D%80.png" alt=""></p>
<p>采用大小不等的段的另一个结果是，逻辑地址和物理地址间不再是简单的对应关系。</p>
<ul>
<li>类似于分页，在简单的分段方案中，每个进程都有一个段表
<ul>
<li>系统也会维护一个内存中的空闲块列表</li>
</ul>
</li>
<li>每个段表项必须给出相应段在内存中的起始地址，还必须指明段的长度，以确保不会使用无效地址</li>
<li>当进程进入运行状态时，系统会把其段表的地址装载到一个寄存器中，由内存管理硬件来使用这个寄存器</li>
</ul>
<p><strong>考虑一个n+m位的地址 → 最左侧的n位是段号，最侧的m位是偏移量。</strong></p>
<ul>
<li>在上图的例子中，n=4、m=12</li>
<li>所以最大段长度为：2<sup>12</sup> = 4096</li>
</ul>
<p>相对地址 → 逻辑地址 → 物理地址：</p>
<ul>
<li>提取段号，即逻辑地址最左侧的n位</li>
<li>以这个段号为索引，查找进程段表中该段的起始物理地址</li>
<li>最右侧m位表示偏移量，偏移量和段长度进行比较，若偏移量大于段长度，则该地址无效</li>
<li>物理地址为该段的起始物理地址与偏移量之和</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E5%88%86%E6%AE%B5%E7%9B%B8%E5%AF%B9%E5%9C%B0%E5%9D%80%E8%BD%AC%E7%89%A9%E7%90%86%E5%9C%B0%E5%9D%80.png" alt=""></p>
<p>以逻辑地址4848为例：</p>
<ul>
<li>逻辑地址为：4848<sub>(10)</sub> = 0001001011110000<sub>(2)</sub></li>
<li>段号为：1 = 0001<sub>(2)</sub>，偏移量为：752 = 001011110000<sub>(2)</sub></li>
<li>假设该段驻留在内存中，起始物理地址为0010000000100000</li>
<li>则相应的物理地址为：0010000000100000（起始物理地址）+  001011110000（偏移量）= 0010001100010000</li>
<li>即物理地址为：8224（起始物理地址）+ 752（偏移量）= 8976</li>
</ul>
</blockquote>
<blockquote>
<p>分段消除了内部碎片，但是和动态分区一样，它会产生外部碎片。不过由于进程被分成多个小块，因此外部碎片也会很小。</p>
</blockquote>
<hr>
<h1>后记</h1>
<p>本篇已完结</p>
<p>（如有修改或补充欢迎评论）</p>
]]></content>
      <categories>
        <category>学习笔记</category>
      </categories>
      <tags>
        <tag>操作系统</tag>
      </tags>
  </entry>
  <entry>
    <title>操作系统学习笔记-信号量相关问题</title>
    <url>/2021/04/25/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E4%BF%A1%E5%8F%B7%E9%87%8F%E7%9B%B8%E5%85%B3%E9%97%AE%E9%A2%98/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\css\APlayer.min.css"><script src="\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\js\Meting.min.js"></script><h1>前言</h1>
<p><em>正在学习操作系统，记录笔记。</em></p>
<p>（补充一下与信号量相关的问题类型以及解决思路）</p>
<blockquote>
<p>参考资料：</p>
<p>《操作系统（精髓与设计原理 第6版） 》</p>
<p>王道考研：<a href="https://www.bilibili.com/video/BV1YE411D7nH?from=search&amp;seid=12220712596266554764">2019 王道考研 操作系统_哔哩哔哩 (゜-゜)つロ 干杯~-bilibili</a></p>
</blockquote>
<hr>
<h1>正文</h1>
<p>先声明：为了方便（就是我懒），下文可能会用<code>P操作</code>来指代<code>semWait(x)</code>；用<code>V操作</code>来指代<code>semSignal(x)</code>。</p>
<h2 id="生产者-消费者问题">生产者-消费者问题</h2>
<p>问题描述：</p>
<ul>
<li>
<p>系统中有一组生产者进程和一组消费者进程，生产者进程每次生产一个产品放入缓冲区，消费者进程每次从缓冲区中取出一个产品并使用。（注：这里的“产品理解为某种数据”）</p>
</li>
<li>
<p>生产者、消费者共享一个初始为空、大小为n的缓冲区。</p>
</li>
<li>
<p>只有缓冲区没满时，生产者才能把产品放入缓冲区，否则必须等待。</p>
</li>
<li>
<p>只有缓冲区不空时，消费者才能从中取出产品，否则必须等待。</p>
</li>
<li>
<p>缓冲区是临界资源，各进程必须互斥地访问（只允许一个生产者放入消息，也只允许一个消费者拿出消息）。</p>
<blockquote>
<p>再次详细解释一下最后一点。意思是，同一个时刻只能是一个生产者或者一个消费者操作缓冲区，禁止以下情况：多个生产者或者多个消费者操作缓冲区；同样，一个生产者和一个消费者同时操作也是禁止的。</p>
</blockquote>
</li>
</ul>
<p>分析：</p>
<ul>
<li>互斥关系：不允许有两方及以上同时访问缓冲区。</li>
<li>同步关系：存在两种同步关系，分别为缓冲区满、缓冲区空。（当消费者消费一个产品，应该告诉生产者，缓冲区有一个空位；当生产者生产一个商品，应该告诉消费者，缓冲区非空）</li>
</ul>
<p>所以根据以上分析得知：应该需要三对P、V操作。因此需要定义如下三个信号量：</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">semaphore mutex = <span class="number">1</span>;    <span class="comment">//互斥信号量，实现对缓冲区的访问</span></span><br><span class="line">semaphore empty = n;    <span class="comment">//同步信号量，表示空闲缓冲区的数量（初始值为n）</span></span><br><span class="line">semaphore full = <span class="number">0</span>;    <span class="comment">//同步信号量，表示产品的数量，也即非缓冲区的数量（初始值为0）</span></span><br></pre></td></tr></table></figure>
<p>实现：</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*producer*/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">producer</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line">        <span class="comment">/*生产一个产品*/</span>;</span><br><span class="line">        semWait(empty);    <span class="comment">//检查有无缓冲区可用  (Ⅰ)</span></span><br><span class="line">        semWait(mutex);    <span class="comment">//互斥操作  (Ⅱ)</span></span><br><span class="line">        <span class="comment">/*将产品放入缓冲区*/</span>;</span><br><span class="line">        semSignal(mutex);    <span class="comment">//互斥操作</span></span><br><span class="line">        semSignal(full);    <span class="comment">//告诉消费者“生产了一个产品”</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*consumer*/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">consumer</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line">        semWait(full);    <span class="comment">//检查有无产品（非空缓冲区）  (Ⅲ)</span></span><br><span class="line">        semWait(mutex);    <span class="comment">//互斥操作  (Ⅳ)</span></span><br><span class="line">        <span class="comment">/*从缓冲区中取出一个产品*/</span>;</span><br><span class="line">        semSignal(mutex);    <span class="comment">//互斥操作</span></span><br><span class="line">        semSignal(empty);    <span class="comment">//告诉生产者“取走了一个产品，缓冲区有空闲”</span></span><br><span class="line">        <span class="comment">/*使用产品*/</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    parbegin(producer(), consumer());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>思考：能否改变相邻P、V操作的顺序？（即调换<code>(Ⅰ)</code>、<code>(Ⅱ)</code>以及<code>(Ⅲ)</code>、<code>(Ⅳ)</code>的顺序）</p>
<p>分析：</p>
<ul>
<li>分析此种情况：若缓冲区内已经放满产品，则empty=0，full=n。</li>
<li>则生产者先执行<code>(Ⅱ)</code>（semWait(mutex)）操作使得mutex变为0，在执行<code>(Ⅰ)</code>操作（semWait(empty)），由于已经没有空闲缓冲区，因此生产者被阻塞。接着切换至消费者进程。消费者进程首先执行<code>(Ⅳ)</code>（semWait(mutex)）操作，由于mutex为0，即生产者还没有释放对临界资源的控制权，因此消费者也被阻塞。</li>
<li>这就出现了<strong>死锁</strong>的情况（生产者等待消费者释放空闲缓冲区，而消费者又等待生产者释放临界区）</li>
<li>同样的我们分析另一种情况：若缓冲区中没有产品，即empty=n，full=0。按照<code>(Ⅳ)``(Ⅲ)``(Ⅱ)</code>的顺序也会发生死锁情况。</li>
</ul>
<p>因此：</p>
<ul>
<li><strong>实现互斥的P操作一定要在实现同步的P操作之后。</strong></li>
<li><strong>V操作不会导致进程阻塞，因此两个V操作顺序可以交换。</strong></li>
</ul>
<p>还需要注意的一点：</p>
<p>生产者<code>“生产一个产品”</code>的操作以及消费者<code>“使用产品”</code>的操作可以放置P、V操作之间，但是要意识到这些操作是非必要的，如果放置在临界区操作则会导致其代码量变大，在一个进程访问临界区的同时就要耗费更多的时间，这会导致进程之间的并发度降低。（<strong>只在临界区做必要操作</strong>）</p>
</blockquote>
<h2 id="多生产者-多消费者问题">多生产者-多消费者问题</h2>
<p>问题描述：</p>
<p>桌子上有一只盘子，每次只能向其中放入一个水果。爸爸专向盘子中放苹果，妈妈专向盘子中放橘子，儿子专等着吃盘子中的橘子，女儿专等着吃盘子中的苹果。只有盘子空时，爸爸或妈妈才可向盘子中放一个水果。仅当盘子中有自己需要的水果时，儿子或女儿可以从盘子中取出水果。用P、V操作实现上述过程。</p>
<p>分析：</p>
<ul>
<li>互斥关系：将盘子视为缓冲区。每个人（进程）对其访问都是互斥的。</li>
<li>同步关系：
<ol>
<li>父亲将苹果放入盘子后，女儿才能取苹果。</li>
<li>母亲将橘子放入盘子后，儿子才能取橘子。</li>
<li>只有盘子为空时，父亲或母亲才能放入水果。（盘子为空事件可由儿子或者女儿触发）</li>
</ol>
</li>
</ul>
<p>所以根据以上分析得知，需要定义如下四个信号量：</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">semaphore mutex = <span class="number">1</span>;    <span class="comment">//实现互斥访问盘子（临界区）</span></span><br><span class="line">semaphore apple = <span class="number">0</span>;    <span class="comment">//盘子中有几个苹果（初始值为0）</span></span><br><span class="line">semaphore orange = <span class="number">0</span>;    <span class="comment">//盘子中有几个橘子（初始值为0）</span></span><br><span class="line">semaphore plate = <span class="number">1</span>;    <span class="comment">//盘子中还可以放多少个水果</span></span><br></pre></td></tr></table></figure>
<p>实现：</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*dad*/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dad</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line">        <span class="comment">/*准备一个苹果*/</span>;</span><br><span class="line">        semWait(plate);    <span class="comment">//检查盘子是否为空</span></span><br><span class="line">        semWait(mutex);    <span class="comment">//实现对盘子这一缓冲区的互斥访问</span></span><br><span class="line">        <span class="comment">/*把苹果放入盘子*/</span>;</span><br><span class="line">        semSignal(mutex);</span><br><span class="line">        semSignal(apple);    <span class="comment">//告诉女儿“盘子里有苹果了”</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*mom*/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">mom</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line">        <span class="comment">/*准备一个橘子*/</span>;</span><br><span class="line">        semWait(plate);    <span class="comment">//检查盘子是否为空</span></span><br><span class="line">        semWait(mutex);    <span class="comment">//实现对盘子这一缓冲区的互斥访问</span></span><br><span class="line">        <span class="comment">/*把橘子放入盘子*/</span>;</span><br><span class="line">        semSignal(mutex);</span><br><span class="line">        semSignal(orange);    <span class="comment">//告诉儿子“盘子里有橘子了”</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*daughter*/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">daughter</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line">        semWait(apple);    <span class="comment">//检查盘子里有没有苹果</span></span><br><span class="line">        semWait(mutex);    <span class="comment">//实现对盘子这一缓冲区的互斥访问</span></span><br><span class="line">        <span class="comment">/*从盘子中取出苹果*/</span>;</span><br><span class="line">        semSignal(mutex);</span><br><span class="line">        semSignal(plate);    <span class="comment">//告诉父母“盘子为空了”</span></span><br><span class="line">        <span class="comment">/*吃掉苹果*/</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*son*/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">son</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line">        semWait(orange);    <span class="comment">//检查盘子里有没有橘子</span></span><br><span class="line">        semWait(mutex);    <span class="comment">//实现对盘子这一缓冲区的互斥访问</span></span><br><span class="line">        <span class="comment">/*从盘子中取出橘子*/</span>;</span><br><span class="line">        semSignal(mutex);</span><br><span class="line">        semSignal(plate);    <span class="comment">//告诉父母“盘子为空了”</span></span><br><span class="line">        <span class="comment">/*吃掉橘子*/</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    parbegin(dad(), mom(), daughter(), son());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>思考：上述案例可不可以不使用互斥信号量（mutex）呢？</p>
<p>分析（删除上述代码中所有的<code>semWait(mutex)</code>以及<code>semSignal(mutex)</code>操作）：</p>
<ul>
<li>刚开始，儿子、女儿进程即使上处理机运行也会被阻塞。</li>
<li>如果刚开始是父亲进程先上处理机运行，则：
<ul>
<li>父亲执行<code>semWait(plate)</code>操作，可以访问盘子。</li>
<li>母亲执行<code>semWait(plate)</code>操作，被阻塞等待盘子。</li>
<li>父亲执行<code>semSignal(apple)</code>操作，放入苹果。</li>
<li>女儿i进程被唤醒（其他进程即使运行也会阻塞）。</li>
<li>女儿执行<code>semWait(apple)</code>操作，访问盘子。并接着执行<code>semSignal(plate)</code>操作。</li>
<li>父亲或者母亲进程再次被唤醒（儿子进程访问会被阻塞）。</li>
<li>…</li>
</ul>
</li>
</ul>
<p>以上分析可以得出结论，即便没有互斥信号量（mutex），也不影响正常运行。</p>
<p>原因在于：本题中的缓冲区大小为1，在任何时刻，apple、orange、plate三个同步信号量中最多只有一个是1。因此在任何时刻，最多只有一个进程的<code>P操作</code>不会被阻塞，并顺利地进入临界区。</p>
<p>但是加入此题盘子的容量为2及以上，就无法保证进程互斥访问盘子。（分析过程省略）</p>
<p><strong>最好直接就设置互斥信号量（mutex），以防出错。</strong></p>
</blockquote>
<h2 id="吸烟者问题">吸烟者问题</h2>
<p>问题描述：</p>
<p>假设一个系统有三个抽烟者进程和一个供应者进程。每个抽烟者不停地卷烟并抽掉它，但是要卷起并抽掉一支烟，抽烟者需要有三种材料：烟草、纸和胶水。三个抽烟者中，第一个拥有烟草、第二个拥有纸、第三个拥有胶水。供应者进程无限地提供三种材料，供应者每次将两种材料放桌子上，拥有剩下第三种材料的抽烟者卷一根烟并抽掉它，并给供应者进程一个信号告诉完成了，供应者就会放另外两种材料再桌上，这个过程一直重复（让三个抽烟者轮流地抽烟）</p>
<p>分析：</p>
<ul>
<li>
<p>互斥关系：将桌子视为缓冲区，每个进程对其访问都是互斥的。</p>
<blockquote>
<p>值得注意的是，尽管供应者每次会将两种材料放置在桌子上，但是桌子（缓冲区）的容量仍为1，我们应该将不同的两种材料视为一种组合：</p>
<ul>
<li>组合一：纸 + 胶水</li>
<li>组合二：烟草 + 胶水</li>
<li>组合三：烟草 + 纸</li>
</ul>
</blockquote>
</li>
<li>
<p>同步关系：</p>
<ol>
<li>桌上有组合一 → 第一个抽烟者取走东西。</li>
<li>桌上有组合二 → 第二个抽烟者取走东西。</li>
<li>桌上有组合三 → 第三个抽烟者取走东西。</li>
<li>抽烟者抽完烟 → 供应者将下一种组合材料放到桌子上。</li>
</ol>
</li>
<li>
<p>需要让三个抽烟者轮流地抽烟。</p>
</li>
</ul>
<p>所以根据以上分析得知，需要定义如下四个信号量：</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">semaphore offer1 = <span class="number">0</span>;    <span class="comment">//桌上组合一的数量</span></span><br><span class="line">semaphore offer2 = <span class="number">0</span>;    <span class="comment">//桌上组合二的数量</span></span><br><span class="line">semaphore offer3 = <span class="number">0</span>;    <span class="comment">//桌上组合三的数量</span></span><br><span class="line">semaphore finish = <span class="number">0</span>;    <span class="comment">//抽烟是否完成</span></span><br><span class="line"><span class="keyword">int</span> i = <span class="number">0</span>;    <span class="comment">//用于实现“三个抽烟者轮流地抽烟”</span></span><br></pre></td></tr></table></figure>
<p>实现：</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*provider*/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">provider</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(i == <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="comment">/*将组合一放桌上*/</span>;</span><br><span class="line">            semSignal(offer1);    <span class="comment">//告诉第一个抽烟者“桌上有组合一”</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(i == <span class="number">1</span>)&#123;</span><br><span class="line">            <span class="comment">/*将组合二放桌上*/</span>;</span><br><span class="line">            semSignal(offer2);    <span class="comment">//告诉第二个抽烟者“桌上有组合二”</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(i == <span class="number">2</span>)&#123;</span><br><span class="line">            <span class="comment">/*将组合三放桌上*/</span>;</span><br><span class="line">            semSignal(offer3);    <span class="comment">//告诉第三个抽烟者“桌上有组合三”</span></span><br><span class="line">        &#125;</span><br><span class="line">        i = (i + <span class="number">1</span>) % <span class="number">3</span>;</span><br><span class="line">        semWait(finish);    <span class="comment">//判断抽烟者是否已经完成吸烟</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*smoker1*/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">smoker1</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line">        semWait(offer1);    <span class="comment">//判断桌子上有没有组合一</span></span><br><span class="line">        <span class="comment">/*从桌子上拿走组合一；卷烟；抽掉*/</span>;</span><br><span class="line">        semSignal(finish);    <span class="comment">//告诉提供者“桌子上已经空了”</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*smoker2*/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">smoker2</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line">        semWait(offer2);    <span class="comment">//判断桌子上有没有组合二</span></span><br><span class="line">        <span class="comment">/*从桌子上拿走组合二；卷烟；抽掉*/</span>;</span><br><span class="line">        semSignal(finish);    <span class="comment">//告诉提供者“桌子上已经空了”</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*smoker3*/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">smoker3</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line">        semWait(offer3);    <span class="comment">//判断桌子上有没有组合三</span></span><br><span class="line">        <span class="comment">/*从桌子上拿走组合三；卷烟；抽掉*/</span>;</span><br><span class="line">        semSignal(finish);    <span class="comment">//告诉提供者“桌子上已经空了”</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    parbegin(provider(), smoker1(), smoker2(), smoker3());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>分析：是否需要专门再设置一个互斥信号量（mutex）？</p>
<p>因为桌子的容量为1（同上面一个例子相同），因此不必设置也不会出错。</p>
</blockquote>
<h2 id="读者-写者问题">读者-写者问题</h2>
<p>问题描述：</p>
<p>有读者和写者两组并发进程，共享一个文件，当两个或两个以上的读进程同时访问共享数据时不会产生副作用，但若某个写进程和其他进程（读进程或写进程）同时访问共享数据时则可能导致数据不一致的错误。因此我们要求：</p>
<ul>
<li>允许多个读者可以同时对文件执行读操作；</li>
<li>只允许一个写者往文件中写信息；</li>
<li>任一写者在完成写操作之前不允许其他读者或写者工作；</li>
<li>写者执行写操作前，应让已有的读者和写者全部退出。</li>
</ul>
<p>分析：</p>
<ul>
<li>
<p>互斥关系：</p>
<ol>
<li>
<p>写进程——写进程</p>
</li>
<li>
<p>写进程——读进程</p>
<p>（读进程之间不存在互斥关系，因此可以同时读文件，如何实现该操作是此类问题的关键）</p>
</li>
</ol>
</li>
</ul>
<p>所以根据以上分析得知，需要定义如下三个信号量：</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">semaphore rw = <span class="number">1</span>;    <span class="comment">//用于实现对文件的互斥访问。表示当前是否有进程在访问共享文件</span></span><br><span class="line"><span class="keyword">int</span> count = <span class="number">0</span>;    <span class="comment">//用于记录当前有几个读进程在访问文件</span></span><br><span class="line">semaphore mutex = <span class="number">1</span>;    <span class="comment">//用于保证对count变量的互斥访问</span></span><br></pre></td></tr></table></figure>
<p>实现：</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*writer*/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">writer</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line">        semWait(rw);    <span class="comment">//在写文件之前“上锁”</span></span><br><span class="line">        <span class="comment">/*写文件*/</span>;</span><br><span class="line">        semSignal(rw);    <span class="comment">//在写完之后“解锁”</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*reader*/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">reader</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line">        semWait(mutex);    <span class="comment">//各读进程互斥访问count</span></span><br><span class="line">        <span class="keyword">if</span>(count == <span class="number">0</span>)&#123;</span><br><span class="line">            semWait(rw);    <span class="comment">//第一个读进程负责“上锁”</span></span><br><span class="line">        &#125;</span><br><span class="line">        count++;    <span class="comment">//访问文件的读进程数加一</span></span><br><span class="line">        semSignal(mutex);    </span><br><span class="line">        <span class="comment">/*读文件*/</span>;</span><br><span class="line">        semWait(mutex);    <span class="comment">//各读进程互斥访问count</span></span><br><span class="line">        count--;    <span class="comment">//访问文件的读进程数减一</span></span><br><span class="line">        <span class="keyword">if</span>(count == <span class="number">0</span>)&#123;</span><br><span class="line">            semSignal(rw);    <span class="comment">//最后一个读进程负责“解锁”</span></span><br><span class="line">        &#125;</span><br><span class="line">        semSignal(mutex);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    parbegin(writer(), reader1(), reader2(),...,readern());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>分析：</p>
<p>mutex变量的设置是为了解决读进程对count的访问（解决多个读进程访问的操作）</p>
<ul>
<li>第一个读进程执行<code>semWait(mutex)</code>操作，顺利通过，并执行之后的<code>semWait(rw)</code>操作（保证了读进程与写进程的互斥）</li>
<li>若此时另一个读进程访问，在执行<code>semWait(mutex)</code>操作会被阻塞，直到第一个读进程执行<code>semSignal(mutex)</code>操作（“解锁”对count的访问，注意此时count值为1）</li>
<li>当count“解锁”后，另一个读进程再执行<code>semWait(mutex)</code>操作，判断count的值不为0，直接跳过<code>semWait(rw)</code>访问，这样就避免了各个读进程之间的互斥访问</li>
</ul>
<p>再仔细体会会发现上述代码存在一个潜在的问题，即：如果读进程一直在不停地访问（count值永不为0），就无法对文件“解锁”，写者进程就可能“饿死”。</p>
<p>因此该种写法是<strong>读进程优先</strong>。</p>
</blockquote>
<p>如何实现写进程优先呢？</p>
<p>这里我们再增加一个信号量：<code>semaphore w = 1</code>。</p>
<p>即现在一共有如下四个信号量：</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">semaphore rw = <span class="number">1</span>;    <span class="comment">//用于实现对文件的互斥访问。表示当前是否有进程在访问共享文件</span></span><br><span class="line"><span class="keyword">int</span> count = <span class="number">0</span>;    <span class="comment">//用于记录当前有几个读进程在访问文件</span></span><br><span class="line">semaphore mutex = <span class="number">1</span>;    <span class="comment">//用于保证对count变量的互斥访问</span></span><br><span class="line">semaphore w = <span class="number">1</span>;    <span class="comment">//用于实现“写进程优先”</span></span><br></pre></td></tr></table></figure>
<p>实现：</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*writer*/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">writer</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line">        semWait(w);    <span class="comment">//Ⅰ</span></span><br><span class="line">        semWait(rw);    <span class="comment">//在写文件之前“上锁”  Ⅱ</span></span><br><span class="line">        <span class="comment">/*写文件*/</span>;</span><br><span class="line">        semSignal(rw);    <span class="comment">//在写完之后“解锁”  Ⅲ</span></span><br><span class="line">        semSignal(w);    <span class="comment">//Ⅳ</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*reader*/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">reader</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line">        semWait(w);    <span class="comment">//Ⅴ</span></span><br><span class="line">        semWait(mutex);    <span class="comment">//各读进程互斥访问count  </span></span><br><span class="line">        <span class="keyword">if</span>(count == <span class="number">0</span>)&#123;</span><br><span class="line">            semWait(rw);    <span class="comment">//第一个读进程负责“上锁”  Ⅵ</span></span><br><span class="line">        &#125;</span><br><span class="line">        count++;    <span class="comment">//访问文件的读进程数加一</span></span><br><span class="line">        semSignal(mutex);</span><br><span class="line">        semSignal(w);    <span class="comment">//Ⅶ</span></span><br><span class="line">        <span class="comment">/*读文件*/</span>;</span><br><span class="line">        semWait(mutex);    <span class="comment">//各读进程互斥访问count</span></span><br><span class="line">        count--;    <span class="comment">//访问文件的读进程数减一</span></span><br><span class="line">        <span class="keyword">if</span>(count == <span class="number">0</span>)&#123;</span><br><span class="line">            semSignal(rw);    <span class="comment">//最后一个读进程负责“解锁”  Ⅷ</span></span><br><span class="line">        &#125;</span><br><span class="line">        semSignal(mutex);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    parbegin(writer(), reader1(), reader2(),...,readern());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>分析：<em>（容我吐槽一下，简直头皮发麻）</em></p>
<ol>
<li>
<p>读者1 → 读者2</p>
<ul>
<li>第一个读进程顺利通过<code>Ⅴ（semWait(w)）</code>操作，并对文件（rw）“上锁”，count++，…，到最后顺利地读文件。</li>
<li>第二个读进程同上。</li>
<li>即在增添了<code>Ⅴ（semWait(w)）</code>操作以及<code>Ⅶ（semSignal(w)）</code>对多个读进程并发访问文件是没有影响的。</li>
</ul>
</li>
<li>
<p>写者1 → 写者2</p>
<ul>
<li>第一个写进程会顺利通过<code>Ⅰ（semWait(w)）</code>操作，<code>Ⅱ（semWait(rw)）</code>操作，并顺利写文件。</li>
<li>第二个写进程如果并发执行会被阻塞在Ⅰ处，直到第一个写进程执行<code>Ⅳ（semSignal(w)）</code>“解锁写操作”，才可以继续执行。</li>
<li>实现了多个写进程之间的互斥。</li>
</ul>
</li>
<li>
<p>写者1 → 读者1</p>
<ul>
<li>写着进程顺利通过<code>Ⅰ（semWait(w)）</code>操作，<code>Ⅱ（semWait(rw)）</code>操作，开始写文件。</li>
<li>此时如果读进程要执行，就会被阻塞在<code>Ⅴ（semWait(w)）</code>操作，直到写进程执行完<code>Ⅳ（semSignal(w)）</code>“解锁写操作”，才可以继续执行。</li>
<li>实现了读者与写者的互斥。</li>
</ul>
</li>
<li>
<p>读者1 → 写者1 → 读者2</p>
<ul>
<li>第一个读进程可以顺利执行到<code>读文件</code>操作。</li>
<li>此时若写进程执行，可以顺利执行<code>Ⅰ（semWait(w)）</code>操作，但在<code>Ⅱ（semWait(rw)）</code>操作会被阻塞。</li>
<li>然后第二个读进程并发执行，由于上一步读进程顺利执行<code>Ⅰ（semWait(w)）</code>操作，所以第二个读进程会被阻塞在<code>Ⅴ（semWait(w)）</code>操作。</li>
<li>直到第一个读进程执行完<code>Ⅷ（semSignal(rw)）</code>操作对文件“解锁”，此时写进程就可以被唤醒，开始写文件。</li>
<li>第二个读进程依然被阻塞在<code>Ⅴ（semWait(w)）</code>操作，直到写进程执行完<code>Ⅳ（semSignal(w)）</code>操作，第二个读进程才可以继续执行。</li>
<li>所以这种情况并不会导致写进程“饥饿”。</li>
</ul>
</li>
<li>
<p>写者1 → 读者1 → 写者2</p>
<ul>
<li>
<p>第一个写进程顺利执行前面的操作，开始写文件。</p>
</li>
<li>
<p>此时如果读进程执行，则会被阻塞在<code>Ⅴ（semWait(w)）</code>操作。</p>
</li>
<li>
<p>此时如果第二个写进程执行，则也会被阻塞在<code>Ⅰ（semWait(w)）</code>操作。</p>
</li>
<li>
<p>如果第一个写进程执行完<code>Ⅳ（semSignal(w)）</code>操作，则此时会根据“先来先得”的原则，首先唤醒读进程，读进程顺利执行。</p>
</li>
<li>
<p>然后读进程会执行<code>Ⅵ（semWait(rw)）</code>操作对文件“上锁”，在执行完<code>Ⅶ（semWait(w)）</code>操作时释放对写进程的操作，第二个写进程就继续执行，但是会被阻塞在<code>Ⅱ（semWait(rw)）</code>操作。</p>
</li>
<li>
<p>读进程继续执行，直到结束，释放对文件的访问控制，第二个写进程才可以顺利执行。</p>
</li>
<li>
<blockquote>
<p>在这种情况我们可以分析出，尽管不会使得写进程“饥饿”，但也不是真正的“写进程优先”，而是符合相对公平的先来先服务的原则。</p>
</blockquote>
</li>
</ul>
</li>
</ol>
</blockquote>
<h2 id="哲学家进餐问题">哲学家进餐问题</h2>
<p>问题描述：</p>
<p>一张圆桌上坐着5名哲学家，每两个哲学家之间的桌上摆一根筷子，桌子的中间是一碗米饭。哲学家们倾注毕生的精力用于思考和进餐，哲学家在思考时，并不影响他人。只有当哲学家饥饿时，才试图拿起左、右两根筷子（一根一根地拿起）。如果筷子已在他人手上，则需等待。饥饿的哲学家只有同时拿起两根筷子才可以开始进餐，当进餐完毕后，放下筷子继续思考。</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E5%93%B2%E5%AD%A6%E5%AE%B6%E8%BF%9B%E9%A4%90%E9%97%AE%E9%A2%98.png" alt=""></p>
<p>分析：</p>
<ul>
<li>
<p>互斥关系：系统中有5个哲学家进程，5位哲学家与左右邻居对其中间筷子的访问是互斥关系。</p>
<blockquote>
<p>这个问题中只有互斥关系，但与之前遇到的问题不同的是，每个哲学家进程需要同时持有两个临界资源才能开始吃饭。如何避免临界资源分配不当造成的死锁现象，是哲学家问题的关键。</p>
</blockquote>
</li>
</ul>
<p>所以根据以上分析得知，需要定义如下信号量数组以及一个互斥信号量：</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">semaphore chopstick[<span class="number">5</span>] = &#123;<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>&#125;;    <span class="comment">//用于实现对5根筷子的互斥访问</span></span><br><span class="line">semaphore mutex = <span class="number">1</span>;    <span class="comment">//互斥地取筷子</span></span><br></pre></td></tr></table></figure>
<p>并规定对哲学家按0~4编号，哲学家 i 左边的筷子编号为 i，右边的筷子编号为 <code>( i + 1 ) % 5</code>。</p>
<p>实现：</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*philosopher*/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">philosopher</span><span class="params">(<span class="keyword">int</span> i)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line">        <span class="comment">/*思考*/</span>;</span><br><span class="line">        semWait(mutex);</span><br><span class="line">        semWait(chopstick[i]);    <span class="comment">//拿起左筷</span></span><br><span class="line">        semWait(chopstick[(i+<span class="number">1</span>)%<span class="number">5</span>]);    <span class="comment">//拿起右筷</span></span><br><span class="line">        semSignal(mutex);</span><br><span class="line">        <span class="comment">/*进餐*/</span>;</span><br><span class="line">        semSignal(chopstick[i]);    <span class="comment">//放下左筷</span></span><br><span class="line">        semSignal(shopstick[(i+<span class="number">1</span>)%<span class="number">5</span>]);    <span class="comment">//放下右筷</span></span><br><span class="line">        <span class="comment">/*思考*/</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    parbegin (philosopher(<span class="number">0</span>), philosopher(<span class="number">1</span>), philosopher(<span class="number">2</span>), philosopher(<span class="number">3</span>), philosopher(<span class="number">4</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>分析：</p>
<p>哲学家进程要想正常进行就需要同时拿起左右两根筷子，一旦请求资源无法满足，就会进入阻塞态。</p>
</blockquote>
<p>方法二：</p>
<p>分析：根据“鸽笼原理”，只要最多只有四位哲学家并发争夺筷子进餐，那么肯定会有一位哲学家可以同时拿到两根筷子。为此我们定义如下信号量：</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">semaphore chopstick[<span class="number">5</span>] = &#123;<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>&#125;;    <span class="comment">//用于实现对5根筷子的互斥访问</span></span><br><span class="line">semaphore room = <span class="number">4</span>;    <span class="comment">//最多允许4为哲学家进餐</span></span><br></pre></td></tr></table></figure>
<p>实现：</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*philosopher*/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">philosopher</span><span class="params">(<span class="keyword">int</span> i)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line">        <span class="comment">/*思考*/</span>;</span><br><span class="line">        semWait(room);</span><br><span class="line">        semWait(chopstick[i]);    <span class="comment">//拿起左筷</span></span><br><span class="line">        semWait(chopstick[(i+<span class="number">1</span>)%<span class="number">5</span>]);    <span class="comment">//拿起右筷</span></span><br><span class="line">        <span class="comment">/*进餐*/</span>;</span><br><span class="line">        semSignal(chopstick[i]);    <span class="comment">//放下左筷</span></span><br><span class="line">        semSignal(shopstick[(i+<span class="number">1</span>)%<span class="number">5</span>]);    <span class="comment">//放下右筷</span></span><br><span class="line">        semSignal(room);</span><br><span class="line">        <span class="comment">/*思考*/</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    parbegin (philosopher(<span class="number">0</span>), philosopher(<span class="number">1</span>), philosopher(<span class="number">2</span>), philosopher(<span class="number">3</span>), philosopher(<span class="number">4</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>方法三：</p>
<p>要求奇数号哲学家先拿左边的筷子，然后再拿右边的筷子；而偶数号的哲学家相反，先拿右边的筷子，再拿左边的筷子。在这种策略下，如果相邻的两个奇偶号哲学家都想吃饭，那么只会有其中一个可以拿起第一只筷子，另一个会直接阻塞。这就避免了占有一支后再等待另一支的情况。</p>
<p>首先定义如下信号量：</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">semaphore chopstick[<span class="number">5</span>] = &#123;<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>&#125;;    <span class="comment">//用于实现对5根筷子的互斥访问</span></span><br></pre></td></tr></table></figure>
<p>实现：</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*philosopher*/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">philosopher</span><span class="params">(<span class="keyword">int</span> i)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(i % <span class="number">2</span> == <span class="number">1</span>)&#123;    <span class="comment">//奇数号哲学家</span></span><br><span class="line">            <span class="comment">/*思考*/</span>;</span><br><span class="line">            semWait(chopstick[i]);    <span class="comment">//拿起左筷</span></span><br><span class="line">            semWait(chopstick[(i+<span class="number">1</span>)%<span class="number">5</span>]);    <span class="comment">//拿起右筷</span></span><br><span class="line">            <span class="comment">/*进餐*/</span>;</span><br><span class="line">            semSignal(chopstick[i]);    <span class="comment">//放下左筷</span></span><br><span class="line">            semSignal(shopstick[(i+<span class="number">1</span>)%<span class="number">5</span>]);    <span class="comment">//放下右筷</span></span><br><span class="line">            <span class="comment">/*思考*/</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(i % <span class="number">2</span> == <span class="number">0</span>)&#123;    <span class="comment">//偶数号哲学家</span></span><br><span class="line">            <span class="comment">/*思考*/</span>;</span><br><span class="line">            semWait(chopstick[(i+<span class="number">1</span>)%<span class="number">5</span>]);    <span class="comment">//拿起右筷</span></span><br><span class="line">            semWait(chopstick[i]);    <span class="comment">//拿起左筷</span></span><br><span class="line">            <span class="comment">/*进餐*/</span>;</span><br><span class="line">            semSignal(shopstick[(i+<span class="number">1</span>)%<span class="number">5</span>]);    <span class="comment">//放下右筷</span></span><br><span class="line">            semSignal(chopstick[i]);    <span class="comment">//放下左筷</span></span><br><span class="line">            <span class="comment">/*思考*/</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    parbegin (philosopher(<span class="number">0</span>), philosopher(<span class="number">1</span>), philosopher(<span class="number">2</span>), philosopher(<span class="number">3</span>), philosopher(<span class="number">4</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h1>后记</h1>
<p>本篇还没结束，持续更新中。</p>
<p><em>（欢迎评论区批评指正）</em></p>
]]></content>
      <categories>
        <category>学习笔记</category>
      </categories>
      <tags>
        <tag>操作系统</tag>
      </tags>
  </entry>
  <entry>
    <title>操作系统学习笔记-单处理器调度</title>
    <url>/2021/05/30/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E5%8D%95%E5%A4%84%E7%90%86%E5%99%A8%E8%B0%83%E5%BA%A6/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\css\APlayer.min.css"><script src="\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\js\Meting.min.js"></script><h1>前言</h1>
<p><em>正在学习操作系统，记录笔记。</em></p>
<blockquote>
<p>参考资料：</p>
<p>《操作系统（精髓与设计原理 第8版） 》</p>
</blockquote>
<hr>
<h1>第九章：单处理器调度</h1>
<p>多道程序设计的关键就是调度。典型的调度有4种（见下表）</p>
<table>
<thead>
<tr>
<th>调度的类型</th>
<th>解释</th>
</tr>
</thead>
<tbody>
<tr>
<td>长程调度（Long-term scheduling）</td>
<td>决定加入待执行进程池</td>
</tr>
<tr>
<td>中程调度（Medium-term scheduling）</td>
<td>决定加入部分或全部位于内存中的进程集合</td>
</tr>
<tr>
<td>短程调度（Short-term scheduling）</td>
<td>决定处理器执行哪个可运行进程</td>
</tr>
<tr>
<td>I/O调度（I/O scheduling）</td>
<td>决定可用I/O设备处理哪个进程挂起的I/O请求</td>
</tr>
</tbody>
</table>
<blockquote>
<p>本章先介绍前三种，I/O调度将在后续章节中介绍。</p>
</blockquote>
<h2 id="处理器调度的类型">处理器调度的类型</h2>
<p>首先要明白调度的目的：根本目的就是提升CPU效率。</p>
<p>有以下三个指标：</p>
<ul>
<li>响应时间（Response time ）</li>
<li>吞吐率（Throughput）</li>
<li>处理器效率（Processor efficiency ）</li>
</ul>
<p>结合进程状态图具体展示出不同调度类型的功能：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E8%BF%9B%E7%A8%8B%E7%8A%B6%E6%80%81%E5%9B%BE%E7%BB%93%E5%90%88%E8%B0%83%E5%BA%A6%E7%B1%BB%E5%9E%8B.png" alt=""></p>
<blockquote>
<p>说明：</p>
<ul>
<li>长程调度：在进程创建的时候执行，它决定是否把进程添加到当前活跃的进程集中。
<ul>
<li>新建态 → 就绪/挂起态</li>
<li>新建态 → 就绪态</li>
</ul>
</li>
<li>中程调度：是交换功能的一部分，它决定是否把进程添加到那些至少部分已在内存且可被执行的进程集中。
<ul>
<li>就绪/挂起态 → 就绪态</li>
<li>阻塞/挂起态 → 阻塞态</li>
</ul>
</li>
<li>短程调度：真正决定下次执行哪个就绪进程。
<ul>
<li>就绪态 → 运行态</li>
</ul>
</li>
<li>（具体长、中、短的含义指的是：进程完成调度的时间）</li>
</ul>
<hr>
<p>下图重新组织了进程状态转换图：</p>
<img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS进程状态转换图新.png" style="zoom:70%;" />
<blockquote>
<p>值得注意的是：</p>
<ul>
<li>长程调度一定嵌套短程调度，但不一定嵌套中程调度。</li>
<li>中程调度一定嵌套短程调度。</li>
</ul>
</blockquote>
<hr>
<p>下图给出了进程转换过程中所涉及的队列：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E8%B0%83%E5%BA%A6%E6%B6%89%E5%8F%8A%E7%9A%84%E9%98%9F%E5%88%97.png" alt=""></p>
<blockquote>
<p>调度的本质：就是对各种队列的管理，以提高系统的利用率。</p>
</blockquote>
</blockquote>
<h3 id="长程调度">长程调度</h3>
<p>长程调度程序决定了哪个程序可以进入系统中进行处理，因此它<strong>控制了系统的并发度</strong>。</p>
<blockquote>
<p>长程调度主要出现在批处理系统中，又叫做：作业调度。</p>
</blockquote>
<p>长程调度程序运行时，从队列中创建相应的进程，这时会涉及两个决策：</p>
<ul>
<li>决定操作系统何时才能接纳一个或多个进程
<ul>
<li>创建的进程越多，每个进程占用处理器的时间就越少（因此长程调度程序会限制并发度）</li>
<li>当一个作业终止时，调度程序会决定增加一个或多个新作业</li>
<li>若处理器的空闲时间片超过了某个阈值，可能会启动长程调度程序</li>
</ul>
</li>
<li>决定接受哪些作业，将其转化为进程
<ul>
<li>可以基于先来先服务（First-come-first-service，FCFS）的原则</li>
<li>可以基于系统性能管理工具，所用的原则包括：优先级（include priorty）、期望执行时间（expected execution time）、I/O请求（I/O requirements）</li>
<li>对于分时系统中交互的程序，操作系统接受所有的授权用户，直到系统饱和</li>
</ul>
</li>
</ul>
<h3 id="中程调度">中程调度</h3>
<p>中程调度是交换功能的一部分。（在之前的章节中分析过）</p>
<p>在典型情况下，换入（swapping-in）决定取决于管理系统并发度的需求。</p>
<h3 id="短程调度">短程调度</h3>
<p>短程调度程序也被称为<strong>分派器（dispatcher）</strong>。</p>
<blockquote>
<p>执行的频繁程度：</p>
<ul>
<li>长程调度程序执行的频率相对较低</li>
<li>中程调度程序执行得较为频繁</li>
<li>短程调度程序执行得最为频繁</li>
</ul>
</blockquote>
<p>导致当前进程阻塞或抢占当前运行进程的事件发生时，调用短程调度程序。这类事件包括：</p>
<ul>
<li>时钟中断（Clock interrupts）</li>
<li>I/O中断（I/O interrupts）</li>
<li>操作系统调用（Operating system calls）</li>
<li>信号（Signals）（如信号量）</li>
</ul>
<h2 id="调度算法">调度算法</h2>
<h3 id="短程调度准则">短程调度准则</h3>
<p>短程调度的主要目标是：按照优化系统一个或多个方面行为的方式，来分配处理器时间。</p>
<p>短程调度准则（Short-Tem Scheduling Criteria）从两个维度来划分：</p>
<ol>
<li>
<p>面向用户的规则（User-oriented）</p>
<ul>
<li>
<p>交互式系统中的响应时间</p>
<p>响应时间：指从提交一条请求到输出响应所经历的时间间隔。（对用户可见）</p>
</li>
</ul>
</li>
<li>
<p>面向系统的规则（System-oriented）</p>
<ul>
<li>
<p>处理器使用的效果和效率</p>
</li>
<li>
<p>吞吐量：即进程完成的速度</p>
<p>吞吐量是系统性能的一个重要测度，我们总是希望系统的吞吐量能达到最大。</p>
</li>
</ul>
</li>
</ol>
<p>从另一个维度去判别短程调度算法的优劣就是性能相关（Performance-related）：</p>
<ul>
<li>与性能相关的规则是定量的，例如：响应时间、吞吐率。</li>
<li>与性能无关的规则本质上要么是定性的，要么不易测量和分析，例如：可预测性。</li>
</ul>
<p>下面四张表总结了几种重要的调度规则：</p>
<ul>
<li>
<p>面向用户，与性能相关</p>
<table>
<thead>
<tr>
<th>调度规则</th>
<th>解释</th>
</tr>
</thead>
<tbody>
<tr>
<td>周转时间（Turnaround time）</td>
<td>指一个进程从提交到完成之间的时间间隔，包括实际执行时间和等待资源（包括处理器资源）的时间。对批处理作业而言，这是一种很合适的测度</td>
</tr>
<tr>
<td>响应时间（Response time）</td>
<td>对一个交互进程来说，这指从提交一个请求到开始接收响应之间的时间间隔。通常情况下，进程在处理该请求的同时，会开始给用户产生一些输出。因此从用户的角度来看，相对于周转时间，这是一种更好的测度。该调度原则会试图实现较低的响应时间，并在可接受的响应时间范围内，使可交互的用户数量最大</td>
</tr>
<tr>
<td>最后期限（Deadlines）</td>
<td>在能指定进程完成的最后期限时，调度原则将降低其他目标，使得满足最后期限的作业数量的百分比最大</td>
</tr>
</tbody>
</table>
</li>
<li>
<p>面向用户，其他</p>
<table>
<thead>
<tr>
<th>调度规则</th>
<th>解释</th>
</tr>
</thead>
<tbody>
<tr>
<td>可预测性（Predictability）</td>
<td>无论系统的负载如何，一个给定作业运行的总时间量和总代价是相同的。用户不希望响应时间或周转时间的变化太大。这可能需要在系统作业负载大范围抖动时发出信号，或需要系统处理不稳定性</td>
</tr>
</tbody>
</table>
</li>
<li>
<p>面向系统，与性能相关</p>
<table>
<thead>
<tr>
<th>调度规则</th>
<th>解释</th>
</tr>
</thead>
<tbody>
<tr>
<td>吞吐量（Throughput）</td>
<td>调度策略应使得单位时间内完成的进程数量最大。这是对能执行多少作业的一种度量。它明显取决于一个进程的平均执行长度，也受调度策略的影响，因为调度策略会影响利用率</td>
</tr>
<tr>
<td>处理器利用率（Processor utilization）</td>
<td>这是处理器处于忙状态的时间百分比。对昂贵的共享系统来说，这个规则很重要。在单用户系统和其他一些系统如实时系统中，该规则与其他规则相比不太重要</td>
</tr>
</tbody>
</table>
</li>
<li>
<p>面向系统。其他</p>
<table>
<thead>
<tr>
<th>调度规则</th>
<th>解释</th>
</tr>
</thead>
<tbody>
<tr>
<td>公平性（Fairness）</td>
<td>没有来自用户或其他系统的指导时，进程应被平等地对待，没有进程处于饥饿状态</td>
</tr>
<tr>
<td>强制优先级（Enforcing priorities）</td>
<td>指定进程的优先级后，调度策略应优先选择高优先级的进程</td>
</tr>
<tr>
<td>平衡资源（Balancing resources）</td>
<td>调度策略使系统中的所有资源处于忙状态，优先调度较少使用紧缺资源的进程。该规则也适用于中程调度和长程调度</td>
</tr>
</tbody>
</table>
</li>
</ul>
<p>设计调度策略时，要在互相竞争的各种要求之间进行折中。</p>
<blockquote>
<p>提供较好的响应时间可能需要调度算法在进程间频繁切换，而这会增加系统开销，降低吞吐量。</p>
</blockquote>
<h3 id="优先级的使用">优先级的使用</h3>
<p>在许多系统中，每个进程都被指定一个优先级，调度程序总是优先选择具有较高优先级的进程。（优先级从最高0开始）</p>
<p>下图展示了优先级排队的队列图（简化）：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E4%BC%98%E5%85%88%E7%BA%A7%E7%9A%84%E4%BD%BF%E7%94%A8%E9%98%9F%E5%88%97.png" alt=""></p>
<ul>
<li>
<p>每个优先级有一个队列：RQ0 &gt; RQ1 &gt; … &gt; RQn</p>
<p>进行调度选择时总是从优先级最高的队列中检查，如果有进程，则对该进程进行调度。只有当较高优先级的队列都为空时，采取调度优先级较低的队列中的进程。</p>
</li>
<li>
<p>这种纯优先级调度的方案可能会引起较低优先级进程饥饿。</p>
<blockquote>
<p>如果不希望出现饥饿的状态，只能让一个进程的优先级随时间或执行历史而变化。</p>
</blockquote>
</li>
</ul>
<h3 id="选择调度策略">选择调度策略</h3>
<p>决策模式（Decision Mode ）</p>
<ul>
<li>
<p>非抢占（Nonpreemptive）：一旦进程处于运行状态，就会不断执行直到终止。进程要么因为等待I/O，要么因为请求某些操作系统服务而被阻塞。</p>
</li>
<li>
<p>抢占（Preemptive）：当前正运行进程可能被操作系统中断，并转换为就绪态。</p>
<blockquote>
<p>一个新进程到达时，或中断发生后把一个阻塞态进程置为就绪态时，或出现周期性的时间中断时，需要进行抢占决策。</p>
</blockquote>
</li>
</ul>
<blockquote>
<ul>
<li>非抢占模式会导致处理器效率降低</li>
<li>抢占模式可能违反公平</li>
</ul>
</blockquote>
<p>下面我们来分析六种进程调度算法，以下表中五个进程为例：</p>
<table>
<thead>
<tr>
<th>进程(Process）</th>
<th>到达时间（Arrival Time）</th>
<th>服务时间（Service Time）</th>
</tr>
</thead>
<tbody>
<tr>
<td>A</td>
<td>0</td>
<td>3</td>
</tr>
<tr>
<td>B</td>
<td>2</td>
<td>6</td>
</tr>
<tr>
<td>C</td>
<td>4</td>
<td>4</td>
</tr>
<tr>
<td>D</td>
<td>6</td>
<td>5</td>
</tr>
<tr>
<td>E</td>
<td>8</td>
<td>2</td>
</tr>
</tbody>
</table>
<blockquote>
<p>注：这里的到达时间和服务时间都是以时间片的形式展示</p>
<ul>
<li>达到时间：进程进入队列的到达时刻</li>
<li>服务时间：进程需要多少时间片可以结束</li>
</ul>
</blockquote>
<p>以下具体描述进程的调度用**甘特图（Gantt chart）**的形式：</p>
<ul>
<li>非抢占：在甘特图中是连续的</li>
<li>抢占：在甘特图中是非连续的</li>
</ul>
<blockquote>
<p>注意，以下关于“当前队列”的描述：自左<code>（队首，进队）</code>向右<code>（队尾，出队）</code></p>
</blockquote>
<h4 id="先来先服务（FCFS）">先来先服务（FCFS）</h4>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E5%85%88%E6%9D%A5%E5%85%88%E6%9C%8D%E5%8A%A1.png" alt=""></p>
<blockquote>
<p>说明：先来先服务（First-Come-First-Served，FCFS）</p>
<ul>
<li>0时刻，A进程进入队列，并开始执行，连续执行3个时间片</li>
<li>2时刻（此时A进程在执行），B进程进入队列，并等待执行</li>
<li>3时刻，A进程执行完毕，B进程开始执行，连续执行6个时间片</li>
<li>以此类推</li>
</ul>
</blockquote>
<ul>
<li>
<p>这是一种非抢占的算法</p>
</li>
<li>
<p>在当前进程执行完毕的时刻，调度器会选择队列中等待时间最长的进程，分配处理器资源</p>
</li>
<li>
<p>分析该种算法存在问题：对于短进程（服务时间短）和I/O密集型的进程不利。</p>
<blockquote>
<p>以银行取钱为例：</p>
<p>假设我要到银行取钱（办理取钱业务仅需5分钟），但是排在我前面的二十位客户都要开户（办理开户业务需要30分钟），那么我原本仅需5分钟的业务需要等待10h 5min。</p>
</blockquote>
<blockquote>
<p>相比于I/O密集型更有利于处理器密集型的进程：I/O进程必须等待CPU限制进程完成。</p>
<p>FCFS可能导致处理器和I/O设备都未得到充分利用。</p>
</blockquote>
</li>
</ul>
<h4 id="轮转（RR）">轮转（RR）</h4>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E8%BD%AE%E8%BD%AC.png" alt=""></p>
<p>假设轮转的时钟周期 q = 1</p>
<blockquote>
<p>说明：轮转（Round-Robin，RR）</p>
<ul>
<li>0时刻，A进程进入队列，并开始执行，执行两个时间片</li>
<li>2-时刻，B进程进入队列，A进程在2时刻也重新进入队列（此时队列：A、B）</li>
<li>2+时刻，B进程开始执行</li>
<li>以此类推</li>
</ul>
</blockquote>
<ul>
<li>
<p>轮转是一种基于时钟的抢占算法</p>
</li>
<li>
<p>提出的目的在于解决FCFS短进程长时等待的问题，保证每个进程都占用处理器一段时间</p>
</li>
<li>
<p>周期性产生时钟中断，当中断发生时，当前运行的进程就被放置就绪队列中，进而调度下一个进程</p>
</li>
<li>
<p>关于时间片（as time slicing ）的大小设置：</p>
<ul>
<li>
<p>时间片过小：会产生无效的调度，即进程还没来得及执行就被调出了（高频次的进程调度也会带来巨大的开销）</p>
</li>
<li>
<p>时间片过大：退化回FCFS算法</p>
<blockquote>
<p>RR算法从根本上讲并没有解决I/O密集型等待CPU密集型进程的问题</p>
</blockquote>
</li>
<li>
<p>通常时间片的长度设置为：一次交互（产生输出）的时间</p>
</li>
</ul>
</li>
</ul>
<p>基于轮转法又提出了一种改进：虚拟轮转法（Virtual Round-Robin Scheduler，VRR）</p>
<p>引入一个辅助队列，解决了I/O进程长时等待的问题。</p>
<ul>
<li>一个进程因I/O而阻塞时，会加入一个I/O队列</li>
<li>解除了I/O阻塞的进程都会转移到一个FCFS辅助队列中。进行调度决策时，辅助队列中的进程优先于就绪队列中的进程。</li>
</ul>
<h4 id="最短进程优先（SPN）">最短进程优先（SPN）</h4>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E6%9C%80%E7%9F%AD%E8%BF%9B%E7%A8%8B%E4%BC%98%E5%85%88.png" alt=""></p>
<blockquote>
<p>说明：最短进程优先（Shortest Process Next ，SPN）</p>
<ul>
<li>0时刻，A进程进入队列，并开始执行，连续执行3个时间片</li>
<li>2时刻（此时A进程在执行），B进程进入队列，并等待执行</li>
<li>3时刻，A进程执行完毕，判断队列中只有B进程，B进程开始执行，并连续执行6个时间片</li>
<li>4时刻（此时B进程正在执行），C进程进入队列，并等待执行（此时队列：C）</li>
<li>6时刻（此时B进程正在执行），D进程进入队列，并等待执行（此时队列：D、C）</li>
<li>8时刻（此时B进程正在执行），E进程进入队列，并等待执行（此时队列：E、D、C）</li>
<li>9时刻，B进程执行完毕，判断队列中服务时间最小的进程为E，所以执行E进程（此时队列：D、C）</li>
<li>以此类推</li>
</ul>
</blockquote>
<ul>
<li>
<p>这是一种非抢占的算法</p>
</li>
<li>
<p>原则：短进程优先（这也是该算法的初衷：为了解决FCFS短进程长时等待的问题）</p>
</li>
<li>
<p>潜在的问题：</p>
<ul>
<li>
<p>需要估计每个进程的服务时间（预测）。若估计值远低于实际运行时间，系统可能终止该作业。</p>
<blockquote>
<p>预估时间的算法：<strong>指数平均法（Exponential averaging）</strong>。一种基于过去时间值的时间序列预测将来值得算法。</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>S</mi><mrow><mi>n</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>=</mo><mi>α</mi><msub><mi>T</mi><mi>n</mi></msub><mo>+</mo><mtext>（</mtext><mn>1</mn><mo>−</mo><mi>α</mi><mtext>）</mtext><msub><mi>S</mi><mi>n</mi></msub></mrow><annotation encoding="application/x-tex">S_{n+1} = αT_n + （1-α）S_n
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.891661em;vertical-align:-0.208331em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:-0.05764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">α</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.76666em;vertical-align:-0.08333em;"></span><span class="mord cjk_fallback">（</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">α</span><span class="mord cjk_fallback">）</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.05764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p>
<p>α是一个常数加权因子（0 &gt; α &gt; 1），用于确定距现在较近或较远的观测数据的相对权值。</p>
</blockquote>
</li>
<li>
<p>还可能导致长进程饥饿</p>
</li>
</ul>
</li>
</ul>
<h4 id="最短剩余时间（SRT）">最短剩余时间（SRT）</h4>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E6%9C%80%E7%9F%AD%E5%89%A9%E4%BD%99%E6%97%B6%E9%97%B4.png" alt=""></p>
<blockquote>
<p>说明：最短剩余时间（Shortest Remaining Time ，SRT）</p>
<p>注意：当前队列中进程后面的数字表示剩余时间（还有多少时间片执行完毕）</p>
<ul>
<li>0时刻，A进程进入队列，并开始执行，连续执行2个时间片</li>
<li>2-时刻，B进程进入队列，2时刻A进程重新进入队列（此时队列：A(1)、B(6)）</li>
<li>2+时刻，执行A进程</li>
<li>3时刻，A进程执行完毕，此时队列中只有B进程，因此B进程执行</li>
<li>4-时刻，C进程进入队列，4时刻B进程重新进入队列（此时队列：B(5)、C(4)）</li>
<li>4+时刻，执行C进程，连续执行两个时间片</li>
<li>6-时刻，D进程进入队列，6时刻C进程重新进入队列（此时队列：C(2)、D(5)、B(5)）</li>
<li>6+时刻，执行C进程</li>
<li>以此类推</li>
</ul>
</blockquote>
<ul>
<li>SRT算法是最短进程优先（SPN）的抢占版本</li>
<li>潜在的问题：
<ul>
<li>同样需要估计每个进程的服务时间（预测），还需要记录过去的服务时间（增加开销）</li>
<li>仍然可能导致长进程饥饿</li>
</ul>
</li>
</ul>
<h4 id="最高响应比优先（HRRN）">最高响应比优先（HRRN）</h4>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E6%9C%80%E9%AB%98%E5%93%8D%E5%BA%94%E6%AF%94%E4%BC%98%E5%85%88.png" alt=""></p>
<blockquote>
<p>说明：最高响应比优先（Highest Response Ratio Next，HRRN）</p>
<p>注意：当前队列中进程后面的数字表示响应比</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>R</mi><mo stretchy="false">(</mo><mtext>响应比</mtext><mo stretchy="false">)</mo><mo>=</mo><mfrac><mrow><mi>w</mi><mo>+</mo><mi>s</mi></mrow><mi>s</mi></mfrac></mrow><annotation encoding="application/x-tex">R(响应比) = \frac{w+s}{s}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mopen">(</span><span class="mord cjk_fallback">响应比</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.9463300000000001em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.2603300000000002em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">s</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathnormal">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<ul>
<li>w（time spent waiting）：等待处理器的时间。
<ul>
<li>w = 当前时间 - 到达时间(Arrival Time)</li>
</ul>
</li>
<li>s（expected service time）：预计的服务时间。
<ul>
<li>s = 服务时间(Service Time)</li>
</ul>
</li>
</ul>
<p>分析：</p>
<ul>
<li>0时刻，A进程进入队列，并开始执行，连续执行3个时间片</li>
<li>2时刻（此时A进程在执行），B进程进入队列，并等待执行（此时队列：B(1)）</li>
<li>3时刻，A进程执行完毕，队列中只有B进程，执行B进程</li>
<li>4时刻（此时B进程在执行），C进程进入队列，并等待执行（此时队列：C(1)）</li>
<li>6时刻（此时B进程在执行），D进程进入队列，并等待执行（此时队列：D(1)、C(3/2)）</li>
<li>8时刻（此时B进程在执行），E进程进入队列，并等待执行（此时队列：E(1)、D(7/5)、C(2)）</li>
<li>9时刻，B进程执行完毕，此时队列：E(3/2)、D(8/5)、C(9/4)，C进程的响应比最高，因此执行C进程</li>
<li>以此类推</li>
</ul>
</blockquote>
<ul>
<li>是一种非抢占的算法</li>
<li>优势：
<ul>
<li>如果等待时间相同，则短进程优先</li>
<li>长进程等待时间越久，其优先级会逐渐提升</li>
</ul>
</li>
<li>潜在的问题：依旧需要估计每个进程的服务时间（预测），还有其他的开销</li>
</ul>
<h4 id="反馈法（Feedback）">反馈法（Feedback）</h4>
<p>如果不存在各个进程的预计服务时间（事实上我们也希望如此）,则不能使用SPN、SRT、HRRN算法。于是又提出了反馈法：</p>
<img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS反馈法.png" style="zoom:80%;" />
<p>反馈法（Feedback）：同样是考虑短进程优先，对于长时间占有处理器使用权的进程会给予”惩罚“，使其降低优先级。</p>
<ul>
<li>有多个优先级的队列（RQ0、RQ1、…、RQn）</li>
<li>新进程加载进队列时总是先进入优先级最高的队列（RQ0）</li>
<li>有轮转机制：
<ul>
<li>定长时间片（每个队列的时钟周期：q = 固定值）</li>
<li>变长时间片（不同队列的时钟周期不同：q = 2<sup>i</sup> ，i为队列号（从0开始））</li>
</ul>
</li>
<li>当一个正在执行的进程被调出时，会调到比之前低一级的队列中</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E5%8F%8D%E9%A6%88%E6%B3%952.png" alt=""></p>
<blockquote>
<p>说明：假设为定长时间片：q = 1</p>
<ul>
<li>0时刻，A进程进入队列<code>RQ0</code>，执行A进程，持续执行2个时间片</li>
<li>2-时刻，B进程进入队列<code>RQ0</code>，2时刻A进程被调入到队列<code>RQ1</code>，此时
<ul>
<li>队列<code>RQ0</code>：B</li>
<li>队列<code>RQ1</code>：A</li>
</ul>
</li>
<li>2+时刻，执行B进程</li>
<li>3时刻，B进程被调入到队列<code>RQ1</code>，此时
<ul>
<li>队列<code>RQ0</code>：无进程</li>
<li>队列<code>RQ1</code>：B、A</li>
</ul>
</li>
<li>3+时刻，执行A进程</li>
<li>4-时刻，C进程进入队列<code>RQ0</code>，A进程执行完毕，此时
<ul>
<li>队列<code>RQ0</code>：C</li>
<li>队列<code>RQ1</code>：B</li>
</ul>
</li>
<li>4+时刻，执行C进程</li>
<li>5时刻，C进程被调入到队列<code>RQ1</code>，此时
<ul>
<li>队列<code>RQ0</code>：无进程</li>
<li>队列<code>RQ1</code>：C、B</li>
</ul>
</li>
<li>5+时刻，执行B进程</li>
<li>依次执行</li>
</ul>
</blockquote>
<h4 id="调度策略的比较">调度策略的比较</h4>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E8%B0%83%E5%BA%A6%E7%AD%96%E7%95%A5%E7%9A%84%E6%AF%94%E8%BE%83.png" alt=""></p>
<blockquote>
<p>说明：</p>
<ul>
<li>Finish Time（完成时间）：进程最终结束的时刻</li>
<li>Turnaround Time (T<sub>r</sub> ，周转时间)：完成时间 - 到达时间</li>
<li>T<sub>r</sub> / T<sub>s</sub>：周转时间 / 服务时间</li>
<li>最后一列：平均值</li>
</ul>
</blockquote>
<hr>
<h1>后记</h1>
<p>本篇已完结</p>
<p>（如有修改或补充欢迎评论）</p>
]]></content>
      <categories>
        <category>学习笔记</category>
      </categories>
      <tags>
        <tag>操作系统</tag>
      </tags>
  </entry>
  <entry>
    <title>操作系统学习笔记-并发：死锁和饥饿</title>
    <url>/2021/05/04/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E5%B9%B6%E5%8F%91%EF%BC%9A%E6%AD%BB%E9%94%81%E5%92%8C%E9%A5%A5%E9%A5%BF/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\css\APlayer.min.css"><script src="\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\js\Meting.min.js"></script><h1>前言</h1>
<p><em>正在学习操作系统，记录笔记。</em></p>
<blockquote>
<p>参考资料：</p>
<p>《操作系统（精髓与设计原理 第6版） 》</p>
</blockquote>
<hr>
<h1>第六章：并发：死锁和饥饿</h1>
<p>本文的标题为“死锁和饥饿”，但是在接下来的内容中讲述的基本上都是死锁的问题。在这里说明一下原因：</p>
<p>先给结论（当然这个说法并不准确，但可以如此理解）：总体来说，从概念上看死锁可以看作是饥饿的<strong>子集</strong>。</p>
<p>为什么这么讲，那我们就来分析一下二者的区别：</p>
<p><strong>饥饿</strong>：一个以上的进程（具备运行条件），遇到某种情况导致一直无法运行。</p>
<p><strong>死锁</strong>：可以定义为一组（两个及以上）相互竞争系统资源或进行通信的进程间的“永久”阻塞。如果没有操作系统的干预，死锁无法自己解决问题。</p>
<blockquote>
<p>二者的共同点：</p>
<ul>
<li>得不到需要的资源，无法运行。</li>
</ul>
<p>二者的差异：</p>
<ul>
<li>死锁只是因为双方（或多方）相互干预而无法运行，而导致饥饿无法运行的还有其他原因。</li>
<li>如果没有操作系统的干预，死锁不会自行解决问题，而饥饿有可能自动解除。</li>
</ul>
<p>关于死锁的一点补充：死锁的问题有多种，但是并没有一种“万金油”式的通用有效的解决方案。需要根据具体问题具体分析。</p>
</blockquote>
<h2 id="死锁的原理">死锁的原理</h2>
<p>造成死锁的问题主要分为两类（后面会有案例）：</p>
<ul>
<li>稀缺资源的抢夺</li>
<li>资源充足，但是请求顺序不当</li>
</ul>
<p>对于资源的概念，通常可以分为两类：可重用资源以及可消耗资源。</p>
<h3 id="可重用资源">可重用资源</h3>
<ul>
<li>一次只被一个进程安全地使用（资源是互斥的），并且不会由于使用而耗尽。</li>
<li>进程使用完资源后释放，其他进程可以再次使用。</li>
<li>包括：处理器、I/O通道、内存和外存、设备以及诸如文件、数据库和信号量之类的数据结构。</li>
<li>如果每个进程持有一个资源并请求另一个资源，就会发生死锁。</li>
</ul>
<p>下面将给出涉及可重用资源死锁的例子：</p>
<ul>
<li>
<p>案例一：</p>
<p>如下图所示，考虑竞争独占访问磁盘文件D和磁带设备T的两个进程。如果多道程序设计系统按照p<sub>0</sub>、p<sub>1</sub>、q<sub>0</sub>、q<sub>1</sub>、p<sub>2</sub>、q<sub>2</sub>的顺序交替地执行P、Q两个进程，则会发生死锁。</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E5%8F%AF%E9%87%8D%E7%94%A8%E8%B5%84%E6%BA%90%E6%AD%BB%E9%94%81%E4%B8%80.png" alt=""></p>
<p>处理这类死锁的一个策略是给系统设计施加关于资源请求顺序的约束。</p>
</li>
<li>
<p>案例二：</p>
<p>如下图所示，假设可用的内存分配空间为200KB，且进程P1、P2发生如下请求序列：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E5%8F%AF%E9%87%8D%E7%94%A8%E8%B5%84%E6%BA%90%E6%AD%BB%E9%94%81%E4%BA%8C.png" alt=""></p>
<p>如果两个进程都前进到它们的第二个请求时，则会发生死锁。解决这类特殊问题的最好办法是，通过使用虚拟内存。</p>
</li>
</ul>
<h3 id="可消耗资源">可消耗资源</h3>
<ul>
<li>
<p>可消耗资源是指可以被创建（生产）和销毁（消耗）的资源。（通常对某种类型可消耗资源的数目没有限制，一个无阻塞的生产进程可以创建任意数目的这类资源。）</p>
</li>
<li>
<p>包括：中断、信号、消息和I/O缓冲区中的信息。</p>
</li>
<li>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E5%8F%AF%E6%B6%88%E8%80%97%E8%B5%84%E6%BA%90%E6%AD%BB%E9%94%81.png" alt=""></p>
<p>如果Receive阻塞（即接收进程被阻塞直到收到消息），则发生死锁。</p>
</li>
<li>
<p>很少的事件组合也可能导致死锁。</p>
</li>
</ul>
<h3 id="资源分配图">资源分配图</h3>
<p>为了更有效刻画进程的资源分配情况，引入了资源分配图（如下图）。</p>
<ul>
<li>
<p>圆：表示并发的进程</p>
</li>
<li>
<p>方框：表示待分配的资源（其中的点的数量表示可用资源的数量）</p>
</li>
<li>
<p>有向线：</p>
<ul>
<li>进程→资源（圆→方框）：表示进程请求资源，但还没有得到授权。</li>
<li>资源→进程（方框→圆）：表示资源请求已经被授权。（资源已经被进程占有）</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E8%B5%84%E6%BA%90%E5%88%86%E9%85%8D%E5%9B%BE.png" alt=""></p>
</li>
</ul>
<p>下面看一个例子：</p>
<blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E8%B5%84%E6%BA%90%E5%88%86%E9%85%8D%E5%9B%BE%E6%AD%BB%E9%94%81.png" alt=""></p>
<p>分析：</p>
<p>这是一个死锁的例子。资源Ra和Bb都仅拥有一个单位的资源。进程P1持有Rb同时请求Ra，同时，P2进程持有Ra同时又请求Rb。</p>
</blockquote>
<h3 id="死锁的条件">死锁的条件</h3>
<ul>
<li>
<p>死锁的必要条件（一旦出现死锁，则必然发生的条件）：</p>
<ul>
<li><strong>互斥</strong>：一次只有一个进程可以使用一个资源。</li>
<li><strong>占有且等待</strong>：当一个进程等待其他进程时，继续占有已经分配的资源。</li>
<li><strong>非抢占</strong>：不能强行抢占进程已占有的资源。</li>
</ul>
</li>
<li>
<p>第四个条件：</p>
<ul>
<li>
<p><strong>循环等待</strong>：存在一个封闭的进程链，使得每个进程至少占有此链中下一个进程所需要的一个资源。（如下图所示）</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E6%AD%BB%E9%94%81%E6%9D%A1%E4%BB%B6%E5%BE%AA%E7%8E%AF%E7%AD%89%E5%BE%85.png" alt=""></p>
</li>
</ul>
<blockquote>
<p>说明：</p>
<p>第四个条件实际上是前三个条件的潜在结果，即假设前三个条件存在，可能发生的一系列事件会导致不可解的循环等待。这个不可解的循环等待实际上就是死锁的定义。条件4中列出的循环等待之所以是不可解的，是因为有前面三个条件的存在。因此，这四个条件连在一起构成了死锁的充分必要条件。</p>
</blockquote>
</li>
</ul>
<p>有了上述对死锁成因的分析，接下来我们将讨论如何解决死锁问题。这里分为两类，其中每一类又可以细分。</p>
<p>死锁的解除方案：</p>
<ul>
<li>允许死锁发生
<ul>
<li>静态策略：无</li>
<li>动态策略：
<ul>
<li><strong>鸵鸟算法</strong></li>
<li><strong>死锁检测与死锁恢复</strong></li>
</ul>
</li>
</ul>
</li>
<li>不允许死锁发生
<ul>
<li>静态策略：<strong>死锁预防</strong></li>
<li>动态策略：<strong>死锁避免</strong></li>
</ul>
</li>
</ul>
<blockquote>
<p>关于鸵鸟算法：</p>
<p>传说中鸵鸟看到危险就把头埋在地底下，使自己看不到危险。所以鸵鸟算法也是一种“不作为”的办法。在死锁问题出现概率很低的情况下，大多数工程师不会以性能损失或者易用性损失的代价来消除死锁，处理死锁问题的办法仅仅是忽略它。因为解决死锁的问题，通常代价很大。所以鸵鸟算法，是平衡性能和复杂性而选择的一种方法。（现在商业大部分都使用此算法）</p>
</blockquote>
<p>下面我们重点讨论除鸵鸟算法之外的其他三种解决方法。</p>
<h2 id="死锁预防">死锁预防</h2>
<p>简单理解，死锁预防就是通过适当的策略，来消除死锁的四个成因之一，从而避免死锁的发生。</p>
<h3 id="互斥">互斥</h3>
<p>一般来讲，在所列出的四个条件中，第一个条件不可能禁止。如果需要对资源进行互斥访问，那么操作系统必须支持互斥。</p>
<h3 id="占有且等待">占有且等待</h3>
<p>为预防占有且等待的条件，可以要求进程一次性地请求所有需要的资源，并且阻塞这个进程直到所有请求都同时满足。</p>
<blockquote>
<p>这种方法在两个方面是低效的。首先，一个进程可能被阻塞很长时间，以等待满足其所有的资源请求。而实际上，只要有一部分资源，它就可以继续执行。其次，分配给一个进程的资源可能有相当长的一段时间不会被使用，且在此期间，它们不能被其他进程使用。</p>
<p>另一个问题是一个进程可能事先并不会知道它所需要的所有资源。</p>
</blockquote>
<h3 id="不可抢占">不可抢占</h3>
<p>下面的方法可以预防这个条件：</p>
<ol>
<li>如果占有某些资源的一个进程进行进一步资源请求被拒绝，则该进程必须释放它最初占有的资源。（如果有必要，可再次请求这些资源和另外的资源）</li>
<li>如果一个进程请求当前被另一个进程占有的一个资源，则操作系统可以抢占另一个进程，要求它释放资源。（只有在任意两个进程的优先级都不相同的条件下才可以实现）</li>
</ol>
<h3 id="循环等待">循环等待</h3>
<p>循环等待条件可以通过定义资源类型的线性顺序来预防。</p>
<blockquote>
<p>如果一个进程已经分配到了R类型的资源，那么它接下来请求的资源只能是那些排在R类型之后的资源类型。</p>
<p>循环等待的预防方法可能是低效的，它会使进程执行速度变慢，并且可能在没有必要的情况下拒绝资源访问。</p>
</blockquote>
<h2 id="死锁避免">死锁避免</h2>
<p>要注意与死锁避免与死锁预防的差异：</p>
<ul>
<li>
<p>死锁预防是通过约束资源请求，防止死锁的四个成因之一发生，从而避免死锁产生。</p>
</li>
<li>
<p>死锁避免允许三个必要条件的发生，但是通过进程启动拒绝算法，去规避可能导致死锁情况的事件发生。</p>
<ul>
<li>
<p>死锁避免比死锁预防允许更多的并发。</p>
</li>
<li>
<p>是否允许当前的资源分配请求是通过判断该请求是否可能导致死锁来决定的。</p>
<blockquote>
<ul>
<li>如果一个进程的请求会导致死锁，则不启动此进程，进程启动拒绝</li>
<li>如果一个进程增加资源的请求会导致死锁，则不容许此分配，资源分配拒绝</li>
</ul>
</blockquote>
</li>
<li>
<p>死锁避免需要知道将来的进程资源请求的情况。</p>
</li>
</ul>
</li>
</ul>
<h3 id="进程启动拒绝">进程启动拒绝</h3>
<p>首先需要掌握四种数据结构：</p>
<ul>
<li>Resource（资源总量表）：系统中每种资源的总量</li>
<li>Available（资源可用表）：未分配给进程的每种资源的总量（可用资源）</li>
<li>Claim（最大需求矩阵）：C<sub>ij</sub> = 进程 i 对资源 j 的需求</li>
<li>Allocation（资源分配矩阵）：A<sub>ij</sub> = 当前分配给进程 i 的资源 j</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E8%BF%9B%E7%A8%8B%E5%90%AF%E5%8A%A8%E6%8B%92%E7%BB%9D%E5%9B%9B%E7%A7%8D%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84.png" alt=""></p>
<p>从以上定义中可以得出以下三个关系：</p>
<ol>
<li>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>R</mi><mi>j</mi></msub><mo>=</mo><msub><mi>V</mi><mi>j</mi></msub><mo>+</mo><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>N</mi></munderover><msub><mi>A</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">R_{j} = V_{j} + \sum_{i=1}^{N} A_{ij}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:3.106005em;vertical-align:-1.277669em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8283360000000002em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.277669em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">ij</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span></span></p>
<blockquote>
<p>对所有 j ，所有资源或者可用，或者已被分配</p>
</blockquote>
</li>
<li>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>C</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>≤</mo><msub><mi>R</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">C_{ij} \le R_{i}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">ij</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p>
<blockquote>
<p>对所有 i、j ，任何一个进程对任何一种资源的请求都不能超过系统中该种资源的总量。</p>
</blockquote>
</li>
<li>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>A</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>≤</mo><msub><mi>C</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">A_{ij} \le C_{ij}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">ij</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">ij</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span></span></p>
<blockquote>
<p>对所有 i、j ，分配给任何一个进程的任何一种资源都不会超过该进程最初声明的此资源的最大请求个数。</p>
</blockquote>
</li>
</ol>
<p>根据以上的关系，就可以定义一个死锁避免的策略：</p>
<p>对于所有的 j ，满足：</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>R</mi><mi>j</mi></msub><mo>≥</mo><msub><mi>C</mi><mrow><mo stretchy="false">(</mo><mi>n</mi><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo><mi>j</mi></mrow></msub><mo>+</mo><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><msub><mi>C</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">R_{j} \ge C_{(n+1)j} + \sum_{i=1}^{n} C_{ij}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">≥</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.03853em;vertical-align:-0.3551999999999999em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.34480000000000005em;"><span style="top:-2.5198em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">n</span><span class="mbin mtight">+</span><span class="mord mtight">1</span><span class="mclose mtight">)</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3551999999999999em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:2.929066em;vertical-align:-1.277669em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6513970000000002em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.277669em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">ij</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span></span></p>
<p>才会启动一个进的进程P<sub>n+1</sub>。（只有所有当前进程的最大请求量加上新的进程请求可以满足时，才会启动该进程。）</p>
<blockquote>
<p>案例分析：如下图，资源1、2、3的总量分别为10、10、9，进程一对三种资源的需求分别为1、4、5，进程二对三种资源的需求分别为3、5、4，如果启动进程P3需要请求三种资源的数量为2、3、1，请分析P3进程能否启动。</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E8%BF%9B%E7%A8%8B%E5%90%AF%E5%8A%A8%E6%A1%88%E4%BE%8B.png" alt=""></p>
<p>分析：</p>
<ul>
<li>对于资源1，三种进程的总需求为 1 + 3 + 2 = 6 &lt; 10 , 满足</li>
<li>对于资源2，三种进程的总需求为 5 + 4 + 3 = 12 &gt; 10 , 不满足</li>
</ul>
<p>所以进程三不得启动。</p>
</blockquote>
<h3 id="银行家算法（资源分配拒绝策略）">银行家算法（资源分配拒绝策略）</h3>
<p>在说明银行家算法之前先明确以下三种状态：</p>
<ul>
<li>系统状态：当前给进程分配的资源情况</li>
<li>安全状态：至少有一个资源分配序列不会导致死锁（即所有进程都能运行直到结束）</li>
<li>不安全状态：顾名思义，就是指不安全的状态</li>
</ul>
<blockquote>
<p>下面来看一个例子：</p>
<p>下图(a)显示了一个含有4个进程和3个资源的系统的状态。R1、R2和R3的资源总量分别为9、3和6。在当前状态下资源分配给4个进程，R2和R3各剩下1个可用单元。请问这是安全状态吗？</p>
<p>根据前面的介绍，对于进程 i 下面的条件应该满足对所有的 j，都有：</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>C</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>−</mo><msub><mi>A</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>≤</mo><msub><mi>V</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">C_{ij} - A_{ij} \le V_{j}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">ij</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">ij</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span></span></p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E9%93%B6%E8%A1%8C%E5%AE%B6%E7%AE%97%E6%B3%95%E6%A1%88%E4%BE%8B%E4%B8%80.png" alt=""></p>
<p>显然这对P1是不可能的，但是P2是可行的，因为P2只需要一个R3资源就拥有了它所需要的最大资源，因此P2进程运行。当运行完之后，它的资源回到可用资源池中（如下图(b)）</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E9%93%B6%E8%A1%8C%E5%AE%B6%E7%AE%97%E6%B3%95%E6%A1%88%E4%BE%8B%E4%BA%8C.png" alt=""></p>
<p>在这种情况下，所有进程都可以完成，假设选择P1运行，结束之后，资源释放并回到可用资源池中，如下图©。</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E9%93%B6%E8%A1%8C%E5%AE%B6%E7%AE%97%E6%B3%95%E6%A1%88%E4%BE%8B%E4%B8%89.png" alt=""></p>
<p>下一步完成P3进程，结束后资源如下图所示(d)。</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E9%93%B6%E8%A1%8C%E5%AE%B6%E7%AE%97%E6%B3%95%E6%A1%88%E4%BE%8B%E5%9B%9B.png" alt=""></p>
<p>最后，可以完成P4进程。至此，所有进程运行结束，因此这是一个安全状态。</p>
<hr>
<p>再考虑下面一种状态：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E9%93%B6%E8%A1%8C%E5%AE%B6%E7%AE%97%E6%B3%95%E6%A1%88%E4%BE%8B%E4%BA%94.png" alt=""></p>
<p>这种情况没有一个进程是可以运行的，因此这不是一个安全状态。</p>
<p>但是这并不是一个死锁状态，它仅仅是有死锁的可能（这点很重要）。</p>
<p>（如果P1从这个状态开始运行，先释放一个R1单元和一个R3单元，后来又再次需要这些资源，则一旦这样做，系统将到达一个安全状态。因此，死锁避免策略并不能确切地预测死锁，它仅仅是预料死锁的可能性并确保永远不会出现这种可能性。）</p>
</blockquote>
<p>下列代码给出了对死锁逻辑的一个抽象描述：</p>
<p>全局数据结构</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">state</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> resource[m];</span><br><span class="line">    <span class="keyword">int</span> available[m];</span><br><span class="line">    <span class="keyword">int</span> claim[n][m];</span><br><span class="line">    <span class="keyword">int</span> alloc[n][m];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>资源分配算法</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (alloc [i,*] + request [*] &gt; claim [i,*])</span><br><span class="line">    &lt; error &gt;;				<span class="comment">/*总请求量大于需求*/</span></span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (request [*] &gt; available [*])</span><br><span class="line">    &lt; suspend process &gt;;				<span class="comment">/*模拟分配*/</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    &lt; define newstate by:</span><br><span class="line">    alloc [i,*] = alloc [i,*] + request [*];</span><br><span class="line">    available [*] = available [*] - request [*] &gt;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (safe (newstate))</span><br><span class="line">    &lt; carry out allocation &gt;;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    &lt;restore original state &gt;;</span><br><span class="line">    &lt; suspend process &gt;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>测试安全算法（银行家算法）</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function">boolean <span class="title">safe</span> <span class="params">(state S)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> currentavail[m];</span><br><span class="line">    process rest[&lt;number of processes&gt;];</span><br><span class="line">    currentavail = available;</span><br><span class="line">    rest = &#123;all processes&#125;;</span><br><span class="line">    possible = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">while</span> (possible)</span><br><span class="line">    &#123;</span><br><span class="line">        &lt; find a process Pk in rest suck that</span><br><span class="line">            claim [k,*] - alloc [k,*] &lt;= currentavail;&gt;</span><br><span class="line">        <span class="keyword">if</span> (found)				<span class="comment">/*模拟Pk的执行*/</span></span><br><span class="line">        &#123;</span><br><span class="line">            currentavail = currentavail + alloc [k,*];</span><br><span class="line">            rest = rest - &#123;Pk&#125;;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            possible = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (rest == null);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>说明：</p>
<p>数据结构<code>state</code>定义了系统状态，<code>request[*]</code>是一个向量，定义了进程 i 的资源请求。</p>
<p>首先，进行一次检测，确保该请求不会超过进程最初声明的要求。如果该请求有效，下一步确定是否可能实现这个请求（即有足够的可用资源）。如果不可能，则该进程被挂起；如果可能，则最后一步是确定完成这个请求是否是安全的。为做到这一点，资源被暂时分配给进程 i 以形成一个newstate。</p>
</blockquote>
<p>死锁避免的优点是它不需要死锁预防中的抢占和回滚进程，并且比死锁预防的限制少。但是仍有以下限制：</p>
<ul>
<li>必须事先声明每个进程请求的最大资源</li>
<li>考虑的进程必须是无关的，也就是说，它们执行的顺序必须没有任何同步要求的限制</li>
<li>分配的资源数目必须是固定的，且只考虑可重用资源</li>
<li>在占有资源时，进程不能退出</li>
<li>时间复杂度高（O(m·n<sup>2</sup>)）</li>
</ul>
<h2 id="死锁检测">死锁检测</h2>
<p>死锁预防策略是非常保守的，它们通过限制访问资源和在进程上强加约束来解决死锁问题。</p>
<p>死锁检测策略则完全相反，它不限制资源访问或约束进程行为。对于死锁检测来说，只要有可能，被请求的资源就被授权给进程。操作系统周期性地执行一个算法检测“循环等待”条件（上文提到的死锁成因中的条件4）。</p>
<h3 id="死锁检测算法">死锁检测算法</h3>
<p>该算法使用了上文提到的<code>Allocation矩阵</code>以及<code>Available向量</code>，除此之外，还定义了请求(Requset)矩阵Q，其中Q<sub>ij</sub>表示进程 i 请求的类型 j 的资源量。算法主要是一个标记没有死锁的进程的过程。最初，所有的进程都是未标记的，然后执行下列步骤：</p>
<ol>
<li>标记Allocation矩阵中一行全为零的进程。</li>
<li>初始化一个临时向量W，令其等于Available向量。</li>
<li>查找下标 i，使用进程 i 当前未标记且 Q 的第 i 行小于等于 W，即对所有的 1 ≤ K ≤ m，Q<sub>ik</sub>≤W<sub>k</sub>。如果找不到这样的行，终止算法。</li>
<li>如果找到这样的行，标记进程 i，并把Allocation矩阵中的相应行加到W中，也就是说，对所有的1 ≤ K ≤ m，令W<sub>k</sub> = W<sub>k</sub> + A<sub>ik</sub>。返回步骤3。</li>
</ol>
<blockquote>
<p>下面来看一个例子：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E6%AD%BB%E9%94%81%E6%A3%80%E6%B5%8B%E7%AE%97%E6%B3%95%E6%A1%88%E4%BE%8B.png" alt=""></p>
<ol>
<li>令 W =（ 0 0 0 0 1 ）（W = A）。</li>
<li>进程P3的请求小于或等于W，因此标记P3，并令W = W +（ 0 0 0 1 0 ）=（ 0 0 0 1 1 ）。</li>
<li>再去检测Request矩阵，发现其他进程都不满足运行条件，因此终止算法。</li>
</ol>
<p>算法的结果是P1、P2、P4未标记，表示这三个进程是死锁的。</p>
</blockquote>
<h3 id="恢复">恢复</h3>
<p>一旦检测到死锁，就需要某种策略以恢复死锁。下面按复杂度递增的顺序列出可能的方法：</p>
<ol>
<li>
<p>取消所有的死锁进程。</p>
</li>
<li>
<p>把每个死锁进程回滚到前面定义的某些检查点，并且重新启动所有进程。</p>
<blockquote>
<p>这要求在系统中构造回滚和重启机制。该方法的风险是原来的死锁可能再次发生。但是，并发进程的不确定性通常能保证不会发生这种情况。</p>
</blockquote>
</li>
<li>
<p>连续取消死锁进程直到不再存在死锁。</p>
<blockquote>
<p>选择取消进程的顺序基于某种最小代价原则。在每次取消后，必须重新调用检测算法，以测试是否仍存在死锁。</p>
</blockquote>
</li>
<li>
<p>连续抢占资源直到不再存在死锁。</p>
<blockquote>
<p>同第3条一样，需要使用一种基于代价的选择方法，并且需要在每次抢占后重新调用检测算法。一个资源被抢占的进程必须回滚到获得这个资源之前的某一状态。</p>
</blockquote>
</li>
</ol>
<p>对于上述的第3、4条，选择原则可以采用下面中的一种：</p>
<ul>
<li>目前为止消耗的处理器时间最少。</li>
<li>目前为止产生的输出最少。</li>
<li>预计剩下的时间最长。</li>
<li>目前为止分配的资源总量最少。</li>
<li>优先级最低。</li>
</ul>
<h2 id="一种综合的死锁策略">一种综合的死锁策略</h2>
<p>我们先以表格的形式小结一下前文讲述的解决死锁的策略：</p>
<table>
<thead>
<tr>
<th>原则</th>
<th>资源分配策略</th>
<th>不同的方案</th>
<th>主要优点</th>
<th>主要缺点</th>
</tr>
</thead>
<tbody>
<tr>
<td>预防</td>
<td>保守的；预提交资源</td>
<td>一次性请求所有资源</td>
<td>·对执行一连串活动的进程非常有效<br/>·不需要抢占</td>
<td>·低效<br/>·延迟进程的初始化<br/>·必须知道将来的资源请求</td>
</tr>
<tr>
<td>预防</td>
<td>保守的；预提交资源</td>
<td>抢占</td>
<td>·用于状态易于保存和恢复的资源时非常方便</td>
<td>·过于经常地没必要地抢占</td>
</tr>
<tr>
<td>预防</td>
<td>保守的；预提交资源</td>
<td>资源排序</td>
<td>·通过编译时检测是可以实施的<br/>·既然问题已经在系统设计时解决了，不需要在运行时间计算</td>
<td>·禁止增加的资源请求</td>
</tr>
<tr>
<td>避免</td>
<td>处于检测和预防中间</td>
<td>操作以发现至少一条安全路径</td>
<td>·不需要抢占</td>
<td>·必须知道将来的资源请求<br/>·进程不能被长时间阻塞</td>
</tr>
<tr>
<td>检测</td>
<td>非常自由；只要可能，请求的资源都允许</td>
<td>周期性地调用以测试死锁</td>
<td>·不会延迟进程的初始化<br/>·易于在线处理</td>
<td>·固有的抢占被丢失</td>
</tr>
</tbody>
</table>
<p>从上表中可见，所有的解决死锁的策略都各有其优缺点。与其将操作系统机制设计为只采用其中一种策略，还不如在不同情况下使用不同的策略更有效。为此提供了一种方法：</p>
<ul>
<li>把资源分成几组不同的资源类。</li>
<li>为预防在资源类之间由于循环等待产生死锁，可使用前面定义的线性排序策略。</li>
<li>在一个资源类中，使用该类资源最适合的算法。为此，考虑下列的资源类：
<ul>
<li>可交换空间：在进程交换中所使用的外存中的存储块。</li>
<li>进程资源：可分配的设备，如磁带设备和文件。</li>
<li>内存：可以按页或按段分配给进程。</li>
<li>内部资源：诸如I/O通道。</li>
</ul>
</li>
<li>以上列出的次序表示了资源分配的次序。考虑到一个进程在其生命周期中的步骤顺序，这个次序是最合理的。在每一类中，可采用以下策略：
<ul>
<li>可交换空间：通过要求<strong>一次性分配所有请求的资源</strong>来预防死锁，就像占有且等待预防策略一样。如果知道最大存储需求（通常情况下都知道），则这个策略是合理的。死锁避免也是可能的。</li>
<li>进程资源：对这类资源，<strong>死锁避免策略</strong>常常是很有效的，这是因为进程可以事先声明它们将需要的这类资源。采用<strong>资源排序的预防策略</strong>也是可能的。</li>
<li>内存：对于内存，基于<strong>抢占</strong>的预防是最适合的策略。当一个进程被抢占后，它仅仅被换到外存，释放空间以解决死锁。</li>
<li>内部资源：可以使用基于<strong>资源排序</strong>的预防策略。</li>
</ul>
</li>
</ul>
<h2 id="哲学家就餐问题">哲学家就餐问题</h2>
<p>同样移步至下方链接👇👇👇👇</p>
<div class="btn-center">
<a class="btn-beautify button--animated block outline orange larger" href="/2021/04/25/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E4%BF%A1%E5%8F%B7%E9%87%8F%E7%9B%B8%E5%85%B3%E9%97%AE%E9%A2%98/" 
  title="点击跳转 至 《信号量相关问题》"><i class="far fa-hand-point-right"></i><span>点击跳转 至 《信号量相关问题》</span></a>
</div>
<hr>
<h1>后记</h1>
<p>本篇已完结</p>
<p>（如有修改或补充欢迎评论）</p>
]]></content>
      <categories>
        <category>学习笔记</category>
      </categories>
      <tags>
        <tag>操作系统</tag>
      </tags>
  </entry>
  <entry>
    <title>操作系统学习笔记-操作系统概述</title>
    <url>/2021/03/22/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%BF%B0/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\css\APlayer.min.css"><script src="\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\js\Meting.min.js"></script><h1>前言</h1>
<p><em>正在学习操作系统，记录笔记。</em></p>
<blockquote>
<p>参考资料：</p>
<p>《操作系统（精髓与设计原理 第6版）</p>
</blockquote>
<hr>
<h1>第二章：操作系统概述</h1>
<h2 id="操作系统的目标和功能">操作系统的目标和功能</h2>
<h3 id="操作系统定义">操作系统定义</h3>
<p>操作系统是一组控制应用程序执行的程序，并充当应用程序和计算机硬件之间的接口。（A group of program that controls the execution of application programs. Acts as an interface between applications and hardware）</p>
<blockquote>
<p>无操作系统也可以使用计算机，但是操作十分复杂，只有受过相当训练的专业人士才可以使用。</p>
</blockquote>
<p>操作系统的目标：</p>
<ul>
<li>方便（Convenience）：使计算机更易于使用。</li>
<li>有效（Efficiency）：允许以更有效地方式使用计算机系统资源。</li>
<li>扩展能力（Ability to evolve ）：允许在不妨碍服务的前提下有效地开发、测试和引入新的系统功能。</li>
</ul>
<h3 id="操作系统作为用户与计算机的接口">操作系统作为用户与计算机的接口</h3>
<p>我们先来看一下计算机系统的层次：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E5%B1%82%E6%AC%A1.png" alt=""></p>
<blockquote>
<p>自上向下看：终端用户一般不会去考虑底层的硬件细节，只需要操作不同的应用程序就好。开发应用的工作由程序员完成，如果需要用一组完全负责控制计算机硬件的机器指令开发应用程序是一件极其复杂的事。为了简化这一开发过程，需要一些系统程序（其中一部分就称为实用工具，Utilities），提供一些如创建程序、管理文件、控制I/O设备功能的接口。最重要的系统程序就是操作系统，它为程序员屏蔽了硬件细节，并为程序员提供各种便于开发的接口。</p>
</blockquote>
<p>操作系统为开发者提供各种服务的接口，以便于更容易地访问和使用以下7类服务：</p>
<ul>
<li>程序开发（Program development）：操作系统提供各种工具以及服务（如：编辑器、调试器…）用于帮助开发程序。（并不属于操作系统核心的一部分）</li>
<li>程序执行（Program execution）：程序运行需要很多步骤——把指令和数据载入内存、为其分配CPU资源、将运行结果保存到外部、释放CPU资源。这一系列的步骤需要操作系统全程参与，做好调度工作。</li>
<li>I/O设备访问（Access to I/O devices）：每个I/O设备的操作都需要特有的指令集或者控制信号，操作系统为此提供了统一的接口，以便使用。</li>
<li>文件访问控制（Controlled access to files）：对于有多个用户的系统，操作系统可以提供保护机制来控制对文件的访问。</li>
<li>系统访问（System access）：对于共享或公共的系统，操作系统可以控制特殊资源的访问（授权/非授权），以此对资源和数据进行保护。</li>
<li>错误检测和响应（Error detection and response）：计算机系统运行可能发生各种错误（包括软件和硬件），对于这些错误操作系统都必须要能检测并且提供响应，以便解决问题。</li>
<li>审计（Accounting）：操作系统可以查看各种资源的使用情况，以便于及时调整，提高性能。</li>
</ul>
<h3 id="操作系统作为资源管理者">操作系统作为资源管理者</h3>
<p>一台计算机就是一组资源，这些资源用于对数据的移动、存储和处理，以及对这些功能的控制。而操作系统负责管理这些资源。</p>
<ul>
<li>
<p>操作系统负责管理资源/硬件。</p>
</li>
<li>
<p>工作方式与其他普通的计算机软件一样，操作系统也是由处理器执行的一段程序或一组程序。</p>
</li>
<li>
<p>操作系统经常会释放控制，并且必须依赖处理器才能恢复控制</p>
<blockquote>
<p>操作系统本质也是一组计算机程序，它可以通过管理计算机资源，从而控制计算机的基本功能。（所以从某种意义上来讲，是操作系统在控制各种数据的移动、存储和处理）。但是它与一般的计算机软件不同的地方在于，操作系统可以主动获取或释放CPU资源。</p>
</blockquote>
</li>
</ul>
<p>操作系统中有一部分常驻于内存中，称之为<strong>内核</strong>（Kernel，也称<strong>核子</strong>，Nucleus）。内核程序包含操作系统中最常使用的功能。</p>
<blockquote>
<p>内存的其余部分包含用户程序和数据，它的分配由操作系统和处理器中的存储管理硬件联合控制。操作系统决定在程序运行过程中何时使用I/O设备，并控制文件的访问和使用。处理器自身也是一个资源，操作系统必须决定在运行一个特定的用户程序时，可以分配多少处理器时间，在多处理器系统中，这个决定要传到所有的处理器。</p>
</blockquote>
<p>下图展示了由操作系统管理的主要资源：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86%E7%9A%84%E8%B5%84%E6%BA%90.png" alt=""></p>
<h3 id="操作系统的易扩展性">操作系统的易扩展性</h3>
<p>一个重要的操作系统应该能够不断发展，其原因如下：</p>
<ul>
<li>
<p>硬件升级和新型硬件的出现：</p>
<p>例如，图形终端和页面式终端代替了行滚动终端；图形终端允许允许用户通过屏幕上的多个“窗口”同时查看多个应用程序。</p>
</li>
<li>
<p>新的服务：</p>
<p>为适应用户的要求或满足管理员的需要，需要扩展操作系统以提供新的服务。</p>
</li>
<li>
<p>纠正错误：</p>
<p>任何一个操作系统都会有bug，随着时间的推移会发现这些错误并引入相应的补丁。（当然补丁也有可能引入新的错误）</p>
</li>
</ul>
<h2 id="操作系统的发展">操作系统的发展</h2>
<h3 id="第一阶段：串行阶段（Serial-Processing-）">第一阶段：串行阶段（Serial Processing ）</h3>
<p>该阶段属于没有操作系统的阶段。（1940s-1950s）</p>
<p>特点：程序员是通过直接与计算机硬件打交道的方式来操作计算机。</p>
<p>操作方式：由于没有操作系统，机器是在一个控制台上运行的，控制台包括：显示灯、触发器（拨动开关）、输入设备、打印机。用机器代码编写的程序通过输入设备（如卡片阅读机）载入计算机，如果错误导致程序终止运行，显示灯会给出指示，如果程序正常完成，运行结果会出现在打印机中。</p>
<p>主要问题：包括两个方面</p>
<ul>
<li>调度问题（Scheduling）：大多数装置都使用一个硬拷贝（hardcopy）的登记表预定机器时间。如果一个用户在预定时间之内没有完成程序的运行，那么将会强制终止；如果在程序运行完成之后还有大量的时间，则会造成当时极为宝贵的CPU资源的浪费。（”人机矛盾“）</li>
<li>准备时间（Setup time）：一个程序在当时称为作业（job）。它包括往内存中加载编译器和高级语言程序（源程序），保存编译后的程序（目标程序），然后加载目标程序和公用函数，并链接在一起。（这里每一步都有可能安装或拆卸磁带，或者准备卡片组，在此期间一旦发生错误，只能重新开始。而且用户是独占计算机系统资源，资源并没有得到有效利用。）</li>
</ul>
<h3 id="第二阶段：简单批处理系统（Simple-Batch-Systems）">第二阶段：简单批处理系统（Simple Batch Systems）</h3>
<p>简单批处理方案的核心思想是使用一个称为<strong>监控程序</strong>（monitor）的软件。</p>
<p>工作流程：</p>
<p>用户不再直接访问机器，他们把卡片或磁带中的作业（分批）交给计算机操作员，由操作员将其按顺序组织起来，放在输入设备上，交给监控程序使用。要执行作业时，控制程序会将CPU控制权移交给作业，每个作业执行完毕又都会将CPU的控制权交还给控制程序。接着监控程序继续加载下一个作业。</p>
<blockquote>
<p>注意程序（program）与作业（job）的区别：</p>
<p><strong>作业 = 程序 + 数据 + 作业说明书</strong></p>
</blockquote>
<p>下面分别从监控程序（Monitor）和处理器（CPU）两个角度分析工作原理：</p>
<ul>
<li>
<p>监控程序角度：</p>
<p>监控程序控制事件的顺序。因此需要大部分监控程序必须总是处于内存中并且可以执行，这部分称作<strong>常驻监控程序</strong>（resident monitor）。监控程序每次从输入设备（通常是卡片阅读机或磁带驱动器）中读取一个作业，并将其置于内存中的一个用户程序区域，并把控制权交给该作业，当作业完成后，控制权返还给监控程序，它继续读取下一个作业。每个作业的结果被发送到输出设备（如打印机），交付给用户。</p>
</li>
<li>
<p>处理器角度：</p>
<p>从某个角度看，处理器执行内存中存储的监控程序中的指令；这些指令读入下一个作业并将其存储到内存中的另一个部分。一旦已经读入一个作业，处理器将会遇到监控程序中的<strong>分支指令</strong>，分支指令指导处理器在用户程序的开始处继续执行。处理器继而执行用户程序中的指令，直到遇到一个结束指令或错误条件。不论哪种情况都将导致处理器从监控程序中取下一条指令。</p>
<p>因此，“控制权交给作业”仅仅意味着处理器当前取和执行的都是用户程序中的指令，而“控制权返回给监控程序”的意思是处理器当前从监控程序中取指令并执行指令。</p>
</li>
</ul>
<blockquote>
<p>监控程序改善了作业的准备时间，每个作业中的指令均以一种<strong>作业控制语言</strong>（Job Control Language，JCL）的基本形式给出，这是一种特殊类型的程序设计语言，用于为监控程序提供指令。</p>
</blockquote>
<p>监控程序（或者说批处理操作系统），只是一个简单的计算机程序。它依赖于处理器可以从内存的不同部分取指令的能力，以交替地获取或释放控制权。此外还考虑到了其他硬件功能：</p>
<ul>
<li>内存保护（Memory protection）：当用户程序正在运行时，不能改变包含监控程序的内存区域。如果试图这样做，处理器硬件将发现错误，并将控制转移给监控程序，监控程序取消这个作业，输出错误信息，并载入下一个作业。</li>
<li>定时器（Timer）：防止一个作业长期独占系统。在每个作业开始时，设置定时器，如果定时器时间到，用户程序被停止，控制权返回给监控程序。</li>
<li>特权指令（Privileged instructions）：某些机器语言只能由监控程序执行。如果处理器在运行一个用户程序时遇到这类指令，则会发生错误，并将控制权转移给监控程序。（I/O指令属于特权指令，因此监控程序可以控制所有的I/O设备）</li>
<li>中断（Interrupts）：早期的计算机模型并没有中断能力。这个特征使得操作系统在让用户程序放弃控制权或从用户程序获得控制权时具有更大的灵活性。</li>
</ul>
<p>CPU模式：</p>
<ul>
<li>用户模式（user mode）：用户程序在用户模式下运行。这便意味着：
<ul>
<li>某些指令是不会被执行的（如特权指令）</li>
<li>有些内存区域是无法被访问的</li>
</ul>
</li>
<li>系统模式（system mode）：监控程序在系统模式下运行。（这也可以成为<strong>内核模式</strong>，Kernel mode）
<ul>
<li>特权指令可以被执行</li>
<li>受保护的内存区域也可以被访问（可以访问所有内存区域）</li>
</ul>
</li>
</ul>
<h3 id="第三阶段：多道批处理系统（Multiprogrammed-Batch-Systems）">第三阶段：多道批处理系统（Multiprogrammed Batch Systems）</h3>
<p>简单批处理系统提高了CPU资源的利用率，但是由于I/O设备相对于处理器的速度太慢（一个用户程序要使用I/O设备，CPU必须要等待），处理器依然是空闲的。</p>
<p>下图显示了只有一个单独程序的情况，被称为<strong>单道程序设计</strong>（Uniprogramming）：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E5%8D%95%E9%81%93%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1.png" alt=""></p>
<p>这种低效率是可以避免的。内存空间可以保存操作系统（常驻监控程序）和一个用户程序。假设内存空间容得下操作系统和两个用户程序，那么当一个作业需要等待I/O时，处理器可以切换到另一个可能并不在等待I/O的作业，进一步还可以扩展存储器以保存三个、四个或更多的程序，并且在它们之间进行切换。这种处理称做<strong>多道程序设计</strong>（Multiprogramming）或<strong>多任务处理</strong>（Multitasking），它是现代操作系统的主要方案。</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E5%A4%9A%E9%81%93%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1.png" alt=""></p>
<p>下面是单道程序设计以及多道程序设计对于硬件设备的利用率对比：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E5%88%A9%E7%94%A8%E7%8E%87%E5%AF%B9%E6%AF%941.png" alt=""></p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E5%88%A9%E7%94%A8%E7%8E%87%E5%AF%B9%E6%AF%942.png" alt=""></p>
<blockquote>
<p>利用率的计算方法（以单道程序设计中对CPU的利用率为例）：</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>利用率</mtext><mo>=</mo><mfrac><mrow><mo>∑</mo><mtext>不同阶段的使用时长</mtext><mo>×</mo><mtext>对应的使用率</mtext></mrow><mtext>总时长</mtext></mfrac></mrow><annotation encoding="application/x-tex">利用率 = \frac{\sum不同阶段的使用时长 × 对应的使用率}{总时长}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord cjk_fallback">利用率</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.113em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord cjk_fallback">总时长</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">∑</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord cjk_fallback">不同阶段的使用时长</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord cjk_fallback">对应的使用率</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>P</mi><mi>r</mi><mi>o</mi><mi>c</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>o</mi><mi>r</mi><mi>u</mi><mi>s</mi><mi>e</mi><mo>=</mo><mfrac><mrow><mn>5</mn><mo>×</mo><mn>0.7</mn><mo>+</mo><mn>15</mn><mo>×</mo><mn>0.1</mn><mo>+</mo><mn>10</mn><mo>×</mo><mn>0.1</mn></mrow><mrow><mn>5</mn><mo>+</mo><mn>15</mn><mo>+</mo><mn>10</mn></mrow></mfrac><mo>=</mo><mn>0.2</mn></mrow><annotation encoding="application/x-tex">Processor use = \frac{5×0.7 + 15×0.1 + 10×0.1}{5+15+10} = 0.2
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord mathnormal" style="margin-right:0.02778em;">rocessor</span><span class="mord mathnormal">u</span><span class="mord mathnormal">se</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.09077em;vertical-align:-0.7693300000000001em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">5</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">15</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">10</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">5</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">0.7</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">15</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">0.1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">10</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">0.1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.7693300000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0.2</span></span></span></span></span></p>
</blockquote>
<p>同简单的批处理系统一样，多道批处理系统依然需要依赖某些计算机硬件功能：中断机制、DMA模块等。</p>
<p>多道批处理系统也存在一些新的问题：</p>
<ul>
<li>内存管理（Memory Management）：对准备运行的多个作业，他们必须都保留在内存中，这时候就要合理的安排内存空间的使用。</li>
<li>调度问题（Scheduling）：如果准备运行多个作业，处理器必须决定运行哪一个，这需要某种调度算法。</li>
<li>状态的保存/恢复（save and restore）：一个作业未处理完要去执行其他作业的时候需要考虑到中断时的状态，以及在处理完其他作业之后回头再继续执行被中断作业的恢复问题。</li>
<li>资源竞争问题（Contention for resources）：每一个作业的运行都要利用资源，这时应该合理考虑资源的分配。</li>
<li>对用户响应时间长（不友好）</li>
</ul>
<h3 id="第四阶段：分时系统（Time-Sharing-Systems）">第四阶段：分时系统（Time-Sharing Systems）</h3>
<p>多道批处理系统已经极大地提高了计算机系统的效率，但是对于用户交互性的实现并不好。所以出现了分时技术（Time-Sharing），多个用户可以同时分享处理器时间，以达到减少用户响应时间的目的。</p>
<p>在分时系统中，多个用户可以通过多个终端同时访问系统，由操作系统控制每个用户程序以很短的时间为单位交替执行。（分时复用）</p>
<p>批处理多道程序设计和分时的比较</p>
<table>
<thead>
<tr>
<th>项目</th>
<th>批处理多道程序设计</th>
<th>分时</th>
</tr>
</thead>
<tbody>
<tr>
<td>主要目标</td>
<td>充分使用处理器</td>
<td>减小响应时间</td>
</tr>
<tr>
<td>操作系统指令源</td>
<td>作业提供的作业控制语言命令</td>
<td>从终端键入的命令</td>
</tr>
</tbody>
</table>
<p>同样的，分时处理系统也需要很多计算机硬件支持（如中断机制等）</p>
<p>像多道批处理系统，分时系统同样也存在以下问题：</p>
<ul>
<li>内存管理（Memory Management）</li>
<li>调度问题（Scheduling）</li>
<li>状态的保存/恢复（save and restore）</li>
<li>资源竞争问题（Contention for resources）</li>
</ul>
<h2 id="主要成就">主要成就</h2>
<p>[DENN80a]提出在操作系统开发中的5个重要的理论进展：进程（The Process）、内存管理（Memory Management）、信息保护和安全（Information Protection and Security）、调度和资源管理（Scheduling and Resource Management）、系统结构（System Structure）。下面就从这五个方面逐介绍。</p>
<h3 id="进程（The-Process）">进程（The Process）</h3>
<p>进程的概念是操作系统的基础。Multics的设计者在20世纪60年代首使用了这个术语[DALE68]。</p>
<p>关于进程的定义（4种）：</p>
<ul>
<li>一个正在执行的程序。</li>
<li>计算机中正在运行的程序的一个实例（Instance）。</li>
<li>可以分配给处理器并由处理器执行的一个实体（Entity）。</li>
<li>由单一的顺序的执行线程、一个当前状态和一组相关的系统资源所描述的活动单元。</li>
</ul>
<p>引入进程的原因：为了实现多道程序批处理操作，以提高计算机的效率。</p>
<blockquote>
<p>计算机系统的发展有三条主线：多道程序批处理操作、分时系统、实时事物系统。他们在时间安排和同步中所产生的问题推动了进程概念的发展。</p>
<p>事务处理系统和分时系统的主要差别：事务处理系统局限于一个或几个应用，而分时系统的用户可以从事程序开发、作业执行以及使用各种各样的应用程序。</p>
</blockquote>
<p>前文介绍，早期的系统程序员在实现多道程序和多用户交互系统时采用的主要工具就是中断。但是由于I/O设备与CPU速度的巨大差异，导致中断并不能有效地支持多道。这就使得计算机系统容易出现错误，大致可以分为以下4类：</p>
<ul>
<li>
<p>不正确的同步（Improper synchronization）</p>
<p>常常会出现这样的情况，即一个例程（routine）必须挂起，等待系统中其他地方的某一事件传来信号。如果设计不正确的信号机制则可能导致信号丢失或者收到重复信号。</p>
</li>
<li>
<p>失败的互斥（Failed mutual exclusion）</p>
<p>常常会出现多个用户或程序试图同时使用一个共享资源的情况。例如，两个用户可能试图编辑同一个文件，如果不控制这种访问，就会发生错误。因此需要设计某种互斥机制，以保证一次只允许一个例程对一部分数据执行事务处理。</p>
</li>
<li>
<p>不确定的程序操作（Nondeterminate program operation）</p>
<p>一个特定程序的结果只依赖于该程序的输入，而并不依赖于共享系统中其他程序的活动。但是，当程序共享内存并且处理器控制它们交错执行时，它们可能会因为重写相同的内存区域而发生不可预测的相互干扰。因此，程序调度顺序可能会影响某个特定程序的输出结果。</p>
</li>
<li>
<p>死锁（Deadlocks）</p>
<p>很有可能两个或多个程序相互挂起等待。</p>
</li>
</ul>
<p>解决这些问题需要一种系统级的方法监控处理器中不同程序的执行。进程的概念为此提供了基础。</p>
<p>进程的组成</p>
<p>进程的组成为三个部分：<code>process = program + data + context</code>。即：</p>
<ul>
<li>
<p>一段可执行的程序</p>
</li>
<li>
<p>程序所需要的相关数据（变量、工作空间、缓冲区等）</p>
</li>
<li>
<p>程序的执行上下文（即程序运行的状态）</p>
<blockquote>
<p>执行上下文（execution context）是根本，又称为进程状态（process state）。是操作系统用来管理和控制进程所需要的内部数据。这种内部信息和进程是分开的，因为操作系统信息不允许被进程直接访问。</p>
</blockquote>
</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E8%BF%9B%E7%A8%8B%E5%AE%9E%E7%8E%B0.jpg" alt=""></p>
<p>如图是一个典型的进程实现方法。进程索引寄存器表明进程B正在执行。以前执行的进程被临时中断，在A中断的同时，所有寄存器的内容被记录在它的执行上下文环境中，以后操作系统就可以执行进程切换，恢复进程A的执行。进程切换过程包括保存B的上下文和恢复A的上下文。当在程序计数器中载入指向A的程序区域的值时，进程A自动恢复执行。</p>
<blockquote>
<p>进程索引寄存器（process index register）：包含当前正在控制处理器的进程在进程表中的索引。</p>
<p>基址寄存器（base register）与界限存储器（limit register）定义了该进程所占据的存储器区域。基址寄存器中保存了该存储器区域的开始地址；界限存储器中保存了该区域的大小（以字节或字为单位）。</p>
<p>程序计数器和所有的数据引用相对于基址寄存器被解释，并且不能超过界限寄存器中的值，这就可以保护内部进程间不会相互干涉。</p>
<p>进程的本质是一种软件机制。</p>
<p>进程被当作数据结构来实现，（一个进程可以是正在执行，也可以是等待执行）：</p>
<ul>
<li>采用这种结构是为了解决多道程序设计和资源共享带来的问题。</li>
<li>操作系统管理进程所需的所有信息都存储在数据结构中。</li>
</ul>
</blockquote>
<h3 id="内存管理（Memory-Management）">内存管理（Memory Management）</h3>
<p>操作系统担负着5个基本的存储器管理（storage management）责任：</p>
<ul>
<li>
<p>进程隔离（Process isolation）</p>
<p>操纵系统必须保护独立的进程，防止互相干涉各自的存储空间，包括数据和指令。</p>
</li>
<li>
<p>自动分配和管理（Automatic allocation and management）</p>
<p>程序应该根据需要在存储层次间动态地分配，分配对程序员是透明的。因此，程序员无需关心与存储限制有关的问题，操作系统有效地实现分配问题，可以仅在需要时才给作业分配存储空间。</p>
</li>
<li>
<p>支持模块化程序设计（Support of modular programming）</p>
<p>程序员应该能够定义程序模块，并且动态地创建、销毁模块，动态地改变模块大小。</p>
</li>
<li>
<p>保护和访问控制（Protection and access control）</p>
<p>不论在存储层次中的哪一级，存储器的共享都会产生一个程序访问另一个程序存储空间的潜在可能性。当一个特定的应用程序需要共事时，这是可取的。但在别的时候，它可能威胁到程序的完整性，甚至威胁到操作系统自身。操作系统必须允许一部分内存可以由各种用户以各种方式进行访问。</p>
</li>
<li>
<p>长期存储（Long-term storage）</p>
<p>许多应用程序需要在计算机关机后长时间保存信息。</p>
</li>
</ul>
<p>在典型情况下，操作系统使用文件系统机制（File System ）和虚拟存储器机制（Virtual Memory / VM）来满足上述要求。</p>
<ul>
<li>
<p>文件系统：实现了长期存储，它在一个有名字的对象中保存信息，这个对象称作文件。（对程序员来说，文件是一个很方便的概念，对操作系统来说，文件是访问控制和保护的一个有用单元）。</p>
</li>
<li>
<p>虚拟存储器：允许程序从逻辑的角度访问存储器，而不考虑物理内存上可用空间的容量。虚拟存储器的构想是为了满足有多个用户作业同时驻留在内存中的要求，这样，当一个进程被写出到辅助存储器中并且后继进程被读人时，在连续的进程执行之间将不会脱节。</p>
<blockquote>
<p>可以把虚拟存储简单的理解为一种存储机制：以小内存去运行大程序。</p>
</blockquote>
</li>
<li>
<p>分页系统（Page）：由于进程大小不同，如果处理器在很多进程间切换，则很难把它们紧密地压入内存中，因此引进了分页系统。在分页系统中，进程由许多固定大小的块组成，这些块称作页。进程的每一页都可以放置在内存中的任何地方。</p>
<blockquote>
<p>分页系统提供了程序中使用的虚地址（virtual address）和内存中的实地址（real address）或物理地址之间的动态映射。</p>
</blockquote>
</li>
</ul>
<h3 id="信息保护和安全（Information-Protection-and-Security）">信息保护和安全（Information Protection and Security）</h3>
<p>大多数与操作系统相关的安全和保护问题可以分为以下4类：</p>
<ul>
<li>可用性（Availability）：保护系统不被打断。</li>
<li>保密性（Confidentiality）：在多个用户共享一个计算机系统时，保证用户不能读取到未授权访问的数据。</li>
<li>数据完整性（Data integrity）：保护数据不被未授权篡改。</li>
<li>认证（Authenticity）：涉及用户身份的正确认证和消息或数据的合法性。</li>
</ul>
<h3 id="调度和资源管理（Scheduling-and-Resource-Management）">调度和资源管理（Scheduling and Resource Management）</h3>
<p>操作系统的一个关键任务就是管理各种可用资源，包括：CPU（进程）管理、内存管理、I/O设备管理、信息（文件）管理。</p>
<p>任何资源分配和调度策略都必须考虑以下3个因素：</p>
<ul>
<li>
<p>公平性（Fairness）</p>
<p>通常希望给竞争使用某一特定资源的所有进程提供几乎相等和公平的访问机会。对同一类作业，也就是说有类似请求的作业，更是需要如此。</p>
</li>
<li>
<p>有差别的响应（Differential responsiveness）</p>
<p>操作系统需要区分有不同服务要求的不同进程。操作系统将试图做出满足所有要求的分配和调度决策，并且动态地做出决策。</p>
</li>
<li>
<p>高效性（Efficiency）</p>
<p>操作系统希望获得最大的吞吐量（throughput）和最小的响应时间（response time），并且在分时的情况下，能够容纳尽可能多的用户。</p>
<blockquote>
<p>可以看出这些标准是相互矛盾的，所以操作系统需要在这些条件下寻找适当的平衡。</p>
</blockquote>
<blockquote>
<p>操作系统在进行调度和资源管理时使用了一种非常重要的数据结构：队列（Queue）</p>
</blockquote>
</li>
</ul>
<h3 id="系统结构（System-Structure）">系统结构（System Structure）</h3>
<p>随着操作系统中增加了越来越多的功能，并且底层硬件变得更强大、更加通用，导致操作系统的大小和复杂性也随着增加。</p>
<blockquote>
<ul>
<li>MIT在1963年投入使用的CTSS，大约包含32000个36位字。</li>
<li>1964年IBM开发的OS/360有超过100万条的机器指令</li>
<li>1975年MIT和Bel1实验室开发的Multics系统增长到了2000万条机器指令</li>
<li>关于Windows：
<ul>
<li>Windows NT 4.0: 1600万行代码</li>
<li>Windows 2000: 3200多万行代码</li>
<li>Windows XP: 3500万行代码</li>
<li>Windows Vista: 5000万行代码</li>
</ul>
</li>
<li>Linux 2.6.27: 1000万行代码</li>
</ul>
</blockquote>
<p>一个功能完善的操作系统的大小和它所处理的任务的困难性，导致了以下4个普遍存在的问题：</p>
<ul>
<li>操作系统在交付使用时就习惯性地表现出落后的态势。这就要求有新的操作系统或者升级老的操作系统</li>
<li>具体的表现总是事与愿违，难以达到期望的性能。</li>
<li>随着时间的推移会发现越来越多的缺陷，这些缺陷必须及时修复。</li>
<li>理论表明，不可能开发出既复杂的又不易受各种包括病毒、蠕虫和未授权访问之类的安全性攻击的操作系统。</li>
</ul>
<p>针对以上问题提出的解决方案：</p>
<ul>
<li>
<p>软件必须是模块化的：有助于组织软件开发过程、限定诊断范围和修正错误。</p>
</li>
<li>
<p>模块相互之间必须有定义很好的接口：接口必须尽可能简单，这不但可以简化程序设计任务，还可以使系统的扩展更加容易。（把不同模块之间的耦合度尽可能降低）</p>
</li>
<li>
<p>分层：现代操作系统的层次结构按照复杂性、时间刻度、抽象级进行功能划分。</p>
<blockquote>
<p>我们可以把系统看作是一系列的层（a series of levels）：</p>
<ul>
<li>每一层执行操作系统所需功能的相关子集。</li>
<li>每一个层次实现功能都要依靠下一个更低的层次，较低层次执行更为原始的功能并隐藏这些功能的细节。</li>
</ul>
<p>这就把一个问题分解成了许多更容易处理的子问题。</p>
</blockquote>
</li>
</ul>
<h2 id="现代操作系统（Modern-Operating-Systems）">现代操作系统（Modern Operating Systems）</h2>
<p>在过去数年中，由于硬件的发展、新的应用程序的出现以及新的安全威胁，操作系统的结构和功能得到逐步发展，是操作系统发生了本质的变化。</p>
<p>对操作系统要求上的变化速度之快不仅需要修改和增强现有的操作系统体系结构，而且需要有新的操作系统组织方法。在实验用和商用操作系统中有很多不同的方法和设计要素，大致可以分为：微内核体系结构（Microkernel architecture）、多线程（Multithreading ）、对称多处理（Symmetric multiprocessing ，SMP）、分布式操作系统（Distributed operating systems ）、面向对象设计（–Object-oriented design）。下面来逐一介绍：</p>
<ul>
<li>
<p>微内核结构（Microkernel architecture）</p>
<p>微内核与宏内核结构（或单体内核，monolithic kernel architecture）的差别在于微内核体系结构仅给内核分配以下最基本的功能：</p>
<ul>
<li>地址空间（Address spaces），地址转换</li>
<li>进程间的通讯（Interprocess communication ，IPC）</li>
<li>基本的调度（Basic scheduling）</li>
</ul>
<blockquote>
<p>大多数认为操作系统应该提供的功能应该由宏内核提供，包括调度、文件系统、网络、设备驱动器、存储管理等。</p>
</blockquote>
</li>
<li>
<p>多线程（Multithreading ）</p>
<p>多线程技术是指：把执行一个应用程序的进程划分为可以同时运行的多个线程。</p>
<blockquote>
<p>线程和进程的差别：</p>
<ul>
<li>
<p>线程：</p>
<p>可分派的工作单元。</p>
<p>线程顺序执行，并且是可中断的，这样处理器可以转到另一个线程。</p>
</li>
<li>
<p>进程：</p>
<p>一个或多个线程和相关系统资源（如包含数据和代码的存储器空间、打开的文件和设备）的集合。（这紧密对应于一个正在执行的程序的概念）</p>
</li>
</ul>
<p>通过把一个应用程序分解成多个线程，程序员可以在很大程度上控制应用程序的模块性和应用程序相关事件的时间安排。</p>
</blockquote>
</li>
<li>
<p>对称多处理（Symmetric multiprocessing ，SMP）</p>
<p>对称多处理计算机可以定义为具有以下特征的一个独立的计算机系统：</p>
<ul>
<li>有多个处理器。</li>
<li>这些处理器共享同一个内存和I/O设备，它们之间通过通信总线或别的内部连接方案互相连接。</li>
<li>所有的处理器都可以执行相同的功能。（因此称为对称）</li>
</ul>
</li>
<li>
<p>分布式操作系统（Distributed operating systems ）</p>
<p>分布式操作系统使用户产生错觉，使多机系统好像具有一个单一的内存空间、外存空间以及其他的统一存取措施。（如分布式文件系统）</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F.jpg" alt=""></p>
<blockquote>
<p>尽管集群正变得越来越流行，市场上也有很多集群产品，但是，分布式操作系统的技术发展水平落后于单处理器操作系统和对称多处理操作系统。</p>
</blockquote>
</li>
<li>
<p>面向对象设计（–Object-oriented design）</p>
<p>面向对象的设计原理：</p>
<ul>
<li>用于给小内核增加模块化的扩展。</li>
<li>在操作系统一级，基于对象的结构使程序员可以定制操纵系统，而不会破坏操作系统的完整性。</li>
</ul>
<blockquote>
<p>面向对象技术还使得分布式工具和分布式操作系统的开发变得更容易。</p>
</blockquote>
</li>
</ul>
<hr>
<h1>后记</h1>
<p>本篇已完结。</p>
<p>（如有修改或补充欢迎评论）</p>
]]></content>
      <categories>
        <category>学习笔记</category>
      </categories>
      <tags>
        <tag>操作系统</tag>
      </tags>
  </entry>
  <entry>
    <title>操作系统学习笔记-文件管理</title>
    <url>/2021/06/09/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E6%96%87%E4%BB%B6%E7%AE%A1%E7%90%86/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\css\APlayer.min.css"><script src="\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\js\Meting.min.js"></script><h1>前言</h1>
<p><em>正在学习操作系统，记录笔记。</em></p>
<blockquote>
<p>参考资料：</p>
<p>《操作系统（精髓与设计原理 第8版） 》</p>
</blockquote>
<hr>
<h1>第十二章：文件管理</h1>
<h2 id="概述">概述</h2>
<h3 id="文件和文件系统">文件和文件系统</h3>
<p>文件管理（File Management）</p>
<p>在大多数一应用中，文件都是核心元素，相对应的就需要文件管理。文件管理的基本目标就是能够快速准确地找到存储在磁盘当中的文件，并将其加载进内存，进行读/写操作。</p>
<p>要实现文件管理可以有两种方式：</p>
<ul>
<li>用户编程实现：对于用户来讲，需要知晓磁盘的物理特性，还有很多其他的要求，显然这并不是一个很好的方案，对于用户来说要求太高。</li>
<li>操作系统实现：我们重点就是要讨论此方案。</li>
</ul>
<p>实际上所有的操作系统都提供了文件管理系统，它由系统实用程序组成，可以作为具有特权的应用程序来运行。</p>
<p>文件系统属性：</p>
<ul>
<li>
<p>长期存在：文件存储在硬盘或其他辅存中，用户退出系统时文件不会丢失，</p>
</li>
<li>
<p>进程共享：文件有名字，具有允许受控共享的相关访问权限。</p>
</li>
<li>
<p>结构化存储：取决于具体的文件系统，一个文件具有针对某个特定应用的内部结构。</p>
<blockquote>
<p>此外，文件可组织为层次结构或更复杂的结构，以反映文件之间的关系。</p>
</blockquote>
</li>
</ul>
<p>文件系统提供对文件进行操作的接口，典型的有以下六种：</p>
<ul>
<li>
<p>创建（Create）：在文件结构中定义并定位一个新文件。</p>
</li>
<li>
<p>删除（Delete）：从文件结构中删除并销毁一个文件。</p>
<blockquote>
<p>注意这里的删除并不能真正地把数据从物理磁盘中抹除。（格式化同样如此）</p>
</blockquote>
</li>
<li>
<p>打开（Open）：进程将一个已有文件声明为“打开”状态，以便允许该进程对这个文件进行操作。</p>
</li>
<li>
<p>关闭（Close）：相关进程关闭一个文件，以便不再能对该文件进行操作，直到该进程再次打开它。</p>
</li>
<li>
<p>读（Read）：进程读取文件中的所有或部分数据。</p>
</li>
<li>
<p>写（Write）：进程更新文件，要么通过添加新数据来扩大文件的尺寸，要么通过改变文件中已有数据项的值。</p>
</li>
</ul>
<h3 id="文件结构">文件结构</h3>
<p>讨论文件时通常要用到如下四个术语：</p>
<ul>
<li>
<p>域（Field）：域是基本的数据单元。</p>
<ul>
<li>
<p>一个域包含一个值</p>
<blockquote>
<p>比如：现有一个工资管理系统，其中有一个名为“花猪”的对象（也可视为一条记录），其中有一个属性叫做性别，这个属性就称为一个域。</p>
</blockquote>
</li>
<li>
<p>可分为<code>基本域</code>和<code>组合域</code>：</p>
<ul>
<li>基本域：不可再分，通常为定长。</li>
<li>组合域：可以再分成子域，通常为变长。（如工资属性可以细分为基本工资、绩效工资等）</li>
</ul>
</li>
</ul>
</li>
<li>
<p>记录（Record）：是一组相关域的集合。</p>
<ul>
<li>
<p>可视为应用程序的一个单元。</p>
<blockquote>
<p>比如：一条雇员记录可能包含以下域：名字、社会保险号、工作类型、雇用日期等。</p>
</blockquote>
</li>
<li>
<p>记录的长度可以是定长的或变长的</p>
</li>
</ul>
</li>
<li>
<p>文件（File）：一组相似记录的集合。</p>
<ul>
<li>
<p>被用户和应用程序视为一个实体，并可通过名字访问</p>
</li>
<li>
<p>有唯一的文件名，可以被创建或删除</p>
</li>
<li>
<p>访问控制通常在文件级实施</p>
<blockquote>
<p>在有些更复杂的系统中，控制访问也可以在记录级或域级实施。</p>
</blockquote>
</li>
</ul>
</li>
<li>
<p>数据库（Database）：是一组相关数据的集合。</p>
<ul>
<li>其本质特征是数据元素间存在着明确的关系</li>
<li>可供不同的应用程序使用</li>
</ul>
</li>
</ul>
<h3 id="文件管理系统">文件管理系统</h3>
<p>文件管理系统是一组系统软件，它为使用文件的用户和应用程序提供服务。</p>
<ul>
<li>文件管理系统是用户或应用程序访问文件的唯一方式</li>
<li>用户或程序员不需要为每个应用程序开发专用软件</li>
</ul>
<p>文件管理系统需要满足以下七大需求：</p>
<ol>
<li>满足数据管理的要求和用户的需求，包括存储数据和执行上述操作的能力。</li>
<li>最大限度地保证文件中的数据有效。</li>
<li>优化性能：包括总体吞吐量（从系统的角度）和响应时间（从用户角度）。</li>
<li>为各种类型的存储设备提供I/O支持。</li>
<li>减少或消除丢失或者破坏数据的可能性。</li>
<li>向用户进程提供标准I/O接口例程集。</li>
<li>在多用户系统中为多个用户提供I/O支持。</li>
</ol>
<p>在上述第一条中，用户需求的范围取决于各种应用程序和计算机系统的使用环境。对于交互式的通用系统，最小需求集合如下：</p>
<ul>
<li>每个用户实现基本操作：如创建、删除、读取和修改文件</li>
<li>每个用户都应能受控地访问其他用户的文件</li>
<li>每个用户都应能控制允许对用户文件进行哪种类型的访问</li>
<li>每个用户应该能够按照自己的需要从而对文件进行重构</li>
<li>每个用户都应能在文件间移动数据</li>
<li>每个用户都应能备份用户文件，并在文件遭到破坏时恢复文件</li>
<li>每个用户都应能通过名字而非数字标识符访问自己的文件</li>
</ul>
<p>文件系统架构</p>
<p>下图展示了文件系统软件架构：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E8%BD%AF%E4%BB%B6%E6%9E%B6%E6%9E%84.png" alt=""></p>
<p>从底层逐层向上介绍：</p>
<ol>
<li>
<p>设备驱动层：</p>
<ul>
<li>直接与外围设备通信</li>
<li>设备驱动程序负责启动设备上的I/O操作，处理I/O请求的完成</li>
</ul>
</li>
<li>
<p>基本文件系统：也称为物理I/O层，是计算机系统外部环境的基本接口。</p>
<ul>
<li>处理在磁盘间或磁带系统间交换的数据块</li>
<li>关注块在辅存和内存缓冲区的位置，而非数据的内容或所涉及的文件结构</li>
<li>通常是操作系统的一部分</li>
</ul>
</li>
<li>
<p>基本I/O管理程序：</p>
<ul>
<li>负责所有文件I/O的初始化和终止</li>
<li>需要一定的控制结构来维护设备的输入、输出、调度和文件状态</li>
<li>根据所选的文件来选择执行文件I/O的设备</li>
<li>为了优化性能，参与调度对磁盘和磁带的访问</li>
<li>是操作系统的一部分</li>
</ul>
</li>
<li>
<p>逻辑I/O：</p>
<ul>
<li>
<p>使用户和应用程序能够访问记录</p>
</li>
<li>
<p>提供一种通用的记录I/O能力</p>
</li>
<li>
<p>维护关于文件的基本数据</p>
<blockquote>
<p>基本文件系统处理的是数据块，而逻辑I/O模块处理的是文件记录。</p>
</blockquote>
</li>
</ul>
</li>
<li>
<p>访问方法：</p>
<ul>
<li>
<p>文件系统中与用户最近的一层</p>
</li>
<li>
<p>在应用程序和文件系统以及保存数据的设备之间提供了一个标准接口</p>
</li>
<li>
<p>不同的访问方法反映了不同的文件结构及访问和处理数据的不同方法</p>
<blockquote>
<p>堆（Pile）、顺序（Sequential）、索引顺序（Indexed Sequential）、索引（Indexed）、散列（Hashed）</p>
</blockquote>
</li>
</ul>
</li>
</ol>
<p>文件管理功能：</p>
<p>下图展示了文件管理的要素</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E6%96%87%E4%BB%B6%E7%AE%A1%E7%90%86%E8%A6%81%E7%B4%A0.png" alt=""></p>
<ul>
<li>
<p>用户或应用进程发送操作文件的命令（创建、删除等）与文件系统进行交互</p>
</li>
<li>
<p>在执行操作任何文件之前，文件系统必须确认和定位所选择的文件</p>
</li>
<li>
<p>定位文件要求使用某种类型的目录来描述所有文件的位置及它们的属性</p>
</li>
<li>
<p>大多数共享系统都实行用户访问控制</p>
<blockquote>
<p>只有被授权用户才允许以特定方式访问特定的文件</p>
</blockquote>
</li>
<li>
<p>文件的访问是以块的形式</p>
<blockquote>
<p>虽然用户和应用程序关注的是记录，但I/O是以块为基础来完成的，因此文件中的记录必须组织成一组块序列来输出，并在输入后将各块组合起来。</p>
</blockquote>
</li>
<li>
<p>支持文件的块I/O需要许多功能：</p>
<ul>
<li>管理辅存：包括把文件分配到辅存中的空闲块</li>
<li>管理空闲存储空间：以便知道新文件和现有文件增长时可以使用哪些块</li>
<li>必须调度单个的块I/O请求</li>
</ul>
</li>
</ul>
<h2 id="文件组织和访问">文件组织和访问</h2>
<h3 id="文件管理的评价标准">文件管理的评价标准</h3>
<ul>
<li>
<p>短的存取时间：</p>
<ul>
<li>
<p>需要时可以随机访问单一记录</p>
</li>
<li>
<p>无需批处理模式</p>
<blockquote>
<p>如果一个文件仅以批处理方式处理，且每次都要访问到它的所有记录，则基本无须关注用于检索一条记录的快速访问。</p>
</blockquote>
</li>
</ul>
</li>
<li>
<p>易于修改：</p>
<blockquote>
<p>存储在CD-ROM中的文件永远不会被修改，因此易于修改这一点根本不需要考虑。</p>
</blockquote>
</li>
<li>
<p>存储经济性：</p>
<ul>
<li>
<p>为了节约存储空间，数据冗余应最小（类似内存管理中考虑减小零头的道理）</p>
<blockquote>
<p>另一方面，冗余是提高数据访问速度的一种主要手段。例如：使用索引。</p>
</blockquote>
</li>
</ul>
</li>
<li>
<p>维护简单</p>
</li>
<li>
<p>可靠性</p>
</li>
</ul>
<p>下面要介绍五类常见的文件组织结构：</p>
<h3 id="堆文件（Pile-）">堆文件（Pile ）</h3>
<img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS堆文件结构.png" style="zoom:80%;" />
<ul>
<li>
<p>最简单的文件组织形式，简单有效</p>
</li>
<li>
<p>数据按照到达的顺序被组织起来，每条记录由一串数据组成。没有固定的结构</p>
<blockquote>
<p>类似于本人考试时候时候草稿纸，按照【会写的】题目顺序依次演算，最后再演算之前较难的题，稿纸上的记录就是做题的顺序，不固定。</p>
</blockquote>
</li>
<li>
<p>堆的目的仅仅是积累大量的数据并保存数据</p>
</li>
<li>
<p>记录可以有不同的域，或者相似但顺序不同</p>
<blockquote>
<p>因此，每个域都应能自我描述，并包含域名和值。</p>
</blockquote>
</li>
<li>
<p>缺点：</p>
<ul>
<li>
<p>写入的数据必须具有自解释性：包含域名和值，</p>
<blockquote>
<p>每个域的长度由分隔符隐式地指定，要么明确地包含在一个子域中，要么是该域类型的默认长度。</p>
</blockquote>
</li>
<li>
<p>对于记录的访问是通过穷举查找的方式（由于非结构化的原因）</p>
<blockquote>
<p>当数据在处理前采集并存储时，或当数据难以组织时，会用到堆文件。当保存的数据大小和结构不同时，这种类型的文件空间使用情况很好，能较好地用于穷举查找，且易于修改。但是，除了这些受限制的使用外，这类文件对大多数应用都不适用。</p>
</blockquote>
</li>
</ul>
</li>
</ul>
<h3 id="顺序文件（Sequential-File-）">顺序文件（Sequential File ）</h3>
<img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS顺序文件结构.png" style="zoom:80%;" />
<ul>
<li>
<p>最常用的文件组织形式</p>
<blockquote>
<p>使用场景：批量的写入数据，例如：爬虫</p>
</blockquote>
</li>
<li>
<p>每条记录都使用一种固定的格式</p>
</li>
<li>
<p>所有记录都具有相同的长度</p>
</li>
<li>
<p>所有记录都由相同数量、长度固定的域按特定的顺序组成</p>
<blockquote>
<p>以上三点可以避免数据的自解释性，降低成本开销。</p>
</blockquote>
</li>
<li>
<p>缺点：</p>
<ul>
<li>对记录的查询仍然是穷举查询</li>
<li>插入一条记录时并不方便，需要移动后续的所有记录位置</li>
</ul>
</li>
<li>
<p>为了解决数据插入的繁琐，引入了一个特殊的域：<strong>关键域（key field）/ 主域</strong></p>
<ul>
<li>通常是每条记录的第一个域</li>
<li>可以唯一地标识该记录（类似数据库中的主键）</li>
</ul>
</li>
<li>
<p>为了高效处理数据，引入<strong>日志文件（log file）/ 事务文件（transaction file）</strong></p>
<ul>
<li>进行文件处理时，把新的记录放在一个单独的堆文件中，即日志文件</li>
<li>通过周期性地执行成批更新，把日志文件合并到主文件中，并按正确的关键字顺序产生一个新文件</li>
</ul>
</li>
</ul>
<h3 id="索引顺序文件（Indexed-Sequential-File）">索引顺序文件（Indexed Sequential File）</h3>
<img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS索引顺序文件结构.png" style="zoom:80%;" />
<ul>
<li>
<p>索引提供了一个查询功能，以快速到达所需记录的附近区域</p>
</li>
<li>
<p>索引文件中的每条记录由两个域组成：关键域和指向主文件的指针，其中关键域和主文件中的关键域相同</p>
</li>
<li>
<p>查找某个特定的域，首先要查找索引：</p>
<ul>
<li>查找关键域值等于目标关键域值或者位于目标关键域值之前且最大的索引</li>
<li>然后在该索引的指针所指的主文件中的位置处开始查找</li>
</ul>
<blockquote>
<p>举个例子说明该方法的有效性：</p>
<p>考虑一个包含100万条记录的顺序文件</p>
<ul>
<li>查找某个特定的关键域值，平均需要访问50万次记录（<code>(1000000 + 1) / 2</code>）</li>
<li>假设现在创建一个包含了1000项的索引，如果要查找特定记录：
<ul>
<li>平均在索引文件中访问500次（<code>(1000 + 1 ) / 2</code>）</li>
<li>接着在主文件中平均访问500次（<code>(1000 + 1 ) / 2</code>）</li>
</ul>
</li>
</ul>
<p>由此可见，平均访问次数从500000降低到了1000，大大降低了查询开销。</p>
</blockquote>
</li>
<li>
<p>文件按如下方式处理：</p>
<ul>
<li>
<p>主文件中的每条记录都包含一个附加域（附加域对应用程序不可见）</p>
</li>
<li>
<p>附加域是指向溢出文件的一个指针</p>
</li>
<li>
<p>向文件中插入一条新记录时，它被添加到溢出文件（overflow file）中</p>
</li>
<li>
<p>修改主文件中逻辑顺序位于这条新纪录之前的记录，使其包含指向新纪录前面的那条记录的指针</p>
<blockquote>
<p>如果新纪录前面的那条记录也在溢出文件中，那么修改新纪录前面的那条记录的指针</p>
</blockquote>
</li>
<li>
<p>索引顺序文件有时也按照批处理的方式合并溢出文件</p>
</li>
</ul>
</li>
<li>
<p>为提供更有效的访问，可以为关键域设置多级索引</p>
<blockquote>
<p>同样以访问包含100万条记录的顺序文件</p>
<ul>
<li>首先构建10000项的低级索引</li>
<li>低级索引再构建100项的高级索引</li>
<li>查询过程从高级索引开始：
<ul>
<li>查询低级索引的一项，平均50次访问（<code>(50 + 1) / 2</code>）</li>
<li>找到主文件中的一项，平均50次访问（<code>(50 + 1) / 2</code>）</li>
<li>最后查找主文件，平均50次访问（<code>(50 + 1) / 2</code>）</li>
</ul>
</li>
<li>总共平均查找150次</li>
</ul>
</blockquote>
</li>
</ul>
<h3 id="索引文件（Indexed-File-）">索引文件（Indexed File ）</h3>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E7%B4%A2%E5%BC%95%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84.png" alt=""></p>
<p>索引顺序文件的是基于文件的一个域（关键域）进行处理，但是在现实中，可能需要对我们所关注的一些域（属性）进行记录查询，这时索引顺序文件就失去了作用。为此，引入了一个多索引的结构。</p>
<ul>
<li>
<p>索引文件摒弃了顺序性和关键字的概念，只通过索引访问记录</p>
</li>
<li>
<p>要求至少有一个索引的指针指向一条记录就好，不限制记录放置的位置</p>
<blockquote>
<p>还可以使用长度可变的记录</p>
</blockquote>
</li>
<li>
<p>可以使用两种类型的索引：</p>
<ul>
<li>
<p>完全索引（exhaustive index）：包含主文件中每条记录的索引项</p>
<p>查询速度快，但是由于包含记录的全部索引项，因此会多占用一部分内存空间</p>
<blockquote>
<p>为了易于查找，索引自身被组织成一个顺序文件</p>
</blockquote>
</li>
<li>
<p>部分索引（partial index）：只包含那些有感兴趣域的记录的索引项</p>
</li>
</ul>
<blockquote>
<p>对于变长记录，某些记录并不包含所有的域。向主文件中增加一条新记录时，索引文件必须全部更新。</p>
</blockquote>
</li>
</ul>
<h3 id="直接文件或散列-哈希文件（Direct-or-Hashed-File）">直接文件或散列/哈希文件（Direct or Hashed File）</h3>
<ul>
<li>
<p>可以直接访问磁盘中任何一个地址已知的块</p>
</li>
<li>
<p>每条记录中都需要一个关键域</p>
<blockquote>
<p>这里对关键域进行Hash操作，较索引文件节约空间，但是存在哈希冲突，因此查询速度要慢一些。</p>
</blockquote>
</li>
</ul>
<h2 id="文件目录">文件目录</h2>
<h3 id="内容">内容</h3>
<p>文件目录解决了这样一个问题：即给定一个文件名，就能够在外存中准确地访问到对应文件。</p>
<p>与任何文件管理系统和文件集合相关联的是文件目录。目录包含文件的相关信息，包括：</p>
<ul>
<li>属性（Attributes）</li>
<li>位置（Location）</li>
<li>所有权（Ownership）</li>
</ul>
<p>目录自身是一个文件，它可被各种文件管理例程访问。</p>
<blockquote>
<p>尽管用户和应用程序也可得到目录中的某些信息，但这通常是由系统例程间接提供的。</p>
</blockquote>
<p>从用户角度看，目录在用户和应用程序所知道的<strong>文件名</strong>和<strong>文件自身</strong>之间提供映射。</p>
<blockquote>
<p>每个文件项都包含文件名。</p>
</blockquote>
<blockquote>
<p>下表列出了文件目录的信息单元</p>
<p><strong>基本信息</strong></p>
<table>
<thead>
<tr>
<th>信息单元</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>文件名</td>
<td>由创建者（用户或程序）选择的名字，在同一个目录中必须是唯一的</td>
</tr>
<tr>
<td>文件类型</td>
<td>如文本文件、二进制文件、加载模块等</td>
</tr>
<tr>
<td>文件组织</td>
<td>供那些支持不同组织的系统使用</td>
</tr>
</tbody>
</table>
<p><strong>地址信息</strong></p>
<table>
<thead>
<tr>
<th>信息单元</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>卷</td>
<td>指示存储文件的设备</td>
</tr>
<tr>
<td>起始地址</td>
<td>文件在辅存中的起始物理地址（如在磁盘上的柱面、磁道和块号）</td>
</tr>
<tr>
<td>使用大小</td>
<td>文件的当前大小，单位为字节、字或块</td>
</tr>
<tr>
<td>分配大小</td>
<td>文件的最大尺寸</td>
</tr>
</tbody>
</table>
<p><strong>访问控制信息</strong></p>
<table>
<thead>
<tr>
<th>信息单元</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>所有者</td>
<td>控制文件的用户。所有者可授权或拒绝其他用户的访问，并改变给予它们的权限</td>
</tr>
<tr>
<td>访问信息</td>
<td>该单元的最简形式包括每个授权用户的用户名和口令</td>
</tr>
<tr>
<td>许可的行为</td>
<td>控制读、写、执行及在网上传送</td>
</tr>
</tbody>
</table>
<p><strong>使用信息</strong></p>
<table>
<thead>
<tr>
<th>信息单元</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>数据创建</td>
<td>文件首次放到目录中的时间</td>
</tr>
<tr>
<td>创建者身份</td>
<td>通常是当前所有者，但不一定必须是当前所有者</td>
</tr>
<tr>
<td>最后一次访问的日期</td>
<td>最后一次读记录的日期</td>
</tr>
<tr>
<td>最后一次读用户的身份</td>
<td>最后一次进行读的用户</td>
</tr>
<tr>
<td>最后一次修改的日期</td>
<td>最后一次修改、插入或删除的日期</td>
</tr>
<tr>
<td>最后一次修改者的身份</td>
<td>最后一次进行修改的用户</td>
</tr>
<tr>
<td>最后一次备份的日期</td>
<td>最后一次把文件备份到另一个存储介质中的日期</td>
</tr>
<tr>
<td>当前使用</td>
<td>当前文件活动的信息，如打开文件的进程、是否被一个进程加锁、文件是否在内存中被修改但未在磁盘中修改等</td>
</tr>
</tbody>
</table>
</blockquote>
<h3 id="结构">结构</h3>
<p>在介绍目录结构之前，为了理解文件结构的需求，我们可以考虑可能在目录上执行的操作：</p>
<ul>
<li>查找：用户或应用程序引用一个文件时，必须查找目录，以找到该文件相应的目录项。</li>
<li>创建文件：创建一个新文件时，必须在目录中增加一个目录项。</li>
<li>删除文件：删除一个文件时，必须在目录中删除相应的目录项。</li>
<li>显示目录：可能会请求目录的全部或部分内容。通常，这个请求是由用户发出的，用于显示该用户所拥有的所有文件和每个文件的某些属性（如类型、访问控制信息、使用信息）。</li>
<li>修改目录：由于某些文件属性保存在目录中，因而这些属性的变化需要改变相应的目录项。</li>
</ul>
<h4 id="简单目录结构">简单目录结构</h4>
<ul>
<li>
<p>最简单的结构是一个目录项列表，每个文件都有一个目录项</p>
</li>
<li>
<p>该结构可表示最简单的顺序文件，文件名作为关键域</p>
</li>
<li>
<p>在组织文件的时候该结构提供不了帮助</p>
</li>
<li>
<p>用户在使用这种结构时需要注意不能给两个不同的文件取相同的名字（强制性的）</p>
</li>
<li>
<p>文件查询速度慢</p>
<blockquote>
<p>实际上若目录是一个简单的顺序列表，则它对于组织文件没有任何帮助。很难满足用户需求，尤其在共享系统中会变得更糟。</p>
</blockquote>
</li>
</ul>
<h4 id="两级目录方案">两级目录方案</h4>
<ul>
<li>
<p>有一个主目录</p>
</li>
<li>
<p>每位用户有一个用户目录</p>
</li>
<li>
<p>主目录中的每一项为用户目录，并提供地址和访问控制信息</p>
</li>
<li>
<p>每个用户目录为简单列表文件</p>
</li>
<li>
<p>对构造结构化文件集合没有任何帮助</p>
</li>
<li>
<p>在不同的目录下，允许给文件进行相同命名</p>
</li>
<li>
<p>较简单目录结构加快了文件查询速度</p>
<blockquote>
<p>举例，有n个用户，每个用户有m个文件：</p>
<ul>
<li>简单目录结构：<code>(n × m) / 2</code></li>
<li>两级目录方案：<code>(n + m) / 2</code></li>
</ul>
</blockquote>
</li>
</ul>
<h4 id="层次-树状结构目录">层次/树状结构目录</h4>
<img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS树状目录结构.png" style="zoom:80%;" />
<ul>
<li>有一个主目录，主目录下是许多用户目录</li>
<li>每个用户目录下又可以包含子目录的目录项和文件的目录项</li>
<li>树状结构目录降低了为文件提供唯一名称的难度</li>
</ul>
<h3 id="命名">命名</h3>
<p>路径名（pathname）：系统中的任何文件都可以按照从根目录或主目录向下到各个分支，最后直到该文件的路径来定位。这一系列目录名和最后到达的文件名组成了该文件的路径名。</p>
<p>文件名称可以相同，只要路径名不同就可以。</p>
<p>现假设有一个名为“<code>HuaZhu”</code>的用户目录，其包含子目录：<code>OS → Nachos → code → thread</code></p>
<p>在<code>thread</code>目录下有一个名为<code>thread.cc</code>文件，现在要定位该文件</p>
<p><strong>绝对路径</strong>：/HuaZhu/OS/Nachos/code/thread/thread.cc</p>
<p>工作目录（working directory ）：（如果要求用户在每次访问文件时都必须拼写完整的绝对路径仍比较复杂）在典型情况下，对交互用户或进程而言，总有一个当前路径与之相关联，通常称为工作目录。文件通常按相对于工作目录的方式访问，即采用相对路径。</p>
<p>现假设我正处于<code>Nachos</code>目录下，定位<code>thread.cc</code>文件</p>
<p><strong>相对路径</strong>：./code/thread/thread.cc</p>
<blockquote>
<p>绝对路径和相对路径的使用没有绝对的优劣，针对不同的使用场景有不同的选择。</p>
</blockquote>
<h2 id="文件共享">文件共享</h2>
<p>在多用户系统中，几乎总是要求允许文件在多个用户间共享，这就会产生两个问题：</p>
<ul>
<li>访问权限</li>
<li>对同时访问的管理</li>
</ul>
<h3 id="访问权限">访问权限</h3>
<p>下面列出了一些具有代表性的访问权限：</p>
<ul>
<li>
<p>无（None）：</p>
<ul>
<li>用户不知道文件是否存在</li>
<li>为了实施这种限制，不允许用户读包含该文件的用户目录</li>
</ul>
</li>
<li>
<p>知道（Knowledge）：</p>
<ul>
<li>
<p>用户仅仅可确定文件是否存在并确定其所有者</p>
<blockquote>
<p>没有更多的访问权限，当然用户可以向文件所有者申请。</p>
</blockquote>
</li>
</ul>
</li>
<li>
<p>执行（Execution）：</p>
<ul>
<li>
<p>用户可以加载并执行一个程序，但不能复制它（看不到程序内部，即不可读文件）</p>
<blockquote>
<p>私有程序通常具有这种访问限制。</p>
</blockquote>
</li>
</ul>
</li>
<li>
<p>读（Reading）：</p>
<ul>
<li>
<p>用户可以读文件，包括复制和执行</p>
<blockquote>
<p>有些系统还可区分浏览和复制，对于前一种情况，文件的内容可以呈现给用户，但用户却无法进行复制。</p>
</blockquote>
</li>
</ul>
</li>
<li>
<p>追加（Appending）：</p>
<ul>
<li>
<p>用户可给文件添加数据，通常只能在末尾追加，但不能修改或删除文件的任何内容</p>
<blockquote>
<p>在许多资源中收集数据时，这种权限非常有用</p>
</blockquote>
</li>
</ul>
</li>
<li>
<p>更新（Updating）：</p>
<ul>
<li>
<p>用户可修改、删除和增加文件中的数据</p>
</li>
<li>
<p>通常包括最初写文件、完全重写或部分重写、移去所有或部分数据</p>
<blockquote>
<p>有些系统还区分不同程度的更新</p>
</blockquote>
</li>
</ul>
</li>
<li>
<p>改变保护（Changing protection ）：</p>
<ul>
<li>
<p>用户可改变已授给其他用户的访问权限</p>
<blockquote>
<p>通常，只有文件的所有者才具有这一权力。在某些系统中，所有者可把这项权力扩展到其他用户。为防止滥用这种机制，文件的所有者通常能指定该项权力的持有者改变哪些权限。</p>
</blockquote>
</li>
</ul>
</li>
<li>
<p>删除（Deletion）：</p>
<ul>
<li>用户可从文件系统中删除该文件</li>
</ul>
</li>
</ul>
<blockquote>
<p>这些权限构成了一个层次结构，层次结构中的每个权限都隐含了前面的那些权限</p>
</blockquote>
<p>被指定为某个文件所有者的用户，通常是最初创建该文件的用户。所有者具有前面列出的全部权限，并且可给其他用户授予权限。访问可以提供给不同类型的用户：</p>
<ul>
<li>特定用户（Specific user ）：由用户ID指定的单个用户。</li>
<li>用户组（User groups ）：非单独定义的一组用户。系统必须能通过某种方式了解用户组的所有成员。</li>
<li>全部（All ）：有权访问该系统的所有用户。这些是公共文件。</li>
</ul>
<h3 id="同时访问">同时访问</h3>
<p>如果允许多个用户追加或更新一个文件，操作系统或文件系统必须强加一些规范：</p>
<ul>
<li>在用户修改文件时，允许用户对整个文件加锁</li>
<li>更好的方案是对文件中要修改的记录进行加锁</li>
</ul>
<p>在设计共享访问能力时，必须解决互斥问题和死锁问题。</p>
<h2 id="二级存储管理（辅存管理）">二级存储管理（辅存管理）</h2>
<p>在辅存中，文件是由许多块组成的。操作系统或文件管理系统负责为文件分配块。这时会引发两个管理问题：</p>
<ul>
<li>辅存中的空间必须分配给文件</li>
<li>必须知道哪些空间可用来进行分配（空闲空间管理）</li>
</ul>
<h3 id="文件分配">文件分配</h3>
<p>文件分配涉及以下几个问题：</p>
<ul>
<li>
<p>创建一个新文件时，是否一次性地给它分配所需的最大空间？</p>
</li>
<li>
<p>给文件分配的空间是一个或多个连续的单元，这些单元称为分区。在分配文件时，分区的大小应该是多少？</p>
<blockquote>
<p>分区（portion）是一组连续的已分配块。分区的大小可以从一个块大小到整个文件大小。</p>
</blockquote>
</li>
<li>
<p>为跟踪分配给文件的分区，应使用哪种数据结构或表？</p>
<p>在DOS或其他系统中，这种表通常称为<strong>文件分配表（File Allocation Table，FAT）</strong></p>
</li>
</ul>
<h4 id="预分配">预分配</h4>
<ul>
<li>
<p>要求在发出创建文件的请求时，声明该文件的最大尺寸</p>
</li>
<li>
<p>实际对于许多应用程序来说，可靠的预估文件的最大尺寸是有难度的</p>
</li>
<li>
<p>用户和应用程序会将文件尺寸估计得大一些，此时就会造成浪费</p>
<blockquote>
<p>因此采用动态分配要好一些</p>
</blockquote>
</li>
</ul>
<h4 id="分区大小">分区大小</h4>
<ul>
<li>
<p>一种极端情况是：分配大到足以保存整个文件的分区</p>
<blockquote>
<p>大小可变的大规模连续分区：能提供较好的性能。大小可变避免了浪费，且会使文件分配表较小，但这又会导致空间很难再次利用。</p>
</blockquote>
</li>
<li>
<p>另一种极端情况是：磁盘空间一次只分配一块</p>
<blockquote>
<p>块：小的固定分区能提供更大的灵活性，但为了分配，它们可能需要较大的表或更复杂的结构。邻近性不再是主要目的，主要目的是根据需要来分配块。</p>
</blockquote>
<blockquote>
<p>因此需要折中考虑单个文件的效率和整个系统的效率，具体要考虑以下内容：</p>
<ul>
<li>邻近空间可以提高性能</li>
<li>数量较多的小分区会增加用于管理分配信息的表的大小</li>
<li>使用固定大小的分区（例如块）可以简化空间的再分配</li>
<li>使用可变大小的分区或固定大小的小分区，可减少超额分配导致的未使用存储空间的浪费</li>
</ul>
</blockquote>
</li>
</ul>
<p>下面考虑三种文件分配的方法，首先下表总结了每种方法的特点：</p>
<table>
<thead>
<tr>
<th></th>
<th>连续</th>
<th>链式</th>
<th>索引</th>
<th>索引</th>
</tr>
</thead>
<tbody>
<tr>
<td>是否预分配</td>
<td>需要</td>
<td>可能</td>
<td>可能</td>
<td>可能</td>
</tr>
<tr>
<td>分区大小是固定还是可变</td>
<td>可变</td>
<td>固定块</td>
<td>固定块</td>
<td>可变</td>
</tr>
<tr>
<td>分区大小</td>
<td>大</td>
<td>小</td>
<td>小</td>
<td>中</td>
</tr>
<tr>
<td>分配频率</td>
<td>一次</td>
<td>低到高</td>
<td>高</td>
<td>低</td>
</tr>
<tr>
<td>分配需要的时间</td>
<td>中</td>
<td>长</td>
<td>短</td>
<td>中</td>
</tr>
<tr>
<td>文件分配表的大小</td>
<td>一个表项</td>
<td>一个表项</td>
<td>大</td>
<td>中</td>
</tr>
</tbody>
</table>
<h4 id="连续分配">连续分配</h4>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E8%BF%9E%E7%BB%AD%E5%88%86%E9%85%8D%E5%9B%BE.png" alt=""></p>
<blockquote>
<p>说明：</p>
<ul>
<li>图左：连续文件分配</li>
<li>图右：连续文件分配（紧缩后）</li>
</ul>
</blockquote>
<ul>
<li>
<p>在创建文件时，给文件分配一组连续的块</p>
</li>
<li>
<p>这是一种使用大小可变分区的预分配策略</p>
</li>
<li>
<p>在文件分配表中，每个文件只需要一个表项，用于说明起始块和文件的长度</p>
</li>
<li>
<p>缺点：随着使用时长的增加，会出现外部碎片</p>
<blockquote>
<p>长时间后很难找到空间大小足够的连续块，因此需要紧缩算法来释放磁盘中的额外空间</p>
</blockquote>
</li>
</ul>
<h4 id="链式分配">链式分配</h4>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E9%93%BE%E5%BC%8F%E5%88%86%E9%85%8D%E5%9B%BE.png" alt=""></p>
<blockquote>
<p>说明：</p>
<ul>
<li>图左：链式分配</li>
<li>图右：链式分配（合并后）</li>
</ul>
</blockquote>
<ul>
<li>
<p>链式分配基于单个块</p>
<blockquote>
<p>连续分配与链式分配是两个极端</p>
</blockquote>
</li>
<li>
<p>链中的每块都包含指向下一块的指针</p>
</li>
<li>
<p>在文件分配表中，每个文件同样只需要一个表项，用于声明起始块和文件的长度</p>
</li>
<li>
<p>优势：无外部碎片。最适合顺序处理的顺序文件</p>
</li>
<li>
<p>缺点：局部性原理失效</p>
<blockquote>
<ul>
<li>若需要像顺序处理那样一次取入一个文件中的多个块，则需要对磁盘的不同部分进行一系列访问。这对于单用户系统有重大影响，也是共享系统需要关注的。</li>
<li>为克服这个问题，有些系统会周期性地合并文件（如图右）</li>
</ul>
</blockquote>
</li>
</ul>
<h4 id="索引分配">索引分配</h4>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E7%B4%A2%E5%BC%95%E5%88%86%E9%85%8D%E5%9B%BE.png" alt=""></p>
<blockquote>
<p>说明：</p>
<ul>
<li>图左：基于块的索引分配</li>
<li>图右：基于长度可变分区的索引分配</li>
</ul>
</blockquote>
<ul>
<li>
<p>每个文件在文件分配表中都有一个一级索引</p>
</li>
<li>
<p>分配给该文件的每个分区在索引中都有一个表项</p>
</li>
<li>
<p>文件的索引保存在一个单独的块中，文件分配表中该文件的表项指向这一块</p>
</li>
<li>
<p>可以基于固定大小的块；也可以基于大小可变的分区</p>
<blockquote>
<p>基于块来分配可以消除外部碎片，而按大小可变的分区分配可以提高局部性。</p>
<p>在任何一种情况下，都需要不时地进行文件整理。在使用大小可变分区的情况下，文件整理可以减少索引的数量，但对于基于块的分配却不能减少索引的数量。</p>
</blockquote>
</li>
<li>
<p>支持顺序访问文件和直接访问文件，因而是最普遍的一种文件分配形式</p>
</li>
</ul>
<h3 id="空闲空间管理">空闲空间管理</h3>
<p>当前还未分配给任何文件的空间同样需要管理。</p>
<p>要实现文件分配技术，首先需要知道磁盘中的哪些块是可用的，除了上述提到的文件分配表（FAT），还需要<strong>磁盘分配表（Disk Allocation Table，DAT）</strong>。</p>
<p><strong>位表（Bit tables ）</strong>：</p>
<p>这种方法使用一个向量，向量的每一位对应于磁盘中的每一块。0表示空闲块，1表示已使用块。</p>
<ul>
<li>
<p>优点：</p>
<ul>
<li>
<p>通过它能相对容易地找到一个或一组连续的空闲块。（因此位表适用于前面描述的任何一种文件分配方法）</p>
</li>
<li>
<p>位表非常小，但其长度仍然很长。一个块位图所需的存储器容量为：<code>磁盘大小（字节数） / （8 × 文件系统块大小</code>）</p>
<blockquote>
<p>例如：对于一个块大小为512字节的16GB磁盘，位表会占用4MB的空间。</p>
</blockquote>
</li>
</ul>
</li>
</ul>
<p><strong>链式空闲区（Chained free portions）</strong>：</p>
<p>使用指向每个空闲区的指针和它们的长度值，可将空闲区链接在一起。</p>
<blockquote>
<ul>
<li>由于不需要磁盘分配表，而仅需要一个指向链的开始处的指针和第一个分区的长度，因而这种方法的空间开销可以忽略不计。</li>
<li>该方法适用于所有的文件分配方法。</li>
</ul>
</blockquote>
<h3 id="可靠性">可靠性</h3>
<p>使用锁来防止进程间干扰和空间分配一致性。</p>
<p>请求一个文件分配时：</p>
<ol>
<li>在磁盘中对磁盘分配表加锁，以防止在分配完成前另一个用户修改这个表。</li>
<li>查找磁盘分配表，查找可用空间。这里假设磁盘分配表的副本总在内存中，若不在，则须先读入。</li>
<li>分配空间，更新磁盘分配表，更新磁盘。更新磁盘包括把磁盘分配表写回磁盘。对于链式磁盘分配，它还包括更新磁盘中的某些指针。</li>
<li>更新文件分配表和更新磁盘。</li>
<li>对磁盘分配表解锁。</li>
</ol>
<hr>
<h1>后记</h1>
<p>本篇已完结</p>
<p><em>先告一段落喽，非常感谢授课老师的指导以及同学们的帮助。</em></p>
<p>（如有修改或补充欢迎评论）</p>
]]></content>
      <categories>
        <category>学习笔记</category>
      </categories>
      <tags>
        <tag>操作系统</tag>
      </tags>
  </entry>
  <entry>
    <title>操作系统学习笔记-线程、对称多处理（SMP）和微内核</title>
    <url>/2021/04/09/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E7%BA%BF%E7%A8%8B%E3%80%81%E5%AF%B9%E7%A7%B0%E5%A4%9A%E5%A4%84%E7%90%86%EF%BC%88SMP%EF%BC%89%E5%92%8C%E5%BE%AE%E5%86%85%E6%A0%B8/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\css\APlayer.min.css"><script src="\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\js\Meting.min.js"></script><h1>前言</h1>
<p><em>正在学习操作系统，记录笔记。</em></p>
<blockquote>
<p>参考资料：</p>
<p>《操作系统（精髓与设计原理 第6版） 》</p>
</blockquote>
<hr>
<h1>第四章：线程、对称多处理（SMP）和微内核</h1>
<h2 id="进程和线程">进程和线程</h2>
<h3 id="线程的引入">线程的引入</h3>
<p>上一章涉及到进程的两个特点：</p>
<ul>
<li>资源所有权（Resource ownership）：一个进程包括一个存放进程映像的虚拟地址空间。进程映像是程序、数据、栈和进程控制块中定义的属性的集合。（一个进程总是拥有对资源的控制或所有权）</li>
<li>调度/执行（Scheduling/Execution）：一个进程沿着通过一个或多个程序的一条执行路径（轨迹）执行。其执行过程可能与其他进程的执行过程交替进行。</li>
</ul>
<p>上述两个特点是独立的，因此操作系统可以独立地处理它们。为了区分这两个特点，分派的单位通常称做<strong>线程</strong>（thread）或<strong>轻量级进程</strong>（light weight process，LWP）；拥有资源所有权的单位通常仍称作<strong>进程</strong>（process）或<strong>任务</strong>（task）。</p>
<blockquote>
<p>进程的优势就是带来了并发的实现，可以提高计算机资源的利用率，但同时这也带来了问题：由于计算机的内存大小受限，并不可能开启任意数量的进程（并发度），如果这样操作，反而会降低计算机系统的运行效率。</p>
</blockquote>
<p>这里先用一个描述来通俗地理解何为线程：线程就是程序当中一个正在独立运行的函数。</p>
<blockquote>
<p>再来一个奇妙的比喻理解下为何要引入线程的概念，或者说线程的引入较进程提高计算机系统的运行效率有何不同：</p>
<p>作为一个早八🐶，每天起床的唯一动力就是肉包子。有一天突发奇想，我不要读书了，我要去校门口卖包子，于是说干就干，休学去校门口创业。好在天赋异禀，做得一手的好包子，生意那是蒸蒸日上，随着名气逐渐在学生间流传开来，每天的包子销量供不应求。我又重新累成🐶，但是为了提高包子的产量，我又想了两个办法：</p>
<ol>
<li>开连锁店，分摊销售压力。</li>
<li>只一家店不变，增派人手，每个人负责制作包子的不同流程。</li>
</ol>
<p>下面我们来分析一下这两种方案的优劣：</p>
<p>方案一，开连锁店。我需要再去找其他店铺，商量租金事宜，装修，招募店主，培训等等。这样是可以提高总体包子的产量，但是感觉稍微有“亿些”麻烦。我还得重新安排各种资源，想想看身为懒🐶的我，要不要考虑一下第二个方案。</p>
<p>方案二，不增设店铺，只招募人手，每个人负责不同的工作。我可以招募个早起买食材的人、和面的、处理食材的、做包子的等等，每个人专注于一个小任务。这样大家干起活来轻松愉快，既提升了包子的产量，又免去了方案一中安排各种资源的繁杂，💰💰💰💰还“哗哗”往腰包里流，岂不美哉。</p>
<p>方案一的实现就映射了“进程”的概念，虽然可以提高计算机系统的效率，但是会占用大量资源；方案二的实现就映射了“线程”的概念，不必分配大量的资源，只优化实现流程。</p>
</blockquote>
<h3 id="多线程（Multithreading）">多线程（Multithreading）</h3>
<p>多线程指的是操作系统在一个进程中支持多个线程执行（多个并发执行路径）的能力。</p>
<blockquote>
<p>Windows, Solaris, Linux, Mach, 以及 OS/2 都支持多线程。</p>
</blockquote>
<p>单线程（Single-Thread）：每个进程中只有一个线程在执行的传统方法。</p>
<blockquote>
<p>MS-DOS就是一个支持单用户进程和单线程的操作系统的例子。</p>
<p>一些版本的UNIX操作系统支持多用户进程，但只支持每个进程一个线程。</p>
<p>Java的运行环境（JVM）是单进程多线程的一个例子。</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E8%BF%9B%E7%A8%8B%E5%92%8C%E7%BA%BF%E7%A8%8B.png" alt=""></p>
<p>进程与线程的差异：</p>
<p>我们可以从本文最开始的文字去区分进程与线程，即：</p>
<ul>
<li>
<p>进程：资源分配和保护的单位。</p>
<ul>
<li>有一个虚拟地址空间（virtual address space），用来存放进程映像。（包括：数据、代码、栈和PCB）</li>
<li>受保护地对处理器、其他进程（用于进程间通信）、文件和I/O资源（设备和通道）的访问。</li>
<li>每个进程包含一个或多个线程。</li>
</ul>
</li>
<li>
<p>线程：执行/调度的单位。每个线程都包含：</p>
<ul>
<li>线程执行状态（运行、就绪等）</li>
<li>在未运行时保存的线程上下文（从某种意义上来看，线程可以被看做进程内的一个被独立地操作的程序计数器）</li>
<li>一个执行栈</li>
<li>用于每个线程局部变量的静态存储空间</li>
<li>与进程内的其他线程共享的对该进程的内存和资源的访问。</li>
</ul>
<blockquote>
<p>如下图为单线程和多线程的进程模型</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E8%BF%9B%E7%A8%8B%E6%A8%A1%E5%9E%8B.png" alt=""></p>
</blockquote>
</li>
</ul>
<p>线程的优点（简记为“4快”）：</p>
<ul>
<li>
<p>创建快：在一个已有进程中创建一个新线程比创建一个全新进程的时间要少许多。</p>
</li>
<li>
<p>结束快：终止一个线程比终止一个进程花费的时间少。</p>
</li>
<li>
<p>切换快：同一进程内线程间切换比进程间切换花费的时间少。</p>
</li>
<li>
<p>通信快：线程提高了不同的执行程序间通信的效率。由于在同一个进程中的线程共享内存和文件，因此它们无需调用内核就可以互相通信。</p>
<blockquote>
<p>在大多数的操作系统中，独立进程间的通信需要内核的介入。</p>
</blockquote>
</li>
</ul>
<blockquote>
<p>如果一个应用程序或函数被实现为一组相关联的执行单位，那么用一组线程比用一组分离的进程更加有效。</p>
</blockquote>
<p>线程在单用户多处理系统（Single-User Multiprocessing System）中的应用：</p>
<ul>
<li>
<p>前/后台工作（Foreground to background work）：</p>
<p>例如：在电子表格中，一个线程可以显示菜单并读取用户输入，而另一个线程执行用户命令并更新电子表格。（这种方案允许程序在前一条命令完成前提示输入下一条命令，因而常常会使用户感觉到应用程序的响应速度有所提高）</p>
</li>
<li>
<p>异步处理（Asynchronous processing）：程序中的异步元素可以用线程实现。</p>
<p>例如：为避免掉电带来的损失，往往把文字处理程序（word 程序）设计成每隔一分钟将随机存取存储器（RAM）缓冲区中的数据写入磁盘一次。可以创建一个线程，其任务是周期性地进行备份，并且直接由操作系统调度该线程。</p>
</li>
<li>
<p>加速执行（Speed of execution）：一个多线程进程在计算这批数据的同时可以从设备读取下一批数据。</p>
<p>在多处理器系统中，同一个进程中的多个线程可以同时执行。这样，即便一个线程在读取数据时由于I/O操作被阻塞，另外一个线程仍然可以继续运行。</p>
</li>
<li>
<p>模块化程序结构（Modular program structure）：涉及多种活动或多种输入输出的源和目的地的程序更易于用线程设计和实现。</p>
</li>
</ul>
<p>进程的活动会影响线程：</p>
<ul>
<li>因为所有线程共享同一个地址空间，所以当一个进程被挂起，其中的所有线程都会被挂起。</li>
<li>进程的终止会导致进程中所有线程的终止。</li>
</ul>
<h3 id="线程的功能特性（Thread-Functionality）">线程的功能特性（Thread Functionality）</h3>
<p>和进程一样，线程具有执行状态，且可以相互之间进行同步。</p>
<p>执行状态（4种）：</p>
<ul>
<li>
<p>派生（Spawn）：在典型情况下，当派生一个新进程时，同时也为该进程派生了一个线程。随后，进程中的线程可以在同一个进程中派生另一个线程，并为新线程提供指令指针和参数；新线程拥有自己的寄存器上下文和栈空间，且被放置在就绪队列中。</p>
</li>
<li>
<p>阻塞（Block）：当线程需要等待一个事件时，它将被阻塞（保存它的用户寄存器、程序计数器和栈指针），此时处理器转而执行另一个处于同一进程中或不同进程中的就绪线程。</p>
</li>
<li>
<p>解除阻塞（Unblock）：当阻塞一个线程的事件发生时，该线程被转移到就绪队列中。</p>
</li>
<li>
<p>结束（Finish）：当一个线程完成时，其寄存器上下文和栈都被释放。</p>
<blockquote>
<p>我们以一个例子来分析多线程的性能获益（暂且考虑线程不会阻塞的情况）：如下图展示，一个执行了两个远程过程调用（RPC）的程序，这两个调用分别涉及两个不同的主机，用于获得一个组合的结果。</p>
<ul>
<li>
<p>在单线程程序中，其结果是按顺序获得的，因此程序必须依次等待来自每个服务器的响应。</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E5%8D%95%E7%BA%BF%E7%A8%8B.png" alt=""></p>
</li>
<li>
<p>如果重写这个程序，为每个RPC使用一个独立的线程，可以使速度得到实质性的提高。</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E5%A4%9A%E7%BA%BF%E7%A8%8B.png" alt=""></p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E5%9B%BE%E6%B3%A8.png" alt=""></p>
</li>
<li>
<p>需要注意的是：如果这个程序在单处理器上运行，那么必须顺序地产生请求并且顺序地处理结果，但是对两个应答的等待是并发的。</p>
</li>
</ul>
<p>在单处理器中，多道程序设计使得在多个进程中的多个线程可以交替执行。在下图所示的例子中，两个进程中的三个线程在处理器中交替执行。在当前正在运行的线程阻塞或它的时间片用完时，执行传递到另一个线程。</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E7%BA%BF%E7%A8%8B%E4%BA%A4%E6%9B%BF%E8%BF%90%E8%A1%8C.png" alt=""></p>
</blockquote>
</li>
</ul>
<p>线程同步：</p>
<p>一个进程中的所有线程共享同一个地址空间和诸如打开的文件之类的其他资源。一个线程对资源的任何修改都会影响同一个进程中其他线程的环境。因此，需要同步各种线程的活动，以便它们互不干涉且不破坏数据结构。</p>
<h3 id="用户级和内核级线程（User-Level-and-Kernel-Level-Thread）">用户级和内核级线程（User-Level and Kernel-Level Thread）</h3>
<p>线程的实现可以分为两大类：用户级线程（User-Level Thread，ULT）和内核级线程（Kernel-Level Thread，KLT）。后者又称做内核支持的线程或轻量级进程。</p>
<ul>
<li>
<p>用户级线程（User-Level Thread，ULT）</p>
<ul>
<li>
<p>在一个纯粹的用户级线程软件中，有关线程管理的所有工作都由应用程序完成。</p>
</li>
<li>
<p>内核意识不到线程的存在</p>
</li>
<li>
<p>任何应用程序都可以通过使用线程库被设计成多线程程序。</p>
<blockquote>
<p>线程库是用于用户级线程管理的一个例程包，它包含用于创建和销毁线程的代码、在线程间传递消息和数据代码、调度线程执行的代码以及保存和恢复线程上下文的代码。</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E7%BA%AF%E7%B2%B9%E7%9A%84%E7%94%A8%E6%88%B7%E7%BA%A7%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F.png" alt=""></p>
<p>以下图为例展示用户级线程状态和进程状态间的关系：假设进程B在它的线程2中执行。</p>
<ol>
<li>
<p>（如图b）线程2中执行的应用程序进行系统调用，阻塞了进程B。例如，进行一次I/O调用。这导致控制转移到内核，内核启动I/O操作，把进程B置于阻塞状态，并切换到另一个进程。在此期间，根据线程库维护的数据结构，进程B的线程2仍处于运行态。</p>
<blockquote>
<p>值得注意的是，从在处理器上执行的角度看，线程2实际上并不处于运行态，但是在线程库看来，它处于运行态。</p>
</blockquote>
</li>
<li>
<p>（如图c）时钟中断把控制传递给内核，内核确定当前正在运行的进程（B）已经用完了它的时间片。内核把进程B置于就绪态并切换到另一个进程。同时，根据线程库维护的数据结构，进程B的线程2仍处于运行态。</p>
</li>
<li>
<p>（如图d）线程2运行到需要进程B的线程1执行某些动作的一个点。此时，线程2进入阻塞态，而线程1从就绪态转换到运行态，进程自身保留在运行态。</p>
</li>
</ol>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E7%94%A8%E6%88%B7%E7%BA%A7%E7%BA%BF%E7%A8%8B%E7%8A%B6%E6%80%81%E5%92%8C%E8%BF%9B%E7%A8%8B%E7%8A%B6%E6%80%81%E7%9A%84%E5%85%B3%E7%B3%BB.png" alt=""></p>
</li>
</ul>
</li>
<li>
<p>内核级线程（Kernel-Level Thread，KLT）：</p>
<ul>
<li>
<p>在一个纯粹的内核级线程软件中，有关线程管理的所有工作都是由内核完成的。</p>
</li>
<li>
<p>内核为进程及其内部的每个线程维护上下文信息。</p>
</li>
<li>
<p>调度是由内核以线程为单位完成的。</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E5%86%85%E6%A0%B8%E7%BA%A7%E7%BA%BF%E7%A8%8B.png" alt=""></p>
</li>
</ul>
</li>
</ul>
<p>两种线程的比较：</p>
<ul>
<li>
<p>用户级较内核级线程的优点：</p>
<ul>
<li>
<p>减少模式的切换</p>
<blockquote>
<p>由于所有线程管理数据结构都在一个进程的用户地址空间中，线程切换不需要内核态特权，因此，进程不需要为了线程管理而切换到内核态，这节省了两次状态转换（从用户态到内核态；从内核态返回到用户态）的开销。</p>
</blockquote>
</li>
<li>
<p>调度可以为应用程序所专用</p>
<blockquote>
<p>一个应用程序可能更适合简单的轮转调度算法，而另一个应用程序可能更适合基于优先级的调度算法。可以做到为应用程序量身定做调度算法而不扰乱底层的操作系统调度程序。</p>
</blockquote>
</li>
<li>
<p>用户级线程可以在任何操作系统中运行</p>
<blockquote>
<p>不需要对底层内核进行修改以支持用户级线程。线程库是一组供所有应用程序共享的应用程序级别的函数。</p>
</blockquote>
</li>
</ul>
</li>
<li>
<p>用户级较内核级线程的缺点：</p>
<ul>
<li>
<p>一个线程被阻塞，该进程的所有其他线程都将被阻塞。</p>
</li>
<li>
<p>在纯粹的用户级线程策略中，一个多线程应用程序不能利用多处理技术。</p>
<blockquote>
<p>内核一次只把一个进程分配给一个处理器，因此一个进程中只有一个线程可以执行。</p>
</blockquote>
<blockquote>
<p>现在已有两个办法可以解决上述两个缺陷：</p>
<ul>
<li>把应用程序写成一个多进程程序，而非多线程。</li>
<li>Jacketing技术（无阻塞调用）：把一个产生阻塞的系统调用转化成一个非阻塞的系统调用。</li>
</ul>
</blockquote>
</li>
</ul>
</li>
<li>
<p>内核级较用户级线程的优点：（克服了用户级线程的两个缺陷）</p>
<ul>
<li>进程中的多个线程可以同时在多个处理器上运行（由内核调度）。</li>
<li>一个线程被阻塞不会使同一进程内的其他线程被阻塞。</li>
<li>内核例程自身也可以使用多线程。</li>
</ul>
</li>
<li>
<p>内核级较用户级线程的缺点：</p>
<ul>
<li>在把控制从一个线程传送到同一个进程内的另一个线程时，需要到内核的状态切换。</li>
</ul>
</li>
</ul>
<p>下图给出了在单处理器VAX机上运行类UNIX操作系统的测量结果：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E6%AF%94%E8%BE%83%E8%A1%A8.png" alt=""></p>
<blockquote>
<p>可以看出用户级线程和内核级线程之间、内核级线程和进程之间都有一个数量级以上的性能差距。</p>
</blockquote>
<p>用户级与内核级的组合方法：</p>
<ul>
<li>
<p>线程创建完全在用户空间中完成。</p>
</li>
<li>
<p>线程的调度和同步在应用程序中进行。</p>
</li>
<li>
<p>在用组合方法的操作系统中，Solaris是一个很好的例子。（当前版本的Solaris限制用户级线程/内核级线程的关系仅仅能为1：1的关系）</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E7%BB%84%E5%90%88%E6%96%B9%E6%B3%95.png" alt=""></p>
</li>
</ul>
<h2 id="对称多处理（Symmetric-Multiprocessing）">对称多处理（Symmetric Multiprocessing）</h2>
<h3 id="SMP体系结构">SMP体系结构</h3>
<p>分为以下4类：</p>
<ul>
<li>
<p>单指令单数据流（SISD）：单处理器执行单个指令流，对保存在单个内存中的数据进行操作。</p>
</li>
<li>
<p>单指令多数据流（SIMD）：每条指令由不同的处理器在不同的数据集合上执行。（向量和阵列处理器都属于这一类。）</p>
</li>
<li>
<p>多指令单数据流（MISD）：一系列数据被传送到一组处理器上，每个处理器执行不同的指令序列。（这个结构从未实现过）</p>
</li>
<li>
<p>多指令多数据流（MIMD）：一组处理器同时在不同的数据集上执行不同的指令序列。</p>
<blockquote>
<p>SIMD和MIMD是主流模式，现代计算机基本都能够实现MIMD。</p>
</blockquote>
</li>
</ul>
<p>下图展示了并行处理器的体系结构：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E5%B9%B6%E8%A1%8C%E5%A4%84%E7%90%86%E5%99%A8%E7%9A%84%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84.png" alt=""></p>
<p><strong>集群（cluster）</strong>：</p>
<p>如果每个处理器都有一个专用内存，那么每个处理部件都可以被看做一个独立的计算机。计算机间的通信或者借助于固定的路径，或者借助于某些网络设施，这类系统称做<strong>集群（cluster）</strong>，或者多计算机系统。</p>
<p>如果处理器共享一个公用内存，每个处理器都访问保存在共享内存中的程序和数据，处理器之间通过该内存互相通信，则这类系统称为<strong>共享内存多处理器</strong>系统。</p>
<blockquote>
<p>共享内存多处理器系统的一个常用的分类是基于如何把进程分配给处理器。最基本的两种方法是主/从（Master/Slave）和对称多处理（SMP）。</p>
<p>关于主/从结构：</p>
<p>在主/从结构中，操作系统内核总是在某个特定的处理器上运行，其他处理器只用于执行用户程序，还可能执行一些操作系统实用程序。主处理器负责调度进程或线程。当一个进程/线程是活跃时，如果从处理器需要服务（如一次I/O调用），它必须给主处理器发送请求，并等待服务的执行。一个处理器控制了所有的内存和I/O资源。这是很简单的方法，但是会有它的缺陷：</p>
<ul>
<li>主处理器的失效将导致整个系统失效。</li>
<li>由于主处理器必须单独完成所有的调度和进程管理，它可能成为性能瓶颈。</li>
</ul>
</blockquote>
<p>对称多处理（Symmetric Multiprocessing）系统：</p>
<ul>
<li>内核可以在任何处理器上执行。</li>
<li>每个处理器从可用的进程或线程池中进行自己的调度工作。</li>
</ul>
<h3 id="SMP系统的组织结构（SMP-Organization）">SMP系统的组织结构（SMP Organization）</h3>
<p>（如下图）SMP中有多个处理器，每个都含有它自己的控制单元、算术逻辑单元和寄存器；每个处理器都可以通过某种形式的互连机制访问一个共享内存和1/O设备；共享总线就是一个通用方法。处理器可以通过内存（留在共享地址空间中的消息和状态信息）互相通信，还可以直接交换信号。内存通常被组织成允许同时有多个对内存不同独立部分的访问。</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OSSMP%E7%BB%84%E7%BB%87%E7%BB%93%E6%9E%84.png" alt=""></p>
<blockquote>
<p>在现代计算机中，处理器通常至少有专用的一级高速缓存。</p>
</blockquote>
<h3 id="多处理操作系统设计的注意事项">多处理操作系统设计的注意事项</h3>
<ul>
<li>
<p>同时的并发进程或线程（Simultaneous concurrent processes or threads）：</p>
<p>为允许多个处理器同时执行相同的内核代码，内核例程必须是可重入的（reentrant）。多个处理器执行内核的相同或不相同部分时，必须对内核表和管理结构进行合适的管理，以避免死锁或非法操作。</p>
</li>
<li>
<p>调度（Scheduling）：</p>
<p>调度可以由任何处理器执行，因此必须避免冲突。如果使用了内核级多线程，则可能出现在多个处理器上同时从同一个进程中调度多个线程的机会。</p>
</li>
<li>
<p>同步（Synchronization）：</p>
<p>因为多个活动进程都可能访问共享地址空间或共享I/O资源，因而需注意提供有效的同步。同步是保证互斥和事件排序的机制。（锁（lock）是多处理器操作系统中一个通用的同步机制）</p>
</li>
<li>
<p>存储管理（Memory management）：</p>
<p>多处理器上的存储管理必须处理在单处理器机器上发现的所有问题。此外，为达到最佳性能，操作系统需要尽可能地利用硬件并行性，如多端口内存；还必须协调不同处理器上的分页机制，以保证当多个处理器共享页或段时页面的一致性，以及决定页面置换的策略。</p>
</li>
<li>
<p>可靠性和容错（Reliability and fault tolerance）：</p>
<p>当处理器失效时，操作系统应该提供适当的功能降低。调度程序和操作系统的其他部分必须知道处理器的失效情况，并且据此重新组织管理表。</p>
</li>
</ul>
<h2 id="微内核（Microkernel）">微内核（Microkernel）</h2>
<p>微内核是一个小型的操作系统核心，它为模块化扩展提供基础。</p>
<p>为了更好地掌握微内核的出现，我们先来了解一下<strong>分层内核</strong>的概念：</p>
<p>早期的操作系统开发很少考虑到结构问题，一般我们称之为<strong>单体结构的操作系统</strong>，其内部耦合度很高（任何过程实际上都可以调用任何别的过程）。逐渐地，操作系统规模越来越大，这种单体结构无法支撑（开发和维护起来太过复杂），于是就出现了<strong>分层的操作系统</strong>（如下图），所有功能按层次组织，只在相邻层之间发生交互。</p>
<p>但是分层方法也有问题：每层都处理相当多的功能，一层中的大的变化可能会对相邻层（上一层或下一层）中的代码产生巨大的影响，这些影响跟踪起来有很多困难。其结果是，在基本操作系统上很难通过增加或减少一些功能实现一个专用版本，而且由于在相邻层之间有很多交互，因而很难保证安全性。</p>
<blockquote>
<p>在分层方法中，大多数层或所有层都在内核态下执行。</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E5%88%86%E5%B1%82%E7%9A%84%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F.png" alt=""></p>
<p>于是，就引入了微内核的概念。</p>
<h3 id="微内核体系结构（Microkernel-Architecture）">微内核体系结构（Microkernel Architecture）</h3>
<ul>
<li>
<p>小型操作系统核心。</p>
</li>
<li>
<p>只将最基本的操作系统功能放于内核中。</p>
</li>
<li>
<p>许多传统上属于操作系统一部分的功能现在都是外部子系统。（包括设备驱动程序、文件系统、虚存管理程序、窗口系统和安全服务。它们可以与内核交互，也可以相互交互）</p>
</li>
<li>
<p>非基本的服务和应用程序在微内核之上构造，并在用户态下执行。</p>
<blockquote>
<p>相对的内核称为<strong>单体内核（monolithic kernel）</strong></p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E5%BE%AE%E5%86%85%E6%A0%B8%E7%BB%93%E6%9E%84.png" alt=""></p>
<blockquote>
<p>微内核结构用一个水平分层的结构代替了传统的纵向分层的结构。</p>
</blockquote>
</li>
</ul>
<h3 id="微内核组织结构的优点（Benefits-of-a-Microkernel-Organization）">微内核组织结构的优点（Benefits of a Microkernel Organization）</h3>
<ul>
<li>
<p>一致接口（Uniform interface）：</p>
<ul>
<li>进程不需要区分是内核级服务还是用户级服务。</li>
<li>所有服务都是通过消息传递提供的。</li>
</ul>
</li>
<li>
<p>可扩展性（Extensibility）：</p>
<ul>
<li>允许增加新的服务</li>
</ul>
</li>
<li>
<p>灵活性（Flexibility）：</p>
<ul>
<li>可以在操作系统中增加新的功能。</li>
<li>可以删减现有的功能。</li>
</ul>
</li>
<li>
<p>可移植性（Portability）：</p>
<p>将操作系统移植到新的处理器时只需改变微内核中的内容，而不用改变其他服务。</p>
</li>
<li>
<p>可靠性（Reliability）：</p>
<ul>
<li>模块化设计。</li>
<li>小的微内核可以被严格地测试。</li>
</ul>
</li>
<li>
<p>分布式系统支持（Distributed system support ）：</p>
<ul>
<li>
<p>进程可以在不知道目标服务驻留在哪个机器上的情况下发送信息。</p>
<blockquote>
<p>当客户端往一个服务器进程发送消息时，该消息必须包含所请求服务的标识符。如果分布式系统（如集群）被配置为所有的进程和服务都具有唯一的标识符，那么实际上在微内核级别上可以看做只有一个单独的系统映像。</p>
</blockquote>
</li>
</ul>
</li>
<li>
<p>对面向对象操作系统支持（Object-oriented operating system ）：</p>
<ul>
<li>构件是具有明确定义的接口的对象，可以以搭积木的方式通过互连构造软件，构件中的所有交互都使用构件接口。</li>
</ul>
</li>
</ul>
<h3 id="微内核性能（Microkernel-Performance）">微内核性能（Microkernel Performance）</h3>
<p>经常提到，微内核的一个潜在缺点是性能问题。</p>
<blockquote>
<p>通过微内核构造和发送信息、接受应答并解码所花费的时间比进行一次系统调用的时间要多。但是，由于别的因素的作用，很难概括出是否有性能损失以及损失了多少。</p>
</blockquote>
<p>不论对微内核如何优化，上述问题（损失）依旧是存在的。</p>
<p>针对这种问题，其中一个方法是：把一些关键的服务程序和驱动程序重新放回操作系统，这将增大微内核。（回退）</p>
<p>另一种办法是让微内核变得更小：[LIED96b]表明，通过正确的设计，一个非常小的微内核可以消除性能损失并提高灵活性和可靠性。</p>
<h3 id="微内核设计（Microkernel-Design）">微内核设计（Microkernel Design）</h3>
<p>微内核必须包括直接依赖于硬件的功能，以及那些支持服务程序和应用程序在用户态下运行的功能。这些功能通常可分为以下几类：低级存储管理（Low-level memory management）、进程间通信（Interprocess communication / IPC）以及I/O和中断管理（I/O and interrupt management ）。</p>
<ul>
<li>
<p>低级存储管理（Low-level memory management）：</p>
<p>微内核必须控制硬件概念上的地址空间，使得操作系统可以在进程级实现保护。微内核只负责把每个虚拟页映射到一个物理页框。</p>
<blockquote>
<p>存储管理的大部分功能，包括保护一个进程的地址空间免于另一个进程的干涉，页面置换算法以及其他分页逻辑都可以在内核外实现。</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E7%BC%BA%E9%A1%B5%E4%B8%AD%E6%96%AD%E5%A4%84%E7%90%86.png" alt=""></p>
</li>
<li>
<p>进程间通信（Interprocess communication）：</p>
<p>微内核操作系统中进程之间或线程之间进行通信的基本形式是消息。</p>
<blockquote>
<p>消息由消息头和消息体组成，消息头描述了发送消息和接收消息的进程；消息体中含有数据，或者是指向一个数据块的指针，或者是关于进程的某些控制信息。</p>
</blockquote>
<ul>
<li>消息（Message）</li>
<li>端口（Port）</li>
<li>基于线程的IPC（Thread-based IPC）</li>
<li>共享内存（Memory-sharing）</li>
</ul>
</li>
<li>
<p>I/O和中断管理（I/O and interrupt management ）：</p>
<p>在微内核结构中，可以做到以消息的方式处理硬件中断和把I/O端口包含到地址空间中。微内核可以识别中断但不处理中断，它产生一条消息给与该中断相关联的用户级进程。</p>
<blockquote>
<p>当允许一个中断时，一个特定的用户级进程被指派给这个中断，并且由内核维护这个映射。</p>
<p>把中断转换成消息的工作必须由微内核完成，但是微内核并不涉及设备专用的中断处理。</p>
</blockquote>
<blockquote>
<p>[LIED96a]提出把硬件看做一组具有唯一标识符的线程，并给用户空间中相关的软件线程发送消息（仅包含线程ID号）。接收线程确定消息是否来自一个中断，并确定具体是哪个中断。这类用户级代码的通用结构如下：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E4%B8%AD%E6%96%AD%E9%80%9A%E7%94%A8%E7%BB%93%E6%9E%84.png" alt=""></p>
</blockquote>
</li>
</ul>
<hr>
<h1>后记</h1>
<p>本篇已完结</p>
<p>（如有修改或补充欢迎评论）</p>
]]></content>
      <categories>
        <category>学习笔记</category>
      </categories>
      <tags>
        <tag>操作系统</tag>
      </tags>
  </entry>
  <entry>
    <title>CSS选择器</title>
    <url>/2021/09/26/CSS/CSS%E9%80%89%E6%8B%A9%E5%99%A8/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\css\APlayer.min.css"><script src="\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\js\Meting.min.js"></script><h1>前言</h1>
<p>本文将介绍基本的CSS选择器使用方法。</p>
<hr>
<h1>CSS选择器</h1>
<p>CSS选择器主要可以分为两大类：</p>
<ul>
<li>基础标签器</li>
<li>复合选择器</li>
</ul>
<p>除了基于HTML标签的属性选择元素，还有一些特殊的选择器：</p>
<ul>
<li>伪类选择器</li>
<li>伪元素选择器</li>
</ul>
<p>下面来逐一介绍。</p>
<h2 id="基础标签器">基础标签器</h2>
<h3 id="元素选择器">元素选择器</h3>
<p>直接选择元素标签</p>
<p>格式：<code>element</code></p>
<p>示例：选择所有的<code>&lt;div&gt;</code>标签，将其文本内容设置倾斜样式</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h2</span> <span class="attr">class</span>=<span class="string">&quot;title&quot;</span> <span class="attr">id</span>=<span class="string">&quot;title&quot;</span> <span class="attr">title</span>&gt;</span>面朝大海，春暖花开<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;author&quot;</span> <span class="attr">id</span>=<span class="string">&quot;author&quot;</span>&gt;</span>海子<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;para1&quot;</span> <span class="attr">id</span>=<span class="string">&quot;para1&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;red&quot;</span> <span class="attr">id</span>=<span class="string">&quot;red1&quot;</span>&gt;</span>从明天起，做一个幸福的人<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;red&quot;</span> <span class="attr">id</span>=<span class="string">&quot;red2&quot;</span>&gt;</span>喂马，劈柴，周游世界<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;orange&quot;</span> <span class="attr">id</span>=<span class="string">&quot;orange1&quot;</span>&gt;</span>从明天起，关心粮食和蔬菜<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;orange&quot;</span> <span class="attr">id</span>=<span class="string">&quot;orange2&quot;</span>&gt;</span>我有一所房子，面朝大海，春暖花开<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;para2&quot;</span> <span class="attr">id</span>=<span class="string">&quot;para2&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;yellow&quot;</span> <span class="attr">id</span>=<span class="string">&quot;yellow1&quot;</span>&gt;</span>从明天起，和每一个亲人通信<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;yellow&quot;</span> <span class="attr">id</span>=<span class="string">&quot;yellow2&quot;</span>&gt;</span>告诉他们我的幸福<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;green&quot;</span> <span class="attr">id</span>=<span class="string">&quot;green1&quot;</span>&gt;</span>那幸福的闪电告诉我的<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;green&quot;</span> <span class="attr">id</span>=<span class="string">&quot;green2&quot;</span>&gt;</span>我将告诉每一个人<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;para3&quot;</span> <span class="attr">id</span>=<span class="string">&quot;para3&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;cyan&quot;</span> <span class="attr">id</span>=<span class="string">&quot;cyan1&quot;</span>&gt;</span>给每一条河每一座山取一个温暖的名字<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;cyan&quot;</span> <span class="attr">id</span>=<span class="string">&quot;cyan2&quot;</span>&gt;</span>陌生人，我也为你祝福<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;blue&quot;</span> <span class="attr">id</span>=<span class="string">&quot;blue1&quot;</span>&gt;</span>愿你有一个灿烂的前程<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;blue&quot;</span> <span class="attr">id</span>=<span class="string">&quot;blue2&quot;</span>&gt;</span>愿你有情人终成眷属<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;purple&quot;</span> <span class="attr">id</span>=<span class="string">&quot;purple1&quot;</span>&gt;</span>愿你在尘世获得幸福<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;purple&quot;</span> <span class="attr">id</span>=<span class="string">&quot;purple2&quot;</span>&gt;</span>我只愿面朝大海，春暖花开<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">div</span>&#123;</span><br><span class="line">  <span class="attribute">font-style</span>: italic;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>效果如下：</p>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/css元素选择器.png" style="zoom: 67%;" />
<h3 id="类选择器">类选择器</h3>
<p>根据class属性选择元素</p>
<p>格式：<code>.class</code></p>
<p>示例：将第三段（<code>class=para3</code>）的文本内容加粗</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h2</span> <span class="attr">class</span>=<span class="string">&quot;title&quot;</span> <span class="attr">id</span>=<span class="string">&quot;title&quot;</span> <span class="attr">title</span>&gt;</span>面朝大海，春暖花开<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;author&quot;</span> <span class="attr">id</span>=<span class="string">&quot;author&quot;</span>&gt;</span>海子<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;para1&quot;</span> <span class="attr">id</span>=<span class="string">&quot;para1&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;red&quot;</span> <span class="attr">id</span>=<span class="string">&quot;red1&quot;</span>&gt;</span>从明天起，做一个幸福的人<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;red&quot;</span> <span class="attr">id</span>=<span class="string">&quot;red2&quot;</span>&gt;</span>喂马，劈柴，周游世界<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;orange&quot;</span> <span class="attr">id</span>=<span class="string">&quot;orange1&quot;</span>&gt;</span>从明天起，关心粮食和蔬菜<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;orange&quot;</span> <span class="attr">id</span>=<span class="string">&quot;orange2&quot;</span>&gt;</span>我有一所房子，面朝大海，春暖花开<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;para2&quot;</span> <span class="attr">id</span>=<span class="string">&quot;para2&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;yellow&quot;</span> <span class="attr">id</span>=<span class="string">&quot;yellow1&quot;</span>&gt;</span>从明天起，和每一个亲人通信<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;yellow&quot;</span> <span class="attr">id</span>=<span class="string">&quot;yellow2&quot;</span>&gt;</span>告诉他们我的幸福<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;green&quot;</span> <span class="attr">id</span>=<span class="string">&quot;green1&quot;</span>&gt;</span>那幸福的闪电告诉我的<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;green&quot;</span> <span class="attr">id</span>=<span class="string">&quot;green2&quot;</span>&gt;</span>我将告诉每一个人<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;para3&quot;</span> <span class="attr">id</span>=<span class="string">&quot;para3&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;cyan&quot;</span> <span class="attr">id</span>=<span class="string">&quot;cyan1&quot;</span>&gt;</span>给每一条河每一座山取一个温暖的名字<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;cyan&quot;</span> <span class="attr">id</span>=<span class="string">&quot;cyan2&quot;</span>&gt;</span>陌生人，我也为你祝福<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;blue&quot;</span> <span class="attr">id</span>=<span class="string">&quot;blue1&quot;</span>&gt;</span>愿你有一个灿烂的前程<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;blue&quot;</span> <span class="attr">id</span>=<span class="string">&quot;blue2&quot;</span>&gt;</span>愿你有情人终成眷属<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;purple&quot;</span> <span class="attr">id</span>=<span class="string">&quot;purple1&quot;</span>&gt;</span>愿你在尘世获得幸福<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;purple&quot;</span> <span class="attr">id</span>=<span class="string">&quot;purple2&quot;</span>&gt;</span>我只愿面朝大海，春暖花开<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.para3</span>&#123;</span><br><span class="line">  <span class="attribute">font-weight</span>: bolder;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>效果如下：</p>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/css类选择器.png" style="zoom:67%;" />
<h3 id="ID选择器">ID选择器</h3>
<p>根据唯一的id值选择对应的元素</p>
<p>格式：<code>#id</code></p>
<p>示例：将第二段（<code>id=para2</code>）的文本增加下划线</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h2</span> <span class="attr">class</span>=<span class="string">&quot;title&quot;</span> <span class="attr">id</span>=<span class="string">&quot;title&quot;</span> <span class="attr">title</span>&gt;</span>面朝大海，春暖花开<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;author&quot;</span> <span class="attr">id</span>=<span class="string">&quot;author&quot;</span>&gt;</span>海子<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;para1&quot;</span> <span class="attr">id</span>=<span class="string">&quot;para1&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;red&quot;</span> <span class="attr">id</span>=<span class="string">&quot;red1&quot;</span>&gt;</span>从明天起，做一个幸福的人<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;red&quot;</span> <span class="attr">id</span>=<span class="string">&quot;red2&quot;</span>&gt;</span>喂马，劈柴，周游世界<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;orange&quot;</span> <span class="attr">id</span>=<span class="string">&quot;orange1&quot;</span>&gt;</span>从明天起，关心粮食和蔬菜<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;orange&quot;</span> <span class="attr">id</span>=<span class="string">&quot;orange2&quot;</span>&gt;</span>我有一所房子，面朝大海，春暖花开<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;para2&quot;</span> <span class="attr">id</span>=<span class="string">&quot;para2&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;yellow&quot;</span> <span class="attr">id</span>=<span class="string">&quot;yellow1&quot;</span>&gt;</span>从明天起，和每一个亲人通信<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;yellow&quot;</span> <span class="attr">id</span>=<span class="string">&quot;yellow2&quot;</span>&gt;</span>告诉他们我的幸福<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;green&quot;</span> <span class="attr">id</span>=<span class="string">&quot;green1&quot;</span>&gt;</span>那幸福的闪电告诉我的<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;green&quot;</span> <span class="attr">id</span>=<span class="string">&quot;green2&quot;</span>&gt;</span>我将告诉每一个人<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;para3&quot;</span> <span class="attr">id</span>=<span class="string">&quot;para3&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;cyan&quot;</span> <span class="attr">id</span>=<span class="string">&quot;cyan1&quot;</span>&gt;</span>给每一条河每一座山取一个温暖的名字<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;cyan&quot;</span> <span class="attr">id</span>=<span class="string">&quot;cyan2&quot;</span>&gt;</span>陌生人，我也为你祝福<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;blue&quot;</span> <span class="attr">id</span>=<span class="string">&quot;blue1&quot;</span>&gt;</span>愿你有一个灿烂的前程<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;blue&quot;</span> <span class="attr">id</span>=<span class="string">&quot;blue2&quot;</span>&gt;</span>愿你有情人终成眷属<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;purple&quot;</span> <span class="attr">id</span>=<span class="string">&quot;purple1&quot;</span>&gt;</span>愿你在尘世获得幸福<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;purple&quot;</span> <span class="attr">id</span>=<span class="string">&quot;purple2&quot;</span>&gt;</span>我只愿面朝大海，春暖花开<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-id">#para2</span>&#123;</span><br><span class="line">  <span class="attribute">text-decoration</span>: underline;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>效果如下：</p>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/cssid选择器.png" style="zoom:67%;" />
<h3 id="通配符选择器">通配符选择器</h3>
<p>选择页面中所有元素（一般不使用）</p>
<p>格式：<code>*</code></p>
<p>示例：将所有内容增添下划线</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h2</span> <span class="attr">class</span>=<span class="string">&quot;title&quot;</span> <span class="attr">id</span>=<span class="string">&quot;title&quot;</span> <span class="attr">title</span>&gt;</span>面朝大海，春暖花开<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;author&quot;</span> <span class="attr">id</span>=<span class="string">&quot;author&quot;</span>&gt;</span>海子<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;para1&quot;</span> <span class="attr">id</span>=<span class="string">&quot;para1&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;red&quot;</span> <span class="attr">id</span>=<span class="string">&quot;red1&quot;</span>&gt;</span>从明天起，做一个幸福的人<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;red&quot;</span> <span class="attr">id</span>=<span class="string">&quot;red2&quot;</span>&gt;</span>喂马，劈柴，周游世界<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;orange&quot;</span> <span class="attr">id</span>=<span class="string">&quot;orange1&quot;</span>&gt;</span>从明天起，关心粮食和蔬菜<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;orange&quot;</span> <span class="attr">id</span>=<span class="string">&quot;orange2&quot;</span>&gt;</span>我有一所房子，面朝大海，春暖花开<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;para2&quot;</span> <span class="attr">id</span>=<span class="string">&quot;para2&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;yellow&quot;</span> <span class="attr">id</span>=<span class="string">&quot;yellow1&quot;</span>&gt;</span>从明天起，和每一个亲人通信<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;yellow&quot;</span> <span class="attr">id</span>=<span class="string">&quot;yellow2&quot;</span>&gt;</span>告诉他们我的幸福<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;green&quot;</span> <span class="attr">id</span>=<span class="string">&quot;green1&quot;</span>&gt;</span>那幸福的闪电告诉我的<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;green&quot;</span> <span class="attr">id</span>=<span class="string">&quot;green2&quot;</span>&gt;</span>我将告诉每一个人<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;para3&quot;</span> <span class="attr">id</span>=<span class="string">&quot;para3&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;cyan&quot;</span> <span class="attr">id</span>=<span class="string">&quot;cyan1&quot;</span>&gt;</span>给每一条河每一座山取一个温暖的名字<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;cyan&quot;</span> <span class="attr">id</span>=<span class="string">&quot;cyan2&quot;</span>&gt;</span>陌生人，我也为你祝福<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;blue&quot;</span> <span class="attr">id</span>=<span class="string">&quot;blue1&quot;</span>&gt;</span>愿你有一个灿烂的前程<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;blue&quot;</span> <span class="attr">id</span>=<span class="string">&quot;blue2&quot;</span>&gt;</span>愿你有情人终成眷属<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;purple&quot;</span> <span class="attr">id</span>=<span class="string">&quot;purple1&quot;</span>&gt;</span>愿你在尘世获得幸福<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;purple&quot;</span> <span class="attr">id</span>=<span class="string">&quot;purple2&quot;</span>&gt;</span>我只愿面朝大海，春暖花开<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">*&#123;</span><br><span class="line">  <span class="attribute">text-decoration</span>: underline;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>效果如下：</p>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/css通配符选择器.png" style="zoom:67%;" />
<h3 id="属性选择器">属性选择器</h3>
<p>可以根据元素的属性以及属性值来选择元素</p>
<div class="tabs" id="属性选择器"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#属性选择器-1">[属性名]</button></li><li class="tab"><button type="button" data-href="#属性选择器-2">[属性名="属性值"]</button></li><li class="tab"><button type="button" data-href="#属性选择器-3">[属性名*=部分属性值]</button></li><li class="tab"><button type="button" data-href="#属性选择器-4">[属性名^=以xx开头的属性值]</button></li><li class="tab"><button type="button" data-href="#属性选择器-5">[属性名$=以xx结尾的属性值]</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="属性选择器-1"><p>格式：<code>[attribute]</code></p>
<p>示例：将带有<code>title</code>属性的元素内容添加橙色阴影</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h2</span> <span class="attr">class</span>=<span class="string">&quot;title&quot;</span> <span class="attr">id</span>=<span class="string">&quot;title&quot;</span> <span class="attr">title</span>&gt;</span>面朝大海，春暖花开<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;author&quot;</span> <span class="attr">id</span>=<span class="string">&quot;author&quot;</span>&gt;</span>海子<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;para1&quot;</span> <span class="attr">id</span>=<span class="string">&quot;para1&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;red&quot;</span> <span class="attr">id</span>=<span class="string">&quot;red1&quot;</span>&gt;</span>从明天起，做一个幸福的人<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;red&quot;</span> <span class="attr">id</span>=<span class="string">&quot;red2&quot;</span>&gt;</span>喂马，劈柴，周游世界<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;orange&quot;</span> <span class="attr">id</span>=<span class="string">&quot;orange1&quot;</span>&gt;</span>从明天起，关心粮食和蔬菜<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;orange&quot;</span> <span class="attr">id</span>=<span class="string">&quot;orange2&quot;</span>&gt;</span>我有一所房子，面朝大海，春暖花开<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;para2&quot;</span> <span class="attr">id</span>=<span class="string">&quot;para2&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;yellow&quot;</span> <span class="attr">id</span>=<span class="string">&quot;yellow1&quot;</span>&gt;</span>从明天起，和每一个亲人通信<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;yellow&quot;</span> <span class="attr">id</span>=<span class="string">&quot;yellow2&quot;</span>&gt;</span>告诉他们我的幸福<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;green&quot;</span> <span class="attr">id</span>=<span class="string">&quot;green1&quot;</span>&gt;</span>那幸福的闪电告诉我的<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;green&quot;</span> <span class="attr">id</span>=<span class="string">&quot;green2&quot;</span>&gt;</span>我将告诉每一个人<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;para3&quot;</span> <span class="attr">id</span>=<span class="string">&quot;para3&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;cyan&quot;</span> <span class="attr">id</span>=<span class="string">&quot;cyan1&quot;</span>&gt;</span>给每一条河每一座山取一个温暖的名字<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;cyan&quot;</span> <span class="attr">id</span>=<span class="string">&quot;cyan2&quot;</span>&gt;</span>陌生人，我也为你祝福<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;blue&quot;</span> <span class="attr">id</span>=<span class="string">&quot;blue1&quot;</span>&gt;</span>愿你有一个灿烂的前程<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;blue&quot;</span> <span class="attr">id</span>=<span class="string">&quot;blue2&quot;</span>&gt;</span>愿你有情人终成眷属<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;purple&quot;</span> <span class="attr">id</span>=<span class="string">&quot;purple1&quot;</span>&gt;</span>愿你在尘世获得幸福<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;purple&quot;</span> <span class="attr">id</span>=<span class="string">&quot;purple2&quot;</span>&gt;</span>我只愿面朝大海，春暖花开<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-attr">[title]</span>&#123;</span><br><span class="line">  <span class="attribute">text-shadow</span>: <span class="number">0.1em</span> <span class="number">0.1em</span> <span class="number">0.2em</span> darkorange;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>效果如下：</p>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/css属性选择器1.png" style="zoom:67%;" /><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="属性选择器-2"><p>格式：<code>[attribute=value]</code></p>
<p>示例：将第一段（class属性值为para1）的文本内容添加蓝色阴影</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h2</span> <span class="attr">class</span>=<span class="string">&quot;title&quot;</span> <span class="attr">id</span>=<span class="string">&quot;title&quot;</span> <span class="attr">title</span>&gt;</span>面朝大海，春暖花开<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;author&quot;</span> <span class="attr">id</span>=<span class="string">&quot;author&quot;</span>&gt;</span>海子<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;para1&quot;</span> <span class="attr">id</span>=<span class="string">&quot;para1&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;red&quot;</span> <span class="attr">id</span>=<span class="string">&quot;red1&quot;</span>&gt;</span>从明天起，做一个幸福的人<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;red&quot;</span> <span class="attr">id</span>=<span class="string">&quot;red2&quot;</span>&gt;</span>喂马，劈柴，周游世界<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;orange&quot;</span> <span class="attr">id</span>=<span class="string">&quot;orange1&quot;</span>&gt;</span>从明天起，关心粮食和蔬菜<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;orange&quot;</span> <span class="attr">id</span>=<span class="string">&quot;orange2&quot;</span>&gt;</span>我有一所房子，面朝大海，春暖花开<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;para2&quot;</span> <span class="attr">id</span>=<span class="string">&quot;para2&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;yellow&quot;</span> <span class="attr">id</span>=<span class="string">&quot;yellow1&quot;</span>&gt;</span>从明天起，和每一个亲人通信<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;yellow&quot;</span> <span class="attr">id</span>=<span class="string">&quot;yellow2&quot;</span>&gt;</span>告诉他们我的幸福<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;green&quot;</span> <span class="attr">id</span>=<span class="string">&quot;green1&quot;</span>&gt;</span>那幸福的闪电告诉我的<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;green&quot;</span> <span class="attr">id</span>=<span class="string">&quot;green2&quot;</span>&gt;</span>我将告诉每一个人<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;para3&quot;</span> <span class="attr">id</span>=<span class="string">&quot;para3&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;cyan&quot;</span> <span class="attr">id</span>=<span class="string">&quot;cyan1&quot;</span>&gt;</span>给每一条河每一座山取一个温暖的名字<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;cyan&quot;</span> <span class="attr">id</span>=<span class="string">&quot;cyan2&quot;</span>&gt;</span>陌生人，我也为你祝福<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;blue&quot;</span> <span class="attr">id</span>=<span class="string">&quot;blue1&quot;</span>&gt;</span>愿你有一个灿烂的前程<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;blue&quot;</span> <span class="attr">id</span>=<span class="string">&quot;blue2&quot;</span>&gt;</span>愿你有情人终成眷属<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;purple&quot;</span> <span class="attr">id</span>=<span class="string">&quot;purple1&quot;</span>&gt;</span>愿你在尘世获得幸福<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;purple&quot;</span> <span class="attr">id</span>=<span class="string">&quot;purple2&quot;</span>&gt;</span>我只愿面朝大海，春暖花开<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-attr">[class=para1]</span>&#123;</span><br><span class="line">  <span class="attribute">text-shadow</span>: <span class="number">0.1em</span> <span class="number">0.1em</span> <span class="number">0.2em</span> blue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>效果如下：</p>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/css属性选择器2.png" style="zoom:67%;" /><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="属性选择器-3"><p>格式：<code>[attribute*=value]</code></p>
<p>示例：将class属性包含<code>para</code>值的元素内容添加绿色阴影</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h2</span> <span class="attr">class</span>=<span class="string">&quot;title&quot;</span> <span class="attr">id</span>=<span class="string">&quot;title&quot;</span> <span class="attr">title</span>&gt;</span>面朝大海，春暖花开<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;author&quot;</span> <span class="attr">id</span>=<span class="string">&quot;author&quot;</span>&gt;</span>海子<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;para1&quot;</span> <span class="attr">id</span>=<span class="string">&quot;para1&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;red&quot;</span> <span class="attr">id</span>=<span class="string">&quot;red1&quot;</span>&gt;</span>从明天起，做一个幸福的人<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;red&quot;</span> <span class="attr">id</span>=<span class="string">&quot;red2&quot;</span>&gt;</span>喂马，劈柴，周游世界<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;orange&quot;</span> <span class="attr">id</span>=<span class="string">&quot;orange1&quot;</span>&gt;</span>从明天起，关心粮食和蔬菜<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;orange&quot;</span> <span class="attr">id</span>=<span class="string">&quot;orange2&quot;</span>&gt;</span>我有一所房子，面朝大海，春暖花开<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;para2&quot;</span> <span class="attr">id</span>=<span class="string">&quot;para2&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;yellow&quot;</span> <span class="attr">id</span>=<span class="string">&quot;yellow1&quot;</span>&gt;</span>从明天起，和每一个亲人通信<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;yellow&quot;</span> <span class="attr">id</span>=<span class="string">&quot;yellow2&quot;</span>&gt;</span>告诉他们我的幸福<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;green&quot;</span> <span class="attr">id</span>=<span class="string">&quot;green1&quot;</span>&gt;</span>那幸福的闪电告诉我的<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;green&quot;</span> <span class="attr">id</span>=<span class="string">&quot;green2&quot;</span>&gt;</span>我将告诉每一个人<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;para3&quot;</span> <span class="attr">id</span>=<span class="string">&quot;para3&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;cyan&quot;</span> <span class="attr">id</span>=<span class="string">&quot;cyan1&quot;</span>&gt;</span>给每一条河每一座山取一个温暖的名字<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;cyan&quot;</span> <span class="attr">id</span>=<span class="string">&quot;cyan2&quot;</span>&gt;</span>陌生人，我也为你祝福<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;blue&quot;</span> <span class="attr">id</span>=<span class="string">&quot;blue1&quot;</span>&gt;</span>愿你有一个灿烂的前程<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;blue&quot;</span> <span class="attr">id</span>=<span class="string">&quot;blue2&quot;</span>&gt;</span>愿你有情人终成眷属<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;purple&quot;</span> <span class="attr">id</span>=<span class="string">&quot;purple1&quot;</span>&gt;</span>愿你在尘世获得幸福<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;purple&quot;</span> <span class="attr">id</span>=<span class="string">&quot;purple2&quot;</span>&gt;</span>我只愿面朝大海，春暖花开<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-attr">[class*=para]</span>&#123;</span><br><span class="line">  <span class="attribute">text-shadow</span>: <span class="number">0.1em</span> <span class="number">0.1em</span> <span class="number">0.2em</span> green;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>效果如下：</p>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/css属性选择器3.png" style="zoom:67%;" /><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="属性选择器-4"><p>格式：<code>[attribute^=value]</code></p>
<p>示例：将id属性以<code>pa</code>开头的元素内容添加黄色阴影</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h2</span> <span class="attr">class</span>=<span class="string">&quot;title&quot;</span> <span class="attr">id</span>=<span class="string">&quot;title&quot;</span> <span class="attr">title</span>&gt;</span>面朝大海，春暖花开<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;author&quot;</span> <span class="attr">id</span>=<span class="string">&quot;author&quot;</span>&gt;</span>海子<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;para1&quot;</span> <span class="attr">id</span>=<span class="string">&quot;para1&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;red&quot;</span> <span class="attr">id</span>=<span class="string">&quot;red1&quot;</span>&gt;</span>从明天起，做一个幸福的人<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;red&quot;</span> <span class="attr">id</span>=<span class="string">&quot;red2&quot;</span>&gt;</span>喂马，劈柴，周游世界<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;orange&quot;</span> <span class="attr">id</span>=<span class="string">&quot;orange1&quot;</span>&gt;</span>从明天起，关心粮食和蔬菜<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;orange&quot;</span> <span class="attr">id</span>=<span class="string">&quot;orange2&quot;</span>&gt;</span>我有一所房子，面朝大海，春暖花开<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;para2&quot;</span> <span class="attr">id</span>=<span class="string">&quot;para2&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;yellow&quot;</span> <span class="attr">id</span>=<span class="string">&quot;yellow1&quot;</span>&gt;</span>从明天起，和每一个亲人通信<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;yellow&quot;</span> <span class="attr">id</span>=<span class="string">&quot;yellow2&quot;</span>&gt;</span>告诉他们我的幸福<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;green&quot;</span> <span class="attr">id</span>=<span class="string">&quot;green1&quot;</span>&gt;</span>那幸福的闪电告诉我的<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;green&quot;</span> <span class="attr">id</span>=<span class="string">&quot;green2&quot;</span>&gt;</span>我将告诉每一个人<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;para3&quot;</span> <span class="attr">id</span>=<span class="string">&quot;para3&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;cyan&quot;</span> <span class="attr">id</span>=<span class="string">&quot;cyan1&quot;</span>&gt;</span>给每一条河每一座山取一个温暖的名字<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;cyan&quot;</span> <span class="attr">id</span>=<span class="string">&quot;cyan2&quot;</span>&gt;</span>陌生人，我也为你祝福<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;blue&quot;</span> <span class="attr">id</span>=<span class="string">&quot;blue1&quot;</span>&gt;</span>愿你有一个灿烂的前程<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;blue&quot;</span> <span class="attr">id</span>=<span class="string">&quot;blue2&quot;</span>&gt;</span>愿你有情人终成眷属<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;purple&quot;</span> <span class="attr">id</span>=<span class="string">&quot;purple1&quot;</span>&gt;</span>愿你在尘世获得幸福<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;purple&quot;</span> <span class="attr">id</span>=<span class="string">&quot;purple2&quot;</span>&gt;</span>我只愿面朝大海，春暖花开<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-attr">[id^=pa]</span>&#123;</span><br><span class="line">  <span class="attribute">text-shadow</span>: <span class="number">0.1em</span> <span class="number">0.1em</span> <span class="number">0.2em</span> yellow;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>效果如下：</p>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/css属性选择器4.png" style="zoom:67%;" /><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="属性选择器-5"><p>格式：<code>[attribute$=value]</code></p>
<p>示例：将id以<code>le</code>结尾的元素内容添加绿色边框</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h2</span> <span class="attr">class</span>=<span class="string">&quot;title&quot;</span> <span class="attr">id</span>=<span class="string">&quot;title&quot;</span> <span class="attr">title</span>&gt;</span>面朝大海，春暖花开<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;author&quot;</span> <span class="attr">id</span>=<span class="string">&quot;author&quot;</span>&gt;</span>海子<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;para1&quot;</span> <span class="attr">id</span>=<span class="string">&quot;para1&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;red&quot;</span> <span class="attr">id</span>=<span class="string">&quot;red1&quot;</span>&gt;</span>从明天起，做一个幸福的人<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;red&quot;</span> <span class="attr">id</span>=<span class="string">&quot;red2&quot;</span>&gt;</span>喂马，劈柴，周游世界<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;orange&quot;</span> <span class="attr">id</span>=<span class="string">&quot;orange1&quot;</span>&gt;</span>从明天起，关心粮食和蔬菜<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;orange&quot;</span> <span class="attr">id</span>=<span class="string">&quot;orange2&quot;</span>&gt;</span>我有一所房子，面朝大海，春暖花开<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;para2&quot;</span> <span class="attr">id</span>=<span class="string">&quot;para2&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;yellow&quot;</span> <span class="attr">id</span>=<span class="string">&quot;yellow1&quot;</span>&gt;</span>从明天起，和每一个亲人通信<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;yellow&quot;</span> <span class="attr">id</span>=<span class="string">&quot;yellow2&quot;</span>&gt;</span>告诉他们我的幸福<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;green&quot;</span> <span class="attr">id</span>=<span class="string">&quot;green1&quot;</span>&gt;</span>那幸福的闪电告诉我的<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;green&quot;</span> <span class="attr">id</span>=<span class="string">&quot;green2&quot;</span>&gt;</span>我将告诉每一个人<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;para3&quot;</span> <span class="attr">id</span>=<span class="string">&quot;para3&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;cyan&quot;</span> <span class="attr">id</span>=<span class="string">&quot;cyan1&quot;</span>&gt;</span>给每一条河每一座山取一个温暖的名字<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;cyan&quot;</span> <span class="attr">id</span>=<span class="string">&quot;cyan2&quot;</span>&gt;</span>陌生人，我也为你祝福<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;blue&quot;</span> <span class="attr">id</span>=<span class="string">&quot;blue1&quot;</span>&gt;</span>愿你有一个灿烂的前程<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;blue&quot;</span> <span class="attr">id</span>=<span class="string">&quot;blue2&quot;</span>&gt;</span>愿你有情人终成眷属<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;purple&quot;</span> <span class="attr">id</span>=<span class="string">&quot;purple1&quot;</span>&gt;</span>愿你在尘世获得幸福<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;purple&quot;</span> <span class="attr">id</span>=<span class="string">&quot;purple2&quot;</span>&gt;</span>我只愿面朝大海，春暖花开<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-attr">[id$=le]</span>&#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">220px</span>;</span><br><span class="line">  <span class="attribute">outline</span>: yellowgreen outset <span class="number">5px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>效果如下：</p>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/css属性选择器5.png" style="zoom:67%;" /><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div>
<h2 id="复合选择器">复合选择器</h2>
<p>复合选择器是由两个或多个基础选择器，通过不同的方式组合而成的。</p>
<h3 id="交集选择器">交集选择器</h3>
<p>又称“标签指定式选择器”（即…又…）。由两个选择器构成，其中第一个为标记选择器，第二个为class选择器或id选择器。</p>
<blockquote>
<p>注意：两个选择器之间不能有空格</p>
</blockquote>
<p>格式：</p>
<ul>
<li><code>element.class</code></li>
<li><code>element#id</code></li>
</ul>
<p>示例：选择<code>&lt;p&gt;</code>标签下class属性值为<code>purple</code>的元素，将其文本样式设置为紫色、加粗</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h2</span> <span class="attr">class</span>=<span class="string">&quot;title&quot;</span> <span class="attr">id</span>=<span class="string">&quot;title&quot;</span> <span class="attr">title</span>&gt;</span>面朝大海，春暖花开<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;author&quot;</span> <span class="attr">id</span>=<span class="string">&quot;author&quot;</span>&gt;</span>海子<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;para1&quot;</span> <span class="attr">id</span>=<span class="string">&quot;para1&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;red&quot;</span> <span class="attr">id</span>=<span class="string">&quot;red1&quot;</span>&gt;</span>从明天起，做一个幸福的人<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;red&quot;</span> <span class="attr">id</span>=<span class="string">&quot;red2&quot;</span>&gt;</span>喂马，劈柴，周游世界<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;orange&quot;</span> <span class="attr">id</span>=<span class="string">&quot;orange1&quot;</span>&gt;</span>从明天起，关心粮食和蔬菜<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;orange&quot;</span> <span class="attr">id</span>=<span class="string">&quot;orange2&quot;</span>&gt;</span>我有一所房子，面朝大海，春暖花开<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;para2&quot;</span> <span class="attr">id</span>=<span class="string">&quot;para2&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;yellow&quot;</span> <span class="attr">id</span>=<span class="string">&quot;yellow1&quot;</span>&gt;</span>从明天起，和每一个亲人通信<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;yellow&quot;</span> <span class="attr">id</span>=<span class="string">&quot;yellow2&quot;</span>&gt;</span>告诉他们我的幸福<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;green&quot;</span> <span class="attr">id</span>=<span class="string">&quot;green1&quot;</span>&gt;</span>那幸福的闪电告诉我的<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;green&quot;</span> <span class="attr">id</span>=<span class="string">&quot;green2&quot;</span>&gt;</span>我将告诉每一个人<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;para3&quot;</span> <span class="attr">id</span>=<span class="string">&quot;para3&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;cyan&quot;</span> <span class="attr">id</span>=<span class="string">&quot;cyan1&quot;</span>&gt;</span>给每一条河每一座山取一个温暖的名字<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;cyan&quot;</span> <span class="attr">id</span>=<span class="string">&quot;cyan2&quot;</span>&gt;</span>陌生人，我也为你祝福<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;blue&quot;</span> <span class="attr">id</span>=<span class="string">&quot;blue1&quot;</span>&gt;</span>愿你有一个灿烂的前程<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;blue&quot;</span> <span class="attr">id</span>=<span class="string">&quot;blue2&quot;</span>&gt;</span>愿你有情人终成眷属<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;purple&quot;</span> <span class="attr">id</span>=<span class="string">&quot;purple1&quot;</span>&gt;</span>愿你在尘世获得幸福<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;purple&quot;</span> <span class="attr">id</span>=<span class="string">&quot;purple2&quot;</span>&gt;</span>我只愿面朝大海，春暖花开<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">p</span><span class="selector-class">.purple</span>&#123;</span><br><span class="line">  <span class="attribute">color</span>: purple;</span><br><span class="line">  <span class="attribute">font-weight</span>: bolder;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>效果如下：</p>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/css复合选择器-标签指定式.png" style="zoom:67%;" />
<h3 id="并集选择器">并集选择器</h3>
<p>由各个选择器通过逗号<code>,</code>连接而成。</p>
<blockquote>
<p>任何形式的选择器都可以作为并集选择器的一部分</p>
</blockquote>
<p>格式：</p>
<p><code>选择器1,选择器2,...</code></p>
<p>示例：选择<code>&lt;h2&gt;</code>标签和class属性值为<code>orange</code>的元素，将其文本样式设置为橙色、加粗</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h2</span> <span class="attr">class</span>=<span class="string">&quot;title&quot;</span> <span class="attr">id</span>=<span class="string">&quot;title&quot;</span> <span class="attr">title</span>&gt;</span>面朝大海，春暖花开<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;author&quot;</span> <span class="attr">id</span>=<span class="string">&quot;author&quot;</span>&gt;</span>海子<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;para1&quot;</span> <span class="attr">id</span>=<span class="string">&quot;para1&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;red&quot;</span> <span class="attr">id</span>=<span class="string">&quot;red1&quot;</span>&gt;</span>从明天起，做一个幸福的人<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;red&quot;</span> <span class="attr">id</span>=<span class="string">&quot;red2&quot;</span>&gt;</span>喂马，劈柴，周游世界<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;orange&quot;</span> <span class="attr">id</span>=<span class="string">&quot;orange1&quot;</span>&gt;</span>从明天起，关心粮食和蔬菜<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;orange&quot;</span> <span class="attr">id</span>=<span class="string">&quot;orange2&quot;</span>&gt;</span>我有一所房子，面朝大海，春暖花开<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;para2&quot;</span> <span class="attr">id</span>=<span class="string">&quot;para2&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;yellow&quot;</span> <span class="attr">id</span>=<span class="string">&quot;yellow1&quot;</span>&gt;</span>从明天起，和每一个亲人通信<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;yellow&quot;</span> <span class="attr">id</span>=<span class="string">&quot;yellow2&quot;</span>&gt;</span>告诉他们我的幸福<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;green&quot;</span> <span class="attr">id</span>=<span class="string">&quot;green1&quot;</span>&gt;</span>那幸福的闪电告诉我的<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;green&quot;</span> <span class="attr">id</span>=<span class="string">&quot;green2&quot;</span>&gt;</span>我将告诉每一个人<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;para3&quot;</span> <span class="attr">id</span>=<span class="string">&quot;para3&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;cyan&quot;</span> <span class="attr">id</span>=<span class="string">&quot;cyan1&quot;</span>&gt;</span>给每一条河每一座山取一个温暖的名字<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;cyan&quot;</span> <span class="attr">id</span>=<span class="string">&quot;cyan2&quot;</span>&gt;</span>陌生人，我也为你祝福<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;blue&quot;</span> <span class="attr">id</span>=<span class="string">&quot;blue1&quot;</span>&gt;</span>愿你有一个灿烂的前程<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;blue&quot;</span> <span class="attr">id</span>=<span class="string">&quot;blue2&quot;</span>&gt;</span>愿你有情人终成眷属<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;purple&quot;</span> <span class="attr">id</span>=<span class="string">&quot;purple1&quot;</span>&gt;</span>愿你在尘世获得幸福<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;purple&quot;</span> <span class="attr">id</span>=<span class="string">&quot;purple2&quot;</span>&gt;</span>我只愿面朝大海，春暖花开<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">h2</span>,<span class="selector-attr">[class=<span class="string">&quot;orange&quot;</span>]</span>&#123;</span><br><span class="line">  <span class="attribute">color</span>: orange;</span><br><span class="line">  <span class="attribute">font-weight</span>: bolder;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>效果如下：</p>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/css复合选择器-并集选择器2.png" style="zoom:67%;" />
<h3 id="后代、儿子、兄弟选择器">后代、儿子、兄弟选择器</h3>
<div class="tabs" id="后代、儿子、兄弟选择器"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#后代、儿子、兄弟选择器-1">后代选择器</button></li><li class="tab"><button type="button" data-href="#后代、儿子、兄弟选择器-2">儿子选择器</button></li><li class="tab"><button type="button" data-href="#后代、儿子、兄弟选择器-3">相邻兄弟选择器</button></li><li class="tab"><button type="button" data-href="#后代、儿子、兄弟选择器-4">一般兄弟选择器</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="后代、儿子、兄弟选择器-1"><p>又称为“包含选择器”，可以选择某元素后代的元素</p>
<p>格式：</p>
<p><code>element element</code></p>
<p>示例：选择<code>&lt;div&gt;</code>标签下class属性为<code>blue</code>的元素，将其文本样式设置为蓝色、加粗</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h2</span> <span class="attr">class</span>=<span class="string">&quot;title&quot;</span> <span class="attr">id</span>=<span class="string">&quot;title&quot;</span> <span class="attr">title</span>&gt;</span>面朝大海，春暖花开<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;author&quot;</span> <span class="attr">id</span>=<span class="string">&quot;author&quot;</span>&gt;</span>海子<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;para1&quot;</span> <span class="attr">id</span>=<span class="string">&quot;para1&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;red&quot;</span> <span class="attr">id</span>=<span class="string">&quot;red1&quot;</span>&gt;</span>从明天起，做一个幸福的人<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;red&quot;</span> <span class="attr">id</span>=<span class="string">&quot;red2&quot;</span>&gt;</span>喂马，劈柴，周游世界<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;orange&quot;</span> <span class="attr">id</span>=<span class="string">&quot;orange1&quot;</span>&gt;</span>从明天起，关心粮食和蔬菜<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;orange&quot;</span> <span class="attr">id</span>=<span class="string">&quot;orange2&quot;</span>&gt;</span>我有一所房子，面朝大海，春暖花开<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;para2&quot;</span> <span class="attr">id</span>=<span class="string">&quot;para2&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;yellow&quot;</span> <span class="attr">id</span>=<span class="string">&quot;yellow1&quot;</span>&gt;</span>从明天起，和每一个亲人通信<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;yellow&quot;</span> <span class="attr">id</span>=<span class="string">&quot;yellow2&quot;</span>&gt;</span>告诉他们我的幸福<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;green&quot;</span> <span class="attr">id</span>=<span class="string">&quot;green1&quot;</span>&gt;</span>那幸福的闪电告诉我的<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;green&quot;</span> <span class="attr">id</span>=<span class="string">&quot;green2&quot;</span>&gt;</span>我将告诉每一个人<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;para3&quot;</span> <span class="attr">id</span>=<span class="string">&quot;para3&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;cyan&quot;</span> <span class="attr">id</span>=<span class="string">&quot;cyan1&quot;</span>&gt;</span>给每一条河每一座山取一个温暖的名字<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;cyan&quot;</span> <span class="attr">id</span>=<span class="string">&quot;cyan2&quot;</span>&gt;</span>陌生人，我也为你祝福<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;blue&quot;</span> <span class="attr">id</span>=<span class="string">&quot;blue1&quot;</span>&gt;</span>愿你有一个灿烂的前程<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;blue&quot;</span> <span class="attr">id</span>=<span class="string">&quot;blue2&quot;</span>&gt;</span>愿你有情人终成眷属<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;purple&quot;</span> <span class="attr">id</span>=<span class="string">&quot;purple1&quot;</span>&gt;</span>愿你在尘世获得幸福<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;purple&quot;</span> <span class="attr">id</span>=<span class="string">&quot;purple2&quot;</span>&gt;</span>我只愿面朝大海，春暖花开<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">div</span> <span class="selector-attr">[class=<span class="string">&quot;blue&quot;</span>]</span>&#123;</span><br><span class="line">  <span class="attribute">color</span>: blue;</span><br><span class="line">  <span class="attribute">font-weight</span>: bolder;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>效果如下：</p>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/css后代选择器.png" style="zoom: 67%;" /><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="后代、儿子、兄弟选择器-2"><p>只选择某个元素的子元素，而非所有后代元素</p>
<p>格式：</p>
<p><code>element&gt;element</code></p>
<p>示例：选择<code>&lt;div&gt;</code>标签下所有的<code>&lt;p&gt;</code>元素，将其文本样式设置为红色、加粗，并添加粉色边框</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h2</span> <span class="attr">class</span>=<span class="string">&quot;title&quot;</span> <span class="attr">id</span>=<span class="string">&quot;title&quot;</span> <span class="attr">title</span>&gt;</span>面朝大海，春暖花开<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;author&quot;</span> <span class="attr">id</span>=<span class="string">&quot;author&quot;</span>&gt;</span>海子<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;para1&quot;</span> <span class="attr">id</span>=<span class="string">&quot;para1&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;red&quot;</span> <span class="attr">id</span>=<span class="string">&quot;red1&quot;</span>&gt;</span>从明天起，做一个幸福的人<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;red&quot;</span> <span class="attr">id</span>=<span class="string">&quot;red2&quot;</span>&gt;</span>喂马，劈柴，周游世界<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;orange&quot;</span> <span class="attr">id</span>=<span class="string">&quot;orange1&quot;</span>&gt;</span>从明天起，关心粮食和蔬菜<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;orange&quot;</span> <span class="attr">id</span>=<span class="string">&quot;orange2&quot;</span>&gt;</span>我有一所房子，面朝大海，春暖花开<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;para2&quot;</span> <span class="attr">id</span>=<span class="string">&quot;para2&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">em</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;yellow&quot;</span> <span class="attr">id</span>=<span class="string">&quot;yellow1&quot;</span>&gt;</span>从明天起，和每一个亲人通信<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;yellow&quot;</span> <span class="attr">id</span>=<span class="string">&quot;yellow2&quot;</span>&gt;</span>告诉他们我的幸福<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;green&quot;</span> <span class="attr">id</span>=<span class="string">&quot;green1&quot;</span>&gt;</span>那幸福的闪电告诉我的<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;green&quot;</span> <span class="attr">id</span>=<span class="string">&quot;green2&quot;</span>&gt;</span>我将告诉每一个人<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">em</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;para3&quot;</span> <span class="attr">id</span>=<span class="string">&quot;para3&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">em</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;cyan&quot;</span> <span class="attr">id</span>=<span class="string">&quot;cyan1&quot;</span>&gt;</span>给每一条河每一座山取一个温暖的名字<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;cyan&quot;</span> <span class="attr">id</span>=<span class="string">&quot;cyan2&quot;</span>&gt;</span>陌生人，我也为你祝福<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;blue&quot;</span> <span class="attr">id</span>=<span class="string">&quot;blue1&quot;</span>&gt;</span>愿你有一个灿烂的前程<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;blue&quot;</span> <span class="attr">id</span>=<span class="string">&quot;blue2&quot;</span>&gt;</span>愿你有情人终成眷属<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;purple&quot;</span> <span class="attr">id</span>=<span class="string">&quot;purple1&quot;</span>&gt;</span>愿你在尘世获得幸福<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;purple&quot;</span> <span class="attr">id</span>=<span class="string">&quot;purple2&quot;</span>&gt;</span>我只愿面朝大海，春暖花开<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">em</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意：这里第二、三段文本被<code>&lt;em&gt;</code>标签包裹，而非直接在<code>&lt;div&gt;</code>标签下</p>
</blockquote>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">div</span>&gt;<span class="selector-tag">p</span>&#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">280px</span>;</span><br><span class="line">  <span class="attribute">color</span>: red;</span><br><span class="line">  <span class="attribute">font-weight</span>: bolder;</span><br><span class="line">  <span class="attribute">outline</span>: hotpink outset <span class="number">5px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>效果如下：</p>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/css儿子选择器.png" style="zoom:67%;" /><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="后代、儿子、兄弟选择器-3"><p>选择紧邻在一个元素之后的另一个元素（二者必须拥有相同的父元素）</p>
<p>格式：</p>
<p><code>element+element</code></p>
<p>示例：选择紧跟在id值为<code>red1</code>标签后的第一个<code>&lt;p&gt;</code>标签，将其文本样式设置为蓝色、加粗，并添加蓝色边框</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h2</span> <span class="attr">class</span>=<span class="string">&quot;title&quot;</span> <span class="attr">id</span>=<span class="string">&quot;title&quot;</span> <span class="attr">title</span>&gt;</span>面朝大海，春暖花开<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;author&quot;</span> <span class="attr">id</span>=<span class="string">&quot;author&quot;</span>&gt;</span>海子<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;para1&quot;</span> <span class="attr">id</span>=<span class="string">&quot;para1&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;red&quot;</span> <span class="attr">id</span>=<span class="string">&quot;red1&quot;</span>&gt;</span>从明天起，做一个幸福的人<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;red&quot;</span> <span class="attr">id</span>=<span class="string">&quot;red2&quot;</span>&gt;</span>喂马，劈柴，周游世界<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;orange&quot;</span> <span class="attr">id</span>=<span class="string">&quot;orange1&quot;</span>&gt;</span>从明天起，关心粮食和蔬菜<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;orange&quot;</span> <span class="attr">id</span>=<span class="string">&quot;orange2&quot;</span>&gt;</span>我有一所房子，面朝大海，春暖花开<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;para2&quot;</span> <span class="attr">id</span>=<span class="string">&quot;para2&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;yellow&quot;</span> <span class="attr">id</span>=<span class="string">&quot;yellow1&quot;</span>&gt;</span>从明天起，和每一个亲人通信<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;yellow&quot;</span> <span class="attr">id</span>=<span class="string">&quot;yellow2&quot;</span>&gt;</span>告诉他们我的幸福<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;green&quot;</span> <span class="attr">id</span>=<span class="string">&quot;green1&quot;</span>&gt;</span>那幸福的闪电告诉我的<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;green&quot;</span> <span class="attr">id</span>=<span class="string">&quot;green2&quot;</span>&gt;</span>我将告诉每一个人<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;para3&quot;</span> <span class="attr">id</span>=<span class="string">&quot;para3&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;cyan&quot;</span> <span class="attr">id</span>=<span class="string">&quot;cyan1&quot;</span>&gt;</span>给每一条河每一座山取一个温暖的名字<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;cyan&quot;</span> <span class="attr">id</span>=<span class="string">&quot;cyan2&quot;</span>&gt;</span>陌生人，我也为你祝福<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;blue&quot;</span> <span class="attr">id</span>=<span class="string">&quot;blue1&quot;</span>&gt;</span>愿你有一个灿烂的前程<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;blue&quot;</span> <span class="attr">id</span>=<span class="string">&quot;blue2&quot;</span>&gt;</span>愿你有情人终成眷属<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;purple&quot;</span> <span class="attr">id</span>=<span class="string">&quot;purple1&quot;</span>&gt;</span>愿你在尘世获得幸福<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;purple&quot;</span> <span class="attr">id</span>=<span class="string">&quot;purple2&quot;</span>&gt;</span>我只愿面朝大海，春暖花开<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-attr">[id=<span class="string">&quot;red1&quot;</span>]</span>+<span class="selector-tag">p</span>&#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">280px</span>;</span><br><span class="line">  <span class="attribute">color</span>: cornflowerblue;</span><br><span class="line">  <span class="attribute">font-weight</span>: bolder;</span><br><span class="line">  <span class="attribute">outline</span>: deepskyblue outset <span class="number">5px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>效果如下：</p>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/css相邻兄弟选择器2.png" style="zoom:67%;" /><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="后代、儿子、兄弟选择器-4"><p>选择一个元素之后所有指定的同级元素</p>
<p>格式：</p>
<p><code>element~element</code></p>
<p>示例：选择紧跟在id值为<code>red1</code>之后所有的<code>&lt;p&gt;</code>标签，将其文本样式设置为橙色、加粗，并添加绿色边框</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h2</span> <span class="attr">class</span>=<span class="string">&quot;title&quot;</span> <span class="attr">id</span>=<span class="string">&quot;title&quot;</span> <span class="attr">title</span>&gt;</span>面朝大海，春暖花开<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;author&quot;</span> <span class="attr">id</span>=<span class="string">&quot;author&quot;</span>&gt;</span>海子<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;para1&quot;</span> <span class="attr">id</span>=<span class="string">&quot;para1&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;red&quot;</span> <span class="attr">id</span>=<span class="string">&quot;red1&quot;</span>&gt;</span>从明天起，做一个幸福的人<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;red&quot;</span> <span class="attr">id</span>=<span class="string">&quot;red2&quot;</span>&gt;</span>喂马，劈柴，周游世界<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;orange&quot;</span> <span class="attr">id</span>=<span class="string">&quot;orange1&quot;</span>&gt;</span>从明天起，关心粮食和蔬菜<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;orange&quot;</span> <span class="attr">id</span>=<span class="string">&quot;orange2&quot;</span>&gt;</span>我有一所房子，面朝大海，春暖花开<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;para2&quot;</span> <span class="attr">id</span>=<span class="string">&quot;para2&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;yellow&quot;</span> <span class="attr">id</span>=<span class="string">&quot;yellow1&quot;</span>&gt;</span>从明天起，和每一个亲人通信<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;yellow&quot;</span> <span class="attr">id</span>=<span class="string">&quot;yellow2&quot;</span>&gt;</span>告诉他们我的幸福<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;green&quot;</span> <span class="attr">id</span>=<span class="string">&quot;green1&quot;</span>&gt;</span>那幸福的闪电告诉我的<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;green&quot;</span> <span class="attr">id</span>=<span class="string">&quot;green2&quot;</span>&gt;</span>我将告诉每一个人<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;para3&quot;</span> <span class="attr">id</span>=<span class="string">&quot;para3&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;cyan&quot;</span> <span class="attr">id</span>=<span class="string">&quot;cyan1&quot;</span>&gt;</span>给每一条河每一座山取一个温暖的名字<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;cyan&quot;</span> <span class="attr">id</span>=<span class="string">&quot;cyan2&quot;</span>&gt;</span>陌生人，我也为你祝福<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;blue&quot;</span> <span class="attr">id</span>=<span class="string">&quot;blue1&quot;</span>&gt;</span>愿你有一个灿烂的前程<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;blue&quot;</span> <span class="attr">id</span>=<span class="string">&quot;blue2&quot;</span>&gt;</span>愿你有情人终成眷属<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;purple&quot;</span> <span class="attr">id</span>=<span class="string">&quot;purple1&quot;</span>&gt;</span>愿你在尘世获得幸福<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;purple&quot;</span> <span class="attr">id</span>=<span class="string">&quot;purple2&quot;</span>&gt;</span>我只愿面朝大海，春暖花开<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-attr">[id=<span class="string">&quot;red1&quot;</span>]</span>~<span class="selector-tag">p</span>&#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">280px</span>;</span><br><span class="line">  <span class="attribute">color</span>: orange;</span><br><span class="line">  <span class="attribute">font-weight</span>: bolder;</span><br><span class="line">  <span class="attribute">outline</span>: forestgreen outset <span class="number">5px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>效果如下：</p>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/css一般兄弟选择器.png" style="zoom:67%;" /><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div>
<h2 id="伪类选择器">伪类选择器</h2>
<p>伪类选择器可以根据元素的状态或者元素的某种结构来选择元素。</p>
<p>根据上述介绍可以将伪类选择器分为两类：</p>
<ul>
<li>UI伪类选择器</li>
<li>结构伪类选择器</li>
</ul>
<p>下面来逐一介绍。</p>
<h3 id="UI伪类选择器">UI伪类选择器</h3>
<div class="tabs" id="ui伪类选择器"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#ui伪类选择器-1">链接伪类</button></li><li class="tab"><button type="button" data-href="#ui伪类选择器-2">:focus伪类</button></li><li class="tab"><button type="button" data-href="#ui伪类选择器-3">:target伪类</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="ui伪类选择器-1"><ul>
<li>link：链接等待用户点击的状态</li>
<li>visited：用户此前已经点击过链接</li>
<li>hover：用户鼠标悬停在链接上</li>
<li>focus：链接拥有焦点的时候</li>
<li>active：链接正在被点击（鼠标在元素上按下，还没有被释放）</li>
</ul>
<blockquote>
<p>注意：如果链接拥有上述多种状态设置时，必须按照“<strong>LVHFA</strong>”的顺序定义选择器，否则会失效。</p>
</blockquote>
<p>示例：以百度链接为例实现如下效果：</p>
<ul>
<li>当未访问过时字体为蓝色</li>
<li>当鼠标悬停在链接上方时为灰色</li>
<li>当鼠标点击不释放时为红色</li>
<li>当链接拥有焦点时为黄色</li>
<li>当链接访问过时为紫色</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://www.baidu.com/&quot;</span>&gt;</span>百度一下，你就知道<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">a</span><span class="selector-pseudo">:link</span>&#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#2440b3</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">a</span><span class="selector-pseudo">:visited</span>&#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#771cb2</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">a</span><span class="selector-pseudo">:hover</span>&#123;</span><br><span class="line">  <span class="attribute">color</span>: darkgrey;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">a</span><span class="selector-pseudo">:focus</span>&#123;</span><br><span class="line">  <span class="attribute">color</span>: gold;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">a</span><span class="selector-pseudo">:active</span>&#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#ff0000</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>效果如下：</p>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/css链接伪类选择器.gif" style="zoom:80%;" /><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="ui伪类选择器-2"><p>一个元素在获得焦点时选择该元素</p>
<p>格式：</p>
<p><code>e:focus</code>（其中<code>e</code>代表html中的任意元素）</p>
<p>示例：构建一个表单，当输入框获取到焦点时，样式改为：字体橙色、加粗，并添加绿色边框</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;#&quot;</span>&gt;</span></span><br><span class="line">    用户名：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span>&gt;</span></span><br><span class="line">    密码：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;提交&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">input</span><span class="selector-pseudo">:focus</span>&#123;</span><br><span class="line">  <span class="attribute">color</span>: orange;</span><br><span class="line">  <span class="attribute">font-weight</span>: bolder;</span><br><span class="line">  <span class="attribute">outline</span>: forestgreen outset <span class="number">5px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>效果如下：</p>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/css-focus伪类选择器.gif" style="zoom:80%;" /><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="ui伪类选择器-3"><p>这里要涉及锚点。当点击锚点链接时，选中被链接的元素。</p>
<p>格式：</p>
<p><code>#xx:target</code></p>
<p>示例：点击锚点链接，被链接的文本样式加粗</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span> <span class="attr">class</span>=<span class="string">&quot;title&quot;</span> <span class="attr">id</span>=<span class="string">&quot;title&quot;</span> <span class="attr">title</span>&gt;</span>面朝大海，春暖花开<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;author&quot;</span> <span class="attr">id</span>=<span class="string">&quot;author&quot;</span>&gt;</span>海子<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;para1&quot;</span> <span class="attr">id</span>=<span class="string">&quot;para1&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;red&quot;</span> <span class="attr">id</span>=<span class="string">&quot;red1&quot;</span>&gt;</span>从明天起，做一个幸福的人<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;red&quot;</span> <span class="attr">id</span>=<span class="string">&quot;red2&quot;</span>&gt;</span>喂马，劈柴，周游世界<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;orange&quot;</span> <span class="attr">id</span>=<span class="string">&quot;orange1&quot;</span>&gt;</span>从明天起，关心粮食和蔬菜<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;orange&quot;</span> <span class="attr">id</span>=<span class="string">&quot;orange2&quot;</span>&gt;</span>我有一所房子，面朝大海，春暖花开<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;para2&quot;</span> <span class="attr">id</span>=<span class="string">&quot;para2&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;yellow&quot;</span> <span class="attr">id</span>=<span class="string">&quot;yellow1&quot;</span>&gt;</span>从明天起，和每一个亲人通信<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;yellow&quot;</span> <span class="attr">id</span>=<span class="string">&quot;yellow2&quot;</span>&gt;</span>告诉他们我的幸福<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;green&quot;</span> <span class="attr">id</span>=<span class="string">&quot;green1&quot;</span>&gt;</span>那幸福的闪电告诉我的<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;green&quot;</span> <span class="attr">id</span>=<span class="string">&quot;green2&quot;</span>&gt;</span>我将告诉每一个人<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;para3&quot;</span> <span class="attr">id</span>=<span class="string">&quot;para3&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;cyan&quot;</span> <span class="attr">id</span>=<span class="string">&quot;cyan1&quot;</span>&gt;</span>给每一条河每一座山取一个温暖的名字<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;cyan&quot;</span> <span class="attr">id</span>=<span class="string">&quot;cyan2&quot;</span>&gt;</span>陌生人，我也为你祝福<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;blue&quot;</span> <span class="attr">id</span>=<span class="string">&quot;blue1&quot;</span>&gt;</span>愿你有一个灿烂的前程<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;blue&quot;</span> <span class="attr">id</span>=<span class="string">&quot;blue2&quot;</span>&gt;</span>愿你有情人终成眷属<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;purple&quot;</span> <span class="attr">id</span>=<span class="string">&quot;purple1&quot;</span>&gt;</span>愿你在尘世获得幸福<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;purple&quot;</span> <span class="attr">id</span>=<span class="string">&quot;purple2&quot;</span>&gt;</span>我只愿面朝大海，春暖花开<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#para1&quot;</span>&gt;</span>第一段<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#para2&quot;</span>&gt;</span>第二段<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#para3&quot;</span>&gt;</span>第三段<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-id">#para1</span><span class="selector-pseudo">:target</span>&#123;</span><br><span class="line">  <span class="attribute">font-weight</span>: bolder;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#para2</span><span class="selector-pseudo">:target</span>&#123;</span><br><span class="line">  <span class="attribute">font-weight</span>: bolder;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#para3</span><span class="selector-pseudo">:target</span>&#123;</span><br><span class="line">  <span class="attribute">font-weight</span>: bolder;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>效果如下：</p>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/css-target伪类选择器.gif" style="zoom:67%;" /><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div>
<h2 id="伪元素选择器">伪元素选择器</h2>
<p>伪元素选择符可以根据元素中特殊位置选择元素。</p>
<h3 id="结构伪类选择器">结构伪类选择器</h3>
<p>结构伪类根据元素所处的位置选择元素，通常用于序列型的元素，如列表。</p>
<div class="tabs" id="结构伪类选择器"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#结构伪类选择器-1">e:first-child</button></li><li class="tab"><button type="button" data-href="#结构伪类选择器-2">e:last-child</button></li><li class="tab"><button type="button" data-href="#结构伪类选择器-3">nth-child(n)</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="结构伪类选择器-1"><p>选择列表的第一个元素</p>
<p>格式：</p>
<p><code>e:first-child</code>（<code>e</code>为列表元素）</p>
<p>示例：选择列表的第一个元素，将其文本样式修改为红色</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>结构伪类选择器<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;<span class="name">ol</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>第一项<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>第二项<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>第三项<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>第四项<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>第五项<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>第六项<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">ol</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">li</span><span class="selector-pseudo">:first</span>-child&#123;</span><br><span class="line">  <span class="attribute">color</span>: red;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>效果如下：</p>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/css结构伪类选择器1.png" style="zoom:67%;" /><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="结构伪类选择器-2"><p>选择列表的最后一个元素</p>
<p>格式：</p>
<p><code>e:last-child</code>（<code>e</code>为列表元素）</p>
<p>示例：选择列表的最后一个元素，将其文本样式修改为绿色、加粗</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>结构伪类选择器<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;<span class="name">ol</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>第一项<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>第二项<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>第三项<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>第四项<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>第五项<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>第六项<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">ol</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">li</span><span class="selector-pseudo">:last-child</span>&#123;</span><br><span class="line">  <span class="attribute">color</span>: green;</span><br><span class="line">  <span class="attribute">font-weight</span>: bolder;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>效果如下：</p>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/css结构伪类选择器2.png" style="zoom:67%;" /><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="结构伪类选择器-3"><p>选择列表的指定位置元素</p>
<p>格式：</p>
<p><code>e:nth-child(n)</code>（<code>e</code>为列表元素，<code>n</code>为数字，即指定的列表项）</p>
<p>示例：选择列表的第四项元素，将其文本样式修改为蓝色、加粗</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>结构伪类选择器<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;<span class="name">ol</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>第一项<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>第二项<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>第三项<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>第四项<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>第五项<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>第六项<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">ol</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">li</span><span class="selector-pseudo">:nth-child</span>(<span class="number">4</span>)&#123;</span><br><span class="line">  <span class="attribute">color</span>: deepskyblue;</span><br><span class="line">  <span class="attribute">font-weight</span>: bolder;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>效果如下：</p>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/css结构伪类选择器3.png" style="zoom:67%;" /><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div>
<h3 id="伪元素选择器-2">伪元素选择器</h3>
<p>伪元素是指元素当中的某一个位置。伪元素选择器可以选择一个位置的元素或者是位置的相对空间</p>
<div class="tabs" id="伪元素选择器"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#伪元素选择器-1">e::first-letter</button></li><li class="tab"><button type="button" data-href="#伪元素选择器-2">e::first-line</button></li><li class="tab"><button type="button" data-href="#伪元素选择器-3">e::before</button></li><li class="tab"><button type="button" data-href="#伪元素选择器-4">e::after</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="伪元素选择器-1"><p>可以选择元素的第一个字符</p>
<p>格式：</p>
<p><code>e::first-letter（</code>e<code>为列表元素）</code></p>
<p>示例：选择每一行的第一个字，将其样式增大、加粗</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span> <span class="attr">class</span>=<span class="string">&quot;title&quot;</span> <span class="attr">id</span>=<span class="string">&quot;title&quot;</span> <span class="attr">title</span>&gt;</span>面朝大海，春暖花开<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;author&quot;</span> <span class="attr">id</span>=<span class="string">&quot;author&quot;</span>&gt;</span>海子<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;para1&quot;</span> <span class="attr">id</span>=<span class="string">&quot;para1&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;red&quot;</span> <span class="attr">id</span>=<span class="string">&quot;red1&quot;</span>&gt;</span>从明天起，做一个幸福的人<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;red&quot;</span> <span class="attr">id</span>=<span class="string">&quot;red2&quot;</span>&gt;</span>喂马，劈柴，周游世界<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;orange&quot;</span> <span class="attr">id</span>=<span class="string">&quot;orange1&quot;</span>&gt;</span>从明天起，关心粮食和蔬菜<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;orange&quot;</span> <span class="attr">id</span>=<span class="string">&quot;orange2&quot;</span>&gt;</span>我有一所房子，面朝大海，春暖花开<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;para2&quot;</span> <span class="attr">id</span>=<span class="string">&quot;para2&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;yellow&quot;</span> <span class="attr">id</span>=<span class="string">&quot;yellow1&quot;</span>&gt;</span>从明天起，和每一个亲人通信<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;yellow&quot;</span> <span class="attr">id</span>=<span class="string">&quot;yellow2&quot;</span>&gt;</span>告诉他们我的幸福<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;green&quot;</span> <span class="attr">id</span>=<span class="string">&quot;green1&quot;</span>&gt;</span>那幸福的闪电告诉我的<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;green&quot;</span> <span class="attr">id</span>=<span class="string">&quot;green2&quot;</span>&gt;</span>我将告诉每一个人<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;para3&quot;</span> <span class="attr">id</span>=<span class="string">&quot;para3&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;cyan&quot;</span> <span class="attr">id</span>=<span class="string">&quot;cyan1&quot;</span>&gt;</span>给每一条河每一座山取一个温暖的名字<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;cyan&quot;</span> <span class="attr">id</span>=<span class="string">&quot;cyan2&quot;</span>&gt;</span>陌生人，我也为你祝福<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;blue&quot;</span> <span class="attr">id</span>=<span class="string">&quot;blue1&quot;</span>&gt;</span>愿你有一个灿烂的前程<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;blue&quot;</span> <span class="attr">id</span>=<span class="string">&quot;blue2&quot;</span>&gt;</span>愿你有情人终成眷属<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;purple&quot;</span> <span class="attr">id</span>=<span class="string">&quot;purple1&quot;</span>&gt;</span>愿你在尘世获得幸福<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;purple&quot;</span> <span class="attr">id</span>=<span class="string">&quot;purple2&quot;</span>&gt;</span>我只愿面朝大海，春暖花开<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">p</span><span class="selector-pseudo">::first-letter</span>&#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">18px</span>;</span><br><span class="line">  <span class="attribute">font-weight</span>: bolder;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>效果如下：</p>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/css伪元素选择器1.png" style="zoom:67%;" /><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="伪元素选择器-2"><p>选择元素的首行</p>
<p>格式：</p>
<p><code>e::first-line（</code>e<code>为列表元素）</code></p>
<p>示例：选择首行文字，将其样式设置为红色、斜体</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>CSS（层叠样式表）<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">      层叠样式表(英文全称：Cascading Style Sheets)是一种用来表现HTML（标准通用标记语言的一个应用）或<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">      XML（标准通用标记语言的一个子集）等文件样式的计算机语言。CSS不仅可以静态地修饰网页，<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">      还可以配合各种脚本语言动态地对网页各元素进行格式化。</span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">p</span><span class="selector-pseudo">::first-line</span>&#123;</span><br><span class="line">  <span class="attribute">color</span>: red;</span><br><span class="line">  <span class="attribute">font-style</span>: italic;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>效果如下：</p>
<p><img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/css%E4%BC%AA%E5%85%83%E7%B4%A0%E9%80%89%E6%8B%A9%E5%99%A82.png" alt=""></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="伪元素选择器-3"><p>可以选择元素的前面位置添加特殊内容</p>
<p>格式：</p>
<p><code>e::before（</code>e<code>为列表元素）</code></p>
<p>示例：在“25岁”前添加“<code>年龄：</code>”字样</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;age&quot;</span>&gt;</span>25岁<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">p</span><span class="selector-id">#age</span><span class="selector-pseudo">::before</span>&#123;</span><br><span class="line">  <span class="attribute">content</span>: <span class="string">&quot;年龄: &quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>效果如下：</p>
<p><img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/css%E4%BC%AA%E5%85%83%E7%B4%A0%E9%80%89%E6%8B%A9%E5%99%A83.png" alt=""></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="伪元素选择器-4"><p>可以选择元素的后面位置添加特殊内容</p>
<p>格式：</p>
<p><code>e::after（</code>e<code>为列表元素）</code></p>
<p>示例：在“身高：”后添加内容</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;height&quot;</span>&gt;</span>身高：<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">p</span><span class="selector-id">#height</span><span class="selector-pseudo">::after</span>&#123;</span><br><span class="line">  <span class="attribute">content</span>: <span class="string">&quot;190cm&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>效果如下：</p>
<p><img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/css%E4%BC%AA%E5%85%83%E7%B4%A0%E9%80%89%E6%8B%A9%E5%99%A84.png" alt=""></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div>
<hr>
<h1>后记</h1>
<p>结束</p>
<p>（也许会再补充…）</p>
]]></content>
      <categories>
        <category>学习笔记</category>
      </categories>
      <tags>
        <tag>CSS</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue学习-Vuex</title>
    <url>/2021/08/17/Vue/Vue%E5%AD%A6%E4%B9%A0-Vuex/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\css\APlayer.min.css"><script src="\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\js\Meting.min.js"></script><h1>前言</h1>
<p>本文将介绍Vuex的用法。</p>
<hr>
<h1>Vuex</h1>
<h2 id="介绍">介绍</h2>
<p>Vuex 是一个专为 Vue.js 应用程序开发的<strong>状态管理模式</strong>。（官方解释）</p>
<ul>
<li>它采用集中式存储管理应用的所有组件的状态，并以相应的规则保证状态以一种可预测的方式发生变化。</li>
<li>Vuex也集成到Vue的官方调试工具<code>devtools</code>、<code>extension</code>，提供了诸如零配置的<code>time-travel</code>调试、状态快照导入导出等高级调试功能。</li>
</ul>
<p>简单理解：不同的组件需要访问一些同一状态量，如果把这些状态量随意定义到任意组件中都不合适，我们希望能够有一个对象对这些共享状态量进行统一封装，而Vuex就是这样一个提供在多个组件间共享状态的插件。</p>
<blockquote>
<p>举例一些共享状态量：用户的登陆状态、用户名称、头像、地理位置信息等。</p>
</blockquote>
<h2 id="安装">安装</h2>
<p>打开终端，进入项目目录，键入如下命令（注意版本号）：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm install vuex --save</span><br></pre></td></tr></table></figure>
<h2 id="基本使用">基本使用</h2>
<p>共享状态量会统一放一起管理，在项目的<code>src</code>文件夹下新建一个名为<code>store</code>的文件夹，在其中新建<code>index.js</code>文件：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Vuex <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 1.安装插件</span></span><br><span class="line">Vue.use(Vuex)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.新建Vuex.Store对象</span></span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> Vuex.Store(&#123;</span><br><span class="line">  state: &#123;</span><br><span class="line">    counter: <span class="number">1</span></span><br><span class="line">  &#125;,</span><br><span class="line">  mutations:&#123;&#125;,</span><br><span class="line">  actions:&#123;&#125;,</span><br><span class="line">  getters:&#123;&#125;,</span><br><span class="line">  modules:&#123;&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.导出store独享</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store</span><br></pre></td></tr></table></figure>
<p>这里在store对象中的<code>state</code>属性中定义了一个<code>counter</code>（之后用于其他组件的访问）</p>
<blockquote>
<p>注意：</p>
<ul>
<li>Vuex专门提供了一个<code>Store</code>类，初始化应创建store对象</li>
<li>Store对象中有五种常用属性：<code>state</code>、<code>mutations</code>、<code>actions</code>、<code>getters</code>、<code>modules</code>（之后会详细介绍）</li>
</ul>
</blockquote>
<p>接着在项目的<code>main.js</code>文件中导入并注册store组件：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">&#x27;./App&#x27;</span></span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;./store&#x27;</span>  <span class="comment">//导入</span></span><br><span class="line"></span><br><span class="line">Vue.config.productionTip = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  el: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">  store,  <span class="comment">//注册</span></span><br><span class="line">  render: <span class="function"><span class="params">h</span> =&gt;</span> h(App)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>一切准备完成之后就可以在组件中直接访问定义的共享状态量<code>counter</code>了，这里以<code>App.vue</code>为例：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>我是App标题<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>&#123;&#123;$store.state.counter&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;$store.state.counter++&quot;</span>&gt;</span>+<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;$store.state.counter--&quot;</span>&gt;</span>-<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">  name: <span class="string">&#x27;App&#x27;</span>,</span></span><br><span class="line"><span class="javascript">  <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">      message: <span class="string">&#x27;我是App页面内容&#x27;</span></span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Vuex-基本使用.gif" style="zoom:80%;" />
<blockquote>
<p>说明：</p>
<p>可以直接通过<code>$store.state.xxx</code>的形式访问，但是一般不会直接访问并随意修改其状态。</p>
</blockquote>
<h2 id="Devtools">Devtools</h2>
<h3 id="Vuex的状态管理">Vuex的状态管理</h3>
<p>Vue官方提供了一个Vuex状态管理图例：</p>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Vuex-状态管理图例.png" style="zoom:80%;" />
<p>当然可以直接在组件中修改状态量，但是官方并不建议这么做。因为在最初介绍的时候提到过一些调试工具，如接下来要讲的<code>devtools</code>，当多个组件实例对同一状态量进行修改时，它可以对该状态量进行跟踪，方便调试。如果跨过<code>Mutations</code>直接对状态量进行修改，则调试工具就不能够跟踪。</p>
<h3 id="安装Devtools">安装Devtools</h3>
<p>在浏览器的扩展中查找<code>Vue.js devtools</code>插件：</p>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Vuex-devtools插件.png" style="zoom:80%;" />
<p>可以看到提供方就是Vue官方。</p>
<p>下载完成之后就可以看到在有Vue项目页面的情况下，开发者工具中就会多出一个Vue的选项。</p>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Vuex-devtools插件2.png" style="zoom:80%;" />
<blockquote>
<p>注意：安装完插件后需要重新启动浏览器才可以看到。</p>
</blockquote>
<p>利用该插件就可以对Vue项目中的内容做一些跟踪查看：</p>
<p><img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Vuex-devtools%E6%8F%92%E4%BB%B63.png" alt=""></p>
<h3 id="mutations用法">mutations用法</h3>
<p>正常想要改变状态量的值需要通过mutations（Store对象中的一个属性），可以在其中定义方法：</p>
<p><code>index.js</code>:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Vuex <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"></span><br><span class="line">Vue.use(Vuex)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> Vuex.Store(&#123;</span><br><span class="line">  state: &#123;</span><br><span class="line">    counter: <span class="number">1</span></span><br><span class="line">  &#125;,</span><br><span class="line">  mutations:&#123;</span><br><span class="line">    <span class="function"><span class="title">increase</span>(<span class="params">state</span>)</span> &#123;  <span class="comment">//自动传入state对象</span></span><br><span class="line">      state.counter++</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">decrease</span>(<span class="params">state</span>)</span> &#123;  <span class="comment">//自动传入state对象</span></span><br><span class="line">      state.counter--</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  actions:&#123;&#125;,</span><br><span class="line">  getters:&#123;&#125;,</span><br><span class="line">  modules:&#123;&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store</span><br></pre></td></tr></table></figure>
<blockquote>
<p>说明：</p>
<p>在<code>mutations</code>属性中可以定义方法，其中传入的参数就是<code>state</code>对象，通过在其中定义方法去修改状态量。</p>
</blockquote>
<p>接着就是在组件中调用定义的方法：</p>
<p><code>App.vue</code>：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>我是App标题<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>&#123;&#123;$store.state.counter&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;add&quot;</span>&gt;</span>+<span class="tag">&lt;/<span class="name">button</span>&gt;</span>  <span class="comment">&lt;!-- +按钮绑定add方法 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;reduce&quot;</span>&gt;</span>-<span class="tag">&lt;/<span class="name">button</span>&gt;</span>  <span class="comment">&lt;!-- -按钮绑定reduce方法 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">  name: <span class="string">&#x27;App&#x27;</span>,</span></span><br><span class="line">  methods: &#123;</span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">add</span>(<span class="params"></span>)</span> &#123;  <span class="comment">//定义add方法</span></span></span><br><span class="line"><span class="javascript">      <span class="built_in">this</span>.$store.commit(<span class="string">&#x27;increase&#x27;</span>)  <span class="comment">//调用mutations中的increase方法</span></span></span><br><span class="line">    &#125;,</span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">reduce</span>(<span class="params"></span>)</span> &#123;  <span class="comment">//定义reduce方法</span></span></span><br><span class="line"><span class="javascript">      <span class="built_in">this</span>.$store.commit(<span class="string">&#x27;decrease&#x27;</span>)  <span class="comment">//调用mutations中的decrease方法</span></span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<blockquote>
<p>说明：</p>
<p>实例中需要再在<code>methods</code>属性中定义对应的方法去调用<code>mutations</code>中的方法，语法如下：</p>
<p><code>$store.commit('方法名')</code></p>
</blockquote>
<p>最后就可以使用Devtools调试工具跟踪状态量的变化情况。</p>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Vuex-devtools.gif" style="zoom:80%;" />
<h2 id="Getters">Getters</h2>
<p><code>getters</code>是Store对对象中的五个属性之一。</p>
<h3 id="基本使用-2">基本使用</h3>
<p>getters的一个用法类似于组件中的computed计算属性。</p>
<p>例如，要多次获取state属性中的counter值乘100，不必在每次调用时都去计算，而是在getters中定义一个计算属性：</p>
<p><code>index.js</code>:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Vuex <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"></span><br><span class="line">Vue.use(Vuex)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> Vuex.Store(&#123;</span><br><span class="line">  state: &#123;</span><br><span class="line">    counter: <span class="number">1</span></span><br><span class="line">  &#125;,</span><br><span class="line">  mutations:&#123;</span><br><span class="line">    <span class="function"><span class="title">increase</span>(<span class="params">state</span>)</span> &#123; </span><br><span class="line">      state.counter++</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">decrease</span>(<span class="params">state</span>)</span> &#123;  </span><br><span class="line">      state.counter--</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  actions:&#123;&#125;,</span><br><span class="line">  getters:&#123;</span><br><span class="line">    <span class="function"><span class="title">mul</span>(<span class="params">state</span>)</span> &#123;  <span class="comment">//自动传入state对象</span></span><br><span class="line">      <span class="keyword">return</span> state.counter*<span class="number">100</span>  <span class="comment">//定义计算属性mul</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  modules:&#123;&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store</span><br></pre></td></tr></table></figure>
<p><code>App.vue</code>:</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>我是App标题<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>&#123;&#123;$store.state.counter&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;add&quot;</span>&gt;</span>+<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;reduce&quot;</span>&gt;</span>-<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>获取mul的值：&#123;&#123;$store.getters.mul&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span>  <span class="comment">&lt;!--获取store中getters属性的mul计算属性--&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">  name: <span class="string">&#x27;App&#x27;</span>,</span></span><br><span class="line">  methods: &#123;</span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">add</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">this</span>.$store.commit(<span class="string">&#x27;increase&#x27;</span>)</span></span><br><span class="line">    &#125;,</span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">reduce</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">this</span>.$store.commit(<span class="string">&#x27;decrease&#x27;</span>)</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Vuex-getters-show1.gif" style="zoom:80%;" />
<blockquote>
<p>说明：</p>
<p>调用语法：<code>$store.getters.xxx</code></p>
</blockquote>
<h3 id="参数传递">参数传递</h3>
<p>getters中也可以使用一些高阶函数来实现一些功能。</p>
<p>以过滤器<code>filter</code>为例，现在在<code>state</code>属性中定义了<code>students</code>数组，里面存放了一些学生信息，希望通过getter实现一些信息过滤（获取年龄大于20岁的学生信息）：</p>
<p><code>index.js</code>:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Vuex <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"></span><br><span class="line">Vue.use(Vuex)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> Vuex.Store(&#123;</span><br><span class="line">  state: &#123;</span><br><span class="line">    students: [</span><br><span class="line">      &#123;<span class="attr">id</span>: <span class="number">110</span>, <span class="attr">name</span>: <span class="string">&#x27;张三&#x27;</span>, <span class="attr">age</span>: <span class="number">18</span>&#125;,</span><br><span class="line">      &#123;<span class="attr">id</span>: <span class="number">111</span>, <span class="attr">name</span>: <span class="string">&#x27;李四&#x27;</span>, <span class="attr">age</span>: <span class="number">24</span>&#125;,</span><br><span class="line">      &#123;<span class="attr">id</span>: <span class="number">112</span>, <span class="attr">name</span>: <span class="string">&#x27;王五&#x27;</span>, <span class="attr">age</span>: <span class="number">30</span>&#125;,</span><br><span class="line">      &#123;<span class="attr">id</span>: <span class="number">113</span>, <span class="attr">name</span>: <span class="string">&#x27;赵六&#x27;</span>, <span class="attr">age</span>: <span class="number">10</span>&#125;</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  mutations:&#123;&#125;,</span><br><span class="line">  actions:&#123;&#125;,</span><br><span class="line">  getters:&#123;</span><br><span class="line">    <span class="function"><span class="title">studentsShow</span>(<span class="params">state</span>)</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> state.students.filter(<span class="function"><span class="params">s</span> =&gt;</span> s.age &gt; <span class="number">20</span>)  <span class="comment">//返回年龄大于20的学生信息</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  modules:&#123;&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store</span><br></pre></td></tr></table></figure>
<p><code>App.vue</code>：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>我是App标题<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>获取学生信息：&#123;&#123;$store.getters.studentsShow&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span>  <span class="comment">&lt;!--获取store中getters属性的studentsShow信息--&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">  name: <span class="string">&#x27;App&#x27;</span>,</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Vuex-getters-show2.png" style="zoom:80%;" />
<p>如果想要获取年龄大于20岁的学生人数，可以如下操作：</p>
<p><code>index.js</code>：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Vuex <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"></span><br><span class="line">Vue.use(Vuex)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> Vuex.Store(&#123;</span><br><span class="line">  state: &#123;</span><br><span class="line">    students: [</span><br><span class="line">      &#123;<span class="attr">id</span>: <span class="number">110</span>, <span class="attr">name</span>: <span class="string">&#x27;张三&#x27;</span>, <span class="attr">age</span>: <span class="number">18</span>&#125;,</span><br><span class="line">      &#123;<span class="attr">id</span>: <span class="number">111</span>, <span class="attr">name</span>: <span class="string">&#x27;李四&#x27;</span>, <span class="attr">age</span>: <span class="number">24</span>&#125;,</span><br><span class="line">      &#123;<span class="attr">id</span>: <span class="number">112</span>, <span class="attr">name</span>: <span class="string">&#x27;王五&#x27;</span>, <span class="attr">age</span>: <span class="number">30</span>&#125;,</span><br><span class="line">      &#123;<span class="attr">id</span>: <span class="number">113</span>, <span class="attr">name</span>: <span class="string">&#x27;赵六&#x27;</span>, <span class="attr">age</span>: <span class="number">10</span>&#125;</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  mutations:&#123;&#125;,</span><br><span class="line">  actions:&#123;&#125;,</span><br><span class="line">  getters:&#123;</span><br><span class="line">    <span class="function"><span class="title">studentsShow</span>(<span class="params">state</span>)</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> state.students.filter(<span class="function"><span class="params">s</span> =&gt;</span> s.age &gt; <span class="number">20</span>)  <span class="comment">//返回年龄大于20的学生信息</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">studentsNumber</span>(<span class="params">state,getters</span>)</span> &#123;</span><br><span class="line">      <span class="comment">// return state.students.filter(s =&gt; s.age &gt; 20).length  //方式一：利用state属性</span></span><br><span class="line">      <span class="keyword">return</span> getters.studentsShow.length  <span class="comment">//方式二：直接利用getters属性</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  modules:&#123;&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store</span><br></pre></td></tr></table></figure>
<blockquote>
<p>说明：</p>
<ul>
<li>方式一：仍使用state属性，但是返回值书写过于繁杂</li>
<li>方式二：可以在参数中传递getters属性，利用<code>studentsShow</code>获取列表长度</li>
</ul>
</blockquote>
<p><code>App.vue</code>：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>我是App标题<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>获取学生信息：&#123;&#123;$store.getters.studentsShow&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span>  <span class="comment">&lt;!--获取store中getters属性的studentsShow信息--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>获取学生人数：&#123;&#123;$store.getters.studentsNumber&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span>  <span class="comment">&lt;!--获取store中getters属性的studentsNumber信息--&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Vuex-getters-show3.png" style="zoom:80%;" />
<p>如果学生过滤的条件想让前端用户输入而不是在<code>index.js</code>中写死，那么getters中定义的计算属性可以返回函数：</p>
<p><code>index.js</code>：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Vuex <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"></span><br><span class="line">Vue.use(Vuex)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> Vuex.Store(&#123;</span><br><span class="line">  state: &#123;</span><br><span class="line">    students: [</span><br><span class="line">      &#123;<span class="attr">id</span>: <span class="number">110</span>, <span class="attr">name</span>: <span class="string">&#x27;张三&#x27;</span>, <span class="attr">age</span>: <span class="number">18</span>&#125;,</span><br><span class="line">      &#123;<span class="attr">id</span>: <span class="number">111</span>, <span class="attr">name</span>: <span class="string">&#x27;李四&#x27;</span>, <span class="attr">age</span>: <span class="number">24</span>&#125;,</span><br><span class="line">      &#123;<span class="attr">id</span>: <span class="number">112</span>, <span class="attr">name</span>: <span class="string">&#x27;王五&#x27;</span>, <span class="attr">age</span>: <span class="number">30</span>&#125;,</span><br><span class="line">      &#123;<span class="attr">id</span>: <span class="number">113</span>, <span class="attr">name</span>: <span class="string">&#x27;赵六&#x27;</span>, <span class="attr">age</span>: <span class="number">10</span>&#125;</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  mutations:&#123;&#125;,</span><br><span class="line">  actions:&#123;&#125;,</span><br><span class="line">  getters:&#123;</span><br><span class="line">    <span class="function"><span class="title">studentsShow</span>(<span class="params">state</span>)</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">age</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> state.students.filter(<span class="function"><span class="params">s</span> =&gt;</span> s.age &gt; age)  <span class="comment">//返回年龄大于age的学生信息</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  modules:&#123;&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store</span><br></pre></td></tr></table></figure>
<p>还可以使用箭头函数简写：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">studentsShow</span>(<span class="params">state</span>)</span> &#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="function"><span class="params">age</span> =&gt;</span> &#123;</span><br><span class="line">         <span class="keyword">return</span> state.students.filter(<span class="function"><span class="params">s</span> =&gt;</span> s.age &gt; age)  <span class="comment">//返回年龄大于age的学生信息</span></span><br><span class="line">       &#125;  </span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure>
<p>可以在<code>App.vue</code>中动态接收参数：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>我是App标题<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>获取学生信息：&#123;&#123;$store.getters.studentsShow(25)&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span>  <span class="comment">&lt;!--studentsShow返回一个函数，这里可以传参--&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="Mutations">Mutations</h2>
<h3 id="基本使用-3">基本使用</h3>
<p>前面也提到过Mutations是为了更新store的状态（且官方也指出这是Vuex更新状态量的唯一方式）。</p>
<p>Mutation主要包括两部分：</p>
<ul>
<li>
<p>字符串的事件类型（type）：可以理解为就是函数的定义名称。这在组件中使用<code>commit</code>方法时会用到：</p>
<p><code>$store.commit('事件类型')</code></p>
</li>
<li>
<p>回调函数（handler）：该回调函数的第一个参数就是<code>state</code>。</p>
</li>
</ul>
<h3 id="参数传递-2">参数传递</h3>
<h4 id="参数唯一">参数唯一</h4>
<p>在通过mutation更新数据的时候，有时希望附带一些额外的参数。</p>
<p>仍然以计数器案例展示效果，现在希望在Vue模板中仅调用一个方法就实现不同的计数按钮：</p>
<p>首先就需要在<code>index.js</code>文件中的mutation内定义该方法（含参）：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Vuex <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"></span><br><span class="line">Vue.use(Vuex)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> Vuex.Store(&#123;</span><br><span class="line">  state: &#123;</span><br><span class="line">    counter: <span class="number">1</span></span><br><span class="line">  &#125;,</span><br><span class="line">  mutations:&#123;</span><br><span class="line">    <span class="function"><span class="title">increase</span>(<span class="params">state, num</span>)</span> &#123;  <span class="comment">//第二个参数num即为Vue对象中定义的methods方法中传递来的number</span></span><br><span class="line">      state.counter += num</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">decrease</span>(<span class="params">state, num</span>)</span> &#123;  <span class="comment">//第二个参数num即为Vue对象中定义的methods方法中传递来的number</span></span><br><span class="line">      state.counter -= num</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  actions:&#123;&#125;,</span><br><span class="line">  getters:&#123;&#125;,</span><br><span class="line">  modules:&#123;&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store</span><br></pre></td></tr></table></figure>
<p><code>App.vue</code>：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>我是App标题<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>&#123;&#123;$store.state.counter&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;add(5)&quot;</span>&gt;</span>+5<span class="tag">&lt;/<span class="name">button</span>&gt;</span>  <span class="comment">&lt;!--调用含参方法--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;reduce(5)&quot;</span>&gt;</span>-5<span class="tag">&lt;/<span class="name">button</span>&gt;</span>  <span class="comment">&lt;!--调用含参方法--&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">  name: <span class="string">&#x27;App&#x27;</span>,</span></span><br><span class="line">  methods: &#123;</span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">add</span>(<span class="params">number</span>)</span> &#123;  <span class="comment">//接收前端传来的参数</span></span></span><br><span class="line"><span class="javascript">      <span class="built_in">this</span>.$store.commit(<span class="string">&#x27;increase&#x27;</span>,number)  <span class="comment">//将参数传递给Vuex对象中的mutations内定义的方法</span></span></span><br><span class="line">    &#125;,</span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">reduce</span>(<span class="params">number</span>)</span> &#123;  <span class="comment">//接收前端传来的参数</span></span></span><br><span class="line"><span class="javascript">      <span class="built_in">this</span>.$store.commit(<span class="string">&#x27;decrease&#x27;</span>,number)  <span class="comment">//将参数传递给Vuex对象中的mutations内定义的方法</span></span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>说明：</p>
<p>仅依次案例展示mutation的参数传递，该参数可以为其他类型（如：对象）。</p>
</blockquote>
<h4 id="payload（多个参数）">payload（多个参数）</h4>
<p>实际上通过mutation更新状态量时，被传递的参数称为mutation的载荷(Payload，是一个对象)。在传递参数的数量仅为一个的时候，可以用上面的方法。如果要传递多个参数，建议使用Payload。</p>
<p>案例：在上一个计数器的基础上多增加一个描述信息传递：</p>
<p><code>index.js</code>：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Vuex <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"></span><br><span class="line">Vue.use(Vuex)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> Vuex.Store(&#123;</span><br><span class="line">  state: &#123;</span><br><span class="line">    counter: <span class="number">1</span></span><br><span class="line">  &#125;,</span><br><span class="line">  mutations:&#123;</span><br><span class="line">    <span class="function"><span class="title">increase</span>(<span class="params">state, payload</span>)</span> &#123;</span><br><span class="line">      state.counter += payload.number</span><br><span class="line">      <span class="built_in">console</span>.log(payload.desc)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">decrease</span>(<span class="params">state, payload</span>)</span> &#123;</span><br><span class="line">      state.counter -= payload.number</span><br><span class="line">      <span class="built_in">console</span>.log(payload.desc)</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  actions:&#123;&#125;,</span><br><span class="line">  getters:&#123;&#125;,</span><br><span class="line">  modules:&#123;&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store</span><br></pre></td></tr></table></figure>
<blockquote>
<p>说明：</p>
<p>Vue对象传递过来的对象类型的参数用payload接收，在使用的时候也从payload中调用多个参数。</p>
</blockquote>
<p><code>App.vue</code>：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>我是App标题<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>&#123;&#123;$store.state.counter&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;add(5)&quot;</span>&gt;</span>+5<span class="tag">&lt;/<span class="name">button</span>&gt;</span>  <span class="comment">&lt;!--调用含参方法--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;reduce(5)&quot;</span>&gt;</span>-5<span class="tag">&lt;/<span class="name">button</span>&gt;</span>  <span class="comment">&lt;!--调用含参方法--&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">  name: <span class="string">&#x27;App&#x27;</span>,</span></span><br><span class="line">  methods: &#123;</span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">add</span>(<span class="params">number</span>)</span> &#123;  <span class="comment">//接收前端传来的参数</span></span></span><br><span class="line"><span class="javascript">      <span class="built_in">this</span>.$store.commit(&#123;</span></span><br><span class="line"><span class="javascript">        type: <span class="string">&#x27;increase&#x27;</span>,  <span class="comment">//指明提交的事件类型</span></span></span><br><span class="line"><span class="javascript">        number,  <span class="comment">//参数一</span></span></span><br><span class="line"><span class="javascript">        desc: <span class="string">&#x27;执行计数器加法&#x27;</span>  <span class="comment">//参数二</span></span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">reduce</span>(<span class="params">number</span>)</span> &#123;  <span class="comment">//接收前端传来的参数</span></span></span><br><span class="line"><span class="javascript">      <span class="built_in">this</span>.$store.commit(&#123;</span></span><br><span class="line"><span class="javascript">        type: <span class="string">&#x27;decrease&#x27;</span>,  <span class="comment">//指明提交的事件类型</span></span></span><br><span class="line"><span class="javascript">        number,  <span class="comment">//参数一</span></span></span><br><span class="line"><span class="javascript">        desc: <span class="string">&#x27;执行计数器减法&#x27;</span>  <span class="comment">//参数二</span></span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>说明：</p>
<p>commit的参数为一个对象，其中包含有type用于指明提交的事件类型，以及其他参数。</p>
</blockquote>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Vuex-mutation-show1.gif" style="zoom:80%;" />
<h3 id="响应式规则">响应式规则</h3>
<blockquote>
<p>注意：vue4版本已更新该规则。</p>
</blockquote>
<p>如果是在state中已经定义并且初始化的数据，则这些数据都是响应式的（即对数据做修改后会在页面实时显示），但是未在state中定义的数据，并且想要在方法中进行增添或删除的操作，则该操作就是非响应式的（虽然数据被已修改，但是并不会在页面实时显示）。</p>
<p>以学生信息增添为例：</p>
<p>定义在state的学生对象中共有<code>id</code>、<code>name</code>、<code>age</code>三种属性，如果想要增添一个<code>address</code>的信息，有可能会出现非响应式的情况：</p>
<p><code>index.js</code>：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Vuex <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"></span><br><span class="line">Vue.use(Vuex)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> Vuex.Store(&#123;</span><br><span class="line">  state: &#123;</span><br><span class="line">    studetInfo: &#123;</span><br><span class="line">      id: <span class="number">110</span>, </span><br><span class="line">      name: <span class="string">&#x27;张三&#x27;</span>, </span><br><span class="line">      age: <span class="number">18</span>&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  mutations:&#123;</span><br><span class="line">    <span class="function"><span class="title">updateInfo</span>(<span class="params">state</span>)</span> &#123;</span><br><span class="line">      state.studetInfo[<span class="string">&#x27;address&#x27;</span>] = <span class="string">&#x27;北京&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  actions:&#123;&#125;,</span><br><span class="line">  getters:&#123;&#125;,</span><br><span class="line">  modules:&#123;&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store</span><br></pre></td></tr></table></figure>
<blockquote>
<p>说明：</p>
<p>这里使用的更新数据的方式为：<code>state.studetInfo['address'] = '北京'</code></p>
</blockquote>
<p><code>App.vue</code>：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>我是App标题<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>&#123;&#123;$store.state.studetInfo&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;updateInfo&quot;</span>&gt;</span>更新<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">  name: <span class="string">&#x27;App&#x27;</span>,</span></span><br><span class="line">  methods: &#123;</span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">updateInfo</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> <span class="built_in">this</span>.$store.commit(<span class="string">&#x27;updateInfo&#x27;</span>)</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>效果如下：</p>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Vuex-mutation响应式-show1.gif" style="zoom:80%;" />
<p>可以看到右侧确实显示有添加了<code>address</code>的信息，但是左侧页面并无显示。</p>
<p>如果想要做到响应式，则需要使用<code>Vue.set</code>方法：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">updateInfo</span>(<span class="params">state</span>)</span> &#123;</span><br><span class="line">      Vue.set(state.studetInfo, <span class="string">&#x27;address&#x27;</span>, <span class="string">&#x27;北京&#x27;</span>)</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>Vue.set</code>参数说明：</p>
<p><code>Vue.set(状态量名, 属性名, 属性值)</code></p>
</blockquote>
<p>如果要删除的话，类似的可以使用<code>Vue.delete</code>方法：</p>
<p><code>Vue.delete(状态量名, 属性名)</code></p>
<p>例如删除学生<code>age</code>属性：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">updateInfo</span>(<span class="params">state</span>)</span> &#123;</span><br><span class="line">      Vue.delete(state.studetInfo, <span class="string">&#x27;age&#x27;</span>)</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h3 id="常量类型">常量类型</h3>
<p>在修改状态量时规定需要经过mutations，但是在实际开发中会定义许多事件类型（方法名称），相应的在vue对象中也需要提交不同的commit参数。不便于后期的管理，也容易出错。因此官方给出了一种方案：使用常量代替Mutations中的事件类型。</p>
<p>（仍以计数器案例展示）</p>
<p>首先在store文件夹中创建<code>mutations-types.js</code>，在其中定义常量：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> INCREASE = <span class="string">&#x27;increase&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> DECREASE = <span class="string">&#x27;decrease&#x27;</span></span><br></pre></td></tr></table></figure>
<p>然后在<code>index.js</code>中导入并使用这些常量：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Vuex <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> types <span class="keyword">from</span> <span class="string">&#x27;./mutations-types&#x27;</span>  <span class="comment">//导入方式一：*全部直接导入</span></span><br><span class="line"></span><br><span class="line">Vue.use(Vuex)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> Vuex.Store(&#123;</span><br><span class="line">  state: &#123;</span><br><span class="line">    counter: <span class="number">1</span></span><br><span class="line">  &#125;,</span><br><span class="line">  mutations:&#123;</span><br><span class="line">    [types.INCREASE](state) &#123;  <span class="comment">//使用INCREASE常量(注意格式)</span></span><br><span class="line">      state.counter++</span><br><span class="line">    &#125;,</span><br><span class="line">    [types.DECREASE](state) &#123;  <span class="comment">//使用DECREASE常量(注意格式)</span></span><br><span class="line">      state.counter--</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  actions:&#123;&#125;,</span><br><span class="line">  getters:&#123;</span><br><span class="line">  &#125;,</span><br><span class="line">  modules:&#123;&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意：</p>
<p>此时的事件类型需要用中括号包裹常量使用。</p>
</blockquote>
<p>在<code>App.vue</code>中导入并使用这些常量：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>我是App标题<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>&#123;&#123;$store.state.counter&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;add&quot;</span>&gt;</span>+<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;reduce&quot;</span>&gt;</span>-<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> &#123;INCREASE,DECREASE&#125; <span class="keyword">from</span> <span class="string">&#x27;./store/mutations-types&#x27;</span>  <span class="comment">//导入方式二：按需导入</span></span></span><br><span class="line"></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">  name: <span class="string">&#x27;App&#x27;</span>,</span></span><br><span class="line">  methods: &#123;</span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">add</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">this</span>.$store.commit(INCREASE)  <span class="comment">//使用INCREASE常量</span></span></span><br><span class="line">    &#125;,</span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">reduce</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">this</span>.$store.commit(DECREASE)  <span class="comment">//使用DECREASE常量</span></span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="Actions">Actions</h2>
<h3 id="Mutations同步说明">Mutations同步说明</h3>
<p>Vuex要求Mutation中更新状态量的方法必须是同步方法，如果在其中实现异步方法，那么Devtools检测工具就会失效，无法跟踪状态量的变化。</p>
<p>下面仍以<code>setTimeout()</code>代替实现异步方法，做一个信息打印案例：</p>
<p><code>index.js</code>：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Vuex <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"></span><br><span class="line">Vue.use(Vuex)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> Vuex.Store(&#123;</span><br><span class="line">  state: &#123;</span><br><span class="line">    message: <span class="string">&#x27;原始信息&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  mutations:&#123;</span><br><span class="line">    <span class="function"><span class="title">showMessage</span>(<span class="params">state</span>)</span> &#123;</span><br><span class="line">      <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        state.message = <span class="string">&#x27;更新信息&#x27;</span>  </span><br><span class="line">      &#125;,<span class="number">1000</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  actions:&#123;&#125;,</span><br><span class="line">  getters:&#123;</span><br><span class="line">  &#125;,</span><br><span class="line">  modules:&#123;&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store</span><br></pre></td></tr></table></figure>
<p><code>App.vue</code>：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>我是App标题<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>&#123;&#123;$store.state.message&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;update&quot;</span>&gt;</span>更新<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">  name: <span class="string">&#x27;App&#x27;</span>,</span></span><br><span class="line">  methods: &#123;</span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">update</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> <span class="built_in">this</span>.$store.commit(<span class="string">&#x27;showMessage&#x27;</span>)</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>效果如下：</p>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Vuex-actions-show1.gif" style="zoom:80%;" />
<p>可以看到页面信息进行了更新，但是检测工具并未捕捉到状态量的变化。（实际状态量确实发生了改变）</p>
<blockquote>
<p>说明：插件已开启自动更新状态量设置。</p>
</blockquote>
<p>官方规定如果要定义异步方法（请求），需要经过Actions。</p>
<h3 id="基本使用-4">基本使用</h3>
<h4 id="操作">操作</h4>
<blockquote>
<p>说明：</p>
<p>Actions仍然可以像Mutations一样在方法名处用常量类型调用方法，使用格式不变。</p>
<p>（出于演示方便，以下的代码中并未使用常量类型的形式）</p>
</blockquote>
<p>Actions类似于Mutations，只是用来实现异步方法，使用的方式也类似。</p>
<p>接下来使用Actions完成上一个案例实现：</p>
<p><code>index.js</code>：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Vuex <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"></span><br><span class="line">Vue.use(Vuex)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> Vuex.Store(&#123;</span><br><span class="line">  state: &#123;</span><br><span class="line">    message: <span class="string">&#x27;原始信息&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  mutations:&#123;</span><br><span class="line">    <span class="function"><span class="title">showMessage</span>(<span class="params">state</span>)</span> &#123;</span><br><span class="line">      state.message = <span class="string">&#x27;更新信息&#x27;</span>  <span class="comment">//同步方法</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  actions:&#123;</span><br><span class="line">    <span class="function"><span class="title">updateMessage</span>(<span class="params">context</span>)</span> &#123;  <span class="comment">//参数为context（上下文）</span></span><br><span class="line">      <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;  <span class="comment">//实现异步操作（请求）</span></span><br><span class="line">        context.commit(<span class="string">&#x27;showMessage&#x27;</span>)  <span class="comment">//调用mutations中的同步方法</span></span><br><span class="line">      &#125;, <span class="number">1000</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  getters:&#123;</span><br><span class="line">  &#125;,</span><br><span class="line">  modules:&#123;&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store</span><br></pre></td></tr></table></figure>
<blockquote>
<p>说明：</p>
<ul>
<li>
<p><code>context</code>：上下文。是actions定义异步方法中的参数，是和state对象具有相同的方法和属性的对象。所以可以通过context去进行<code>commit</code>相关的操作, 也可以获取<code>context.state</code>等。</p>
</li>
<li>
<p>异步方法（请求）的实现思路如下：</p>
<p>在actions中定义方法去实现异步请求，如果需要改变状态量，则仍需要调用mutations中的同步方法，在同步方法中实现对状态量的更新。</p>
<p>注意：如果跳过mutations直接改变状态量是没有效果的。</p>
</li>
</ul>
</blockquote>
<p><code>App.vue</code>：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>我是App标题<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>&#123;&#123;$store.state.message&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;update&quot;</span>&gt;</span>更新<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">  name: <span class="string">&#x27;App&#x27;</span>,</span></span><br><span class="line">  methods: &#123;</span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">update</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> <span class="built_in">this</span>.$store.dispatch(<span class="string">&#x27;updateMessage&#x27;</span>)  <span class="comment">//使用$store.dispatch调用actions中定义的异步方法</span></span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>说明：</p>
<p>在Vue实例中通过<code>$store.dispatch('方法名')</code>去调用actions中定义的异步方法。</p>
</blockquote>
<p>效果如下：</p>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Vuex-actions-show2.gif" style="zoom:80%;" />
<p>可以看到插件可以正常跟踪到状态量的变化情况。</p>
<h4 id="payload">payload</h4>
<p>同样的，actions中也支持payload对象的参数传递。</p>
<p>案例：vue实例传递一条消息（以对象的形式），actions进行接收并传递给mutations，最后由mutations中的方法执行控制台打印。</p>
<p><code>index.js</code>：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Vuex <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"></span><br><span class="line">Vue.use(Vuex)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> Vuex.Store(&#123;</span><br><span class="line">  state: &#123;</span><br><span class="line">    message: <span class="string">&#x27;原始信息&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  mutations:&#123;</span><br><span class="line">    <span class="function"><span class="title">showMessage</span>(<span class="params">state, payload</span>)</span> &#123;  <span class="comment">//接收从actions中的updateMessage方法传来的payload</span></span><br><span class="line">      state.message = <span class="string">&#x27;更新信息&#x27;</span></span><br><span class="line">      <span class="built_in">console</span>.log(payload.message)  <span class="comment">//打印payload中的信息</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  actions:&#123;</span><br><span class="line">    <span class="function"><span class="title">updateMessage</span>(<span class="params">context, payload</span>)</span> &#123;  <span class="comment">//接收从Vue实例中传来的payload</span></span><br><span class="line">      <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        context.commit(<span class="string">&#x27;showMessage&#x27;</span>, payload)  <span class="comment">//传递给mutations中的showMessage方法</span></span><br><span class="line">      &#125;, <span class="number">1000</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  getters:&#123;</span><br><span class="line">  &#125;,</span><br><span class="line">  modules:&#123;&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store</span><br></pre></td></tr></table></figure>
<p><code>App.vue</code>：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>我是App标题<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>&#123;&#123;$store.state.message&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;update&quot;</span>&gt;</span>更新<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">  name: <span class="string">&#x27;App&#x27;</span>,</span></span><br><span class="line">  methods: &#123;</span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">update</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> <span class="built_in">this</span>.$store.dispatch(&#123;</span></span><br><span class="line"><span class="javascript">        type: <span class="string">&#x27;updateMessage&#x27;</span>,  <span class="comment">//指定传递给actions中定义的updateMessage方法</span></span></span><br><span class="line"><span class="javascript">        message: <span class="string">&#x27;原始信息已被修改&#x27;</span></span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>（效果展示省略）</p>
<h3 id="Promise的应用">Promise的应用</h3>
<p>如果希望Vue实例在调用异步方法（请求）时返回一些执行结果（用以判断请求是否成功）可以结合Promise使用。</p>
<p>案例需求同上：</p>
<p><code>index.js</code>：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Vuex <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"></span><br><span class="line">Vue.use(Vuex)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> Vuex.Store(&#123;</span><br><span class="line">  state: &#123;</span><br><span class="line">    message: <span class="string">&#x27;原始信息&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  mutations:&#123;</span><br><span class="line">    <span class="function"><span class="title">showMessage</span>(<span class="params">state</span>)</span> &#123;</span><br><span class="line">      state.message = <span class="string">&#x27;更新信息&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  actions:&#123;</span><br><span class="line">    <span class="function"><span class="title">updateMessage</span>(<span class="params">context</span>)</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          context.commit(<span class="string">&#x27;showMessage&#x27;</span>)</span><br><span class="line">          resolve(<span class="string">&#x27;信息已完成更新&#x27;</span>)  <span class="comment">//模拟异步请求到的数据</span></span><br><span class="line">        &#125;, <span class="number">1000</span>)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  getters:&#123;</span><br><span class="line">  &#125;,</span><br><span class="line">  modules:&#123;&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store</span><br></pre></td></tr></table></figure>
<blockquote>
<p>说明：</p>
<p>在updateMessage方法中返回一个新的<code>Promise</code>对象，内部实现异步请求的操作，并通过<code>resolve</code>将数据传递给<code>then</code>进一步处理。但是<code>then</code>会在Vue实例中实现。</p>
</blockquote>
<p><code>App.vue</code>：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>我是App标题<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>&#123;&#123;$store.state.message&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;update&quot;</span>&gt;</span>更新<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">  name: <span class="string">&#x27;App&#x27;</span>,</span></span><br><span class="line">  methods: &#123;</span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">update</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> <span class="built_in">this</span>.$store.dispatch(<span class="string">&#x27;updateMessage&#x27;</span>).then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(data)  <span class="comment">//对请求到的数据进行处理</span></span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>重点理解：</p>
<p>update方法返回了actions中定义的updateMessage方法，而该方法返回了一个新的<code>Promise</code>对象，所以在这里<code>this.$store.dispatch('updateMessage')</code>就是一个<code>Promise</code>对象，因而可以在其后直接链接一个<code>then</code>函数，内部的<code>data</code>参数就接收了来自actions中利用Promise异步请求来的数据。</p>
</blockquote>
<p>效果展示：</p>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Vuex-actions-show3.gif" style="zoom:80%;" />
<h2 id="modules">modules</h2>
<p>Vue实例中很多状态量都是交由Vuex中的store来保管，但是在当应用非常复杂时，store对象就会变得非常臃肿，这时就可以使用modules对store对象中的状态量进行分模块进行抽离。</p>
<p>每个模块都有自己的<code>state</code>、<code>mutations</code>、<code>actions</code>、<code>getters</code>，也有<code>modules</code>（但一般不会再进行模块抽离）</p>
<h3 id="基本使用-5">基本使用</h3>
<p>可以直接在store中定义各类modules，但是建议将其抽离出来单独写，然后在store中注册，格式如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> moduleA = &#123;  <span class="comment">//模块A</span></span><br><span class="line">  state: &#123;...&#125;,</span><br><span class="line">  mutations: &#123;...&#125;,</span><br><span class="line">  actions: &#123;...&#125;,</span><br><span class="line">  getters: &#123;...&#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> moduleB = &#123;  <span class="comment">//模块B</span></span><br><span class="line">  state: &#123;...&#125;,</span><br><span class="line">  mutations: &#123;...&#125;,</span><br><span class="line">  actions: &#123;...&#125;,</span><br><span class="line">  getters: &#123;...&#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> Vuex.store(&#123;</span><br><span class="line">  modules: &#123;</span><br><span class="line">    a: moduleA,  <span class="comment">//注册模块A</span></span><br><span class="line">    b: moduleB,  <span class="comment">//注册模块B</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="state使用">state使用</h3>
<p><code>index.js</code>：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Vuex <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"></span><br><span class="line">Vue.use(Vuex)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ModuleTest = &#123;</span><br><span class="line">  state: &#123;</span><br><span class="line">    message: <span class="string">&#x27;我是模块信息&#x27;</span>  <span class="comment">//定义state中的message</span></span><br><span class="line">  &#125;,</span><br><span class="line">  mutations:&#123;&#125;,</span><br><span class="line">  actions:&#123;&#125;,</span><br><span class="line">  getters:&#123;&#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> Vuex.Store(&#123;</span><br><span class="line">  state: &#123;&#125;,</span><br><span class="line">  mutations:&#123;&#125;,</span><br><span class="line">  actions:&#123;&#125;,</span><br><span class="line">  getters:&#123;&#125;,</span><br><span class="line">  modules:&#123;</span><br><span class="line">    ModuleTest: ModuleTest</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store</span><br></pre></td></tr></table></figure>
<p><code>App.vue</code>：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>我是App标题<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>&#123;&#123;$store.state.ModuleTest.message&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">  name: <span class="string">&#x27;App&#x27;</span>,</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>说明：</p>
<p>用法：<code>$store.state.模块名.属性名</code></p>
</blockquote>
<p>效果如下：</p>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Vuex-modules-show1.png" style="zoom:80%;" />
<h3 id="getters使用">getters使用</h3>
<p><code>index.js</code>：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Vuex <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"></span><br><span class="line">Vue.use(Vuex)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ModuleTest = &#123;</span><br><span class="line">  state: &#123;</span><br><span class="line">    counter: <span class="number">1</span>  <span class="comment">//模块中的数据</span></span><br><span class="line">  &#125;,</span><br><span class="line">  mutations:&#123;&#125;,</span><br><span class="line">  actions:&#123;&#125;,</span><br><span class="line">  getters:&#123;</span><br><span class="line">    <span class="function"><span class="title">mulModule</span>(<span class="params">state</span>)</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> state.counter*<span class="number">100</span>  <span class="comment">//修改模块中的数据</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">mulRoot</span>(<span class="params">state, mulModule, rootState</span>)</span> &#123;  <span class="comment">//注意参数位置</span></span><br><span class="line">      <span class="keyword">return</span> rootState.counter*<span class="number">100</span>  <span class="comment">//修改根中的数据</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> Vuex.Store(&#123;</span><br><span class="line">  state: &#123;</span><br><span class="line">    counter: <span class="number">2</span>  <span class="comment">//根中的数据</span></span><br><span class="line">  &#125;,</span><br><span class="line">  mutations:&#123;&#125;,</span><br><span class="line">  actions:&#123;&#125;,</span><br><span class="line">  getters:&#123;&#125;,</span><br><span class="line">  modules:&#123;</span><br><span class="line">    ModuleTest: ModuleTest</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store</span><br></pre></td></tr></table></figure>
<blockquote>
<p>说明：</p>
<p>模块中getters方法内参数的定义：<code>方法名(state, 其他方法名, rootState)</code></p>
<p>注意参数位置不能颠倒。</p>
</blockquote>
<p><code>App.vue</code>：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>我是App标题<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>Modules原始数据：&#123;&#123;$store.state.ModuleTest.counter&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>修改Modules数据：&#123;&#123;$store.getters.mulModule&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>Root原始数据：&#123;&#123;$store.state.counter&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>修改Root数据：&#123;&#123;$store.getters.mulRoot&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">  name: <span class="string">&#x27;App&#x27;</span>,</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>说明：</p>
<p>在访问模块中的getters方法时不用特意指明模块，直接指出方法名就好，格式：</p>
<p><code>$store.getters.方法名</code></p>
</blockquote>
<p>效果如下：</p>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Vuex-modules-show2.png" style="zoom:80%;" />
<h3 id="mutations使用">mutations使用</h3>
<p><code>index.js</code>：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Vuex <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"></span><br><span class="line">Vue.use(Vuex)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ModuleTest = &#123;</span><br><span class="line">  state: &#123;</span><br><span class="line">    counter: <span class="number">1</span></span><br><span class="line">  &#125;,</span><br><span class="line">  mutations:&#123;</span><br><span class="line">    <span class="function"><span class="title">increase</span>(<span class="params">state, payload</span>)</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(payload.message)</span><br><span class="line">      <span class="keyword">return</span> state.counter += <span class="number">1</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">decrease</span>(<span class="params">state, payload</span>)</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(payload.message)</span><br><span class="line">      <span class="keyword">return</span> state.counter -= <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  actions:&#123;&#125;,</span><br><span class="line">  getters:&#123;&#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> Vuex.Store(&#123;</span><br><span class="line">  state: &#123;&#125;,</span><br><span class="line">  mutations:&#123;&#125;,</span><br><span class="line">  actions:&#123;&#125;,</span><br><span class="line">  getters:&#123;&#125;,</span><br><span class="line">  modules:&#123;</span><br><span class="line">    ModuleTest: ModuleTest</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store</span><br></pre></td></tr></table></figure>
<blockquote>
<p>说明：</p>
<p>操作与store中的mutations一致。</p>
</blockquote>
<p><code>App.vue</code>：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>我是App标题<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>Modules数据：&#123;&#123;$store.state.ModuleTest.counter&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;add&quot;</span>&gt;</span>+<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;reduce&quot;</span>&gt;</span>-<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">  name: <span class="string">&#x27;App&#x27;</span>,</span></span><br><span class="line">  methods: &#123;</span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">add</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> <span class="built_in">this</span>.$store.commit(&#123;</span></span><br><span class="line"><span class="javascript">        type: <span class="string">&#x27;increase&#x27;</span>,</span></span><br><span class="line"><span class="javascript">        message: <span class="string">&#x27;数据已增加&#x27;</span></span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">reduce</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> <span class="built_in">this</span>.$store.commit(&#123;</span></span><br><span class="line"><span class="javascript">        type: <span class="string">&#x27;decrease&#x27;</span>,</span></span><br><span class="line"><span class="javascript">        message: <span class="string">&#x27;数据已减少&#x27;</span></span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>说明：</p>
<p>在访问模块中的mutations方法时不用特意指明模块，直接指出方法名就好，格式：</p>
<ul>
<li><code>$store.commit('方法名')</code></li>
<li><code>$store.commit(payload对象)</code></li>
</ul>
</blockquote>
<p>效果如下：</p>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Vuex-modules-show3.gif" style="zoom:80%;" />
<h3 id="actions使用">actions使用</h3>
<p><code>index.js</code>：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Vuex <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"></span><br><span class="line">Vue.use(Vuex)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ModuleTest = &#123;</span><br><span class="line">  state: &#123;</span><br><span class="line">    message: <span class="string">&#x27;Module原始信息&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  mutations:&#123;</span><br><span class="line">    <span class="function"><span class="title">updateMessage</span>(<span class="params">state</span>)</span> &#123;</span><br><span class="line">      state.message = <span class="string">&#x27;Module信息已被修改&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  actions:&#123;</span><br><span class="line">    <span class="function"><span class="title">update</span>(<span class="params">context</span>)</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          context.commit(<span class="string">&#x27;updateMessage&#x27;</span>)</span><br><span class="line">          resolve(<span class="string">&#x27;信息修改已完成&#x27;</span>)</span><br><span class="line">        &#125;, <span class="number">1000</span>)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  getters:&#123;&#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> Vuex.Store(&#123;</span><br><span class="line">  state: &#123;&#125;,</span><br><span class="line">  mutations:&#123;&#125;,</span><br><span class="line">  actions:&#123;&#125;,</span><br><span class="line">  getters:&#123;&#125;,</span><br><span class="line">  modules:&#123;</span><br><span class="line">    ModuleTest: ModuleTest</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store</span><br></pre></td></tr></table></figure>
<blockquote>
<p>说明：</p>
<p>操作与store中的actions一致。</p>
</blockquote>
<p><code>App.vue</code>：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>我是App标题<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>&#123;&#123;$store.state.ModuleTest.message&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;updateM&quot;</span>&gt;</span>更新<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">  name: <span class="string">&#x27;App&#x27;</span>,</span></span><br><span class="line">  methods: &#123;</span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">updateM</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> <span class="built_in">this</span>.$store.dispatch(<span class="string">&#x27;update&#x27;</span>).then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(data)</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>说明：</p>
<p>在访问模块中的actions方法时不用特意指明模块，直接指出方法名就好，格式：</p>
<p><code>$store.dispatch('方法名')</code></p>
</blockquote>
<p>效果展示：</p>
<img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Vuex-modules-show4.gif" style="zoom:80%;" />
<h2 id="项目结构">项目结构</h2>
<p>为了更清晰明了的编写项目，以及后期方便维护，建议将Vuex.Store对象中的<code>mutations</code>、<code>actions</code>、<code>getters</code>、<code>modules</code>进行抽离，建立新的文件（<code>state</code>状态量仍然在<code>index.js</code>文件中）：</p>
<p><img src="https://gitee.com/CNhuazhu/tu-chuang1/raw/master/img-blog/Vuex-%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84.png" alt=""></p>
<p><code>index.js</code>：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Vuex <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> mutations <span class="keyword">from</span> <span class="string">&#x27;./mutations&#x27;</span></span><br><span class="line"><span class="keyword">import</span> actions <span class="keyword">from</span> <span class="string">&#x27;./actions&#x27;</span></span><br><span class="line"><span class="keyword">import</span> getters <span class="keyword">from</span> <span class="string">&#x27;./getters&#x27;</span></span><br><span class="line"><span class="keyword">import</span> ModuleA <span class="keyword">from</span> <span class="string">&#x27;./modules/ModuleA&#x27;</span></span><br><span class="line"><span class="keyword">import</span> ModuleB <span class="keyword">from</span> <span class="string">&#x27;./modules/ModuleB&#x27;</span></span><br><span class="line"></span><br><span class="line">Vue.use(Vuex)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> state = &#123;</span><br><span class="line">  message: <span class="string">&#x27;项目结构&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> Vuex.Store(&#123;</span><br><span class="line">  state,</span><br><span class="line">  mutations,</span><br><span class="line">  actions,</span><br><span class="line">  getters,</span><br><span class="line">  modules:&#123;</span><br><span class="line">    ModuleA: ModuleA,</span><br><span class="line">    ModuleB: ModuleB,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store</span><br></pre></td></tr></table></figure>
<p><code>mutations.js</code>：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="function"><span class="title">Mmethod1</span>(<span class="params">state, payload</span>)</span> &#123;...&#125;,</span><br><span class="line">  <span class="function"><span class="title">Mmethod2</span>(<span class="params">state, payload</span>)</span> &#123;...&#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>actions.js</code>：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="function"><span class="title">Amethod1</span>(<span class="params">context</span>)</span> &#123;...&#125;,</span><br><span class="line">  <span class="function"><span class="title">Amethod2</span>(<span class="params">context</span>)</span> &#123;...&#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>getters.js</code>：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="function"><span class="title">Gmethod1</span>(<span class="params">state</span>)</span> &#123;...&#125;,</span><br><span class="line">  <span class="function"><span class="title">Gmethod2</span>(<span class="params">state, Gmethod1</span>)</span> &#123;...&#125;,</span><br><span class="line">  <span class="function"><span class="title">Gmethod3</span>(<span class="params">state, Gmethod2, rootState</span>)</span> &#123;...&#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>模块会再新建一个文件夹：</p>
<p><code>./modules/ModuleA</code>：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    state: &#123;...&#125;,</span><br><span class="line">    mutations: &#123;...&#125;,</span><br><span class="line">    actions: &#123;...&#125;,</span><br><span class="line">    getters: &#123;...&#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>./modules/ModuleB</code>：</p>
<h2 id="code￼48"><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  state: &#123;...&#125;,</span><br><span class="line">  mutations: &#123;...&#125;,</span><br><span class="line">  actions: &#123;...&#125;,</span><br><span class="line">  getters: &#123;...&#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></h2>
<h1>后记</h1>
<p>在做项目的时候也需要注意一些代码结构的细节，到后期代码量增加的时候便于维护。</p>
]]></content>
      <categories>
        <category>学习笔记</category>
      </categories>
      <tags>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>操作系统学习笔记-虚拟内存</title>
    <url>/2021/05/24/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\css\APlayer.min.css"><script src="\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\js\Meting.min.js"></script><h1>前言</h1>
<p><em>正在学习操作系统，记录笔记。</em></p>
<blockquote>
<p>参考资料：</p>
<p>《操作系统（精髓与设计原理 第8版） 》</p>
</blockquote>
<hr>
<h1>第八章：虚拟内存</h1>
<p>在正式开始前先介绍一下本章要用到的术语：</p>
<table>
<thead>
<tr>
<th>术语</th>
<th>解释</th>
</tr>
</thead>
<tbody>
<tr>
<td>虚拟内存（Virtual memory）</td>
<td>一种存储器分配方案，在这种分配方案中，辅助存储器可以被寻址，就好像它是主存储器的一部分一样。程序可用于引用内存的地址与内存系统用于标识物理存储站点的地址相区别，程序生成的地址自动转换为相应的机器地址。虚拟存储器的大小受到计算机系统寻址方案和可用辅助存储器数量的限制，而不受主存储器位置的实际数量的限制</td>
</tr>
<tr>
<td>虚拟地址（Virtual address）</td>
<td>在虚拟内存中分配给某一位置的地址，它使得该位置可被访问，就好像是主存的一部分那样</td>
</tr>
<tr>
<td>虚拟地址空间（Virtual address space）</td>
<td>分配给进程的虚拟存储</td>
</tr>
<tr>
<td>地址空间（Address space）</td>
<td>用于某进程的内存地址范围</td>
</tr>
<tr>
<td>实地址（Real address）</td>
<td>内存中存储位置的地址</td>
</tr>
</tbody>
</table>
<h2 id="硬件和控制结构">硬件和控制结构</h2>
<p>由上一章我们可以了解到分页和分段机制在内存管理中取得的根本性突破：</p>
<ul>
<li>进程中的所有内存访问都是逻辑地址，这些逻辑地址会在运行时动态地转换为物理地址。这意味着一个进程可被换入或换出内存，因此进程可在执行过程的不同时刻占据内存中的不同区域。</li>
<li>一个进程可划分为许多块（页和段），在执行过程中，这些块不需要连续地位于内存中。</li>
</ul>
<p>那么我们由此可以思考：如果保有上述这两个特点，在程序执行中，不需要进程的所有部分（页或段）都被加载到内存中，如果内存中保存有待取的下一条指令的所在块（页或段）以及待访问的下一个数据单元所在的块，那么进程可以持续运行下去。</p>
<p>接着就来描述一下程序如何以这样的方式在内存中运行：</p>
<ul>
<li>
<p>一个新进程被载入内存，操作系统在最初只是载入新程序最开处的一个或几个块（页或段），而非全部。</p>
</li>
<li>
<p>**常驻集：**进程执行的任何时候都在内存的部分称为进程的常驻集。</p>
<p>只要所有内存访问都是访问常驻集中的单元，执行就可以顺利进行。</p>
</li>
<li>
<p>当处理器需要访问一个不在内存中的逻辑地址时：</p>
<ul>
<li>会产生一个中断（缺页中断），即出现了内存访问故障。</li>
<li>操作系统会将此进程置于阻塞态。</li>
</ul>
</li>
<li>
<p>操作系统会把包含引发访问故障的逻辑地址的进程块读入内存，具体流程如下：</p>
<ul>
<li>操作系统产生一个磁盘I/O读请求。</li>
<li>在执行磁盘I/O期间，操作系统可以调度另一个进程运行。</li>
<li>当需要的块读入内存后，再产生一个中断，操作系统把之前由于缺少进程块而被阻塞的进程置位就绪态。</li>
</ul>
</li>
<li>
<p>进程继续执行。</p>
</li>
</ul>
<p>这种执行进程的策略有以下优点（暂且不考虑由于中断、载入新块所带来的效率影响）：</p>
<ul>
<li>在内存中保留多个进程：
<ul>
<li>对于任何特定进程，都只载入某些部分到内存中，这样内存会有足够的空间运行多个进程。</li>
<li>由于内存中存在的进程数量增加，那么在任意时刻总会有至少一个进程处于就绪态，进而使得处理器没有闲置状态，提高了效率。</li>
</ul>
</li>
<li>支持运行大于主存的程序：
<ul>
<li>大程序可以分成小块，通过某种覆盖策略分别加载。（基于分段或分页的虚拟内存）</li>
</ul>
</li>
</ul>
<p><strong>实存储器</strong>（简称：实存，real memory）：就是主存（main memory），进程只能在此运行。</p>
<p><strong>虚拟内存</strong>（简称：虚存，virtual memory）：</p>
<ul>
<li>通常分配在磁盘上</li>
<li>支持更有效的系统并发度</li>
<li>可以解除用户与内存之间没有必要的紧密约束</li>
</ul>
<blockquote>
<p>下表总结了使用和不使用虚存情况下分页和分段的特点：</p>
<table>
<thead>
<tr>
<th>简单分页</th>
<th>虚存分页</th>
<th>简单分段</th>
<th>虚存分段</th>
</tr>
</thead>
<tbody>
<tr>
<td>内存划分为大小固定的小块，称为页框</td>
<td>内存划分为大小固定的小块，称为页框</td>
<td>内存未划分</td>
<td>内存未划分</td>
</tr>
<tr>
<td>程序被编译器或内存管理系统划分为页</td>
<td>程序被编译器或内存管理系统划分为页</td>
<td>由程序员给编译器指定程序段（即由程序员决定）</td>
<td>由程序员给编译器指定程序段（即由程序员决定）</td>
</tr>
<tr>
<td>页框中有内部碎片</td>
<td>页框中有内部碎片</td>
<td>无内部碎片</td>
<td>无内部碎片</td>
</tr>
<tr>
<td>无外部碎片</td>
<td>无外部碎片</td>
<td>有外部碎片</td>
<td>有外部碎片</td>
</tr>
<tr>
<td>操作系统须为每个进程维护一个页表，以说明每页对应的页框</td>
<td>操作系统须为每个进程维护一个页表，以说明每页对应的页框</td>
<td>操作系统须为每个进程维护一个段表，以说明每段中的加载地址和长度</td>
<td>操作系统须为每个进程维护一个段表，以说明每段中的加载地址和长度</td>
</tr>
<tr>
<td>操作系统须维护一个空闲页框列表</td>
<td>操作系统须维护一个空闲页框列表</td>
<td>操作系统须维护一个内存中的空闲空洞列表</td>
<td>操作系统须维护一个内存中的空闲空洞列表</td>
</tr>
<tr>
<td>处理器使用页号和偏移量来计算绝对地址</td>
<td>处理器使用页号和偏移量来计算绝对地址</td>
<td>处理器使用段号和偏移量来计算绝对地址</td>
<td>处理器使用段号和偏移量来计算绝对地址</td>
</tr>
<tr>
<td>进程运行时，它的所有页必须都在内存中，除非使用了覆盖技术</td>
<td>进程运行时，并非所有页都须在内存页框中。仅在需要时才读入页</td>
<td>进程运行时，其所有段都须在内存中，除非使用了覆盖技术</td>
<td>进程运行时，并非其所有段都须在内存中。仅在需要时才读入段</td>
</tr>
<tr>
<td></td>
<td>把一页读入内存可能需要把另一页写出到磁盘</td>
<td></td>
<td>把一段读入内存可能需要把另外一段或几段写出到磁盘</td>
</tr>
</tbody>
</table>
</blockquote>
<p><strong>系统抖动/系统颠簸（Thrashing）</strong>：当操作系统读入一个块时，必须将另一个块换出，如果被换出的块在不远的将来会用到，那么该块又会被重新换入。如果这种情况经常发生，导致处理器的大部分时间都用来处理交换块而非执行指令。这样的现象被称为系统抖动。</p>
<h3 id="局部性和虚拟内存">局部性和虚拟内存</h3>
<p>虚存的优势确实很有吸引力，但是曾经对于虚存的方案有过争论，其关键点就在于进程块的切换：如何有效地加载部分块到内存中，以及避免系统抖动。但是局部性原理表明虚拟内存的方案是切实可行的。</p>
<p>局部性原理：</p>
<ul>
<li>一个进程中的程序和数据引用存在集簇倾向。</li>
<li>在一个很短的时间内仅需要进程的一部分块是合理的。</li>
<li>可以对未来可能会访问的块进行预测，从而避免系统抖动。</li>
</ul>
<p>事实上在众多操作系统的经验也已经证实了虚拟内存的可行性，但是要使虚存比较实用且有效，还需要两方面的因素：</p>
<ul>
<li>必须有对所采用分页或分段方案的硬件支持</li>
<li>操作系统必须能够管理页或段在内存和辅助存储器（简称：辅存）之间的移动</li>
</ul>
<h3 id="分页">分页</h3>
<h4 id="页表">页表</h4>
<ul>
<li>
<p>每个进程都有自己的页表</p>
</li>
<li>
<p>**页表项（Page Table Entry，PTE）**包含有与内存中的页框相对应的页框号</p>
</li>
<li>
<p>每个页表项需要有一个P位来表示它所对应的页当前是否在内存中</p>
<blockquote>
<p>一个进程可能只有一部分页在内存中</p>
</blockquote>
</li>
<li>
<p>每个页表项需要有一个M位来表示相应页的内容从上次装入内存到现在是否已改变</p>
<ul>
<li>若未改变，则在需要把该页换出时，无须用页框中的内容更新该页（无需写入磁盘）</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E8%99%9A%E6%8B%9F%E5%9C%B0%E5%9D%80%E5%88%86%E9%A1%B5%E9%A1%B9.png" alt=""></p>
</li>
</ul>
<p>地址转换系统：</p>
<p>从内存中读取一个字需要页表从虚拟地址（逻辑地址）到物理地址的转换</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E5%88%86%E9%A1%B5%E5%9C%B0%E5%9D%80%E8%BD%AC%E6%8D%A2%E7%B3%BB%E7%BB%9F.png" alt=""></p>
<blockquote>
<p>说明：</p>
<ul>
<li>
<p>虚拟地址/逻辑地址由页号和偏移量组成；物理地址由页框号和偏移量组成</p>
</li>
<li>
<p>当进程运行时，一个寄存器保存该进程页表的起始地址</p>
</li>
<li>
<p>虚拟地址的页号（Page #，n位）用于检索页表，以查找相应的页框号（Frame，m位）</p>
</li>
<li>
<p>查找到的页框号作为物理地址的页号，再与虚拟地址的偏移量结合起来形成最终的物理地址。（页框号|偏移量）</p>
<blockquote>
<ul>
<li>一般情况下，页号域长于页框号域（n &gt; m）</li>
<li>由于页表长度是变化的，因而不能期望在寄存器保存它。寄存器只能保存一个指向页表起始地址的页表指针（Page Table Rtr）</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
<p>考虑这样一个情景：如果每个进程的虚存空间可达 2<sup>31</sup> = 2GB，如果页大小为 2<sup>9</sup> = 512字节，那么则每个进程需要 2<sup>31</sup> / 2<sup>9</sup> = 2<sup>22</sup> 个页表项。这反映出整个页表的大小与虚拟地址空间的大小成正比，而导致的后果就是：将耗费大量的内存空间去放置页表。</p>
<h4 id="两级层次页表">两级层次页表</h4>
<p>为了解决这个问题，思考一下是否可以将页表也存储于虚拟内存中。于是有了两级层次页表的结构：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E4%B8%A4%E7%BA%A7%E5%B1%82%E6%AC%A1%E9%A1%B5%E8%A1%A8.png" alt=""></p>
<blockquote>
<p>说明：</p>
<ul>
<li>
<p>当一个进程正在运行时，它的页表至少有一部分须在内存中，这一部分包括正在运行的页的页表项</p>
</li>
<li>
<p>页目录：其中的每项指向一个页表</p>
<ul>
<li>如果页目录的长度为X，且一个页表的最大长度为Y，则一个进程可以有XY页</li>
</ul>
<blockquote>
<p>分析上图实例（用于32位地址的两级方案）：</p>
<ul>
<li>页大小为：4KB（2<sup>12</sup>）；虚拟地址空间大小为：4GB（2<sup>32</sup>）</li>
<li>则该虚拟地址空间由 2<sup>32</sup> / 2<sup>12</sup> = 2<sup>20</sup> 个页组成</li>
<li>规定每个页都由一个4字节的页表项映射，则可以创建一个由2<sup>20</sup>页组成的一个页表，这时需要2<sup>20</sup> × 2<sup>2</sup> = 2<sup>22</sup> = 4MB 的内存空间
<ul>
<li>我们可以将这部分内容保留到虚存中，那么该部分虚拟内存空间又由2<sup>22</sup> / 2<sup>12</sup> = 2<sup>10</sup> 个页组成</li>
<li>这2<sup>10</sup> 个页又可以组成一个新的根页表，其占据的内存为：2<sup>10</sup> × 2<sup>2</sup> = 2<sup>12</sup> = 4KB</li>
</ul>
</li>
<li>如此一来，我们便可仅在内存中存放一个4KB大小的根页表，去访问一个4GB大小的虚拟内存中的数据</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
<p>两级层次页表方案所对应的虚拟地址到物理地址的转换流程如下：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E4%B8%A4%E7%BA%A7%E5%B1%82%E6%AC%A1%E9%A1%B5%E8%A1%A8%E7%9A%84%E5%9C%B0%E5%9D%80%E8%BD%AC%E6%8D%A2.png" alt=""></p>
<blockquote>
<p>说明：</p>
<ul>
<li>虚拟地址的前10位用于检索根页表，查找关于用户页表的页的页表项
<ul>
<li>若该页不在内存中，则发生一次缺页中断</li>
</ul>
</li>
<li>若该页在内存中，则用虚拟地址中接下来的10位检索用户页表项页，查找该虚拟地址引用的页的页表项</li>
<li>最终查找到的页框号作为物理地址的页号，再与虚拟地址的偏移量结合起来形成最终的物理地址。（页框号|偏移量）[同之前的方案一致]</li>
</ul>
</blockquote>
<h4 id="反向页表-倒排页表">反向页表/倒排页表</h4>
<p>替代一级或多级页表的一种方法是，使用一个反向页表结构（Inverted Page Table）。</p>
<ul>
<li>
<p>虚拟地址的页号部分被映射成一个hash值 （散列函数映射），hash映射值构成一个散列表</p>
</li>
<li>
<p>hash值指向反向页表</p>
<blockquote>
<p>散列表包含指向反向表的指针，反向表中含有页表项</p>
</blockquote>
</li>
<li>
<p>得益于散列技术，多个虚拟地址可能映射到同一个散列表项中，可以减少表的容量</p>
<blockquote>
<p>多对一的映射关系可能导致数据访问冲突，但是也有相应的解决访问冲突的算法，这里先不考虑</p>
</blockquote>
<blockquote>
<p>页表结构称为“倒排/反向”的原因是，它使用页框号而非虚拟页号来索引页表项</p>
</blockquote>
</li>
</ul>
<p>反向页表的每项都包含如下内容：</p>
<ul>
<li>
<p>页号（Page number）：虚拟地址的页号部分</p>
</li>
<li>
<p>进程标识符（Process identifier）：使用该页的进程</p>
<blockquote>
<p>页号和进程标志符共同标志一个特定进程的虚拟地址空间的一页</p>
</blockquote>
</li>
<li>
<p>控制位（Control bits）：该域包含一些标记，比如有效、访问和修改，以及保护和锁定信息</p>
</li>
<li>
<p>链指针（Chain pointer）：</p>
<ul>
<li>若某项没有链项，则该域为空（或用一个单独的位来表示）</li>
<li>否则，该域包含链中下一项的索引值（0 ~ 页框数量-1 之间的数字）</li>
</ul>
</li>
</ul>
<blockquote>
<p>实例：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E5%80%92%E6%8E%92%E9%A1%B5%E8%A1%A8.png" alt=""></p>
<p>分析：</p>
<ul>
<li>物理内存中有2<sup>m</sup>个页框，反向页表包含2<sup>m</sup>项</li>
<li>虚拟地址前n位表示页号，且 n &gt; m</li>
<li>散列函数映射n位页号到m位数，用这m位数去索引反向页表</li>
<li>由此得页框号作为物理地址的页号，再与虚拟地址的偏移量结合起来形成最终的物理地址</li>
</ul>
</blockquote>
<h4 id="转移后备缓冲器-旁视缓冲器">转移后备缓冲器/旁视缓冲器</h4>
<p>原则上，每次虚存访问都可能会引起两次物理内存访问：</p>
<ul>
<li>一次取相应的页表项</li>
<li>另一次取需要的数据</li>
</ul>
<p>因此，简单的虚拟内存方案会导致内存访问时间加倍。为了解决这个问题，引入转移后备缓冲器。</p>
<p><strong>转移后备缓冲器/旁视缓冲器（Translation Lookaside Buffer，TLB</strong>）：大多数虚拟内存方案都为页表项使用了一个特殊的高速缓存，它包含有最近用过的页表项。</p>
<p>具体虚拟地址转换为物理地址的流程如下：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E8%BD%AC%E7%A7%BB%E5%90%8E%E5%A4%87%E7%BC%93%E5%86%B2%E5%99%A8.png" alt=""></p>
<blockquote>
<p>说明：</p>
<ul>
<li>
<p>给定一个虚拟地址，处理器首先检查TLB</p>
<ul>
<li>若需要的页表项在其中（TLB命中），则检索页框号并形成实地址</li>
<li>若未找到需要的页表项（TLB未命中），则处理器用页号检索进程页表，并检查相应的页表项
<ul>
<li>若“存在位”已置位（表示该页在内存中），处理器从页表项中检索页框号以形成实地址。同时更新TLB，使其包含这个新页表项。</li>
<li>若“存在位”未置位（表示该页不在内存中），这时会产生缺页故障中断，会去磁盘寻找数据。最后更新页表和TLB</li>
</ul>
</li>
</ul>
<p>详细流程见下图（包括关于缺页处理的细节）：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E8%BD%AC%E7%A7%BB%E5%90%8E%E5%A4%87%E7%BC%93%E5%86%B2%E5%99%A8%E6%B5%81%E7%A8%8B.png" alt=""></p>
</li>
</ul>
</blockquote>
<p>最后，虚拟存储机制需要与内存中的高速缓存进行交互（如下图）：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E8%99%9A%E5%AD%98%E4%B8%8E%E9%AB%98%E9%80%9F%E7%BC%93%E5%AD%98%E4%BA%A4%E4%BA%92.png" alt=""></p>
<blockquote>
<p>说明：</p>
<ul>
<li>内存系统查看TLB中是否存在匹配的页表项
<ul>
<li>若存在，就组合页框号和偏移量，形成物理地址</li>
<li>若不存在，则从页表中读取页表项。产生由一个标记（tag）和其余部分组成的实地址后，查看高速缓存中是否存在包含这个字的块
<ul>
<li>若有，则把它返回给CPU</li>
<li>若没有，则从内存中检索这个字</li>
</ul>
</li>
</ul>
</li>
</ul>
</blockquote>
<p>先来一个小梳理：</p>
<p>虚拟地址转换为实地址时，需要访问页表项，而页表项可能在TLB中，也可能在内存中或磁盘中，且被访问的字可能在高速缓存中、内存中或磁盘中。若被访问的字只在磁盘中，则包含该字的页必须装入内存，且它所在的块须装入高速缓存。此外，包含该字的页所对应的页表项必须更新。</p>
<h4 id="页尺寸">页尺寸</h4>
<p>页尺寸是一个重要的硬件设计决策，它需要考虑多方面的因素：</p>
<ul>
<li>页越小，内部碎片的总量越少</li>
<li>页越小，每个进程需要的页的数量就越多，这就意味着更大的页表</li>
<li>对于大程序，活动进程有一部分页表在虚存而非内存中，从而导致一次内存访问可能产生两次缺页中断：
<ul>
<li>第一次读取所需的页表部分</li>
<li>第二次读取进程页</li>
</ul>
</li>
<li>又基于大多数辅存设备的物理特性，为了实现更为有效的数据块传送，它们更希望页尺寸比较大</li>
</ul>
<p>页尺寸对缺页中断发生概率的影响使得这些问题变得更为复杂：</p>
<ul>
<li>
<p>如果页尺寸非常小，那么每个进程在内存中就有较多数量的页</p>
<p>一段时间后，内存中的页都包含有最近访问的部分，因此缺页率较低</p>
</li>
<li>
<p>当页尺寸增加时，每页包含的单元和任何一个最近访问过的单元越来越远（削弱局部性原理）</p>
<p>这会导致缺页率增长</p>
<p>但是，当页尺寸接近整个进程的大小时，缺页率开始下降。当一页包含整个进程时，不会发生缺页中断（如下图(a)，这很好理解）</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E9%A1%B5%E5%B0%BA%E5%AF%B8%E7%9A%84%E5%BD%B1%E5%93%8D.png" alt=""></p>
</li>
</ul>
<p>更为复杂的是，缺页率还取决于分配给一个进程的页框的数量（如上图(b)），该图表明：对固定的页尺寸，当内存中的页数量增加时，缺页率会下降（这也不难理解）</p>
<h3 id="分段">分段</h3>
<ul>
<li>
<p>段的大小不等，并且是动态的</p>
</li>
<li>
<p>简化了对不断增长的数据结构的处理</p>
<blockquote>
<p>特定的数据结构（程序员并不知晓最后会变得多大）可以分配到它自己的段，需要时操作系统可以扩大或缩小这个段。</p>
<p>若扩大的段需要在内存中，且内存中已无足够的空间，操作系统则把这个段移到内存中的一个更大区域（如果可以得到），或把它换出。对于后一种情况，扩大的段会在下次有机会时换回。</p>
</blockquote>
</li>
<li>
<p>允许程序独立地改变或重新编译，而不要求整个程序集重新链接和重新加载</p>
</li>
<li>
<p>有助于进程间的共享</p>
<blockquote>
<p>程序员可以在段中放置一个实用工具程序或一个有用的数据表，供其他进程访问</p>
</blockquote>
</li>
<li>
<p>有助于保护</p>
<blockquote>
<p>由于一个段可被构造成包含一个明确定义的程序或数据集，因而程序员或系统管理员可以更方便地指定访问权限</p>
</blockquote>
</li>
</ul>
<p>每个进程都有自己的段表，每个段表项包含：</p>
<ul>
<li>
<p>相应段在内存中的起始地址（段基址）</p>
</li>
<li>
<p>段的长度</p>
</li>
<li>
<p>有一个P位来表示它所对应的段当前是否在内存中</p>
</li>
<li>
<p>有一个M位来表示相应段的内容从上次装入内存到现在是否已改变</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E6%AE%B5%E8%A1%A8%E7%9A%84%E7%BB%93%E6%9E%84.png" alt=""></p>
</li>
</ul>
<p>虚拟地址到物理地址的转换：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E6%AE%B5%E7%9A%84%E8%99%9A%E6%8B%9F%E5%9C%B0%E5%9D%80%E5%88%B0%E7%89%A9%E7%90%86%E5%9C%B0%E5%9D%80%E7%9A%84%E8%BD%AC%E6%8D%A2.png" alt=""></p>
<blockquote>
<p>说明：</p>
<ul>
<li>当一个进程正在运行时，有一个寄存器为该进程保存段表的起始地址</li>
<li>虚拟地址中的段号（Seg #）用于检索段表，查找得到该段起始点的相应的内存地址（Base）</li>
<li>将得到的基地址与虚拟地址中的偏移量（offset）相加，得到最终的物理地址</li>
</ul>
</blockquote>
<h3 id="段页式">段页式</h3>
<p>分页和分段各有优势：</p>
<ul>
<li>分页对程序员是透明的，它消除了外部碎片，因而能更有效地使用内存</li>
<li>分段对程序员是可见的，它具有处理不断增长的数据结构的能力，及支持共享和保护的能力</li>
</ul>
<p>结合这二者的优点，引出了段页式结构。</p>
<p>先来介绍段表项以及页表项的结构：</p>
<ul>
<li>
<p>段表项：</p>
<ul>
<li>包含段的长度</li>
<li>包含一个指向一个页表的基域</li>
<li>无存在位和修改位</li>
</ul>
</li>
<li>
<p>页表项：</p>
<ul>
<li>与纯粹的分页系统中的页表项相同</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E6%AE%B5%E9%A1%B5%E5%BC%8F%E8%A1%A8%E9%A1%B9.png" alt=""></p>
</li>
</ul>
<p>虚拟地址到物理地址的转化：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E6%AE%B5%E9%A1%B5%E5%BC%8F%E8%99%9A%E6%8B%9F%E5%9C%B0%E5%9D%80%E8%BD%AC%E7%89%A9%E7%90%86%E5%9C%B0%E5%9D%80.png" alt=""></p>
<blockquote>
<p>说明：</p>
<ul>
<li>当一个进程正在运行时，使用一个寄存器记录该进程段表的起始地址</li>
<li>处理器利用虚拟地址中的段号（Seg #）来检索进程段表以寻找该段的页表</li>
<li>虚拟地址中的页号（page #）用于检索页表并查找相应的页框号</li>
<li>最后得到的页框号就是物理地址的页号，结合虚拟地址的偏移量，得到最终的物理地址</li>
</ul>
</blockquote>
<h3 id="保护和共享">保护和共享</h3>
<blockquote>
<p>分段有助于实现保护与共享机制。由于每个段表项包括一个长度和一个基地址，因而程序不会不经意地访问超出该段的内存单元。为实现共享，一个段可能会在多个进程的段表中引用。当然，在分页系统中也可得到同样的机制。但是，这种情况下由于程序的页结构和数据对程序员不可见，因此更难说明共享和保护需求。（下图说明了这类系统中可以实施的保护关系的类型）</p>
<img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS保护与共享.png" style="zoom:80%;" />
</blockquote>
<h2 id="操作系统软件">操作系统软件</h2>
<p>在实现内存管理的时候，需要考虑三方面的因素：</p>
<ul>
<li>是否支持虚拟存储</li>
<li>虚拟存储的具体实现方式（分页、分段、段页式）</li>
<li>操作系统在内存分配时的具体算法</li>
</ul>
<p>前两个因素取决于硬件部分，而第三个因素属于操作系统软件领域的问题，以下将会介绍虚拟存储考虑的六种策略。</p>
<h3 id="读取策略">读取策略</h3>
<p>读取策略（Fetch Policy）决定一个页何时被取入内存，常用到的有以下两种方法：</p>
<ul>
<li>
<p>请求分页式（Demand paging）：只有当访问到某页中的一个单元时才将该页取入内存。</p>
<ul>
<li>
<p>当一个进程首次启动时，会在一段时间出现大量的缺页中断</p>
<blockquote>
<p>取入越来越多的页后，局部性原理表明大多数将来访问的页都是最近读取的页。因此，在一段时间后错误会逐渐减少，缺页中断的数量会降到很低。</p>
</blockquote>
</li>
</ul>
</li>
<li>
<p>预约分页式（Prepaging）：启动进程时一次读取页的数量要比实际需要访问的多。</p>
<ul>
<li>
<p>更为有效的做法是一次读取辅存设备（如磁盘）中连续的页</p>
<blockquote>
<p>由于该策略本身的原因，可能会导致大部分读取的页执行进程不会访问，在这种情况下该策略其实是低效的。</p>
</blockquote>
</li>
</ul>
</li>
</ul>
<p>为了有效地提高效率，可以采用两种策略相结合的方式：在进程首次启动时以及发生缺页中断时采用预约分页式策略，在正常执行时采用请求分页式策略。</p>
<h3 id="放置策略">放置策略</h3>
<p>放置策略（Placement Policy）决定一个进程块驻留在实存中的什么位置。</p>
<ul>
<li>
<p>在分段系统以及非一致存储访问（NonUniform Memory Access，NUMA）系统中很重要</p>
</li>
<li>
<p>对于分页和段页式系统，放置策略通常无关紧要</p>
<blockquote>
<p>地址转换硬件和内存访问硬件能以相同的效率为任何页框组合执行相应的功能，因此分页和段页式系统对于放置不敏感</p>
</blockquote>
</li>
</ul>
<h3 id="置换策略">置换策略</h3>
<p>当内存已满，在进程必须读取一个新页时，不得不置换出内存中的一页，关于如何置换页，置换策略（Replacement Policy）给出了一些方法。</p>
<p>首先我们要考虑置换页时，我们应该选择哪些页被换出：</p>
<ul>
<li>
<p>置换的目标应该聚焦在那些在未来一段时间内不会被进程访问到或是访问次数很少的页（这不难理解）</p>
<blockquote>
<p>这里需要声明一点（包括在以后的章节中也有此类问题）：关于未来进程的执行需要哪些访问，程序员以及操作系统都是无法预测的。</p>
<p>（很多设计之初是这样的，在最开始有一个理想的目标或定位。但是在实现起来却发现在实际操作中会遇到致命的问题。要么采用一些手段去想办法解决，要么退而求其次，修改一下目标实现）</p>
</blockquote>
</li>
<li>
<p>大多数策略都基于过去的行为来预测将来的行为</p>
<blockquote>
<p>好在智慧的人们总结出来这么一条规律：以历史去推测未来。</p>
<p>局部性原理告诉我们：最近的访问历史和最近将要访问的模式间有很大的相关性。</p>
<p>（既然我们无法站在现在去预测未来，那我们就站在历史的角度去观测现在）</p>
</blockquote>
</li>
<li>
<p>值得注意的是，置换策略设计得越精致、越复杂，实现它的软硬件开销就越大</p>
</li>
</ul>
<h3 id="页框锁定">页框锁定</h3>
<p>在置换页时需要注意的是，置换策略有一个约束条件——页框锁定（Frame Locking）。</p>
<p>内存中的某些页框可能是被锁定的，当一个页框被锁定时，当前保存在该页框中的页就不能被置换。例如以下内容：</p>
<ul>
<li>操作系统的内核</li>
<li>重要的控制结构</li>
<li>I/O缓冲区以及一些其他对时间要求严格的区域</li>
</ul>
<p>锁定是通过给每个页框关联一个“锁定”位实现的，这一位可以包含在页框表和当前的页表中。</p>
<p>基本算法：不论采用哪种驻留集管理策略，都有一些用于选择置换页的基本算法。包括以下四种：</p>
<ul>
<li>最佳（Optimal policy，OPT）</li>
<li>最近最少使用（Least Recently Used ，LRU）</li>
<li>先进先出（First In First Out，FIFO）</li>
<li>时钟（Clock）</li>
</ul>
<h4 id="最佳（OPT）">最佳（OPT）</h4>
<p>OPT策略选择置换下次访问距当前时间最长的那些页。</p>
<ul>
<li>这种算法导致的缺页中断最少</li>
<li>但是要求操作系统需要预测未来访问</li>
</ul>
<h4 id="最近最少使用（LRU）">最近最少使用（LRU）</h4>
<p>LRU策略选择置换内存中最长时间未被引用的页。</p>
<blockquote>
<p>如何理解“最近最少使用”：即在短时间的未来最少被进程访问的页。</p>
<p>同样根据局部性原理，在内存中最长时间未被引用的页，也是短时间内未来最不可能访问到的页。</p>
</blockquote>
<p>实现方法是：</p>
<ol>
<li>给每页添加一个最后一次访问的时间戳，并在每次访问内存时更新这个时间戳。
<ul>
<li>这种方案需要硬件的支持，会造成大量的开销</li>
</ul>
</li>
<li>维护一个关于访问页的栈
<ul>
<li>依然会造成大量的开销</li>
</ul>
</li>
</ol>
<h4 id="先进先出（FIFO）">先进先出（FIFO）</h4>
<p>将分配给进程的一个页框视为一个循环缓冲区，以顺次循环的方式替换页。</p>
<ul>
<li>只需要一个指针，该指针在进程的页框中循环</li>
<li>这是最简单的一种算法</li>
<li>该方法会将驻留在内存中最久的页替换出去，但是有可能该页会在未来的不久被访问到</li>
</ul>
<h4 id="时钟策略（Clock）">时钟策略（Clock）</h4>
<p>给每一个页框关联一个称为<code>使用位</code>的附加位，整个缓冲区（也是循环的）有一个指针：</p>
<ul>
<li>
<p>当一个页首次被加入到内存中时，使用位被置为1（首次加载当然会被访问）</p>
<ul>
<li>随后被访问到（在访问产生缺页中断后）时也会置为1。（简单讲：只要被进程访问，使用位就置位1）</li>
</ul>
</li>
<li>
<p>当一个页面被置换时，指针指向缓冲区的下一个页框</p>
</li>
<li>
<p>考虑如何置换（进程的页框已被占满）：</p>
<ul>
<li>需要置换一页时，操作系统从指针指向的页框顺次扫描整个缓冲区，如果找到第一个使用位为0的页框，就将该页置换出去，并将使用位置为1，指针指向下一个页框</li>
<li>在指针扫描过程中，如果遇到使用位为1的页框，将其置为0，继续扫描，直到找到使用位为0的页框，进行替换</li>
<li>缓冲区是循环的，用图像具象化展示该种策略也不难理解为什么称之为时钟策略</li>
</ul>
<blockquote>
<p>具体实例如下图：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E6%97%B6%E9%92%9F%E7%AD%96%E7%95%A5%E7%BD%AE%E6%8D%A2.png" alt=""></p>
</blockquote>
</li>
</ul>
<p>下图给出了四种策略的例子：</p>
<ul>
<li>假设该程序所需要的页地址顺序为：2、3、2、1、5、2、4、5、3、2、5、2</li>
<li>假设为该进程分配了3个页框（驻留集大小固定）</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E7%BD%AE%E6%8D%A2%E7%AD%96%E7%95%A5%E5%AE%9E%E4%BE%8B.png" alt=""></p>
<blockquote>
<p>说明：</p>
<ul>
<li><strong>F</strong> 表示产生缺页中断</li>
<li>始终策略中：有符号<code>*</code>表示该页框的使用位被置位1，没有标记则表示0</li>
</ul>
</blockquote>
<p>针对上述四种算法的相关实验结果如下图：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E5%9B%9B%E7%A7%8D%E7%BD%AE%E6%8D%A2%E7%AE%97%E6%B3%95%E7%9A%84%E5%AE%9E%E9%AA%8C.png" alt=""></p>
<blockquote>
<p>说明：假设分配给一个进程的页框数量是固定的。该实验结果基于在一个FORTRAN程序中执行 0.25 × 10<sup>6</sup>次访问，页尺寸为256个字</p>
<ul>
<li>纵轴表示每1000次访问的缺页；横轴表示分配的页框数</li>
<li>当分配的页框比较少时，四种策略的差别非常显著</li>
<li>结果表明，为了更高效的执行，我们希望：
<ul>
<li>能处于拐点的右侧（即缺页率小）</li>
<li>同时又希望处于拐点左侧（即保证小页框的分配）</li>
<li>因此表明需要的操作模式应位于曲线的拐点处</li>
</ul>
</li>
</ul>
</blockquote>
<h4 id="增强型时钟">增强型时钟</h4>
<p>之前讨论的算法中，只考虑到了如何置换，而当页被修改时，并未讨论。</p>
<p>基于时钟策略，考虑到页修改的情况，于是有了增强型时钟策略：在原有使用位的基础上，新增添了一个修改位。</p>
<blockquote>
<p>修改位是必须的，若某页被修改，则在它被写回外存前不会被置换出。</p>
</blockquote>
<p>考虑以下四种情形（使用位用<code>u</code>表示，修改位用<code>m</code>表示）：</p>
<ol>
<li>最近未被访问，也未被修改（u=0；m=0）</li>
<li>最近被访问，但未被修改（u=1；m=0）</li>
<li>最近未被访问，但被修改（u=0；m=1）</li>
<li>最近被访问，且被修改（u=1；m=1）</li>
</ol>
<p>根据以上分类，时钟算法对于使用位的策略不变，具体流程如下：</p>
<ul>
<li>先扫描<code>u=0；m=0</code>的页，如果遇到，则置换该页</li>
<li>若上一步失败，则扫描<code>u=1；m=0</code>的页，如果遇到，则置换该页</li>
<li>若上一步失败，则返回第一步（指针回到其最初的位置），此时便有u=0的页了</li>
</ul>
<h4 id="页缓冲">页缓冲</h4>
<p>考虑开销的问题，无疑FIFO的策略是最简单的，但是很明显它可能造成抖动，这是不被接受的。于是在考虑能否以FIFO策略为基础提出一种改进算法，这便有了页缓冲（Page Buffering）。</p>
<ul>
<li>
<p>提供了两个表，当页发生置换时：</p>
<ul>
<li>若页未被修改，则分配到空闲页表（Free page list）中</li>
<li>若已被修改，则分配到修改页表（Modified page list）中</li>
</ul>
<blockquote>
<ul>
<li>这些操作的一个重要特点是，被置换的页仍然留在内存中。因此，若进程访问该页，则可迅速返回该进程的驻留集，且代价很小。</li>
<li>实际上，空闲页链表和修改页链表充当着页的高速缓存的角色。</li>
<li>修改页表还有另外一种很有用的功能：已修改的页按簇写回，而不是一次只写一页，因此大大减少了I/O操作的数量，进而减少了磁盘访问时间。</li>
</ul>
</blockquote>
</li>
</ul>
<h4 id="高速缓存">高速缓存</h4>
<p>置换策略和高速缓存大小如前所述，随着内存越来越大，应用的局部性特性逐渐降低。作为补偿，高速缓存的大小也相应增加。较大的高速缓存，甚至是几兆字节的高速缓存，现在也是合理的设计选择。</p>
<h3 id="驻留集管理">驻留集管理</h3>
<h4 id="驻留集大小">驻留集大小</h4>
<p>驻留集（Resident Set）大小对于分页式虚拟内存，在准备执行时，不需要也不可能把一个进程的所有页都读入内存。因此，操作系统必须决定读取多少页，即决定给特定的进程分配多大的内存空间。这需要考虑以下几个因素：</p>
<ul>
<li>
<p>分配给一个进程的内存越少，在任何时候驻留在内存中的进程数就越多。</p>
<blockquote>
<p>这增加了操作系统至少找到一个就绪进程的可能性，减少了由于交换而消耗的处理器时间。</p>
</blockquote>
</li>
<li>
<p>若一个进程在内存中的页数较少，尽管有局部性原理，缺页率仍相对较高。</p>
</li>
<li>
<p>给特定进程分配的内存空间超过一定大小后，由于局部性原理，该进程的缺页率没有明显的变化。</p>
</li>
</ul>
<p>基于以上因素，当代操作系统通常采取以下两种策略：</p>
<ul>
<li>
<p>固定分配策略（Fixed-allocation）：</p>
<ul>
<li>在进程执行时，为其在内存中分配固定数量的页框（这一数量在进程创建时就被确定）</li>
<li>一旦在进程的执行过程中发生缺页中断，该进程的一页就必须被它所需要的页面置换</li>
</ul>
</li>
<li>
<p>可变分配策略（Variable-allocation）：</p>
<ul>
<li>
<p>允许分配给一个进程的页框在该进程的生命周期中不断地发生变化。</p>
<blockquote>
<p>理论上：</p>
<ul>
<li>若一个进程的缺页率一直比较高，则表明在该进程中局部性原理表现较弱，应给它多分配一些页框以减小缺页率；</li>
<li>若一个进程的缺页率特别低，则表明从局部性的角度看该进程的表现非常好，可在不明显增大缺页率的前提下减少分配给它的页框。</li>
</ul>
</blockquote>
<blockquote>
<p>看起来的优势策略必然会导致开销：可变分配策略要求操作系统对活动进程进行评估；除此之外还包括硬件上的开销。</p>
</blockquote>
</li>
</ul>
</li>
</ul>
<h4 id="置换范围">置换范围</h4>
<p>置换策略的范围分为以下两类：</p>
<ul>
<li>局部置换策略（Local Replace Policy）：在替换页时，仅在产生这次缺页的进程的驻留页中选择。</li>
<li>全局置换策略（Global Replace Policy）：把内存中所有未被锁定的页都作为置换的候选页，而不管它们属于哪个进程。</li>
</ul>
<p>置换范围和驻留集大小之间存在一定的联系（如下表）：</p>
<table>
<thead>
<tr>
<th></th>
<th>局部置换</th>
<th>全局置换</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>固定分配</strong></td>
<td>分配给一个进程的页框数是固定的<br>从分配给该进程的页框中选择被置换的页</td>
<td>无此方案</td>
</tr>
<tr>
<td><strong>可变分配</strong></td>
<td>分配给一个进程的页框数不时变化，用于保存该进程的工作集<br>从分配给该进程的页框中选择被置换的页</td>
<td>从内存中的所有可用页框中选择被置换的页；这将导致进程驻留集的大小不断变化</td>
</tr>
</tbody>
</table>
<p>下面来一一详细介绍：</p>
<h4 id="固定分配、局部置换">固定分配、局部置换</h4>
<p>分配给在内存中运行的进程的页框数固定</p>
<ul>
<li>总页数分配得过少时，会产生很高的缺页率</li>
<li>总页数分配得过多时，内存中只能有很少的几个程序，处理器会有很多空闲时间，并把大量时间花费在交换上</li>
</ul>
<h4 id="可变分配、全局置换">可变分配、全局置换</h4>
<ul>
<li>该种组合方式最容易实现，并被许多操作系统使用</li>
<li>操作系统除了为每个进程分配了一定数量的页框，还维护有一个空闲页框列表，发生一次缺页中断时，一个空闲页框会被添加到进程的驻留集，并读入该页。因此发生缺页中断的进程的大小会逐渐增大
<ul>
<li>如果没有空闲页框可用时，操作系统必须选择一个当前位于内存中的页框进行置换（不包括被锁定的页框）</li>
</ul>
</li>
</ul>
<blockquote>
<p>问题：选择的置换页可以属于任何一个驻留进程，而没有任何原则用于确定哪个进程应从其驻留集中失去一页。因此，驻留集大小减小的那个进程可能并不是最适合被置换的。</p>
<p>解决此问题的一种方法是使用页缓冲：按照这种方法，选择置换哪一页并不重要，因为如果在下次重写这些页之前访问到了这一页，则这一页仍可回收。</p>
</blockquote>
<h4 id="可变分配、局部置换">可变分配、局部置换</h4>
<p>为了解决可变分配、全局置换的潜在问题，引入了另一种组合：可变分配、局部置换。</p>
<ul>
<li>当一个新进程被装入内存时，根据应用类型、程序要求或其他原则，给它分配一定数量的页框作为其驻留集
<ul>
<li>使用预先分页或请求分页填满这些页框</li>
</ul>
</li>
<li>发生一次缺页中断时，从产生缺页中断的进程的驻留集中选择一页用于置换</li>
<li>不时地重新评估进程的页框分配情况，增加或减少分配给它的页框，以提高整体性能</li>
</ul>
<h3 id="清除策略">清除策略</h3>
<p>与读取策略相反，清除策略（Clearing Policy）用于确定何时将已修改的一页写回辅存，通常有以下两种选择：</p>
<ul>
<li>
<p>请求式清除（Demand cleaning）：只有当页被选择用于置换时才被写回辅存。</p>
</li>
<li>
<p>预约式清除（Precleaning）：将这些已修改的多页在需要使用它们所占据的页框之前成批写回辅存。</p>
<blockquote>
<p>分析：</p>
<p>完全使用任何一种策略都存在问题：</p>
<ul>
<li>对于请求式清除：写回已修改的页和读入新页是成对出现的，且写回在读入之前。这就意味着当发生缺页中断的进程在解除阻塞之前必须等待两次页传送，可能降低处理器效率。</li>
<li>对于预约式清除：需要被写回辅存的页可能仍然留在内存中，直到页面置换算法指示它被移出。预约式清除允许成批地写回页，但是这样意义不大，因为这些页中地大部分通常在置换前又被修改。</li>
</ul>
</blockquote>
</li>
</ul>
<p>由于单纯使用某一种策略都会有潜在的问题，一种比较好的方式就是结合页缓冲技术。具体策略：只清除可用于置换的页，但去除了清除和置换操作间的成对关系。</p>
<ul>
<li>被置换的页会放在如下两个页表中：
<ul>
<li>修改表：修改表中的页可以周期性地成批写出，并移入未修改表中。</li>
<li>未修改表：未修改表中的一页要么因为被重新访问而被回收，要么在其页框分配给另一页时被淘汰。</li>
</ul>
</li>
</ul>
<h3 id="加载控制">加载控制</h3>
<p>加载控制（Load Control）会影响到驻留在内存中的进程数量，这称为系统并发度。</p>
<p>如何控制系统并发度是一个值得思考的问题，因为有以下两种情况影响着处理器利用率：</p>
<ul>
<li>
<p>如果驻留进程太少，那么所有进程都处于阻塞态的概率就较大。</p>
</li>
<li>
<p>如果驻留进程太多，那么平均每个进程的驻留集大小将会不够用，此时会频繁发生缺页中断，导致系统抖动。</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E5%B9%B6%E5%8F%91%E5%BA%A6%E5%A4%A7%E5%B0%8F.png" alt=""></p>
<blockquote>
<p>最好能够保证并发度达到图中虚线位置，使处理器效率达到最大</p>
<blockquote>
<p>工作集或PFF算法都隐含了加载控制。</p>
<ul>
<li>只允许执行那些驻留集足够大的进程。</li>
<li>在为每个活动进程提供需要的驻留集大小时，该策略会自动并动态地确定活动程序的数量。</li>
</ul>
</blockquote>
</blockquote>
</li>
</ul>
<h4 id="进程挂起">进程挂起</h4>
<p>系统并发度减小时，一个或多个当前驻留进程须被挂起（换出）。具体为以下六种情况：</p>
<ul>
<li>
<p>最低优先级进程：实现调度策略决策，与性能问题无关。</p>
</li>
<li>
<p>缺页中断进程：原因在于很有可能是缺页中断任务的工作集还未驻留，因而挂起它对性能的影响最小。</p>
<blockquote>
<p>此外，由于它阻塞了一个一定会被阻塞的进程，并且消除了页面置换和I/O操作的开销，因而该选择可以立即收到成效。</p>
</blockquote>
</li>
<li>
<p>最后一个被激活的进程：这个进程的工作集最有可能还未驻留。</p>
</li>
<li>
<p>驻留集最小的进程：在将来再次装入时的代价最小，但不利于局部性较小的程序。</p>
</li>
<li>
<p>最大空间的进程：可在过量使用的内存中得到最多的空闲页框，使它不会很快又处于去活（deactivation）状态。</p>
</li>
<li>
<p>具有最大剩余执行窗口的进程：在大多数进程调度方案中，一个进程在被中断或放置在就绪队列末尾之前，只运行一定的时间。这近似于最短处理时间优先的调度原则。</p>
</li>
</ul>
<hr>
<h1>后记</h1>
<p>本篇已完结</p>
<p><em>通过本章细细品味一下操作系统为何在计算机学课中是具有那么一些哲学味道的学课</em>🤔🤔🤔🤔</p>
<p>（如有修改或补充欢迎评论）</p>
]]></content>
      <categories>
        <category>学习笔记</category>
      </categories>
      <tags>
        <tag>操作系统</tag>
      </tags>
  </entry>
  <entry>
    <title>操作系统学习笔记-进程描述和控制</title>
    <url>/2021/03/30/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E8%BF%9B%E7%A8%8B%E6%8F%8F%E8%BF%B0%E5%92%8C%E6%8E%A7%E5%88%B6/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\css\APlayer.min.css"><script src="\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\js\Meting.min.js"></script><h1>前言</h1>
<p><em>正在学习操作系统，记录笔记。</em></p>
<blockquote>
<p>参考资料：</p>
<p>《操作系统（精髓与设计原理 第6版） 》</p>
</blockquote>
<hr>
<h1>第三章：进程描述和控制</h1>
<h2 id="什么是进程">什么是进程</h2>
<p>在给进程下定义之前，我们先回顾总结一下第一章和第二章的概念。</p>
<ul>
<li>
<p>计算机平台包括一组硬件资源。（如处理器、内存、I/O模块、定时器和磁盘驱动器等）</p>
</li>
<li>
<p>计算机程序是为执行某些任务而开发的。</p>
</li>
<li>
<p>直接根据给定的硬件平台写应用程序效率是低下的。</p>
<blockquote>
<p>原因如下：</p>
<ul>
<li>针对相同的平台可以开发出很多应用程序，所以开发出这些应用程序访问计算机资源的通用例程是很有意义的。</li>
<li>处理器本身只能对多道程序设计提供有限的支持，需要用软件去管理处理器和其他资源同时被多个程序共享。</li>
<li>如果多个程序在同一时间都是活跃的，那么需要保护每个程序的数据、I/O使用和其他资源不被其他程序占用。</li>
</ul>
</blockquote>
</li>
<li>
<p>开发操作系统是为了给应用程序提供一个方便、安全和一致的接口。</p>
</li>
<li>
<p>可以把操作系统想象为资源的统一抽象表示，可以被应用程序请求和访问。</p>
</li>
</ul>
<p>操作系统需要以一个有序的方式管理应用程序的执行，以达到以下目的：</p>
<ul>
<li>资源对多个应用程序是可用的。</li>
<li>物理处理器在多个应用程序间切换以保证所有程序都在执行中。</li>
<li>处理器和I/O设备能得到充分的利用。</li>
</ul>
<h2 id="进程和进程控制块">进程和进程控制块</h2>
<p>下面给出进程（process）的4个定义：</p>
<ol>
<li>正在执行的程序。</li>
<li>正在计算机上执行的程序实例。</li>
<li>能分配给处理器并由处理器执行的实体。</li>
<li>具有以下特征的活动单元：
<ul>
<li>一组指令序列的执行。</li>
<li>一个当前状态。</li>
<li>相关的系统资源集。</li>
</ul>
</li>
</ol>
<blockquote>
<p>进程的两个基本元素是<strong>程序代码</strong>（可能被执行相同程序的其他进程共享）和代码相关联的<strong>数据集</strong>。</p>
</blockquote>
<p>进程控制块（Process Control Block）</p>
<p>进程控制块是一种数据结构，该控制块由操作系统创建和管理。其中包含了以下信息：</p>
<ul>
<li>
<p>标识信息（Process Identification）/基本信息</p>
<p>系统给每个进程定义了一个唯一标识该进程的非负整数，称作<strong>进程标识符</strong>(PID:Process Identifier)</p>
</li>
<li>
<p>状态信息（Processor State Information）</p>
<p>其中包括以下内容：</p>
<ul>
<li>用户可见寄存器（User-Visible Registers）</li>
<li>控制和状态寄存器（Control and Status Registers）</li>
<li>堆栈指针（Stack Pointers）</li>
</ul>
</li>
<li>
<p>控制信息（Process Control information）</p>
<p>控制信息可以分为以下两类：</p>
<ol>
<li>调度信息（Scheduling Information）：其中包括
<ul>
<li>状态（state）/进程</li>
<li>优先级（Priority）</li>
<li>审计信息（ Accounting information）</li>
</ul>
</li>
<li>控制信息（Control Information）：其中包括
<ul>
<li>数据结构（Data Structuring）</li>
<li>内存管理（Memory Management）</li>
<li>进程间通讯（Interprocess Communication）</li>
<li>资源所有权和利用（Resource Ownership and Utilization）</li>
</ul>
</li>
</ol>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E8%BF%9B%E7%A8%8B%E6%8E%A7%E5%88%B6%E5%9D%97.jpg" alt=""></p>
</li>
</ul>
<blockquote>
<p>关于进程控制块的几点说明：</p>
<ul>
<li>包含了进程元素</li>
<li>由操作系统创建和管理</li>
<li>允许支持多个进程</li>
</ul>
<p>进程控制块包含了充分的信息，这样就可以中断一个进程的执行，并且在后来恢复执行进程时就好像进程未被中断过。进程控制块是操作系统能够支持多进程和提供多处理的关键工具。当进程被中断时，操作系统会把程序计数器和处理器寄存器（上下文数据）保存到进程控制块中的相应位置，进程状态也被改变为其他的值（例如阻塞状态或就绪状态）。</p>
</blockquote>
<blockquote>
<p>关于进程和程序的差异：</p>
<ul>
<li>进程是动态的，它的存在只是暂时的。</li>
<li>程序是静态的，它可以持久化存在。</li>
</ul>
</blockquote>
<blockquote>
<p>关于并行和并发：</p>
<ul>
<li>并发：同一个时间段有多个进程在执行。</li>
<li>并行：同一个时间点有多个进程在执行。</li>
</ul>
</blockquote>
<h2 id="进程状态（Process-States）">进程状态（Process States）</h2>
<p>进程轨迹（Trace of Process）</p>
<p>进程轨迹就是：进程执行的指令序列。</p>
<p>调度器（Dispatcher）/分派器可以使处理器从一个进程切换到另一个进程。</p>
<blockquote>
<p>对一个被执行的程序，操作系统会为该程序创建一个进程或任务。从处理器的角度看，它在指令序列中按某种顺序执行指令，这个顺序根据程序计数器寄存器中不断变化的值来指示，程序计数器可能指向不同进程中不同部分的程序代码；从程序自身的角度看，它的执行涉及程序中的一系列指令。</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E8%B0%83%E5%BA%A6%E5%99%A8.jpg" alt=""></p>
<p>上图给出了三个进程在内存中的布局，其中进程A和C执行12条指令，进程B执行4条指令（如下图）</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E8%B0%83%E5%BA%A6%E5%99%A82.jpg" alt=""></p>
<p>现在假设编号为8003的指令执行 后进程必须等待I/O操作，且操作系统仅允许一个进程最多连续执行6个指令周期。下图给出了最初的52个指令周期中交替的轨迹。</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E8%B0%83%E5%BA%A6%E5%99%A84.jpg" alt=""></p>
<p>（阴影部分表示调度器程序的执行）</p>
</blockquote>
<p>指令执行图并不实用，看起来过于繁杂，于是引入了进程模型。下面将会分别介绍两状态进程模型、五状态进程模型以及七状态进程模型。</p>
<h3 id="两状态进程模型（Two-State-Process-Model）">两状态进程模型（Two-State Process Model）</h3>
<p>该模型下的进程有两种状态：运行态（Running）以及非运行态（Not-running）</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E4%B8%A4%E7%8A%B6%E6%80%81%E5%9B%BE.jpg" alt=""></p>
<blockquote>
<p>四种状态：</p>
<ol>
<li>操作系统创建一个新进程（Enter）。</li>
<li>新进程被调度器转换为运行态（Dispatch）。</li>
<li>被中断的进程被调整为非运行态（Pause）。</li>
<li>进程结束运行（Exit）。</li>
</ol>
</blockquote>
<p>从上面这个简单的模型中进而可以分析道，必须通过某种方式来表示进程，从而使操作系统可以跟踪它们。未运行的进程必须保持在某种类型的队列中，并等待它们的执行时机。下图给出了一个队列结构，队列中的每一项都指向某个特定进程的指针。（队列也可以由数据块构成的链表组成，每个数据块表示一个进程）。</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E8%BF%9B%E7%A8%8B%E9%98%9F%E5%88%97.jpg" alt=""></p>
<blockquote>
<p>可以用该排队图描述分派器的行为。被中断的进程转移到等待进程队列中，或者，如果进程已经结束或取消，则被销毁（离开系统）。在任何一种情况下，分派器均从队列中选择一个进程来执行。</p>
</blockquote>
<h3 id="进程的创建和终止">进程的创建和终止</h3>
<p>导致进程创建的原因（4类）：</p>
<table>
<thead>
<tr>
<th>事件</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>新的批处理作业</td>
<td>通常位于磁带或磁盘中的批处理作业控制流被提供给操作系统。当操作系统准备接纳新工作时，它将读取下一个作业控制命令</td>
</tr>
<tr>
<td>交互登录</td>
<td>终端用户登录到系统</td>
</tr>
<tr>
<td>操作系统因为提供一项服务而创建</td>
<td>操作系统可以创建一个进程，代表用户程序执行一个功能，使用户无需等待（如控制打印的进程）</td>
</tr>
<tr>
<td>由现有的进程派生</td>
<td>基于模块化的考虑，或者为了开发并行性，用户程序可以指示创建多个进程</td>
</tr>
</tbody>
</table>
<blockquote>
<p>当操作系统位另一个进程的显示请求创建一个进程时，这个动作被称为<strong>进程派生</strong>。当一个进程派生另一个进程时，前一个称作<strong>父进程</strong>，被派生的叫做<strong>子进程</strong>。</p>
</blockquote>
<p>导致进程终止的事件（我们大致可以分为三类）：</p>
<ol>
<li>自然死亡：程序正常运行完毕。</li>
<li>异常死亡：由于程序在运行过程中本身出现问题，从而触发操作系统的保护机制，杀死进程。</li>
<li>他杀：又可以分为两种情况
<ul>
<li>CPU占用率达到100%，此时操作系统需要杀死一些进程保证计算机系统的运行效率。</li>
<li>用户进程可以杀死它创建的子进程。</li>
</ul>
</li>
</ol>
<p>还有一些具体导致进程终止的原因可见下表：</p>
<table>
<thead>
<tr>
<th>事件</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>正常完成</td>
<td>进程自行执行一个操作系统服务调用，表示它已经结束运行</td>
</tr>
<tr>
<td>超过时限</td>
<td>进程运行时间超过规定的时限。可以测量很多种类型的时间，包括总的运行时间（“挂钟时间”）、花费在执行上的时间以及对于交互进程从上一次用户输入到当前时刻的时间总量</td>
</tr>
<tr>
<td>无可用内存</td>
<td>系统无法满足进程需要的内存空间</td>
</tr>
<tr>
<td>越界</td>
<td>进程试图访问不允许访问的内存单元</td>
</tr>
<tr>
<td>保护错误</td>
<td>进程试图使用不允许使用的资源或文件，或者试图以一种不正确的方式使用，如往只读文件中写</td>
</tr>
<tr>
<td>算数错误</td>
<td>进程试图进行被禁止的计算，如除以零或者存储大于硬件可以接纳的数字</td>
</tr>
<tr>
<td>时间超出</td>
<td>进程等待某一事件发生的时间超过了规定的最大值</td>
</tr>
<tr>
<td>I/O失败</td>
<td>在输入或输出期间发生错误，如找不到文件、在超过规定的最多努力次数后仍然读/写失败（例如当遇到了磁带上的一个坏区时）或者无效操作（如从行式打印机中读）</td>
</tr>
<tr>
<td>无效指令</td>
<td>进程试图执行一个不存在的指令（通常是由于转移到了数据区并企图执行数据）</td>
</tr>
<tr>
<td>特权指令</td>
<td>进程试图使用为操作系统保留的指令</td>
</tr>
<tr>
<td>数据误用</td>
<td>错误类型或未初始化的一块数据</td>
</tr>
<tr>
<td>操作员或操作系统干涉</td>
<td>由于某些原因，操作员或操作系统终止进程（例如，如果存在死锁）</td>
</tr>
<tr>
<td>父进程终止</td>
<td>当一个父进程终止时，操作系统可能会自动终止该进程的所有后代进程</td>
</tr>
<tr>
<td>父进程请求</td>
<td>父进程通常具有终止其任何后代进程的权力</td>
</tr>
</tbody>
</table>
<h3 id="五状态模型">五状态模型</h3>
<p>引入五状态模型的原因：</p>
<p>对于之前介绍的两状态模型，处理器会对可运行的进程以一种轮转（round-robin）的方式操作（依次给队列中的每一个进程一定的执行时间，然后进程返回队列，阻塞情况除外）。但是这种方式存在两类问题：</p>
<ol>
<li>处于非运行状态的进程：
<ul>
<li>进程已经准备就绪，可以运行，但是由于CPU正在被其他占用，从而导致处于非运行态。</li>
<li>存在一些处于阻塞状态（blocked）等待I/O操作结束的进程。</li>
</ul>
</li>
<li>调度器不能只考虑选择队列中等待时间最长的进程，因为这些进程很有可能被阻塞。应该查找那些未被阻塞且在队列中时间最长的进程。</li>
</ol>
<p>解决上述问题的方法就是将非运行状态再细分为两种状态：就绪态（Ready）和阻塞态（Blocked）。因此就出现了如下图所示的五状态模型。</p>
<p>它分别有：</p>
<ul>
<li>
<p>运行态（Running）:该程序正在执行。</p>
</li>
<li>
<p>就绪态（Ready）:进程做好了准备，只要有机会就开始运行。</p>
</li>
<li>
<p>阻塞态（Blocked）:进程在某些事件发生前不能执行（如I/O操作完成）。</p>
</li>
<li>
<p>新建态（New）:新创建的进程，操作系统还未将其加入到可执行进程组中。（进程控制块已经创建但是还未被加载到内存中）</p>
</li>
<li>
<p>退出态（Exit）:操作系统从可执行进程组中释放出的进程（或者是因为它自身停止了，或者是因为某种原因被取消）。</p>
<blockquote>
<p>注意：</p>
<p>新建态：当进程处于新建态时，操作系统所需要的关于该进程的信息保存在内存中的进程表中，但进程自身还未进入内存（存在于外存中，通常是磁盘）。</p>
<p>退出态：指令和数据已经被释放，但是PCB还在内存中。</p>
</blockquote>
</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E4%BA%94%E7%8A%B6%E6%80%81%E5%9B%BE.jpg" alt=""></p>
<p>五状态模型中的9种事件类型：</p>
<ul>
<li>
<p>空→新建：创建执行一个程序的新进程。</p>
</li>
<li>
<p>新建→就绪（Admit）：操作系统准备好再接纳一个进程时，把一个进程从新建态转换到就绪态。</p>
</li>
<li>
<p>就绪→运行（Dispatch）：需要选择一个新进程运行时，调度器会选择一个处于就绪态的进程。</p>
</li>
<li>
<p>运行→退出（Release）：如果当前正在运行的进程表示自己已经完成或取消，则它将被操作系统终止。</p>
</li>
<li>
<p>运行→就绪（Timeout）：主要有以下几种情况：</p>
<ul>
<li>正在运行的进程达到了“最大运行时长”。（所有多道程序操作系统都有时长限定）</li>
<li>进程优先级导致的进程中断。</li>
<li>进程本身自愿释放对处理器的控制。（例如一个周期性地进行记账和维护的后台进程）</li>
</ul>
</li>
<li>
<p>运行→阻塞（Event Wait）：如果进程请求它必须等待的某些事件，则会进入阻塞态。（如等待I/O）</p>
</li>
<li>
<p>阻塞→就绪（Event Occurs）：当所等待的事件发生时，处于阻塞态的进程会转为就绪态。</p>
</li>
<li>
<p>就绪→退出：在某些系统中，父进程可以在任何时刻终止一个子进程。如果一个父进程终止，则与该父进程有关的所有子进程都将被终止。</p>
</li>
<li>
<p>阻塞→退出：原因同上一条。</p>
<blockquote>
<p>僵尸进程：父进程先于其子进程结束，这时子进程还在内存中，被称为僵尸进程。（如果僵尸进程数量过多会影响计算机系统的运行效率）</p>
</blockquote>
</li>
</ul>
<p>下图给出了进程在不同状态间转换时可能实现的排队规则：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E8%BF%9B%E7%A8%8B%E9%98%9F%E5%88%972.jpg" alt=""></p>
<blockquote>
<p>有两个队列：就绪队列和阻塞队列。进入系统的每个进程被放置在就绪队列中，当操作系统选择另一个进程运行时，将从就绪队列中选择。当一个正在运行的进程被移出处理器时，它根据情况或者被终止，或者被放置在就绪或阻塞队列中。最后，当一个事件发生时，所有位于阻塞队列中等待这个事件的进程都被转换到就绪队列中。</p>
</blockquote>
<p>上述方案意味着当一个事件发生时，操作系统必须扫描整个阻塞队列，搜所那些等待该事件的进程。但是在大型操作系统中，队列中可能存在几百甚至上千个进程，所以拥有多个队列将会更有效，一个事件可以对应一个队列，这样在某事件发生时，相应队列中的所有进程都将转换到就绪态。</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E8%BF%9B%E7%A8%8B%E9%98%9F%E5%88%973.jpg" alt=""></p>
<p>最后还有一种改进：按照优先级方案分配进程，维护多个就绪队列（每个优先级一个队列）将会带来更多便利。操作系统就可以很容易地确定哪个就绪进程具有最高地优先级且等待事件最长。</p>
<h3 id="被挂起的进程（Suspended-Processes）">被挂起的进程（Suspended Processes）</h3>
<p>实际上，由于I/O活动比计算机速度慢得多，内存中可以保有多个进程，当一个进程在等待时（比如I/O），处理器可以转移到另一个进程。即便如此，上述方案可能导致的一种常见的情况是：内存中有很多进程都在等待I/O。多道程序设计并不能从根本解决问题，大多数时候处理器仍可能处于空闲状态。</p>
<p>一种解决办法就是扩大内存，使其能够载入更多的进程。但是这种办法有两个严重的问题：一是内存价格的问题，从第一章的内容可以看出，扩大内存需要付出很大经济代价。第二个问题是，内存的扩大更可能导致带来更大的进程，而非更多的进程。</p>
<p>所以就出现了第二种解决办法：<strong>交换（swapping）</strong></p>
<p><strong>交换：把内存中某个进程的一部分或者全部转移到外存（磁盘）中。</strong></p>
<blockquote>
<p>交换概念就带来了**挂起（suspend）**状态：当内存中没有处于就绪状态的进程时，操作系统就把被阻塞的进程换出到磁盘的“挂起队列”（suspend queue）中。此后，操作系统可以从挂起队列中取出另一个进程，或者接受一个新进程的请求，将其纳入内存运行。</p>
</blockquote>
<blockquote>
<p>交换是一个I/O操作，但是由于磁盘I/O一般是系统中最快的I/O（相对于磁带或打印机），所以交换通常会提高性能。</p>
</blockquote>
<p>由于交换的出现，又引入了<strong>七状态模型</strong>。</p>
<p>在原有五状态模型的基础上又新增了两个状态：</p>
<ul>
<li>阻塞/挂起态（Blocked/Suspend）：进程在外存中并等待一个事件。</li>
<li>就绪/挂起态（Ready/Suspend）：进程在外存中，但是只要被载入内存就可以执行。</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E4%B8%83%E7%8A%B6%E6%80%81%E5%9B%BE.jpg" alt=""></p>
<p>同样的，在五状态模型的9种事件类型的基础上又新增了7种事件类型：</p>
<ul>
<li>
<p>阻塞→阻塞/挂起（Suspend）：如果没有就绪进程，则至少一个阻塞进程被换出，为另一个没有阻塞的进程让出空间。</p>
</li>
<li>
<p>阻塞/挂起→就绪/挂起（Event Suspend）：如果等待的事件发生了，则处于阻塞/挂起状态的进程可以转换到就绪/挂起状态。（注意，这要求操作系统必须能够得到挂起进程的状态信息。）</p>
</li>
<li>
<p>就绪/挂起→就绪（Activate）：如果内存中没有就绪态进程，操作系统需要调入一个进程继续执行。（此外，当处于就绪/挂起态的进程比处于就绪态的任何进程的优先级都要高时，也可以进行这种转换。）</p>
</li>
<li>
<p>就绪→就绪/挂起（Suspend）：通常，操作系统更倾向于挂起阻塞态进程而不是就绪态进程，因为就绪态进程可以立即执行，而阻塞态进程占用了内存空间但不能执行。但如果释放内存以得到足够空间的唯一方法是挂起一个就绪态进程，那么这种转换也是必需的。并且，如果操作系统确信高优先级的阻塞态进程很快将会就绪，那么它可能选择挂起一个低优先级的就绪态进程，而不是一个高优先级的阻塞态进程。</p>
</li>
<li>
<p>新建→就绪/挂起（Admit）：当创建一个新进程时，该进程或者加入到就绪队列，或者加入到就绪/挂起队列中。不论哪种情况，操作系统都必须建立一些表以管理进程，并为进程分配地址空间。（当内存中没有足够的空间分配给新建进程，就会采用此种策略）</p>
</li>
<li>
<p>阻塞/挂起→阻塞（Activate）：一个进程终止，释放了一些内存空间，阻塞/挂起队列中有一个进程比就绪/挂起队列中的任何进程的优先级都要高，并且操作系统有理由相信阻塞进程的事件很快就会发生，这时，把阻塞进程而不是就绪进程调入内存是合理的。</p>
</li>
<li>
<p>运行→就绪/挂起（Suspend）：通常当分配给一个运行进程的时间期满时，它将转换到就绪态。但是，如果由于位于阻塞/挂起队列的具有较高优先级的进程变得不再被阻塞，操作系统抢占这个进程，也可以直接把这个运行进程转换到就绪/挂起队形中，并释放一些内存空间。（这是可能但不是必须的转换）</p>
<blockquote>
<p>在某些操作系统中，允许一个进程可以被创建它的进程终止，所以在这样的情况下，进程在任何状态都可以转换到退出状态。</p>
</blockquote>
</li>
</ul>
<p>挂起的特点（重新理解并定义）：</p>
<ul>
<li>进程不能立即执行。</li>
<li>进程可能是或不是正在等待一个事件。如果是，阻塞条件不依赖于挂起条件，阻塞事件的发生不会使进程立即被执行。</li>
<li>为阻止进程执行，可以通过代理把这个进程置于挂起状态，代理可以是进程自己，也可以是父进程或操作系统。</li>
<li>除非代理显式地命令系统进行状态转换，否则进程无法从这个状态中转移。</li>
</ul>
<p>下表展示了导致进程挂起的原因：</p>
<table>
<thead>
<tr>
<th>事件</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>交换</td>
<td>操作系统需要释放足够的内存空间，以调入并执行处于就绪状态的进程</td>
</tr>
<tr>
<td>其他OS原因</td>
<td>操作系统可能挂起后台进程或工具程序进程，或者被怀疑导致问题的进程</td>
</tr>
<tr>
<td>交互式用户请求</td>
<td>用户可能希望挂起一个程序的执行，目的是为了调试或者与一个资源的使用进行连接</td>
</tr>
<tr>
<td>定时</td>
<td>一个进程可能会周期性地执行（例如记账或系统监视进程），而且可能在等待下一个时间间隔时被挂起</td>
</tr>
<tr>
<td>父进程请求</td>
<td>父进程可能会希望挂起后代进程的执行，以检查或修改挂起的进程，或者协调不同后代进程之间的行为</td>
</tr>
</tbody>
</table>
<h2 id="进程描述（Process-Description）">进程描述（Process Description）</h2>
<p>进程和资源（Processes and Resources）</p>
<p>在多道程序设计环境中，在虚拟内存中有许多已经创建了的进程（P<sub>1</sub>，…，P<sub>n</sub>），每个进程在执行期间，需要访问某些系统资源，包括处理器、I/O设备和内存。在图中，进程P<sub>1</sub>正在运行，该进程至少有一部分在内存中，并且还控制着两个I/O设备；进程P<sub>2</sub>也在内存中，但由于正在等待分配给P<sub>1</sub>的I/O设备而被阻塞；进程P<sub>n</sub>已经被换出，因此是挂起的。</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E8%BF%9B%E7%A8%8B%E6%8F%8F%E8%BF%B0.jpg" alt=""></p>
<p>操作系统的控制结构（Operating System Control Structures）</p>
<p>操作系统为了管理进程和资源，必须掌握关于每个进程和资源当前状态的信息。普遍使用的方法是：操作系统构造并维护它所管理的每个实体的信息表。在一般情况下，操作系统维护着4种不同类型的表：内存表（Memory Tables）、I/O表（I/O Tables）、文件表（File Tables）、进程表（Process Table）。</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E5%AE%9E%E4%BD%93%E4%BF%A1%E6%81%AF%E8%A1%A8.png" alt=""></p>
<ul>
<li>
<p>内存表：用于跟踪内（实）存和外存（虚拟内存）。</p>
<ul>
<li>分配给进程的主存（内存）</li>
<li>分配给进程的辅存（外存）</li>
<li>内存块或虚拟内存块的任何保护属性，如哪些进程可以访问某些共享内存区域。</li>
<li>管理虚拟内存所需要的任何信息</li>
</ul>
</li>
<li>
<p>I/O表：管理计算机系统中的I/O设备和通道。</p>
<ul>
<li>I/O设备或是可用的，或是已分配给某个特定的进程。</li>
<li>I/O操作的状态。</li>
<li>如果正在进行I/O操作，则操作系统需要知道I/O操作的状态和作为I/O传送的源和目标的内存单元。</li>
</ul>
</li>
<li>
<p>文件表：</p>
<ul>
<li>文件是否存在。</li>
<li>文件在外存中的位置。</li>
<li>当前状态。</li>
<li>其他属性。</li>
</ul>
</li>
<li>
<p>进程表：每个条目描述一个进程映像。</p>
<blockquote>
<p>进程表主要有四种类型（见下表）：用户数据、用户程序、系统栈以及进程控制块。这些表必须以某种方式链接起来或交叉引用。内存、I/O和文件是代表进程而被管理的，因此进程表中必须有对这些资源的直接或间接引用。文件表中的文件可以通过I/O设备访问，有时它们也位于内存中或虚拟内存中。这些表自身必须可以被操作系统访问到，因此它们受制于内存管理。</p>
</blockquote>
<p>进程映像（process image）</p>
<table>
<thead>
<tr>
<th>项目</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>用户数据</td>
<td>用户空间中的可修改部分，可以包括程序数据、用户栈区域和可修改的程序</td>
</tr>
<tr>
<td>用户程序</td>
<td>将被执行的程序</td>
</tr>
<tr>
<td>系统栈</td>
<td>每个进程有一个或多个后进先出（LIFO）系统栈。栈用于保存参数、过程调用地址和系统调用地址</td>
</tr>
<tr>
<td>进程控制块</td>
<td>操作系统控制进程所需要的数据</td>
</tr>
</tbody>
</table>
</li>
</ul>
<blockquote>
<p>进程最少必须包括一个或一组被执行的程序，与这些程序相关联的是局部变量、全局变量和任何已定义常量的数据单元。程序的执行通常涉及用于跟踪过程调用和过程间参数传递的栈。与每个进程相关联的还有操作系统用于控制进程的许多属性，通常，属性的集合称为进程控制块（PCB）。</p>
</blockquote>
<blockquote>
<p>进程控制块信息可以分为以下三类：</p>
<ul>
<li>进程标识信息</li>
<li>处理器状态信息</li>
<li>进程控制信息</li>
</ul>
<p>进程控制块中的典型元素见下表：</p>
<p>进程标识信息</p>
<table>
<thead>
<tr>
<th>元素</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>标识符</td>
<td>存储在进程控制块中的数字标识符，包括<br/>· 此进程的标识符（Process ID，简称进程ID）<br/>· 创建这个进程的进程（父进程）标识符<br/>· 用户标识符（UserID，简称用户ID）</td>
</tr>
</tbody>
</table>
<p>处理器状态信息</p>
<table>
<thead>
<tr>
<th>元素</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>用户可见寄存器</td>
<td>用户可见寄存器是处于用户态的处理器执行的机器语言可以访问的寄存器。通常有8到32个此类寄存器，而在一些RISC实现中有超过100个此类寄存器</td>
</tr>
<tr>
<td>控制和状态寄存器</td>
<td>用于控制处理器操作的各种处理器寄存器，包括：<br/>· 程序计数器：包含将要取的下一条指令的地址<br/>· 条件码：最近的算术或逻辑运算的结果（例如符号、零、进位、等于、溢出）<br/>· 状态信息：包括中断允许/禁用标志、异常模式</td>
</tr>
<tr>
<td>栈指针</td>
<td>每个进程有一个或多个与之相关联的后进先出（LIFO）系统栈。栈用于保存参数和过程调用或系统调用的地址，栈指针指向栈顶</td>
</tr>
</tbody>
</table>
<p>进程控制信息</p>
<table>
<thead>
<tr>
<th>元素</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>调度和状态信息</td>
<td>这是操作系统执行其调度功能所需要的信息，典型的信息项包括：<br/>· 进程状态：定义将被调度执行的进程的准备情况（例如运行态、就绪态、等待态、停止态）<br/>· 优先级：用于描述进程调度优先级的一个或多个域。在某些系统中，需要多个值（例如默认、当前、最高许可）<br/>· 调度相关信息：这取决于所使用的调度算法。例如进程等待的时间总量和进程在上一次运行时执行时间总量<br/>· 事件：进程在继续执行前等待的事件标识</td>
</tr>
<tr>
<td>数据结构</td>
<td>进程可以以队列、环或者别的结构形式与其他进程进行链接。例如，所有具有某一特定优先级且处于等待状态的进程可链接在一个队列中；进程还可以表示出与另一个进程的父子（创建者-被创建者）关系。进程控制块为支持这些结构需要包含指向其他进程的指针</td>
</tr>
<tr>
<td>进程间通信</td>
<td>与两个独立进程间的通信相关联的各种标记、信号和信息。进程控制块中维护着某些或全部此类信息</td>
</tr>
<tr>
<td>进程特权</td>
<td>进程根据其可以访问的内存空间以及可以执行的指令类型被赋予各种特权。此外，特权还用于系统实用程序和服务的使用</td>
</tr>
<tr>
<td>存储管理</td>
<td>这一部分包括指向描述分配给该进程的虚拟内存空间的段表和页表的指针</td>
</tr>
<tr>
<td>资源的所有权和使用情况</td>
<td>进程控制的资源可以表示成诸如一个打开的文件，还可能包括处理器或其他资源的使用历史；调度器会需要这些信息</td>
</tr>
</tbody>
</table>
</blockquote>
<blockquote>
<p>实际上在所有的操作系统中，对于进程标识符，每个进程都分配了一个唯一的数字标识符。进程标识符可以简单地表示为主进程表中的一个索引；否则，必须有一个映射，使得操作系统可以根据进程标识符定位相应的表。</p>
<p>除了进程标识符，还给进程分配了一个用户标识符，用于标明拥有该进程的用户。</p>
</blockquote>
<h2 id="进程控制（Process-Control）">进程控制（Process Control）</h2>
<p>执行模式（Modes of Execution）</p>
<p>大多数处理器至少支持两种执行模式：用户模式（User mode）以及内核模式（kernel mode）</p>
<p>用户模式：</p>
<ul>
<li>低权限模式</li>
<li>用户程序通常在这种模式下执行</li>
</ul>
<p>内核模式：</p>
<ul>
<li>高权限模式</li>
<li>操作系统的内核</li>
</ul>
<blockquote>
<p>使用两种模式的原因是很显然的，它可以保护操作系统和重要的操作系统表（如进程控制块）不受用户程序的干涉。在内核态下，软件具有对处理器以及所有指令、寄存器和内存的控制能力，这一级的控制对用户程序不是必需的，并且为了安全起见也不是用户程序可访问的。</p>
</blockquote>
<p>两种模式的切换</p>
<p>程序状态字中有一位表示执行模式，这一位应某些事件的要求而改变。在典型情况下，当用户调用一个操作系统服务或中断触发系统例程的执行时，执行模式被设置成内核态，当从系统服务返回到用户进程时，执行模式被设置为用户态。<strong>处理器状态寄存器（Processor status register ，PSR）<strong>中包含</strong>当前特权级别（Current privileged level，CPL）</strong>。当执行不同的进程时，操作系统会根据需要对CPL进行置位或清零的操作去改变其模式（通常数字越小，级别越大）。</p>
<p>进程创建（Process Creation）</p>
<p>进程创建的步骤按如下5步进行：</p>
<ol>
<li>
<p>给进程分配一个唯一的进程标识符。</p>
<p>此时，在主进程表中增加了一个新表项，表中的每个新表项对应着一个进程。</p>
</li>
<li>
<p>给进程分配空间。</p>
<p>这包括进程映像中的所有元素。</p>
</li>
<li>
<p>初始化进程控制块。</p>
</li>
<li>
<p>设置正确的连接。</p>
<p>例如，如果操作系统把每个调度队列都保存成链表，则新进程必须放置在就绪或就绪/挂起链表中。</p>
</li>
<li>
<p>创建或扩充其他数据结构。</p>
<p>例如，操作系统可能为每个进程保存着一个记账文件，可用于编制账单和/或进行性能评估。</p>
</li>
</ol>
<p>进程切换（Process Switching）</p>
<p>引发进程切换的原因：</p>
<ul>
<li>
<p>中断：当前指令的外部执行</p>
<ul>
<li>
<p>时钟中断（Clock interrupt）：当前运行的进程超过了最大允许时间段（片），则该进程必须切换到就绪态，调入另一个进程。</p>
</li>
<li>
<p>I/O中断</p>
</li>
<li>
<p>内存中断（失效，Memory fault）：处理器访问一个虚拟内存地址，且此地址单元不在内存中时，操作系统必须从外存中把包含这个引用的内存块（页或段）调入内存中。</p>
<blockquote>
<p>在发出调入内存块的I/O请求之后，操作系统可能会执行一个进程切换，以恢复另一个进程的执行，发生内存失效的进程被置为阻塞态，当想要的块调入内存中时，该进程被置为就绪态。</p>
</blockquote>
</li>
</ul>
</li>
<li>
<p>陷阱（Trap）：当前指令的执行相关</p>
<p>一个运行中的程序由于自身错误的原因引发操作系统的保护机制。可能导致进程被转为退出态。</p>
</li>
<li>
<p>系统调用（System Call）</p>
<p>例如打开文件操作。通常，使用系统调用会导致把用户进程置位阻塞态。</p>
</li>
</ul>
<p>模式切换VS进程切换</p>
<p>模式切换：</p>
<p>（当中断发生时）</p>
<ol>
<li>把程序计数器置成中断处理程序的开始地址。</li>
<li>从用户态切换到内核态，使得中断处理代码可以包含有特权的指令。</li>
</ol>
<p>进程切换：</p>
<ol>
<li>保存处理器上下文环境。包括程序计数器和其他寄存器。</li>
<li>更新当前处于运行态进程的进程控制块。包括将进程的状态改变到另一状态（就绪态、阻塞态、就绪/挂起态或退出态）。还必须更新其他相关域，包括离开运行态的原因和记账信息。</li>
<li>将进程的进程控制块移到相应的队列（就绪、在事件i处阻塞、就绪/挂起）。</li>
<li>选择另一个进程执行。</li>
<li>更新所选择进程的进程控制块。包括将进程的状态变为运行态。</li>
<li>更新内存管理的数据结构。</li>
<li>恢复处理器在被选择的进程最近一次切换出运行状态时的上下文环境。这可以通过载入程序计数器和其他寄存器以前的值来实现。</li>
</ol>
<blockquote>
<p>模式切换较进程切换的代价要小。</p>
<p>进程切换一定包含模式切换；但是模式切换不一定包含进程切换。</p>
</blockquote>
<p>操作系统的执行（Execution of the Operating System）</p>
<p>操作系统与普通计算机软件一样由处理器执行，同样的，操作系统也是一个进程。下面介绍关于如何控制这种进程。</p>
<p>无进程的内核（Non-process Kernel）</p>
<ul>
<li>
<p>在许多老操作系统中，非常传统和通用的一种方式就是在所有进程之外执行操作系统内核。</p>
</li>
<li>
<p>操作系统有自己的内存区域和系统栈，用于控制过程调用和返回。</p>
</li>
<li>
<p>操作系统代码作为一个在特权模式下工作的独立实体被执行。</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E6%97%A0%E8%BF%9B%E7%A8%8B%E7%9A%84%E5%86%85%E6%A0%B8.jpg" alt=""></p>
</li>
</ul>
<p>在用户进程中执行（Execution Within User Processes）</p>
<ul>
<li>
<p>在用户进程的上下文中执行几乎所有操作系统软件。（操作系统从根本上说时用户调用的一组例程，在用户环境中执行，用于实现各种功能）</p>
</li>
<li>
<p>执行操作系统代码时，进程在特权模式下执行。</p>
</li>
<li>
<p>在用户进程中执行的代码是共享操作系统代码而不是用户代码。基于用户态和内核态的概念，即使操作系统例程在用户进程环境中执行，用户也不能篡改或干涉操作系统的历程。（这也进一步说明了进程和程序的概念是不同的）</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E5%9C%A8%E7%94%A8%E6%88%B7%E8%BF%9B%E7%A8%8B%E4%B8%AD%E6%89%A7%E8%A1%8C.jpg" alt=""></p>
</li>
</ul>
<p>基于进程的操作系统（Process-Based Operating System）</p>
<ul>
<li>
<p>把操作系统作为一组系统进程来实现。</p>
</li>
<li>
<p>使用模块化操作系统，并且模块之间具有最小的、简明的接口。</p>
</li>
<li>
<p>一些非关键的操作系统函数可简单地用独立的进程实现。</p>
</li>
<li>
<p>这在多处理器或多机环境中都是十分有用的。</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E5%9F%BA%E4%BA%8E%E8%BF%9B%E7%A8%8B%E7%9A%84%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F.jpg" alt=""></p>
</li>
</ul>
<hr>
<h1>后记</h1>
<p>本篇已完结</p>
<p>（如有修改或补充欢迎评论）</p>
]]></content>
      <categories>
        <category>学习笔记</category>
      </categories>
      <tags>
        <tag>操作系统</tag>
      </tags>
  </entry>
  <entry>
    <title>计算机网络学习笔记-传输层</title>
    <url>/2021/05/10/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E4%BC%A0%E8%BE%93%E5%B1%82/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\css\APlayer.min.css"><script src="\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\js\Meting.min.js"></script><h1>前言</h1>
<p><em>正在学习计算机网络这门课程，顺便做个笔记，记录一下知识点。</em></p>
<blockquote>
<p>参考资料：</p>
<p>中科大郑烇老师全套《计算机网络（自顶向下方法 第7版，James F.Kurose，Keith W.Ross）》课程：<a href="https://www.bilibili.com/video/BV1JV411t7ow?p=1">https://www.bilibili.com/video/BV1JV411t7ow?p=1</a></p>
<p>《计算机网络（自顶向下方法 第7版，James F.Kurose，Keith W.Ross）》</p>
</blockquote>
<hr>
<h1>第三章：传输层</h1>
<h2 id="概述和传输层服务">概述和传输层服务</h2>
<p>传输层为运行在不同主机上的应用进程提供<strong>逻辑通信</strong>服务（以报文为单位）。</p>
<blockquote>
<p>提供进程-进程之间的通信</p>
</blockquote>
<p>传输协议运行在端系统中：</p>
<ul>
<li>发送方：将应用层的报文分成报文段（添加段头，形成本层数据单元），然后传递给网络层。</li>
<li>接收方：将报文段重组成报文（去掉段的头部信息，取出段的内容），然后以字节流的形式传递给应用层</li>
</ul>
<p>传输层向上层提供多种协议：</p>
<ul>
<li>Internet: TCP和UDP</li>
</ul>
<blockquote>
<p>传输层VS网络层</p>
<p>网络层服务：主机之间的逻辑通信。</p>
<p>传输层服务：进程间的逻辑通信。（主机之间服务的细分）</p>
<ul>
<li>
<p>依赖于网络层的服务：延时、带宽。</p>
</li>
<li>
<p>对网络层的服务进行增强：数据丢失、顺序混乱、加密。</p>
</li>
<li>
<p>有些服务是不可以加强的：带宽、延迟。</p>
</li>
<li>
<p>传输层向上层提供的服务其中很重要的一个功能就是<strong>复用</strong>（源端）以及<strong>解复用</strong>（目标端）。（后文详细介绍）</p>
<blockquote>
<p>下面举个例子来说明传输层的服务：</p>
<p>假设Ann家与Bill家各有12个小孩，定期，各家的12个小孩会向对方家的12个小孩进行书信往来。那么一次单向通信就需要12×12=144封信件。现在假定是Ann家的孩子们向Bill家的孩子们发送信件。但是一封一封的发送过于繁琐，孩子们会这样解决问题：由Ann家的老大将信件全部收集起来，打包一起发送到Bill家。Bill家的老大收到信件后就会分发给不同的孩子。</p>
<p>在这个例子中：</p>
<ul>
<li>两个家庭 = 于两个主机</li>
<li>每个小孩 = 不同的进程</li>
<li>信封中的信件 = 应用层报文</li>
<li>Ann和Bill = 传输协议：
<ul>
<li>Ann将信件打包的过程（聚合） = 复用</li>
<li>Bill将打包的信件分发（拆分） = 解复用</li>
</ul>
</li>
<li>送信的邮件服务 = 网络层协议</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
<p>Internet传输层协议：</p>
<ul>
<li>
<p>TCP：可靠的、保序的传输（提供字节流的服务）</p>
<ul>
<li>多路复用、解复用</li>
<li>拥塞控制</li>
<li>流量控制</li>
<li>建立连接</li>
</ul>
</li>
<li>
<p>UDP：不可靠、不保序的传输（提供数据报的服务）</p>
<ul>
<li>多路复用、解复用</li>
<li>没有为尽力而为的IP服务添加更多的其它额外服务</li>
</ul>
<blockquote>
<p>二者都是在IP提供的服务的基础之上提供服务（IP提供的服务：best effort）</p>
<p>二者都不能提供的服务：</p>
<ul>
<li>延时保证</li>
<li>带宽保证</li>
</ul>
</blockquote>
</li>
</ul>
<h2 id="多路复用与解复用">多路复用与解复用</h2>
<p>我们已经知道，IP向传输层提供的提供的服务是主机-主机的，而传输层提供的服务是进程-进程的，如何在传输层实现这一细分的服务的实现，所依靠的就是端口号。</p>
<p>此外：引入Socket的目的就是使层间传递的数据尽可能少。</p>
<blockquote>
<p>TCP和UDP都分别有各自的端口号，但二者使用端口的方式并不一样。</p>
</blockquote>
<p>先来描述述一下多路复用/解复用的概念：</p>
<ul>
<li>
<p>在发送方主机多路复用：</p>
<p>从多个套接字接收来自多个进程的报文，根据套接字对应的IP地址和端口号等信息对报文段用头部加以封装 (该头部信息用于以后的解复用)</p>
</li>
<li>
<p>在接收方主机多路解复用：</p>
<p>根据报文段的头部信息中的IP地址和端口号将接收到的报文段发给正确的套接字(和对应的应用进程)</p>
</li>
</ul>
<h3 id="TCP的多路复用-解复用">TCP的多路复用/解复用</h3>
<p>之前我们介绍过，TCP的Socket和四元组相捆绑，代表两个进程之间的会话关系。</p>
<blockquote>
<p>四元组包含：源端IP，源端进程端口；目标端IP，目标端进程端口。</p>
</blockquote>
<p>发送方复用：</p>
<ol>
<li>应用层将进程的信息向传输层传递，其中包含两个部分：<code>Socket</code>和<code>Message</code>。</li>
<li>Socket包含源端进程端口以及目标端进程端口，这时就会将这两个端口封装在报文段（Segment）中（这里还会封装一些其他信息，我们先不考虑）。段以及源端IP和目标端IP再向下层网络层传输。</li>
<li>网络层接收来自上层的段以及IP信息，并进行封装。由此便可以借助下层提供的服务将其传输道目标主机。</li>
</ol>
<p>接收方解复用：</p>
<ol>
<li>网络层接收到传输来的分组，把头部信息去掉，剩下的段的部分交给传输层。</li>
<li>传输层得到段可以通过头部信息知道源端IP、源端进程端口、目标端IP以及目标端进程端口。并可以将信息继续向应用层传递，交给对应的进程。</li>
</ol>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CNTCP%E5%A4%8D%E7%94%A8%E8%A7%A3%E5%A4%8D%E7%94%A8%E6%94%B9.png" alt=""></p>
<blockquote>
<p>补充：</p>
<p>服务器能够在一个TCP端口上同时支持多个TCP套接字。</p>
<p>Web服务器对每个连接客户端有不同的套接字。</p>
</blockquote>
<h3 id="UDP的多路复用-解复用">UDP的多路复用/解复用</h3>
<p>UDP的Socket和二元组相捆绑。</p>
<blockquote>
<p>二元组包含：本地IP，本地进程端口。</p>
</blockquote>
<p>发送方复用：</p>
<ol>
<li>应用层将Message、Socket与目标IP和目标进程端口向传输层传递（注意UDP Socket同TCP不同，不包含目标IP与目标进程端口）。</li>
<li>传输层将源进程端口以及目标进程端口封装在头部，形成报文段，向网络层传递。</li>
<li>网络层继续将源IP和目标IP封装起来形成数据报（datagram），并借助下层提供的服务将其传输道目标主机。</li>
</ol>
<p>接收方解复用：</p>
<ol>
<li>网络层接收到传来的数据报，把头部信息去掉，将报文段以及目标IP和目标进程端口向传输层传递。</li>
<li>传输层接收下层传来的信息，继续解封装，将数据向应用层传递，交给对应的进程。</li>
</ol>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CNUDP%E5%A4%8D%E7%94%A8%E8%A7%A3%E5%A4%8D%E7%94%A8.png" alt=""></p>
<blockquote>
<p>补充：</p>
<p>传输层TCP/UDP报文段格式：</p>
<img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CN传输层报文段格式.png" style="zoom: 67%;" />
<p>对于UDP的多路解复用：如果两个不同源IP地址/源端口号的数据报，但是有相同的目标IP地址和端口号，则被定位到相同的UDP套接字，发给同一个应用进程。（这点同TCP不一样）</p>
<p>因此可以这样记忆：不管是TCP四元组还是UDP二元组，必须元组内信息全部一致，才会对应同一个Socket，发送给同一个进程。</p>
</blockquote>
<h2 id="无连接传输：UDP">无连接传输：UDP</h2>
<p>UDP在IP提供的服务之上并没有增加过多的额外的服务，仅增加了多路复用/解复用。因此UDP也是“尽力而为”的服务。并可能发生如下问题：</p>
<ul>
<li>数据丢失</li>
<li>送到应用进程的报文段乱序</li>
</ul>
<p>UDP的另一个特征就是<strong>无连接</strong>：</p>
<ul>
<li>UDP发送端和接收端之间没有握手</li>
<li>每个UDP报文段都被独立地处理</li>
</ul>
<p>UDP被用于：</p>
<ul>
<li>流媒体（丢失不敏感，速率敏感、应用可控制传输速率）</li>
<li>事务性的应用（仅一次通信）</li>
<li>DNS</li>
<li>SNMP（简单的网络管理协议）</li>
</ul>
<p>如果想使用UDP协议，同时又希望具有可靠性，那么这种可靠性服务只能由进程本身（应用层）提供。可以应用特定的差错恢复。</p>
<p>UDP报文段格式：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CNUDP%E6%8A%A5%E6%96%87%E6%AE%B5%E6%A0%BC%E5%BC%8F.png" alt=""></p>
<p>头部为8Byte，包括：源端口号、目标端口号、长度（包括头部在内的整个报文段的长度）、校验和(checksum)。（均为2Byte）</p>
<blockquote>
<p>UDP存在的必要性：</p>
<ul>
<li>不建立连接 （会增加延时）。</li>
<li>简单：在发送端和接收端没有连接状态（服务器无需维护客户端状态，客户端也无需维护与源端某一进程的通讯状态）。</li>
<li>报文段的头部很小(开销小)。因此一个报文段的载荷（应用程序数据）就比较大。</li>
<li>无拥塞控制和流量控制：UDP可以尽可能快的发送报文段。</li>
</ul>
</blockquote>
<h3 id="UDP校验和">UDP校验和</h3>
<p>校验和的目的：检测在被传输报文段中的差错 (如比特反转)。</p>
<p>发送方：</p>
<ul>
<li>将报文段的内容视为16bit的整数</li>
<li>校验和：报文段的加法和（1的补运算）</li>
<li>发送方将校验和放在UDP的校验和字段</li>
</ul>
<p>接受方：</p>
<ul>
<li>计算接收到的报文段的校验和</li>
<li>检查计算出的校验和与校验和字段的内容是否相等：
<ul>
<li>不相等——检测到差错（一定错）</li>
<li>相等——一种情况是没有差错；另一种情况也许会出现<strong>残存错误</strong>。</li>
</ul>
</li>
</ul>
<p>校验和的具体实现：</p>
<p>将报文段的数据（包含一些头部信息），拆分成16bit一组（不足的补零）。将这些16bit的整数相加。</p>
<ul>
<li>
<p>进位回滚：</p>
<p>16bit整数相加可能会有进位，这是就把进位加到计算结果的最后一位。最后求得的校验和是处理进位的结果的反码。</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CN%E6%A0%A1%E9%AA%8C%E5%92%8C%E8%BF%9B%E4%BD%8D%E5%9B%9E%E6%BB%9A.png" alt=""></p>
<p>目标端重复发送方一样的操作，但是没有最后的取反码的步骤，将其计算出的结果同发送方的检验和相加，如果没有差错，应该是16位“1”（=1111111111111111），否则没有通过校验。</p>
</li>
</ul>
<h2 id="可靠数据传输的原理">可靠数据传输的原理</h2>
<p>可靠数据传输（Reliable data transfer，rdt）在应用层、传输层和数据链路层都很重要。（是网络Top 10问题之一）</p>
<h3 id="可靠数据传输的原理-2">可靠数据传输的原理</h3>
<p><code>rdt</code>需要提供的是可靠的服务（在上层），可是它却要依赖与下层不可靠的<code>udt</code>服务（可能会丢失、可能会乱序），所以下层信道的不可靠特点决定了可靠数据传输协议（ rdt ）的复杂性。</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CN%E5%8F%AF%E9%9D%A0%E6%95%B0%E6%8D%AE%E4%BC%A0%E8%BE%93%E7%9A%84%E6%8F%8F%E8%BF%B0.png" alt=""></p>
<blockquote>
<ul>
<li><code>rdt_send()</code>和<code>deliver_data()</code>是传输层与应用层的层间接口；</li>
<li><code>udt_send()</code>和<code>rdt_rcv()</code>是传输层与网络层的层间接口。</li>
</ul>
</blockquote>
<p>下面我们来具体讲述传输层是如何实现可靠传输机制的。</p>
<blockquote>
<p>在展开讲述之前先提前做个铺垫，如何渐进式地描述这一问题：</p>
<ul>
<li>
<p>先假设底层信道传输是可靠的（实际上并非如此），那么上层就不需要任何机制就可以保证可靠传输，于是我们会将下层的可靠性一点一点剥落，同样的上层就会相应地增加可靠传输机制。这便是接下来的讲解思路。</p>
</li>
<li>
<p>虽然信息传输是双向流动的，但是我们可以只考虑单向数据传输。（双向的数据传输问题实际上是2个单向数据传输问题的综合）</p>
</li>
<li>
<p>使用有限状态机 (FSM) 来描述发送方和接收方：</p>
<ul>
<li>
<p>FSM（有限状态机）：实际上就是描述协议工作机制的形式化的描述方案。</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CNFSM.png" alt=""></p>
<p>节点代表状态；边代表节点状态之间的迁移；边上的标记（label）：分母代表事件、分子代表采取的动作。</p>
</li>
</ul>
</li>
</ul>
</blockquote>
<h4 id="rdt1-0：在可靠信道上的可靠数据传输">rdt1.0：在可靠信道上的可靠数据传输</h4>
<p>首先假设信道传输：</p>
<ul>
<li>没有比特出错</li>
<li>没有分组丢失</li>
</ul>
<p>发送方：</p>
<ol>
<li>应用层将数据传送下来</li>
<li>传输层只做两件事情：
<ul>
<li>添加头部信息，封装为包（packet）</li>
<li>借助于下层的服务将数据发送出去</li>
</ul>
</li>
</ol>
<p>接收方：</p>
<ol>
<li>等待下层传来的数据</li>
<li>传输层依旧只做两件事：
<ul>
<li>解封装</li>
<li>将数据向上层传递</li>
</ul>
</li>
</ol>
<p>rdt1.0的FSM描述：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CNrdt1.0.png" alt=""></p>
<h4 id="rdt2-0：具有比特差错的信道">rdt2.0：具有比特差错的信道</h4>
<p>假设下层信道传输可能出现比特翻转（比特差错）</p>
<p>解决方案就是采用上文提到过的<strong>校验和</strong>。</p>
<p>发送方在向接收方发送数据时，会采用校验和来判断数据传输有无差错，并且接收方会有一个反馈机制：</p>
<ul>
<li>确认(ACK)：如果通过了校验和，接收方会发送ACK信息，显式地告诉发送方分组已被正确接收。</li>
<li>否定确认( NAK)：如果未通过校验和，接收方会发送NAK信息，显式地告诉发送方分组发生了差错。接着发送方会重新发送分组。</li>
</ul>
<blockquote>
<p>发送方会有一个缓存，以便发送分组失败后可以重新将分组发送给接收方。</p>
</blockquote>
<p>发送方：</p>
<ol>
<li>接收来自上层的数据</li>
<li>计算校验和并封装为packet；借助下层的服务将数据发送出去</li>
<li>转变为等待ACK/NAK的状态：
<ul>
<li>如果接收到NAK信息，重新发送packet，并继续维持等待状态</li>
<li>如果接收到ACK信息，转为接收上层信息并发送数据的状态</li>
</ul>
</li>
</ol>
<p>接收方：</p>
<ol>
<li>接收下层传来的packet，并计算校验和：
<ul>
<li>如果通过（未腐败的(notcorrupt)）校验和，解封装，将数据向上层传递，向并发送方发送ACK确认信息</li>
<li>如果为通过（腐败的(corrupt)）校验和，则向发送方发送NAK信息</li>
</ul>
</li>
</ol>
<p>rdt2.0的FSM描述：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CNrdt2.0.png" alt=""></p>
<h4 id="rdt2-1：停止等待协议">rdt2.1：停止等待协议</h4>
<blockquote>
<p>停等协议：发送方发送一个分组，然后等待接收方的应答。（一次只发送一个等待确认信息）</p>
</blockquote>
<p>我们仔细思考就会察觉，rdt2.0有一个致命的错误：如果接收方的反馈信息（ACK/NAK）发生了差错该如何处理？</p>
<blockquote>
<p>理想很丰满，现实很骨感。接受方说：“正确收到”，那么发送方继续传送下一个包；接收方说：“发生错误”，则发送方重新传包。就怕接收方来了一句：“歪比巴卜”，这就容易给发送方整懵了。</p>
<p>所以说rdt2.0的协议机制并不完备。</p>
</blockquote>
<p>为此引入新的机制：序号（sequence number）</p>
<blockquote>
<p>停等协议由于一次只发送一个等待确认的信息，因此只需要一位就可以识别（0、1）排序。</p>
</blockquote>
<p>发送方：</p>
<ol>
<li>会在每一个分组中添加序号（P<sub>0</sub>、P<sub>1</sub>）</li>
<li>如果发送方接收到的反馈信息出错（无法识别），无论是ACK还是NAK，发送方都会重新发送旧的分组。</li>
</ol>
<p>接收方：</p>
<ol>
<li>如果是NAK出错，那么正好接收来重新传送的分组，如果通过校验，发送ACK确认信息；否则发送NAK。</li>
<li>如果是ACK出错，那么这时接收方就会收到重复的分组，由于分组增添了序号，那么接收方会将该分组丢掉，不再向上层传递。接着会向发送方发送ACK确认信息，以请求发送后续分组。</li>
</ol>
<p>rdt2.1的FSM描述：</p>
<ul>
<li>
<p>发送方处理出错的ACK/NAK</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CNrdt2.1%E5%8F%91%E9%80%81%E6%96%B9.png" alt=""></p>
</li>
<li>
<p>接收方处理出错的ACK/NAK</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CNrdt2.1%E6%8E%A5%E6%94%B6%E6%96%B9.png" alt=""></p>
</li>
</ul>
<blockquote>
<p>注意：</p>
<p>rdt2.1中，接收方并不知道发送方是否正确收到了其ACK/NAK信息（没有安排确认的确认）。</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CNrdt2.1%E7%9A%84%E8%BF%90%E8%A1%8C.png" alt=""></p>
<p>那考虑是否在发送方安排确认的确认机制呢？那么如此我们如何判断确认的确认是否正确。所以事实上这样的“套娃”设计意义并不大，并不能完美的解决问题。</p>
</blockquote>
<h4 id="rdt2-2：无NAK的协议">rdt2.2：无NAK的协议</h4>
<ul>
<li>
<p>功能同rdt2.1，但只使用ACK(ack需要编号）</p>
<img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CNrdt2.2NAKfree.png" style="zoom:80%;" />
</li>
<li>
<p>接收方对最后正确接收的分组发ACK，以替代NAK。</p>
<blockquote>
<p>接收方必须显式地包含被正确接收分组的序号。</p>
<p>用情商课堂的方式理解很简单：当发送方发送了编号为1的分组（这时它应该等待ACK1）</p>
<ul>
<li>低情商：接收方发来了NAK信息→1号分组出错了</li>
<li>高情商：接收方发来了ACK0→1号分组出错了</li>
</ul>
<p>因此对ACK的编号可以替代NAK。</p>
</blockquote>
</li>
<li>
<p>这就为之后的流水线协议做好了基础（一次发送多个数据单位）。</p>
<ul>
<li>使用对前一个数据单位的ACK，代替本数据单位的NAK</li>
<li>这样可以使确认信息减少一半，协议处理简单</li>
</ul>
</li>
</ul>
<blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CNrdt2.2%E7%9A%84%E8%BF%90%E8%A1%8C.png" alt=""></p>
<p>当然如果ACK信息发送错误依然有可能导致接收方接收分组重复，解决方案仍和rdt2.1是一样的：</p>
<img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CNrdt2.2的运行2.png" style="zoom:80%;" />
</blockquote>
<p>rdt2.2的FSM描述（部分）：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CNrdt2.2.png" alt=""></p>
<h4 id="rdt3-0：具有比特差错和分组丢失的信道">rdt3.0：具有比特差错和分组丢失的信道</h4>
<p>假设下层的传输信道除了比特差错之外还可能丢失分组。</p>
<blockquote>
<p>如果出现了分组丢失的情况：一方面接收方在等待分组，另一方面发送方在等待确认信息。所以会出现<strong>死锁</strong>的情况。（rdt2.2还无法处理这种情况）</p>
</blockquote>
<p>所以会引入新的机制：超时重传</p>
<ul>
<li>需要<code>countdown timer</code>（倒计时定时器）</li>
</ul>
<p>发送方会等待ACK信息一段合理的时间，如果在这段时间内没有收到ACK信息，就会重新传输分组（一旦超时，发送方就会认为分组已经丢失）。</p>
<blockquote>
<p>合理的时间：</p>
<ul>
<li>传输层timeout时间是适应式的</li>
<li>链路层的timeout时间确定的</li>
</ul>
</blockquote>
<p>接下来会有新的问题：如果只是发送方的ACK信息丢失，或者只是分组（或ACK信息）被延时，那么就会导致接收方收到的分组重复。这个问题在rdt2.1中就已经解决。</p>
<p>rdt3.0的FSM描述（发送方）：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CNrdt3.0%E5%8F%91%E9%80%81%E6%96%B9.png" alt=""></p>
<blockquote>
<p>rdt3.0的运行：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CNrdt3.0%E7%9A%84%E8%BF%90%E8%A1%8C1.png" alt=""></p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CNrdt3.0%E7%9A%84%E8%BF%90%E8%A1%8C2.png" alt=""></p>
<ul>
<li>过早超时（延迟的ACK）也能够正常工作；但是效率较低，一半的分组和确认是重复的（超时之后的分组和ACK都是发送两次的）；</li>
<li>因此设置一个合理的超时时间也是比较重要的。</li>
</ul>
</blockquote>
<p>rdt3.0的性能：</p>
<p>rdt3.0可以工作（功能比较完备），但链路容量比较大的情况下，性能很差。</p>
<blockquote>
<p>链路容量比较大，一次发一个PDU 的不能够充分利用链路的传输能力。</p>
<p>举个例子：A地到B地相距甚远，驱车从A地到B地需要很长的时间，但是停等协议只允许高速公路上一次跑一辆汽车（实际上高速公路可以容纳很多车辆）。所以链路越大，停等协议对链路的利用率就越低。</p>
<p>即：网络协议限制了物理资源的利用。</p>
<p>具体可以举例计算（如下图）：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CNrdt3.0%E6%80%A7%E8%83%BD%E4%B8%BE%E4%BE%8B.png" alt=""></p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CNrdt3.0%E6%80%A7%E8%83%BD%E4%B8%BE%E4%BE%8B2.png" alt=""></p>
</blockquote>
<h3 id="流水线协议（Pipelined-protocols）">流水线协议（Pipelined protocols）</h3>
<p>为了提高链路利用率，接下来就引入了流水线的方式。</p>
<blockquote>
<p>上文提到造成链路利用率低下的原因是停等协议每次只允许发送一个分组，那么我们就可以考虑一次发送多个分组以提高利用率，但是这个值并不会增加到100%，随着能够同时发送分组的数量的增加，到了后期瓶颈就由停等协议转移到了链路带宽。</p>
</blockquote>
<p>流水线协议：允许发送方在未得到对方确认的情况下一次发送多个分组。</p>
<ul>
<li>必须增加序号的范围：用多个bit表示分组的序号</li>
<li>在发送方/接收方要有缓冲区：
<ul>
<li>发送方缓存：未得到确认，可能需要重传；</li>
<li>接收方缓存：上层用户取用数据的速率 ≠ 接收到的数据速率；接收到的数据可能乱序，排序交付（可靠）</li>
</ul>
</li>
</ul>
<p>有两种通用的流水线协议：</p>
<ul>
<li><strong>Go-back-N：回退N（GBN）</strong></li>
<li><strong>Selective Repeat：选择重传（SR）</strong></li>
</ul>
<p>在介绍以上两种协议时我们先做一些铺垫，先来介绍一个通用协议：<strong>滑动窗口(slide window)协议</strong></p>
<p>该协议根据发送方以及接收方窗口大小的不同可以分为：</p>
<ul>
<li>
<p>停止等待协议：send_window = 1, receive_window = 1</p>
</li>
<li>
<p>回退N协议：send_window ＞ 1，receive_window = 1</p>
</li>
<li>
<p>选择重传协议：send_window ＞ 1，receive_window ＞ 1</p>
<blockquote>
<p>发送方窗口（send_window）大于1的协议我们就称之为流水线协议。</p>
</blockquote>
</li>
</ul>
<p>发送缓冲区：</p>
<ul>
<li>形式：内存中的一个区域，落入缓冲区的分组可以发送</li>
<li>功能：用于存放已发送，但是没有得到确认的分组</li>
<li>必要性：需要重发时可用</li>
<li>发送缓冲区的大小：一次最多可以发送多少个未经确认的分组
<ul>
<li>停止等待协议 = 1</li>
<li>流水线协议 &gt; 1，合理的值，不能很大，链路利用率不能够超100%</li>
</ul>
</li>
<li>发送缓冲区中的分组：
<ul>
<li>未发送的：落入发送缓冲区的分组，可以连续发送出去；</li>
<li>已经发送出去的、等待对方确认的分组：发送缓冲区的分组只有得到确认才能删除</li>
</ul>
</li>
</ul>
<p>发送窗口：</p>
<ul>
<li>
<p>指的是发送缓冲区的一个范围（是发送缓冲区的一个子集）。</p>
</li>
<li>
<p>存放已发送但是未确认的分组。（实际上发送传窗口是那些已发送但是未经确认分组的序号构成的空间）</p>
</li>
<li>
<p>发送窗口的最大值 ≤ 发送缓冲区的值</p>
</li>
<li>
<p>发送窗口的滑动过程：</p>
<ol>
<li>
<p>一开始：没有发送任何一个分组</p>
<ul>
<li>
<p>后沿 = 前沿</p>
</li>
<li>
<p>之间为发送窗口的尺寸 = 0</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CN%E5%8F%91%E9%80%81%E7%AA%97%E5%8F%A31.png" alt=""></p>
</li>
</ul>
</li>
<li>
<p>发送窗口的移动：前沿移动</p>
<ul>
<li>
<p>每发送一个分组，前沿前移一个单位</p>
</li>
<li>
<p>发送窗口前沿移动的极限：不能够超过发送缓冲区</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CN%E5%8F%91%E9%80%81%E7%AA%97%E5%8F%A32.png" alt=""></p>
<blockquote>
<p>注意：绿色部分为发送缓冲区</p>
</blockquote>
</li>
</ul>
</li>
<li>
<p>发送窗口的移动：后沿移动</p>
<ul>
<li>
<p>后沿移动的条件：收到老分组（后沿）的确认</p>
</li>
<li>
<p>结果：发送缓冲区罩住新的分组，来了分组可以发送</p>
</li>
<li>
<p>后沿移动的极限：不能够超过前沿</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CN%E5%8F%91%E9%80%81%E7%AA%97%E5%8F%A33.png" alt=""></p>
</li>
</ul>
</li>
</ol>
</li>
</ul>
<p>接收窗口：</p>
<ul>
<li>
<p>接收窗口 (receiving window) = 接收缓冲区</p>
</li>
<li>
<p>接收窗口用于控制哪些分组可以接收：</p>
<ul>
<li>只有收到的分组序号落入接收窗口内才允许接收</li>
<li>若序号在接收窗口之外，则丢弃</li>
</ul>
</li>
<li>
<p>接收窗口尺寸 Wr = 1，则只能顺序接收</p>
<blockquote>
<p>举例：</p>
<ul>
<li>
<p>Wr＝1，在0的位置；只有0号分组可以接收</p>
</li>
<li>
<p>向前滑动一个，罩在1的位置，如果来了第2号分组，则丢弃</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CN%E6%8E%A5%E6%94%B6%E7%AA%97%E5%8F%A31.png" alt=""></p>
</li>
</ul>
</blockquote>
</li>
<li>
<p>接收窗口尺寸 Wr &gt; 1 ，则可以乱序接收（但提交给上层的分组，要按序提交）</p>
<blockquote>
<ul>
<li>
<p>滑动：</p>
<ul>
<li>低序号的分组到来（按序），接收窗口移动；</li>
<li>高序号分组乱序到，缓存但不交付（因为要实现rdt，不允许失序），不滑动</li>
</ul>
</li>
<li>
<p>发送确认：</p>
<ul>
<li>接收窗口尺寸 = 1 ； 发送连续收到的最大的分组确认（累计确认）</li>
<li>接收窗口尺寸 &gt; 1 ； 收到哪个分组，就发送那个分组的确认（非累计确认）</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CN%E6%8E%A5%E6%94%B6%E7%AA%97%E5%8F%A33.png" alt=""></p>
<p>绿色区域表示可接收的分组。</p>
</li>
</ul>
</blockquote>
</li>
</ul>
<p>正常情况下两个窗口的互动：</p>
<ul>
<li>
<p>发送窗口：</p>
<ul>
<li>有新的分组落入发送缓冲区范围，发送 → 前沿滑动</li>
<li>来了老的低序号分组的确认 → 后沿向前滑动 → 新的分组可以落入发送缓冲区的范围</li>
</ul>
</li>
<li>
<p>接收窗口：</p>
<ul>
<li>收到分组，落入到接收窗口范围内，接收</li>
<li>发送确认给发送方
<ul>
<li>如果低序号分组确认收到，向前滑动接收窗口</li>
<li>否则不滑动</li>
</ul>
</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CN%E5%8F%91%E9%80%81%E7%AA%97%E5%8F%A3%E4%B8%8E%E6%8E%A5%E6%94%B6%E7%AA%97%E5%8F%A3%E7%9A%84%E4%BA%92%E5%8A%A81.png" alt=""></p>
</li>
</ul>
<p>异常情况下GBN的两窗口互动：</p>
<ul>
<li>发送窗口：
<ul>
<li>新分组落入发送缓冲区范围，发送 → 前沿滑动</li>
<li>超时重发机制让发送端将发送窗口中的所有分组发送出去（低序号开始的连续的已发送但未确认的分组全部重新发送）</li>
<li>来了老分组的重复确认 → 后沿不向前滑动 → 新的分组无法落入发送缓冲区的范围（此时如果发送缓冲区有新的分组可以发送）</li>
</ul>
</li>
<li>接收窗口：
<ul>
<li>收到乱序分组，没有落入到接收窗口范围内，抛弃</li>
<li>（重复）发送老分组的确认，累计确认</li>
</ul>
</li>
</ul>
<p>异常情况下SR的两窗口互动：</p>
<ul>
<li>发送窗口：
<ul>
<li>新分组落入发送缓冲区范围，发送 → 前沿滑动</li>
<li>超时重发机制让发送端将超时的分组重新发送出去</li>
<li>来了乱序分组的确认 → 后沿不向前滑动 → 新的分组无法落入发送缓冲区的范围（此时如果发送缓冲区有新的分组可以发送）</li>
</ul>
</li>
<li>接收窗口：
<ul>
<li>收到乱序分组，落入到接收窗口范围内，接收</li>
<li>发送该分组的确认，单独确认</li>
</ul>
</li>
</ul>
<p>由此我们小结一下GBN协议和SR协议的异同：</p>
<ul>
<li>相同点：
<ul>
<li>发送窗口 &gt; 1</li>
<li>一次能够可发送多个未经确认的分组</li>
</ul>
</li>
<li>不同点：
<ul>
<li>GBN :接收窗口尺寸 = 1
<ul>
<li>接收端：只能顺序接收</li>
<li>发送端：从表现来看，一旦一个分组没有发成功，如：0、1、2、3、4; 假如1未成功，2、3、4都发送出去 了，要返回1再发送1、2、3、4。</li>
<li>累计确认：cumulative ack</li>
<li>发送端拥有对最老的未确认分组的定时器：
<ul>
<li>只需设置一个定时器</li>
<li>当定时器到时时，重传所有未确认分组</li>
</ul>
</li>
<li>发送窗口的最大值（序号大小为n）：2<sup>n</sup>-1</li>
</ul>
</li>
<li>SR: 接收窗口尺寸 &gt; 1
<ul>
<li>接收端：可以乱序接收</li>
<li>发送端：发送0、1、2、3、4，一旦1未成功，2、3、4,已发送，无需重发，只选择性发送1。</li>
<li>非累计确认/独立确认：individual ack</li>
<li>发送方为每个未确认的分组保持一个定时器：
<ul>
<li>当超时定时器到时，只是重发到时的未确认分组</li>
</ul>
</li>
<li>发送窗口的最大值（序号大小为n）：2<sup>n-1</sup></li>
</ul>
</li>
</ul>
</li>
</ul>
<p>列出下表对比一下GBN协议和SR协议：</p>
<table>
<thead>
<tr>
<th></th>
<th>GBN</th>
<th>SR</th>
</tr>
</thead>
<tbody>
<tr>
<td>优点</td>
<td>简单，所需资源少（接收方一个缓存单元）</td>
<td>出错时，重传一个代价小</td>
</tr>
<tr>
<td>缺点</td>
<td>一旦出错，回退N步代价大</td>
<td>复杂，所需要资源多（接收方多个缓存单元）</td>
</tr>
</tbody>
</table>
<p>适用范围：</p>
<ul>
<li>出错率低：比较适合GBN，出错非常罕见，没有必要用复杂的SR，为罕见的事件做日常的准备和复杂处理</li>
<li>链路容量大（延迟大、带宽大）：比较适合SR而不是GBN，一旦出错代价太大</li>
</ul>
<h2 id="面向连接的传输：TCP">面向连接的传输：TCP</h2>
<h3 id="TCP概述">TCP概述</h3>
<ul>
<li>
<p>点对点：一个发送方，一个接收方</p>
</li>
<li>
<p>可靠的、按顺序的字节流：没有报文边界</p>
<blockquote>
<p>TCP不提供报文界限：发送方可能发送两个报文，接收方可能会收到一个大的报文，也可能收到四个小的报文。应用进程之间报文的界限需要应用进程自己去维护。</p>
</blockquote>
</li>
<li>
<p>提供管道化（流水线）的协议：</p>
<ul>
<li>TCP拥塞控制和流量控制设置窗口大小</li>
</ul>
</li>
<li>
<p>发送和接收有缓存</p>
</li>
<li>
<p>全双工数据：</p>
<ul>
<li>在同一连接中数据流双向流动（一方进程可同时发送数据和接收数据）</li>
</ul>
</li>
<li>
<p>面向连接：在数据交换之前，通过握手（交换控制报文） 初始化发送方、接收方的状态变量</p>
</li>
<li>
<p>有流量控制：发送方不会淹没接收方</p>
</li>
</ul>
<blockquote>
<p>MSS：最大报文段大小</p>
<p>MTU：最大传输单元</p>
</blockquote>
<h3 id="TCP报文段结构">TCP报文段结构</h3>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CNTCP%E6%8A%A5%E6%96%87%E6%AE%B5%E7%BB%93%E6%9E%84.png" alt=""></p>
<blockquote>
<p>说明：</p>
<ul>
<li>
<p>源端口号、目标端口号：16bit</p>
</li>
<li>
<p>序号并不是报文段的序号，而是报文段的数据载荷（body）部分的第一个字节在整个字节流中的偏移量。（对字节计数）</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CNTCP%E6%8A%A5%E6%96%87%E6%AE%B5%E5%BA%8F%E5%8F%B7.png" alt=""></p>
<p>一般情况下序号并不是从0或1这样固定的序号开始：为了避免长时间滞留在网络中的分组所包括的段对新的连接造成影响。</p>
</li>
<li>
<p>确认号：依然是字节计数</p>
<ul>
<li>如果接收方传来的ACK为555，则表示接收方已经接收到了554及之前所有的字节，并希望发送方下一个传来555字节的数据。（累计确认）</li>
<li>接收方处理乱序的报文段：可以缓存，也可以丢弃。</li>
</ul>
</li>
<li>
<p>首部长度：4个字节为单位，表示该TCP段的首部数据大小。</p>
</li>
<li>
<p>RSF（RST、SYN、FIN）标志位：主要是用于两个应用进程进行TCP连接的标志位。</p>
<p>不同标志位的组合代表不同的握手（后面会提到），以及连接释放请求、确认等。</p>
</li>
<li>
<p>接受窗口：用于流量控制。如果接收方的接收窗口为X，则表示接收方可以接收X字节的数据。</p>
</li>
<li>
<p>校验和：同UDP中的校验和作用一致。</p>
</li>
</ul>
</blockquote>
<p>TCP确认号和序号实例：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CNTCP%E7%A1%AE%E8%AE%A4%E5%8F%B7%E5%92%8C%E5%BA%8F%E5%8F%B7.png" alt=""></p>
<h3 id="TCP往返延时（RTT）和超时">TCP往返延时（RTT）和超时</h3>
<p>分析可能的情况：TCP超时应该设置的比RTT长。如果设置太短，就会发生没必要的重传；如果太长，那么对报文段丢失的反应太慢。但是RTT是在不断变化的，因此我们需要定期测量RTT。</p>
<blockquote>
<p>SampleRTT：测量从报文段发出到收到确认的时间。</p>
<p>仅用当前的SampleRTT是不合理的，应该对几个最近的测量值求平均。</p>
<p>具体公式如下：</p>
<p><strong>EstimatedRTT = (1- α) × EstimatedRTT + α × SampleRTT</strong></p>
<ul>
<li>指数加权移动平均</li>
<li>过去样本的影响呈指数衰减</li>
<li>推荐值：α = 0.125</li>
</ul>
<p>进一步我们需要考虑EstimatedRTT的变化范围：</p>
<ul>
<li>EstimtedRTT + 安全边界时间
<ul>
<li>EstimatedRTT变化大 (方差大) → 较大的安全边界时间</li>
</ul>
</li>
<li>SampleRTT会偏离EstimatedRTT多远：
<ul>
<li><strong>DevRTT = (1-β) × DevRTT + β × |SampleRTT-EstimatedRTT|</strong></li>
<li>(推荐值：β = 0.25)</li>
</ul>
</li>
</ul>
<p>由此我们可以计算超时时间间隔：</p>
<p><strong>TimeoutInterval = EstimatedRTT + 4 × DevRTT</strong></p>
</blockquote>
<h3 id="TCP的可靠数据传输（rdt）">TCP的可靠数据传输（rdt）</h3>
<ul>
<li>TCP在IP不可靠服务的基础上建立了rdt
<ul>
<li>管道化的报文段：GBN or SR（TCP是两种的混合）</li>
<li>累积确认（像GBN）</li>
<li>设置单个重传定时器（像GBN）</li>
<li>是否可以接受乱序的，TCP没有规范。可以缓存乱序报文段，也可以丢弃。</li>
</ul>
</li>
<li>通过以下事件触发重传：
<ul>
<li>超时（只重发那个最早的未确认段：SR）</li>
<li>重复的（三次冗余）确认：
<ul>
<li>例子：收到了ACK50,之后又收到3个ACK50</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>在分析TCP如何建立rdt，我们依旧采取以上讲可靠数据传输原理的流程，一步一步增加功能。</p>
<h4 id="TCP发送方">TCP发送方</h4>
<p>首先考虑简化的TCP发送方：</p>
<ul>
<li>
<p>忽略重复的确认</p>
</li>
<li>
<p>忽略流量控制和拥塞控制</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CNTCP%E5%8F%91%E9%80%81%E6%96%B9%EF%BC%88%E7%AE%80%E5%8C%96%EF%BC%89.png" alt=""></p>
</li>
<li>
<p>TCP发送方事件：</p>
<ul>
<li>从应用层接收数据：
<ul>
<li>用nextseq创建报文段</li>
<li>序号nextseq为报文段首字节的字节流编号</li>
<li>如果还没有运行，启动定时器
<ul>
<li>定时器与最早未确认的报文段关联</li>
</ul>
</li>
</ul>
</li>
<li>超时：
<ul>
<li>重传后沿最老的报文段</li>
<li>重新启动定时器</li>
</ul>
</li>
<li>收到确认：
<ul>
<li>如果是对尚未确认的报文段确认
<ul>
<li>更新已被确认的报文序号</li>
<li>如果当前还有未被确认的报文段，重新启动定时器</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>TCP重传（左图为ACK丢失，右图为ACK超时）：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CNTCP%E9%87%8D%E4%BC%A01%E3%80%812.png" alt=""></p>
<p>（下图为累计确认）</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CNTCP%E9%87%8D%E4%BC%A03.png" alt=""></p>
</li>
</ul>
<p>在RFC中对产生TCP ACK的建议（如下表）</p>
<table>
<thead>
<tr>
<th>接收方的事件</th>
<th>TCP接收方动作</th>
</tr>
</thead>
<tbody>
<tr>
<td>所期望序号的报文段按序到达。 所有在期望序号之前的数据都已经被确认</td>
<td>延迟的ACK。对另一个按序报文段的到达最多等待500ms。如果下一个报文段在这个时间间隔内没有到达，则发送一个ACK。</td>
</tr>
<tr>
<td>有期望序号的报文段到达。另一个按序报文段等待发送ACK（接收到连续的两个段）</td>
<td>立即发送单个累积ACK，以确认两个按序报文段。</td>
</tr>
<tr>
<td>比期望序号大的报文段乱序到达。检测出数据流中的间隔</td>
<td>立即发送重复的ACK，指明下一个期待字节的序号</td>
</tr>
<tr>
<td>能部分或完全填充接收数据间隔的报文段到达。</td>
<td>若该报文段起始于间隔（gap）的低端，则立即发送ACK。</td>
</tr>
</tbody>
</table>
<h4 id="快速重传">快速重传</h4>
<p>产生快速重传的原因：超时周期往往太长（在重传丢失报文段之前的延时太长）。</p>
<p>快速重传：在定时器过时之前重发报文段</p>
<ul>
<li>
<p>由三个冗余ACK触发</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CNTCP%E5%BF%AB%E9%80%9F%E9%87%8D%E4%BC%A0%E5%8E%9F%E5%9B%A0.png" alt=""></p>
<blockquote>
<p>它假设跟在被确认的数据后面的数据丢失了：</p>
<ul>
<li>第一个ACK是正常的；</li>
<li>收到第2个该段的ACK，表示接收方收到一个该段后的乱序段；</li>
<li>收到第3，4个该段的ack，表示接收方收到该段之后的2个 ，3个乱序段，可能性非常大段丢失了</li>
</ul>
</blockquote>
</li>
</ul>
<p>如果发送方收到同一数据 的3个冗余ACK，重传最小序号的段。</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CNTCP%E5%BF%AB%E9%80%9F%E9%87%8D%E4%BC%A0%E5%AE%9E%E4%BE%8B.png" alt=""></p>
<h3 id="TCP流量控制">TCP流量控制</h3>
<p>流量控制：接收方控制发送方，不让发送方发送的太多、太快以至于让接收方的缓冲区溢出。</p>
<ul>
<li>
<p>接收方在其向发送方的TCP段头部的<code>rwnd</code>字段“通告”其<code>空闲buffer</code>大小</p>
<ul>
<li>RcvBuffer大小通过socket选项设置 (典型默认大小为4096 字节)</li>
<li>很多操作系统自动调整 RcvBuffer</li>
</ul>
</li>
<li>
<p>发送方限制未确认(“inflight”)字节的个数 ≤ 接收方发送过来的rwnd值</p>
</li>
<li>
<p>保证接收方不会被淹没</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CNTCP%E6%B5%81%E9%87%8F%E6%8E%A7%E5%88%B6%E7%BC%93%E5%86%B2%E5%8C%BA.png" alt=""></p>
</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CNTCP%E6%B5%81%E9%87%8F%E6%8E%A7%E5%88%B6.png" alt=""></p>
<h3 id="连接管理">连接管理</h3>
<p>在正式交换数据之前，发送方和接收方<strong>握手</strong>建立通信关系:</p>
<ul>
<li>同意建立连接（每一方都知道对方愿意建立连接）</li>
<li>同意连接参数（准备、初始化资源）</li>
</ul>
<h4 id="建立连接">建立连接</h4>
<p>首先考虑2次握手总是可行的吗？（仅一方发送连接请求，另一方收到后发送连接确认）</p>
<p>有很多因素会导致2次握手的失败：</p>
<ul>
<li>变化的延迟（连接请求的段没有丢，但可能超时）</li>
<li>由于丢失造成的重传 (e.g. req_conn(x))</li>
<li>报文乱序</li>
<li>相互看不到对方</li>
</ul>
<p>2次握手的失败场景：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CN2%E6%AC%A1%E6%8F%A1%E6%89%8B%E5%A4%B1%E8%B4%A5%E7%9A%84%E5%9C%BA%E6%99%AF.png" alt=""></p>
<blockquote>
<p>说明</p>
<p>在客户端接收服务器发来的连接确认之前定时器到时，那么客户端就会再发送一条新的连接建立请求，如此服务器会消耗资源去维护许多不必要的“半连接”。</p>
<p>数据超时会导致服务器将老数据按照新的数据处理。</p>
</blockquote>
<p>所以2次握手是不可取的，由此引入了3次握手。</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CN3%E6%AC%A1%E6%8F%A1%E6%89%8B.png" alt=""></p>
<blockquote>
<p>SYNbit = 1 表示建立连接请求</p>
</blockquote>
<p>3次握手可以有效地解决半连接和接收老数据的问题</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CN3%E6%AC%A1%E6%8F%A1%E6%89%8B%E8%A7%A3%E5%86%B3%E9%97%AE%E9%A2%98.png" alt=""></p>
<p>3次握手的FSM表示：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CN3%E6%AC%A1%E6%8F%A1%E6%89%8B%E7%9A%84FSM.png" alt=""></p>
<h4 id="关闭连接">关闭连接</h4>
<ul>
<li>客户端，服务器分别关闭它自己这一侧的连接
<ul>
<li>发送FIN bit = 1的TCP段</li>
</ul>
</li>
<li>一旦接收到FIN，用ACK回应
<ul>
<li>接到FIN段，ACK可以和它自己发出的FIN段一起发送</li>
</ul>
</li>
<li>可以处理同时的FIN交换</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CN%E8%BF%9E%E6%8E%A5%E6%8B%86%E9%99%A4.png" alt=""></p>
<blockquote>
<p>这样的连接拆除方式并不完美：</p>
<p>会存在一方拆除连接，另一方还维持连接的情况。</p>
</blockquote>
<h2 id="拥塞控制原理">拥塞控制原理</h2>
<p>拥塞的非正式定义: “太多的数据需要网络传输，超过了网络的处理能力。”</p>
<p>拥塞控制与流量控制不同：拥塞控制指的是网络的问题，流量控制指的是接收方的问题。</p>
<p>拥塞的表现:</p>
<ul>
<li>分组丢失 (路由器缓冲区溢出)</li>
<li>分组经历比较长的延迟(在路由器的队列中排队)</li>
</ul>
<blockquote>
<p>拥塞是网络中前10位的问题</p>
</blockquote>
<h4 id="产生拥塞的原因-代价">产生拥塞的原因/代价</h4>
<p>场景一：</p>
<ul>
<li>2个发送端，2个接收端</li>
<li>一个路由器，具备无限大的缓冲</li>
<li>输出链路带宽：R</li>
<li>没有重传</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CN%E6%8B%A5%E5%A1%9E%E5%9C%BA%E6%99%AF%E4%B8%80.png" alt=""></p>
<blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CN%E6%8B%A5%E5%A1%9E%E5%9C%BA%E6%99%AF%E4%B8%80%E6%8F%8F%E8%BF%B0.png" alt=""></p>
<ul>
<li>如左图：当λ<sub>in</sub>逐渐增加时，λ<sub>out</sub>也在增加，当λ<sub>in</sub>达到R/2时，λ<sub>out</sub>达到最大值，也就是说每个连接的最大吞吐量为R/2。</li>
<li>如右图：从延迟的角度看，当进入的速率λ<sub>in</sub>接近链路链路带宽R时，延迟陡增。</li>
</ul>
</blockquote>
<p>场景二：</p>
<ul>
<li>一个路由器，有限的缓冲</li>
<li>分组丢失时，发送端重传
<ul>
<li>应用层的输入=应用层输出：λ<sub>in</sub> = λ<sub>out</sub></li>
<li>传输层的输入包括重传：λ<sub>in</sub> ≥ λ<sub>out</sub></li>
</ul>
</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CN%E6%8B%A5%E5%A1%9E%E5%9C%BA%E6%99%AF%E4%BA%8C.png" alt=""></p>
<blockquote>
<p>理想化场景：发送端有完美的信息，即发送端知道什么时候路由器的缓冲是可用的。</p>
<ul>
<li>
<p>只在缓冲可用时发送</p>
</li>
<li>
<p>不会丢失：λ<sup>’</sup><sub>in</sub> = λ<sub>in</sub></p>
</li>
<li>
<p>这样情况依然同上：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CN%E6%8B%A5%E5%A1%9E%E5%9C%BA%E6%99%AF%E4%B8%80%E6%8F%8F%E8%BF%B0.png" alt=""></p>
</li>
<li>
<p>但是这样的代价很大：每个路由器都需要告知发送方自己的空闲缓冲区有多大，不好实现。</p>
</li>
</ul>
<p>理想化场景二：掌握丢失信息。即分组可以丢失，在路由器由于缓冲器满而被丢弃。</p>
<ul>
<li>
<p>如果知道分组丢失了，发 送方重传分组</p>
</li>
<li>
<p>会丢失：λ<sup>’</sup><sub>in</sub> &gt; λ<sub>in</sub></p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CN%E6%8B%A5%E5%A1%9E%E5%9C%BA%E6%99%AF%E4%BA%8C%E7%90%86%E6%83%B3%E5%8C%96%E5%9C%BA%E6%99%AF%E4%BA%8C%E6%8F%8F%E8%BF%B0.png" alt=""></p>
<p>分析：这样一来，为了让λ<sub>out</sub>逼近于R/2，就需要让λ<sup>’</sup><sub>in</sub>比既定的输出要大（因为存在分组丢失）。</p>
<ul>
<li>重传的丢失分组</li>
<li>没有必要重传的重复分组</li>
</ul>
<p>代价：</p>
<ul>
<li>为了达到一个有效输出，网络需要做更多的工作（重传）</li>
<li>没有必要的重传，链路中包括了多个分组的拷贝（超时）
<ul>
<li>是那些没有丢失，经历的时间比较长（拥塞状态）但是超时的分组</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>因为网络拥塞而导致接收效率降低，而为了提高接收效率，就会增加发送量，如此一来会加剧网络拥塞，如果不加以控制，那么网络最终会瘫痪。这也是拥塞的特性。</p>
</blockquote>
<p>场景三：</p>
<ul>
<li>
<p>4个发送端</p>
</li>
<li>
<p>多重路径</p>
</li>
<li>
<p>超时／重传</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CN%E6%8B%A5%E5%A1%9E%E5%9C%BA%E6%99%AF%E4%B8%89.png" alt=""></p>
</li>
</ul>
<blockquote>
<p>从宏观上来看，各方都不停地向网络中发送数据，就会发生网络拥塞的一个极致：整个网络出现死锁的情况</p>
<p>代价：当分组丢失时，任何“关于这个分组的上游传输能力” 都被浪费了。</p>
</blockquote>
<h4 id="拥塞控制方法">拥塞控制方法</h4>
<ul>
<li>端到端拥塞控制：
<ul>
<li>没有来自网络的显式反馈</li>
<li>端系统根据延迟和丢失事件推断是否有拥塞</li>
<li>TCP采用此方法</li>
</ul>
</li>
<li>网络辅助的拥塞控制：
<ul>
<li>路由器提供给端系统以反馈信息
<ul>
<li>单个bit置位，显示有拥塞 (SNA, DECbit,TCP/IP ECN, ATM)</li>
<li>显式提供发送端可以采用的速率</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>首先来了解网络辅助的拥塞控制，以 ATM ABR 拥塞控制为例</p>
<p>ABR: available bit rate: ATM网络的其中一个模式</p>
<ul>
<li>“弹性服务”</li>
<li>如果发送端的路径“轻载 ”
<ul>
<li>发送方尽可能使用可用带宽</li>
</ul>
</li>
<li>如果发送方的路径拥塞了：
<ul>
<li>发送方限制其发送的速度到一个最小保障速率上</li>
</ul>
</li>
</ul>
<p>RM (资源管理) 信元:</p>
<ul>
<li>由发送端发送,在数据信元中间隔插入</li>
<li>RM信元中的比特被交换机设置 (“网络辅助”)
<ul>
<li>NI bit: no increase in rate (轻微拥塞)速率不要增加了</li>
<li>CI bit: congestion indication 拥塞指示</li>
</ul>
</li>
<li>发送端发送的RM 信元被接收端返回, 接收端不做任何改变</li>
</ul>
<blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CNATM%E6%8B%A5%E5%A1%9E%E6%8E%A7%E5%88%B6.png" alt=""></p>
<ul>
<li>在RM信元中的2个字节 ER (explicit rate)字段
<ul>
<li>拥塞的交换机可能会降低信元中ER的值</li>
<li>发送端发送速度因此是最低的可支持速率</li>
</ul>
</li>
<li>数据信元中的EFCI bit: 被拥塞的交换机设置成1
<ul>
<li>如果在管理信元RM前面的数据信元EFCI被设置成了1, 接收端在返回的RM信元中设置CI bit</li>
</ul>
</li>
</ul>
</blockquote>
<h3 id="TCP拥塞控制">TCP拥塞控制</h3>
<p>TCP采用端到端的拥塞控制。</p>
<p>端到端的拥塞控制机制：</p>
<ul>
<li>路由器不向主机有关拥塞的反馈信息
<ul>
<li>路由器的负担较轻</li>
<li>符合网络核心简单的TCP/IP架构原则（复杂性放在网络边缘，传输层及以上）</li>
</ul>
</li>
<li>端系统根据自身得到的信息，判断是否发生拥塞，从而采取动作</li>
</ul>
<p>拥塞控制的几个问题：</p>
<ul>
<li>如何检测拥塞：
<ul>
<li>轻微拥塞</li>
<li>拥塞</li>
</ul>
</li>
<li>控制策略：
<ul>
<li>在拥塞发送时如何动作，降低速率
<ul>
<li>轻微拥塞，如何降低</li>
<li>拥塞时，如何降低</li>
</ul>
</li>
<li>在拥塞缓解时如何动作，增加速率</li>
</ul>
</li>
</ul>
<h4 id="拥塞感知">拥塞感知</h4>
<ul>
<li>
<p>某个段超时了（丢失事件 ）：拥塞</p>
<ul>
<li>超时时间到，某个段的确认没有来</li>
<li>原因1：网络拥塞（某个路由器缓冲区没空间了，被丢弃），概率大</li>
<li>原因2：出错被丢弃了（各级错误，没有通过校验，被丢弃），概率小</li>
<li>一旦超时，就认为拥塞了，有一定误判，但是总体控制方向是对的</li>
</ul>
</li>
<li>
<p>有关某个段的3次重复ACK：轻微拥塞（如下图）</p>
<ul>
<li>
<p>段的第1个ack，正常，确认绿段，期待红段</p>
</li>
<li>
<p>段的第2个重复ack，意味着红段的后一段收到了，蓝段乱序到达</p>
</li>
<li>
<p>段的第2、3、4个ack重复，意味着红段的后第2、3、4个段收到了，橙段乱序到达，同时红段丢失的可能性很大（后面3个段都到了，红段都没到）</p>
</li>
<li>
<p>网络这时还能够进行一定程度的传输，拥塞但情况要比第一种好</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CNTCP%E6%8B%A5%E5%A1%9E%E5%88%A4%E6%96%AD.png" alt=""></p>
</li>
</ul>
</li>
</ul>
<h4 id="速率控制方法">速率控制方法</h4>
<ul>
<li>
<p>维持一个拥塞窗口的值：<code>CongWin</code></p>
</li>
<li>
<p>发送端限制已发送但是未确认的数据量（的上限）:</p>
<p>LastByteSent - LastByteAcked ≤ CongWin</p>
</li>
<li>
<p>从而粗略地控制发送方的往网络中注入的速率（如下公式）：</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>r</mi><mi>a</mi><mi>t</mi><mi>e</mi><mo>≈</mo><mfrac><mrow><mi>C</mi><mi>o</mi><mi>n</mi><mi>W</mi><mi>i</mi><mi>n</mi></mrow><mrow><mi>R</mi><mi>T</mi><mi>T</mi></mrow></mfrac><mi>b</mi><mi>y</mi><mi>t</mi><mi>e</mi><mi>s</mi><mi mathvariant="normal">/</mi><mi>s</mi><mi>e</mi><mi>c</mi></mrow><annotation encoding="application/x-tex">rate ≈ \frac{ConWin}{RTT} bytes/sec
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.61508em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">≈</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.04633em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.36033em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">RTT</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord mathnormal">o</span><span class="mord mathnormal">nWin</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord mathnormal">b</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord mathnormal">t</span><span class="mord mathnormal">es</span><span class="mord">/</span><span class="mord mathnormal">sec</span></span></span></span></span></p>
</li>
<li>
<p>CongWin是动态的，是感知到的网络拥塞程度的函数：</p>
<ul>
<li>超时或者3个重复ack，CongWin会下降：
<ul>
<li>超时时：CongWin降为1MSS,进入SS阶段然后再倍增到CongWin/2（每个RTT），从而进入CA阶段</li>
<li>3个重复ack ：CongWin降为CongWin/2，CA阶段</li>
</ul>
</li>
<li>如果没有超时：CongWin会上升
<ul>
<li>SS（慢启动）阶段：加倍增加(每个RTT)</li>
<li>CA（拥塞避免）阶段：线性增加(每个RTT)</li>
</ul>
</li>
</ul>
</li>
</ul>
<blockquote>
<p>联合控制的方法：</p>
<p>TCP拥塞控制和流量控制的联合动作。</p>
<p>发送端控制发送但是未确认的量同时也不能够超过接收窗口，满足流量控制要求：</p>
<ul>
<li>SendWin = min {CongWin, RecvWin}</li>
<li>同时满足拥塞控制和流量控制要求</li>
</ul>
</blockquote>
<h4 id="TCP拥塞控制策略">TCP拥塞控制策略</h4>
<ul>
<li>慢启动</li>
<li>AIMD：线性增、乘性减少</li>
<li>超时事件后的保守策略</li>
</ul>
<p>TCP慢启动：</p>
<ul>
<li>
<p>连接刚建立, CongWin = 1 MSS</p>
<blockquote>
<p>例如： MSS = 1460bytes  &amp; RTT = 200 msec，则初始速率 = 58.4kbps</p>
</blockquote>
</li>
<li>
<p>但是可用带宽可能远大于MSS/RTT，所以应该尽快加速，到达希望的速率</p>
</li>
<li>
<p>当连接开始时，指数性增加（每个RTT）发送速率直到发生丢失事件</p>
<ul>
<li>每一个RTT， CongWin加倍</li>
<li>每收到一个ACK时，CongWin加1</li>
<li>慢启动阶段：只要不超时或3个重复ack，一个RTT，CongWin加倍</li>
</ul>
</li>
<li>
<p>初始速率很慢，但是加速却是指数性的</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CNTCP%E6%85%A2%E5%90%AF%E5%8A%A8.png" alt=""></p>
</li>
</ul>
<p>AIMD：</p>
<ul>
<li>
<p>乘性减：</p>
<p>丢失事件后将CongWin降为1，将CongWin/2作为阈值，进入慢启动阶段（倍增直到 CongWin/2）</p>
</li>
<li>
<p>加性增：</p>
<p>当CongWin &gt; 阈值时，一个RTT如没有发生丢失事件 ,将CongWin加1MSS: 探测</p>
</li>
</ul>
<p>策略不同：</p>
<ul>
<li>当收到3个重复的ACKs：
<ul>
<li>CongWin 减半</li>
<li>窗口（缓冲区大小）之后线性增长</li>
</ul>
</li>
<li>当超时事件发生时：
<ul>
<li>CongWin被设置成 1 MSS，进入SS阶段</li>
<li>之后窗口指数增长</li>
<li>增长到一个阈值（上次发生拥塞的窗口的一半）时 ，再线性增加</li>
</ul>
</li>
</ul>
<blockquote>
<p>再次强调一下何时候应该将指数性增长变成线性增长：</p>
<p>在超时之前，当 CongWin变成上次发生超时的窗口的一半时</p>
<p>具体实现：</p>
<ul>
<li>
<p>变量：Threshold</p>
</li>
<li>
<p>出现丢失，Threshold设置成 CongWin的1/2</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CNTCP%E6%8B%A5%E5%A1%9E%E6%8E%A7%E5%88%B6%E5%9B%BE.png" alt=""></p>
</li>
</ul>
</blockquote>
<p>小结</p>
<table>
<thead>
<tr>
<th>事件</th>
<th>状态</th>
<th>TCP 发送端行为</th>
<th>解释</th>
</tr>
</thead>
<tbody>
<tr>
<td>以前没有收到ACK的data被ACKed</td>
<td>慢启动 (SS)</td>
<td>CongWin = CongWin + MSS <br>If (CongWin &gt; Threshold) ,状态变成 “CA”</td>
<td>每一个RTT CongWin 加倍</td>
</tr>
<tr>
<td>以前没有收到ACK的data 被ACKed</td>
<td>拥塞避免 (CA)</td>
<td>CongWin = CongWin+MSS × (MSS/CongWin)</td>
<td>加性增加, 每一个RTT对 CongWin 加一个 1 MSS</td>
</tr>
<tr>
<td>通过收到3个重复的ACK，发现丢失的事件</td>
<td>SS or CA</td>
<td>Threshold = CongWin/2，<br>CongWin = Threshold+3，<br>状态变成“CA”，</td>
<td>快速重传, 实现乘性的减，CongWin 没有变成1 MSS.</td>
</tr>
<tr>
<td>超时</td>
<td>SS or CA</td>
<td>Threshold = CongWin/2,<br>CongWin = 1 MSS,<br>状态变成“SS”</td>
<td>进入slow start</td>
</tr>
<tr>
<td>重复的 ACK</td>
<td>SS or CA</td>
<td>对被ACKed 的segment， 增加重复ACK的计数</td>
<td>CongWin and Threshold 不变</td>
</tr>
</tbody>
</table>
<h3 id="TCP吞吐量">TCP吞吐量</h3>
<p>使用窗口window尺寸W和RTT来描述TCP的平均吞吐量（忽略慢启动阶段，假设发送端总有数据传输）：</p>
<ul>
<li>
<p>W：发生丢失事件时的窗口尺寸（单位：字节）</p>
<ul>
<li>
<p>平均窗口尺寸：3/4W</p>
</li>
<li>
<p>平均吞吐量：RTT时间吞吐3/4W</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>a</mi><mi>v</mi><mi>g</mi><mi>T</mi><mi>C</mi><mi>P</mi><mi>t</mi><mi>h</mi><mi>t</mi><mi>u</mi><mi>p</mi><mi>u</mi><mi>t</mi><mo>=</mo><mfrac><mn>3</mn><mn>4</mn></mfrac><mfrac><mi>W</mi><mrow><mi>R</mi><mi>T</mi><mi>T</mi></mrow></mfrac><mi>b</mi><mi>y</mi><mi>t</mi><mi>e</mi><mi>s</mi><mi mathvariant="normal">/</mi><mi>s</mi><mi>e</mi><mi>c</mi></mrow><annotation encoding="application/x-tex">avg TCPthtuput = \frac{3}{4}\frac{W}{RTT} bytes/sec
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.03588em;">vg</span><span class="mord mathnormal">TCPt</span><span class="mord mathnormal">h</span><span class="mord mathnormal">t</span><span class="mord mathnormal">u</span><span class="mord mathnormal">p</span><span class="mord mathnormal">u</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.04633em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">4</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.36033em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">RTT</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord mathnormal">b</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord mathnormal">t</span><span class="mord mathnormal">es</span><span class="mord">/</span><span class="mord mathnormal">sec</span></span></span></span></span></p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CNTCP%E5%90%9E%E5%90%90%E9%87%8F%E4%B8%BE%E4%BE%8B.png" alt=""></p>
</li>
</ul>
</li>
</ul>
<h3 id="TCP公平性">TCP公平性</h3>
<p>公平性目标: 如果 K个TCP会话分享一个链路带宽为R的瓶颈，每一个会话的有效带宽为 R/K</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CNTCP%E5%85%AC%E5%B9%B3%E6%80%A7.png" alt=""></p>
<blockquote>
<p>分析为什么TCP是公平的（2个竞争的TCP会话为例，假设两个会话的RTT相等）：</p>
<ul>
<li>
<p>加性增加，斜率为1, 吞吐量增加</p>
</li>
<li>
<p>乘性减，吞吐量比例减少</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CNTCP%E5%85%AC%E5%B9%B3%E6%80%A7%E8%A7%A3%E9%87%8A.png" alt=""></p>
<p>（具体省略详细解释，但是这个平衡的过程真的很神奇）</p>
</li>
</ul>
<p>考虑并行TCP连接：</p>
<ul>
<li>如果带宽为R的链路支持了 9个TCP连接
<ul>
<li>如果新的应用要求建1个TCP连接,获得带宽R/10</li>
<li>如果新的应用要求建11个TCP 连接,获得带宽R/2</li>
</ul>
</li>
</ul>
</blockquote>
<hr>
<h1>后记</h1>
<p>本篇已完结</p>
<p>（如有补充或错误，欢迎评论区留言）</p>
]]></content>
      <categories>
        <category>学习笔记</category>
      </categories>
      <tags>
        <tag>计算机网络</tag>
      </tags>
  </entry>
  <entry>
    <title>计算机网络学习笔记--计算机网络概述</title>
    <url>/2021/03/09/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%A6%82%E8%BF%B0/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\css\APlayer.min.css"><script src="\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\js\Meting.min.js"></script><h1>前言</h1>
<p><em>正在学习计算机网络这门课程，顺便做个笔记，记录一下知识点。</em></p>
<blockquote>
<p>参考资料：</p>
<p>中科大郑烇老师全套《计算机网络（自顶向下方法 第7版，James F.Kurose，Keith W.Ross）》课程：<a href="https://www.bilibili.com/video/BV1JV411t7ow?p=1">https://www.bilibili.com/video/BV1JV411t7ow?p=1</a></p>
<p>《计算机网络（自顶向下方法 第7版，James F.Kurose，Keith W.Ross）》</p>
</blockquote>
<hr>
<h1>第一章：计算机网络概述</h1>
<p>为了更好的理解<code>Internet（互联网</code>）这个概念，先从简单的<code>网络</code>概念说起：通俗的理解网络，就是由许多<strong>节点</strong>和<strong>边</strong>组成的系统。当我们把这些节点和边具象化之后，计算机网络以及Internet的概念就更容易理解了。</p>
<h2 id="计算机网络">计算机网络</h2>
<p>通俗的解释计算机网络的概念：<strong>联网的计算机所构成的系统。</strong></p>
<p>其“节点”分为两类：分别为<strong>主机节点</strong>以及<strong>数据交换节点</strong>。</p>
<ul>
<li>
<p>主机节点： 主机及其上运行的应用程序（是数据的源或目标）。</p>
<p>举例：ipad、手机、智能冰箱…</p>
</li>
<li>
<p>数据交换节点： 路由器、交换机等网络交换设备（既不是数据的源也不是目标，而是数据的中转节点）。</p>
</li>
</ul>
<p>其“边”（通信链路）同样分为两类：分别为<strong>接入网链路</strong>以及<strong>主干链路</strong>。其作用是将各个节点连接在一起。</p>
<ul>
<li>接入网链路：主机连接到互联网的链路。</li>
<li>主干链路：路由器之间的链路。</li>
</ul>
<p>仅仅依靠所谓的“节点”和“边”是无法进行互联网间的通信的，还有一个要素就是<strong>协议</strong>。</p>
<ul>
<li>协议（protocol）：定义了在两个或多个通信实体之间交换的报文的格式和顺序，以及报文发送和/或接收一条报文或其他事件所采取的动作。</li>
</ul>
<p>Internet 中所有的通信行为都受协议制约。</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CNprotocol.png" alt=""></p>
<p>至此我们可以大致理解计算机网络的概念。</p>
<h2 id="Internet（互联网）">Internet（互联网）</h2>
<p>以TCP/IP协议为主的一簇协议，由该协议支撑起的计算机网络。</p>
<p>我们可以从两方面理解到底何为Internet：一个方面是从Internet的具体构成角度（即上文所提），另一方面是从服务的角度来理解。</p>
<h3 id="从具体构成的角度">从具体构成的角度</h3>
<ul>
<li>
<p>数以亿计的、互联的计算设备，具体包括：</p>
<p>主机（host）= 端系统（end system）</p>
<p>在操作系统中驻留的网络应用程序</p>
</li>
<li>
<p>通信链路</p>
<p>举例：光纤、同轴电缆、无线电、卫星</p>
<p>传输速率 = 带宽（bps）</p>
<blockquote>
<p>注意区分：</p>
<p>存储常用字节Byte：K/M/G层级为2^10进制</p>
<p>传输常用比特Bit：K/M/G层级为10^3进制</p>
</blockquote>
</li>
<li>
<p>分组交换设备：转发分组（packets）。</p>
<p>举例：路由器、交换机…</p>
</li>
<li>
<p>协议：控制发送、接收消息。</p>
<p>举例：TCP、IP、HTTP、FTP、PPP…</p>
</li>
<li>
<p>Internet标准：</p>
<p>RFC（Request for comments）：请求评述</p>
<p>IETF（Internet Engineering Task Force）：互联网工程任务组</p>
</li>
<li>
<p>Internet即“网络的网络”</p>
<blockquote>
<p>理解：</p>
<ul>
<li>很多网络通过网络互联设备连接在一起</li>
<li>网络之下还包括很多小网络</li>
<li>小网络之间也可以任意互联</li>
</ul>
</blockquote>
</li>
</ul>
<h3 id="从服务的角度">从服务的角度</h3>
<p><strong>分布式的应用进程</strong>以及为分布式应用进程提供通讯服务的<strong>基础设施</strong>。</p>
<blockquote>
<p>基础设施：包括主机以及应用层以下的所有协议实体。</p>
</blockquote>
<ul>
<li>
<p>使用通信设施进行通信的分布式应用</p>
<p>举例：Web、VoIP、email、分布式游戏、电子商务、社交网络…</p>
</li>
<li>
<p>通信基础设施为apps提供编程接口（通信服务）：将发送和接收数据的apps与互联网连接起来。</p>
<blockquote>
<p>通信服务分为两种：</p>
<ul>
<li>面向连接的服务：以TCP/IP协议向应用进程提供服务的形式。</li>
<li>无连接的服务：以UDP协议向应用进程提供服务的形式。</li>
</ul>
</blockquote>
</li>
</ul>
<h3 id="网络结构">网络结构</h3>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CNinternetstructure.png" alt=""></p>
<p>如上图，网络结构主要由三个部分组成：<strong>网络边缘（Edge）</strong>、<strong>网络核心（Core）</strong>、<strong>接入网（Acess）\物理媒体</strong></p>
<ul>
<li>网络边缘：包括应用进程（程序）以及为其提供硬件基础服务的主机。边缘上运行的网络应用是网络存在理由。</li>
<li>网络核心：包括网络交换节点（路由）以及节点间的通信链路。边缘主机只有通过接入网连接到网络核心才可以实现相互间的信息传递。</li>
<li>接入网：有线或无线的通信链路。其作用是将边缘的主机系统接入到网络核心中去。</li>
</ul>
<h2 id="网络边缘">网络边缘</h2>
<p>网络边缘就是端系统（主机），包括网络应用（如：Web、Email）和支持网络应用的硬件设备。应用进程可以说是整个网络系统存在的理由，其中不同边缘的应用进程通过网络进行数据交换。</p>
<p>应用进程间的通讯模式有两种：</p>
<ol>
<li>C/S模式（客户端/服务器）：有着明确的客户端以及服务器。其特点也是该模式比较致命的问题：扩展性差。一个服务器的请求载荷是有限的，随着客户端的请求载荷增加，服务器的压力会越来越大，处理能力就会逐渐下降。一旦请求载荷超过某一个阈值时，服务器的处理能力就会出现断崖式下跌。目前的解决方式就是增加服务器的部署。</li>
<li>P2P模式（peer-peer）：没有明确的客户端或者服务器的界限。每一个分布式的应用进程既可以是客户端，又可以是服务器。这样的模式可以很好地解决C/S模式中扩展性差的问题，因为随着请求服务的节点增加，从某种意义上来说提供服务的节点也在相应地增加。（实例：迅雷、BitTorrenth）</li>
</ol>
<p>基础设施为网络应用提供的服务有两种方式：</p>
<blockquote>
<ul>
<li>理解基础设施的概念：在网络应用（应用进程）下层的所有内容，包括主机、接入网、网络核心等，都统一理解为基础设施。</li>
<li>两种服务方式的目的都是在端系统之间传输数据。</li>
</ul>
</blockquote>
<ol>
<li>
<p>面向连接的通信方式：</p>
<p>代表：TCP服务（Transmission Control  Protocol，传输控制协议）</p>
<p>有握手：目的是两个通信主机间为连接建立状态，有一个数据传输前的准备的过程。</p>
<p>特性：</p>
<ul>
<li><strong>可靠地、按顺序地传送数据</strong>：不同端系统间的通信归根到底都是数据通过底层的物理信道进行传输，如何保证物理信息在传输时准确，TCP服务给予保证。</li>
<li><strong>流量控制</strong>：在信息传输时存在这样一种情况，即服务器的能力很强，可以高速地发送大量数据，但是信息接收方（客户端）接收、处理信息的能力很弱，二者的速度不匹配，信息传输就容易造成错误。TCP协议实体可以发送反馈，从而协调好发送方和接收方的速度，致使发送方不会淹没接收方。</li>
<li><strong>拥塞控制</strong>：信息传输时还有一种情况：信息发送和接收双方的能力都很强，但是网络核心中的传输信道发生拥塞，如果此时发送方仍然不断地向外大量发送数据，很可能造成数据的丢失。TCP协议就可以根据情况判断，当网络拥塞时，控制发送方降低信息发送速率。</li>
</ul>
<p>使用TCP的应用： HTTP (Web)、FTP (文件传送)、Telnet (远程登录)、SMTP（email）</p>
</li>
<li>
<p>无连接服务：</p>
<p>代表：UDP服务（User Datagram  Protocol，用户数据报协议）</p>
<p>无握手：直接传输数据，没有传输前的准备过程。</p>
<p>特性：</p>
<ul>
<li><strong>数据传输不可靠</strong></li>
<li><strong>无流量控制</strong></li>
<li><strong>无拥塞控制</strong></li>
</ul>
<p>UDP服务不能保证信息传输的准确性，但是它的存在也具有价值。一些实时流媒体应用对于数据传输的延迟是无法接受的，UDP服务正是省去了信息传输的很多步骤从而保证了信息传输的速度。</p>
<p>使用UDP的应用：流媒体、远程会议、DNS、Internet电话</p>
</li>
</ol>
<h2 id="网络核心">网络核心</h2>
<p>网络核心由<strong>数据交换节点</strong>和其间的<strong>通信链路</strong>组成。</p>
<p>网络核心的主要功能是：</p>
<ul>
<li><strong>路由</strong>：决定分组采用的源主机到目标主机的路径（全局）</li>
<li><strong>转发</strong>：将分组从路由器的输入链路转移到输出链路（局部）</li>
</ul>
<p>通信网络大致可以按照如下方式分类：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CNnetwork.png" alt=""></p>
<h3 id="电路交换网络">电路交换网络</h3>
<p>端到端的资源被分配给从源端到目标端的呼叫（建立起一条专有链路）。</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CN%E7%94%B5%E8%B7%AF%E4%BA%A4%E6%8D%A2%E7%BD%91%E7%BB%9C.png" alt=""></p>
<p>如图：每段链路有4条链路。从左上到右下角主机间建立了呼叫。该呼叫采用了上面链路的第2个线路，右边链路的第1个线路。</p>
<p>电路交换网络的特点是<strong>资源独享</strong>，即便主机间建立连接后无数据传输，也会占用线路资源，从而使其他用户无法使用，导致资源浪费。但是这种连接方式保证了性能，多用于传统电话网络，而不适用计算机间的连接。</p>
<blockquote>
<p>计算机之间的通信不像电话，它具有很强的突发性，两台主机建立连接后并不是时时刻刻都在进行数据传输。（如浏览网页，用户发起请求之后的很长一部分时间都在进行页面浏览，此时并没有数据传输）</p>
</blockquote>
<p>为了提高电路交换网络的使用效率，网络资源（如带宽）被分成“片段”，同时被多位用户使用。像这样分成片段的方式主要有：</p>
<ul>
<li>频分（Frequency-division multiplexing）</li>
<li>时分（Time-division  multiplexing）</li>
<li>波分（Wave-division  multiplexing)）</li>
</ul>
<p><strong>频分（FDM）</strong>：将带宽分成几个片段，不同的用户使用不同的片段。</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CNFDM.png" alt=""></p>
<p><strong>时分（TDM）</strong>：将带宽按周期分为成许多片段，每一个周期再分为几个不同的时隙（slot），每位用户固定使用其中的一个时隙。</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CNTDM.png" alt=""></p>
<p><strong>波分（WDM）</strong>：多用于光电路传输，把光信号分成不同波段，分给不同用户使用。</p>
<h3 id="分组交换网络">分组交换网络</h3>
<p>将要传输的数据分成一个个的单位：<strong>分组/包（packet）</strong></p>
<p>与电路交换网络不同，采用分组交换网路通信时，数据传输会占用通信链路的全部带宽。</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CN%E5%88%86%E7%BB%84%E4%BA%A4%E6%8D%A2%E7%BD%91%E7%BB%9C.png" alt=""></p>
<p>主机间的数据传输过程如图：转发节点接收前一个节点传来的分组，并存储起来，等分组的全部传输完成之后，再将数据传输给下一个节点。（存储-转发）</p>
<blockquote>
<p>需要注意的是：每一个节点都必须接收分组的全部之后才能向后传递。如果边接收分组，边向后传输，就会造成多段通信链路全部处于占用状态，致使其他用户无法使用。分组也就失去了意义。</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CN%E5%88%86%E7%BB%84%E4%BA%A4%E6%8D%A2%E4%BE%8B%E5%AD%90.png" alt=""></p>
<blockquote>
<p>例子：如图，长度为<strong>L = 7.5Mbits</strong>的分组，在一个速率为<strong>R = 1.5Mbps</strong>的链路中传输，三次存储-转发的延时为<strong>3 × (7.5 / 1.5)s = 15s</strong>.</p>
</blockquote>
<p>分组交换网络的<strong>优势</strong>就是：按需使用。即有需要时才占用网络资源。</p>
<p>但是这较于电路交换网络的延迟会高很多，延迟的具体组成分为两部分：</p>
<ul>
<li>节点对分组进行存储</li>
<li>排队时间</li>
</ul>
<blockquote>
<p>分组交换的排队延迟和丢失：</p>
<p>当转发节点的<strong>数据到达速率&gt;链路的输出速率</strong>时，分组将会进行排队，如果路由器的缓存用尽，分组将会丢失。</p>
<p>为了保证数据可靠地传输，就需要协议来约束：拥塞控制</p>
</blockquote>
<p>了解了分组交换网络的数据传输原理，就可以引出<strong>统计时分多路复用（statistical time division multiplexing，STDM）</strong>：</p>
<p>这个概念很像时分多路复用（TDM），区别在于：由于每个分组的传输时间不同，因此对于带宽无绝对的时间划分方式（每个时隙是不同的）。</p>
<p><strong>同样的网络资源，分组交换网络较电路交换网络允许更多的用户使用。</strong>（具体的计算过程不赘述，但很有趣)</p>
<h4 id="存储-转发">存储-转发</h4>
<p>分组的存储转发一段一段从源端到目标端，按照有无网络层的连接可分为两种：</p>
<ul>
<li>数据报（datagram）网络</li>
<li>虚电路（virtual circuit）网络</li>
</ul>
<p>数据报网络：</p>
<ul>
<li>在通信之前无需建立连接，一有数据就传输。</li>
<li>每一个分组都独立路由（路径不一样，可能会失序）。</li>
<li>源主机发送给目标主机的分组，携带了目标主机的完整地址，路由器根据分组的目标地址进行路由。</li>
<li>路由器不会维护主机间的通讯状态。</li>
</ul>
<p>虚电路网络：</p>
<ul>
<li>在通信之前，主机间需要先通过<strong>信令</strong>建立连接，分组传输路径保持不变。</li>
<li>每个分组都带标签（虚电路标识VCID），标签决定了下一个跳转。</li>
<li>路由器会维持每个呼叫的状态信息。</li>
</ul>
<h2 id="接入网和物理媒体">接入网和物理媒体</h2>
<p>将端系统和边缘路由器连接的方式可以分为三类：住宅接入网络；单位接入网络（学校、公司）；无线接入网络。</p>
<blockquote>
<p>注意接入网络的带宽分为：共享；专用。（比如：有一个接入住宅大楼的网络是专用的，分发到每个住户的网络是共享这一接入网的。）</p>
</blockquote>
<h3 id="接入网">接入网</h3>
<p>住宅接入：</p>
<ul>
<li>
<p>调制解调器（moden）：将上网数据<strong>调制</strong>加载音频信号上，在电话线上传输，在局端将其中的数据<strong>解调</strong>出来，接入网络核心；反之亦然。</p>
<blockquote>
<p>拨号调制解调器：56kbps的速率直接接入路由器（通常更低）。不能同时上网和打电话。</p>
</blockquote>
</li>
<li>
<p>DSL（digital subscriber line）：采用现存的到交换局DSLAM的电话线。</p>
<blockquote>
<ul>
<li>依然采用调制解调的方式</li>
<li>带宽其中<code>0k~4k</code>的部分用于传播语音，其他的部分分为上行和下行数据传输（通常下行速度更大，称为ADSL（非对称））</li>
<li>DSL线路上的数据被传到互联网</li>
<li>DSL线路上的语音被传到电话网</li>
<li>小于2.5Mbps上行传输速率（typically &lt; 1 Mbps）</li>
<li>小于24Mbps下行传输速率（typically &lt; 10 Mbps）</li>
</ul>
</blockquote>
</li>
<li>
<p>线缆网络：有线电视信号线缆双向改造。（利用电视线传输）</p>
<blockquote>
<ul>
<li>带宽其中一部分用于传播电视信号，其他的部分分为上行和下行数据传输。</li>
<li>FDM：在不同频段传输不同信道的数据，数字电视和上网数据（上、下行）。</li>
<li>HFC（hybrid fiber coax，混合光纤同轴网）：光纤传输系统与同轴电缆分配网相结合。（非对称：最高30Mbps下行传输速率，2Mbps上行传输速率）</li>
<li>线缆和光纤网络：将各个家庭用户接入到ISP路由器。</li>
<li>各用户共享到线缆头端的接入网络。（注意与DSL不同，DSL中每个用户都有一个专用的线路到CO（central office））</li>
</ul>
</blockquote>
</li>
<li>
<p>电缆模式</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CN%E7%94%B5%E7%BC%86%E6%A8%A1%E5%BC%8F.png" alt=""></p>
</li>
<li>
<p>家庭网络：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CN%E5%AE%B6%E5%BA%AD%E7%BD%91%E7%BB%9C.png" alt=""></p>
</li>
</ul>
<p>企业接入网络：</p>
<ul>
<li>
<p>经常被企业或者大学等机构采用（10Mbps、100Mbps、1Gbps、10Gbps传输率。现在，端系统经常直接接到以太网络交换机上）</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CN%E4%BC%81%E4%B8%9A%E6%8E%A5%E5%85%A5%E7%BD%91%E7%BB%9C.png" alt=""></p>
</li>
</ul>
<p>无线接入网络：</p>
<ul>
<li>
<p>各无线端系统共享无线接入网络（端系统到无线路由器）</p>
<blockquote>
<p>无线LANs（建筑物内部）</p>
<p>广域无线接入</p>
</blockquote>
</li>
</ul>
<h3 id="物理媒体">物理媒体</h3>
<blockquote>
<p>几个概念：</p>
<ul>
<li>bit：在<code>发送-接受对</code>间传播</li>
<li>物理链路：连接每个发送-接受对之间的物理媒体</li>
<li>导引型媒体（看得见、摸得着）：信号沿着固体媒介被引导。（eg：同轴电缆、光纤、双绞线）</li>
<li>非导引型媒体（看不见）：开放的空间传输电磁波或者光 信号，在电磁或者光信号中承 载数字数据。</li>
</ul>
</blockquote>
<p>双绞线、同轴电缆、光纤（导引型媒体）：</p>
<ul>
<li>
<p>双绞线（TP）：由两根绝缘铜导线拧合（5类双绞线：100Mbps以太网；6类双绞线：10Gbps万兆以太网）</p>
</li>
<li>
<p>同轴电缆：由两根同轴的铜导线构成。</p>
<blockquote>
<ul>
<li>双向</li>
<li>（窄）基带电缆：电缆上一个单个信道（Ethernet）</li>
<li>宽带电缆：电缆上有多个信道（HFC）</li>
</ul>
</blockquote>
</li>
<li>
<p>光纤和光缆：</p>
<blockquote>
<ul>
<li>光脉冲：每个脉冲表示一个bit，在玻璃纤维中传输</li>
<li>高速：点到点的高速传输（如：10Gbps~100Gbps的传输速率）</li>
<li>低误码率：在两个中继器之间可以有很长的距离，不受电磁噪声的干扰。</li>
<li>安全：光在内导体中进行全反射。</li>
</ul>
</blockquote>
</li>
</ul>
<p>无线链路（非导引型媒体）：</p>
<p>开放空间传输电磁波，携带要传输的数据。（无需物理“线缆”）双向传播。</p>
<p>传播环境效应：反射、吸收、干扰。</p>
<p>类型：</p>
<ul>
<li>地面微波</li>
<li>LAN（eg：WiFi）</li>
<li>wide-area（eg：蜂窝）</li>
<li>卫星</li>
</ul>
<h2 id="Internet结构和ISP">Internet结构和ISP</h2>
<p>ISP：Internet Service Provider</p>
<p>任何一个端系统都是通过接入ISP接入网络，因此就会有很多ISP。由于网络用户数量非常之多，因此也会有许多ISP，ISP必须是互联的，只有这样端系统之间才可以通信。那么ISP之间是如何互联的？</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CNISPs%E4%BA%92%E8%81%94.png" alt=""></p>
<p>有一种办法是将他们两两互联，但是这会存在一个问题：ISP数量非常之多，在数量达到一定的情况下，再增添一个ISP所耗费的成本会非常巨大，整个体系的性能也会下降。因此这个方法并不可行，我们称其为：<strong>不可扩展</strong>。</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CNISP%E4%BA%92%E8%81%942.png" alt=""></p>
<p>当意识到这点之后，人们就会想到利用一个<code>global ISP</code>作为“桥梁”，来将各个接入ISP连接起来。</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CNISPs%E4%BA%92%E8%81%943.png" alt=""></p>
<p>一个global ISP可以完成“桥梁”的工作，很明显这种做法一定是有利可图的，所以为了不让其出现垄断的局面（垄断总是不好的），所以这时一定会有其他的ISP来参与竞争（如图：部分接入网连接ISP A，部分连入ISP B…）。</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CNISPs%E4%BA%92%E8%81%944.png" alt=""></p>
<p>有竞争必然也有合作，运营商们可以互相商量，给彼此提供一个接口，这样所有的客户端就都可以相互通信。</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CNISPs%E4%BA%92%E8%81%946.png" alt=""></p>
<blockquote>
<p>ISP之间连接方式有两种：</p>
<ul>
<li>直接连接（peering link）</li>
<li>通过IXP（Internet exchange point，网络交换点）来连接</li>
</ul>
</blockquote>
<p>接下来该种通信业务就会细分，出现所谓的区域性网络，他们可以更加方便地为某一地区提供通信服务，同时将与之接入的边缘ISP接入到全局的ISP。</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CNISPs%E4%BA%92%E8%81%947.png" alt=""></p>
<p>然后<code>内容提供商网络</code>（Internet Content Providers，ICP，例：Google，Microsoft），可能会构建他们自己的网络，将它们的服务、内容更 加靠近端用户，向用户提供更好的服务,减少自己的运营支出。</p>
<p>至此，整个网络体系就构成了当今的局面，即网络的网络。</p>
<h3 id="Internet结构">Internet结构</h3>
<p>是一个具有层次的结构：</p>
<ul>
<li>
<p>第一层ISP（中心）：国家/国际覆盖，速率极高。（如UUNet, BBN/Genuity, Sprint,  AT&amp;T）</p>
<ul>
<li>直接与其他第一层ISP相连</li>
<li>与大量的第二层ISP和其他客户网络相连</li>
<li>通过Peer或IXP连接</li>
</ul>
</li>
<li>
<p>第二层ISP：更小些的 (通常是区域性的) ISP。</p>
<ul>
<li>与一个或多个第一层ISPs连接，也可能与其他第二层ISP相连。</li>
<li>通过Peer或IXP连接</li>
</ul>
</li>
<li>
<p>第三层ISP与其他本地ISP： 接入网 (与端系统最近)</p>
</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CN%E5%88%86%E7%BB%84%E4%BC%A0%E8%BE%93.png" alt=""></p>
<blockquote>
<p>ISP之间的连接：</p>
<ul>
<li>POP: 高层ISP面向客户网络的接入点，涉及费用结算（如一个低层ISP接入多个高层ISP，多宿（multi home））</li>
<li>对等接入：2个ISP对等互接，不涉及费用结算</li>
<li>IXP：多个对等ISP互联互通之处，通常不涉及费用结算（对等接入）</li>
<li>ICP自己部署专用网络，同时和各级ISP连接</li>
</ul>
</blockquote>
<h2 id="分组延时、丢失和吞吐量">分组延时、丢失和吞吐量</h2>
<p>分组丢失和延时发生的原因：分组在传输过程中，会在路由器的缓冲区形成分组队列，分组等待排到队头，就会被传输至下一节点。这一排队过程就会产生排队延时（还有其他的延时，后面会详细提到）。如果缓冲区容纳不下被传输来的分组（队列容量不够），就会发生分组丢失的现象。</p>
<h3 id="分组延时">分组延时</h3>
<ol>
<li>节点处理延时（nodal processing delay）：节点在收到分组时，为处理分组所花费的时间。
<ul>
<li>检查bit级差错</li>
<li>检查分组首部和决定将分组导向何处</li>
<li>微秒级</li>
</ul>
</li>
<li>排队延时（queuing delay）：分组在节点中排队等待被发送所花费的时间。
<ul>
<li>时间长短依赖于路由的拥塞程度（是不确定的）</li>
<li>毫秒-微妙级</li>
</ul>
</li>
<li>传输延时（transmission delay）：数据从节点进入到传输媒体所耗费的时间。
<ul>
<li>R = 链路带宽（bps）</li>
<li>L = 分组长度（bits）</li>
<li>将分组发送到链路上的时间：T = L/R</li>
</ul>
</li>
<li>传播延时（propagation delay）：数据（电磁波）在物理信道上传输一定距离所耗费的时间。
<ul>
<li>d = 物理链路的长度</li>
<li>s = 数据信号在介质上传播的速度（约为2×10<sup>8</sup> m/sec）</li>
<li>传播延时：T = d/s</li>
</ul>
</li>
</ol>
<p>下面以车队的例子来类比：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CN%E8%BD%A6%E9%98%9F.png" alt=""></p>
<p>延时小结：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CN%E8%8A%82%E7%82%B9%E5%BB%B6%E6%97%B6.png" alt=""></p>
<p>排队延时取决于流量强度：</p>
<blockquote>
<ul>
<li>R = 链路带宽 (bps)</li>
<li>L = 分组长度 (bits)</li>
<li>a = 分组到达队列的平均 速率</li>
</ul>
</blockquote>
<p><strong>流量强度 = La/R</strong></p>
<blockquote>
<ul>
<li>La/R ~ 0: 平均排队延时很小</li>
<li>La/R -&gt; 1: 延时变得很大</li>
<li>La/R &gt; 1: 比特到达队列的速率超过了从该队 列输出的速率，平均排队延时将趋向无穷大！</li>
<li>注意：设计系统时流量强度不能大于1，会导致分组丢失！</li>
</ul>
</blockquote>
<p><code>Traceroute</code> 诊断程序: 提供从源端，经过路 由器，到目的的延时测量。</p>
<ul>
<li>
<p>沿着目的的路径，向每个路由器发送3个探测分组</p>
</li>
<li>
<p>路由器 i 将向发送方返回一个分组</p>
</li>
<li>
<p>发送方对发送和回复之间间隔计时</p>
<blockquote>
<p>Traceroute具体实现原理：</p>
<p>利用了ICMP（Internet Control Message Protocol，互联网控制报文协议）。这种协议下的报文数据IP头部有一个字段：TTL（Time to Live，生存时间）字段。这个字段在最初传输时会被赋值，每经过一个路由器时，TTL减1。当TTL在某一个路由器降为零时，该分组会被抛掉，并会向源主机发送一个ICMP报文——通知源主机：分组发送到该路由时被“干掉”了（并附带IP地址），所以实现每一跳的查询方式就是设置不同的TTL。当分组到达目标主机时，肯定会占用一个端口，但是在目标主机中该端口并没有进程在跑，于是目标主机就会向源主机发送另一种ICMP报文——通知源主机：分组在我这边由于目标端口不可达，“挂掉了”（并附带IP地址）。这就是具体的工作原理。</p>
</blockquote>
<p>例子：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CN%E5%BB%B6%E6%97%B6.png" alt=""></p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CN%E6%97%B6%E5%BB%B62.png" alt=""></p>
<blockquote>
<p>上图在第7步和第8步延时出现了陡增的情况，很有可能是跨洋链路（该段链路特别长）</p>
</blockquote>
</li>
</ul>
<h3 id="吞吐量（Throughput）">吞吐量（Throughput）</h3>
<p>在源端和目标端之间传输的速率（数 据量/单位时间）</p>
<ul>
<li>
<p>瞬间吞吐量: 在一个时间点的速率</p>
</li>
<li>
<p>平均吞吐量: 在一个长时间内平均值</p>
<blockquote>
<p>瓶颈链路：端到端路径上，限制端到端吞吐的链路。（短板效应）</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CN%E5%90%9E%E5%90%90%E9%87%8F.png" alt=""></p>
<p>主机A到主机B之间的通信链路一定是公用的，我们假设有10个用户在用同一段链路（该链路带宽最小），那么A到B的连接就会占用这最小链路带宽的十分之一。这十分之一带宽就是A到B的瓶颈带宽，是它限制了A到B的吞吐量。</p>
</blockquote>
</li>
</ul>
<h2 id="协议层次及服务模型">协议层次及服务模型</h2>
<p>网络是一个复杂的系统。一般对于实现复杂的组织与功能的思路就是分模块，把不同的小功能分模块实现，然后总体实现一个复杂庞大的功能。计算机网络功能的实现同样利用这个思路，利用层次化方式实现复杂的网络功能。</p>
<blockquote>
<p>层次化的具体思路：</p>
<ul>
<li>将网络复杂的功能分层功能明确的<strong>层次</strong>，每一层实现了其中一个或一 组功能，功能中有其上层可以使用的功能：<strong>服务</strong></li>
<li>本层协议实体相互交互执行本层的<strong>协议动作</strong>，目的是实现本层功能， 通过<strong>接口</strong>为上层提供更好的服务</li>
<li>在实现本层协议的时候，直接<strong>利用了下层所提供的服务</strong></li>
<li>本层的服务：借助下层服务实现的本层协议实体之间交互带来的新功能（上层可以利用的）+ 更下层所提供的服务</li>
</ul>
<p>服务（Service）：低层实体向上层实体提供它们之间的 通信的能力，是通过原语(primitive)来操作的，是垂直关系。</p>
<p>协议（protocol) ：对等层实体(peer entity)之间在相互通信的过程中，需要遵循的规则的集合，是水平关系。</p>
<p>协议和服务的关系：协议需要下层提供的服务才能实现，协议实现的目的是为了向上层提供更好的服务。本层的服务用户只能看见服务而无法看见下面的协议，下面的协议对上面的服务用户是透明的（看不见的）。</p>
</blockquote>
<p>一些术语介绍：</p>
<ul>
<li>
<p>实体（entity）：表示任何可发送或接收信息的硬件或软件进程。</p>
</li>
<li>
<p>服务（Service）：低层实体向上层实体提供它们之间的通信的能力。</p>
</li>
<li>
<p>服务访问点 SAP (Services Access Point) ：上层使用下层提供的服务通过层间的接口。</p>
</li>
<li>
<p>原语（primitive）：上层使用下层服务的形式，高层使用低层提供的服务，以及低层向高层提供服务都是通过服务访问原语来进行交互的。</p>
<blockquote>
<p>一个服务提供者（service provider）可能会向上层用户（(service user ）提供不同的服务，提供服务的具体接口就是层间的服务访问点（SAP），服务的具体形式就是原语。</p>
</blockquote>
</li>
</ul>
<p>服务的类型：</p>
<ul>
<li>面向连接的服务（Connection-oriented Service）：
<ul>
<li>连接(Connection)：两个通信实体为进行通信而建立的一 种结合。</li>
<li>面向连接的服务通信的过程：建立连接，通信，拆除连接。</li>
<li>适用范围：对于大的数据块要传输; 不适合小的零星报文。</li>
<li>特点：保序（也不尽然）。</li>
</ul>
</li>
<li>无连接的服务（Connectionless Service）：两个对等层实体在通信前不需要建 立一个连接，不预留资源；不需要通信双方都是 活跃。
<ul>
<li>特点：不可靠、可能重复、可能失序。</li>
<li>适用范围：适合传送零星数据。</li>
</ul>
</li>
</ul>
<p>分层处理和实现复杂系统的好处：</p>
<ul>
<li>
<p>概念化：结构清晰，便于标示网络组件，以及描述其相互关系。（分层参考模型）</p>
</li>
<li>
<p>结构化：模块化更易于维护和系统升级。（改变某一层服务的实现不影响系统中的其他层次）</p>
<blockquote>
<p>分层也具有有害的地方：分层实现一个功能时，需要不同层次时时交换信息数据，那么整体的效率就会降低。（每一层都要做差错检测）</p>
</blockquote>
</li>
</ul>
<p>层具有的功能：</p>
<ul>
<li>差错控制（error control）：使得两个对等体（不同端系统中相同的层次）之间的逻辑通信更加可靠。</li>
<li>流量控制（flow control）：防止发送方淹没接收方。</li>
<li>分段与重组（segmentation and reassembly）：在发送端将大数据块分割成小数据块，在接收端将小数据块重新组合成原来的大数据块。</li>
<li>多路复用（multiplexing）：允许多个上层会话共享一个下层连接。</li>
<li>连接建立（connection setup）：握手。</li>
</ul>
<h3 id="Internet协议栈">Internet协议栈</h3>
<p>从上至下层次划分为：</p>
<ul>
<li>
<p>应用层（application）：完成应用报文之间的交互。（实现各种网络应用）</p>
<p>数据单元：报文（message）</p>
<p>eg：FTP、SMTP、HTTP</p>
</li>
<li>
<p>传输层（transport）：实现进程到进程之间的数据传输。</p>
<p>数据单元：报文段（segment）</p>
<p>eg：TCP、UDP</p>
</li>
<li>
<p>网络层（network）：实现端到端（源主机-目标主机）的以分组为单位的数据传输。</p>
<p>数据单元：分组（packet）；如果是无连接的方式：数据报（datagram）</p>
<p>eg：IP、routing protocols（路由协议）</p>
</li>
<li>
<p>链路层（link）：在<strong>相邻</strong>网络节点间以帧为单位传输数据。</p>
<p>数据单元：帧（frame）</p>
<p>eg：PPP（点对对协议）、802.11(wifi)、Ethernet</p>
</li>
<li>
<p>物理层（physical）：在线路上传送bit。（把数字数据转换成物理信号，使其承载于媒体之上）</p>
<p>数据单元：位（bit）</p>
<blockquote>
<p>Internet实际上只定义了上三层协议（应用层、传输层、网络层），下面的链路层和物理层被统一为网络接口层。</p>
<p>协议栈不同层中的协议并未实现全覆盖，有些应用可以直接跨层，由更低层的协议实现。</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CN%E5%8D%8F%E8%AE%AE%E6%A0%88.png" alt=""></p>
</blockquote>
</li>
</ul>
<h3 id="OSI参考模型">OSI参考模型</h3>
<p>从上至下层次划分为：</p>
<ul>
<li>
<p>应用层（application）</p>
</li>
<li>
<p>表示层（presentation）：允许应用解释传输的数据。（关心交换数据的格式）</p>
<blockquote>
<p>表示层的目的是表示出用户看得懂的数据格式,实现与数据表示有关的功能。主要完成数据字符集的转换、数据格式化和文本压缩、数据加密、解密等工作。</p>
</blockquote>
</li>
<li>
<p>会话层（session）：数据交换的同步，检查点，恢复。</p>
</li>
<li>
<p>传输层（transport）</p>
</li>
<li>
<p>网络层（network）</p>
</li>
<li>
<p>链路层（data link）</p>
</li>
<li>
<p>物理层（physical）</p>
<blockquote>
<p>表示层与会话层的功能在TCP/IP协议栈中由应用层完成。</p>
<p>OSI参考模型包括了体系结构、服务定义和协议规范三级抽象。</p>
</blockquote>
</li>
</ul>
<h3 id="封装与解封装">封装与解封装</h3>
<p>源主机向目标主机传送报文的真正流程——不断地封装与解封：</p>
<p>上层报文的传输需要借助层间接口，依托于下层的服务，在不同层加入相应的控制信息，形成本层的数据单元，继续向下传递，直到物理层将每一个bit传送给通信链路（这是封装的过程）。通过链路交换机，底部物理层会还原数据形成链路层的数据单元（帧），链路层查询帧头部的目标MAC地址，并查询该交换机的栈表（或交换表），并决定将帧从哪一个端口放出，接着就交给该端口的网卡，转换成对应物理层的bit，将其释放到通信链路中。通过路由器，先向上传递形成帧，再将帧转换为网络层的数据单元（分组），网络层从分组获取目标的IP信息，并查询网络层的转发表，决定将数据从哪一个网口释放出去，再形成对应的帧向下传递，进而转为bit由物理层将其传输到通信链路。就这样数据不断传输，最后到达目标主机，并不断解封装形成应用层的报文。</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CN%E5%B0%81%E8%A3%85%E4%B8%8E%E8%A7%A3%E5%B0%81%E8%A3%85.png" alt=""></p>
<h2 id="历史">历史</h2>
<p>早期（1960以前）计算机网络</p>
<ul>
<li>线路交换网络</li>
<li>线路交换的特性使得其不适合计算机之间的通信
<ul>
<li>线路建立时间过长</li>
<li>独享方式占用通信资源，不适合突发性很强的计算机之间的通信</li>
<li>可靠性不高：非常不适合军事通信</li>
</ul>
</li>
<li>三个小组独立地开展分组交换的研究
<ul>
<li>1961: Kleinrock(MIT)，排队论，展现了分组交换的有效性</li>
<li>1964: Baran(美国兰德公司) – 军用网络上的分组交换</li>
<li>1964：Donald（英国）等，NPL</li>
</ul>
</li>
</ul>
<p>1961-1972: 早期的分组交换概念</p>
<ul>
<li>1967: 美国高级研究计划研究局考虑ARPAnet</li>
<li>1969: 第一个 ARPAnet 节点开始工作,UCLA</li>
<li>1969年底: 4个节点</li>
<li>1972:
<ul>
<li>ARPAnet 公众演示</li>
<li>网络控制协议是第一个端系统直接的主机-主机协议（NCP协议：相当于传输层和网络层在一起，支持应用开发）</li>
</ul>
</li>
<li>第一个e-mail程序（BBN）</li>
<li>ARPAnet有15个节点</li>
</ul>
<p>1972-1980: 专用网络和网络互联</p>
<ul>
<li>
<p>出现了很多对以后来说重要的网络形式， 雨后春笋</p>
<ul>
<li>1970: ALOHAnet,夏威夷上的微波网络</li>
<li>1973: Metcalfe在博士论文中提出了Ethernet</li>
<li>ATM网络</li>
<li>ALOHAnet，Telenet，Cyclades法国等</li>
</ul>
</li>
<li>
<p>1970后期，网络体系结构的必要性</p>
<ul>
<li>专用的体系结构： DECnet, SNA, XNA</li>
<li>标准化的体系结构</li>
</ul>
</li>
<li>
<p>1974: 网际互联的Cerf and Kahn 体系结构</p>
<blockquote>
<p>Cerf and Kahn 网络互联原则:</p>
<ul>
<li>极简、自治</li>
<li>尽力而为（best effort）服务模型</li>
<li>无状态的路由器</li>
<li>分布控制</li>
</ul>
<p>定义了今天的Internet体系结构</p>
</blockquote>
</li>
<li>
<p>1979: ARPAnet的规模在持续增加，体系结构也在酝酿着变化，以支持网络互联和其他目的（性能）需求。（有200个节点）</p>
</li>
</ul>
<p>1980-1990: 体系结构变化, 网络数量激增，应用丰富</p>
<ul>
<li>1983: TCP/IP部署，标记日
<ul>
<li>NCP分化成2个层次，TCP/IP， 从而出现UDP</li>
<li>覆盖式IP解决网络互联问题</li>
<li>主机设备和网络交换设备分开</li>
</ul>
</li>
<li>1982: smtp e-mail协议定义</li>
<li>1983: DNS 定义，完成域名到IP地址的转换</li>
<li>1985: ftp 协议定义</li>
<li>1988: TCP拥塞控制</li>
<li>其他网络形式的发展
<ul>
<li>新的国家级网络: Csnet, BITnet, NSFnet, Minitel</li>
<li>1985年：ISO/OSI提出， 时机不对且太繁琐，</li>
</ul>
</li>
<li>100,000主机连接到网络联邦</li>
</ul>
<p>1990, 2000’s: 商业化, Web, 新的应用</p>
<ul>
<li>1990年代初: NSF对ARPAnet 的访问网，双主干，ARPAnet退役</li>
<li>1991: NSF放宽了对NSFnet用于商业目的的限制 (1995退役)，ASFNET非盈利性机构维护，后面叫Internet</li>
<li>UNIX 中TCP/IP的免费捆绑</li>
<li>1990年代初: Web
<ul>
<li>hypertext [Bush 1945, Nelson 1960’s]</li>
<li>HTML, HTTP: Berners-Lee</li>
<li>1994: Mosaic (Netscape， andreesen)</li>
<li>1990年代后期: Web的商业化</li>
</ul>
</li>
<li>1990后期 – 21世纪:
<ul>
<li>TCP/IP体系结构的包容性，在其上部署应用便捷，出现非常多的应用</li>
<li>新一代杀手级应用（即时讯息 ，P2P 文件共享，社交网络等 ）更进一步促进互联网的发展</li>
<li>安全问题不断出现和修订（互联网的补丁对策）</li>
<li>2001网络泡沫，使得一些好公司沉淀下来（谷歌，微软，苹果，Yahoo，思科）</li>
<li>主干网的速率达到Gbps</li>
</ul>
</li>
</ul>
<p>2005-现在</p>
<ul>
<li>~50+亿主机：包括智能手机和平板</li>
<li>宽带接入的快速部署</li>
<li>高速无线接入无处不在：移动互联时代
<ul>
<li>4G部署,5G蓄势待发</li>
<li>带宽大，终端性能高，价格便宜，应用不断增多</li>
</ul>
</li>
<li>在线社交网络等新型应用的出现:
<ul>
<li>Facebook: 10亿用户</li>
<li>微信，qq：数十亿用户</li>
</ul>
</li>
<li>内容提供商 (Google, Microsoft)创建他们自己的网络。通过自己的专用网络提供对搜索、视频内容和电子邮件的即刻访问</li>
<li>电子商务，大学，企业在云中运行他们的服务 (eg, Amazon EC2)</li>
<li>体系结构酝酿着大的变化，未来网络蠢蠢欲动</li>
</ul>
<hr>
<h1>后记</h1>
<p>本篇已完结</p>
<p>（如有补充或错误，欢迎评论区留言）</p>
]]></content>
      <categories>
        <category>学习笔记</category>
      </categories>
      <tags>
        <tag>计算机网络</tag>
      </tags>
  </entry>
  <entry>
    <title>Hexo添加樱花动态效果背景</title>
    <url>/2021/02/19/Hexo%E9%AD%94%E6%94%B9/Hexo%E6%B7%BB%E5%8A%A0%E6%A8%B1%E8%8A%B1%E5%8A%A8%E6%80%81%E6%95%88%E6%9E%9C%E8%83%8C%E6%99%AF/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\css\APlayer.min.css"><script src="\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\js\Meting.min.js"></script><h1>前言</h1>
<p>最开始玩Hexo博客的时候光主题就选择了半天，当时很中意<code>Sakura</code>，一部分原因就是自带的樱花🌸动态效果，戳到我了简直。但是苦于搞了好久一直出问题，就放弃了。随后转战<code>Butterfly</code>，同样也时非常中意。</p>
<p>也是偶然看到一篇文章才让我明白，有了各路大神的搬运，🌸动效也不会再是<code>Sakura</code>独占了，哈哈哈哈。</p>
<p>效果可以查看这个小姐姐的博客，我当时就是一眼看到，瞬间爱上！！！！</p>
<p>链接在这里：<a href="https://cungudafa.gitee.io/">https://cungudafa.gitee.io/</a></p>
<hr>
<h1>操作</h1>
<p>很简单，只需在<code>_config.butterfly.yml</code>文件中，找到<code>inject</code>，在<code>bottom</code>处直接引入：<a href="https://cdn.jsdelivr.net/gh/lete114/CDN/Sum/sakura.js">https://cdn.jsdelivr.net/gh/lete114/CDN/Sum/sakura.js</a></p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="string">&lt;script</span> <span class="string">src=&quot;https://cdn.jsdelivr.net/gh/lete114/CDN/Sum/sakura.js&quot;&gt;&lt;/script&gt;</span> <span class="comment"># 樱花动效</span></span><br></pre></td></tr></table></figure>
<p>之后重新部署，就可以看到漫天🌸🌸🌸🌸</p>
<div class="note danger modern"><p>上面的链接已经没了。这里推荐下面的js代码。</p>
</div>
<p>从这篇博文中找到了樱花动效的js源码：</p>
<p><a href="https://blog.csdn.net/qq_36290227/article/details/105690155">(2条消息) 为博客添加樱花飘落的效果_热夏Lifeee的博客-CSDN博客</a></p>
<p>在<code>\themes\butterfly\source\js</code>路径下创建一个<code>sakura.js</code>文件，在文件中添加如下代码：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> stop, staticx;</span><br><span class="line"><span class="keyword">var</span> img = <span class="keyword">new</span> Image();</span><br><span class="line">img.src = <span class="string">&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAUgAAAEwCAYAAADVZeifAAAACXBIWXMAAACYAAAAmAGiyIKYAAAHG2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDIgNzkuMTYwOTI0LCAyMDE3LzA3LzEzLTAxOjA2OjM5ICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXBSaWdodHM9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9yaWdodHMvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtbG5zOnN0RXZ0PSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VFdmVudCMiIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIiB4bWxuczpwaG90b3Nob3A9Imh0dHA6Ly9ucy5hZG9iZS5jb20vcGhvdG9zaG9wLzEuMC8iIHhtcFJpZ2h0czpNYXJrZWQ9IkZhbHNlIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6NDFDMjQxQjYyNjIwNjgxMTgwODNEMjE2MDAzOTU1NDQiIHhtcE1NOkRvY3VtZW50SUQ9ImFkb2JlOmRvY2lkOnBob3Rvc2hvcDozNDVjOWViOC04NDc4LTFkNDctOGRjMi0yZDkyOGNhYTYxZWQiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6YjAzN2ZiMGItNTU5Mi0xYjRkLWJjZGQtOWU4NGExMDJiMGM2IiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAoV2luZG93cykiIHhtcDpDcmVhdGVEYXRlPSIyMDE4LTA1LTA5VDE0OjQ5OjM3KzA4OjAwIiB4bXA6TW9kaWZ5RGF0ZT0iMjAxOC0wNS0wOVQxNDo1MToyNSswODowMCIgeG1wOk1ldGFkYXRhRGF0ZT0iMjAxOC0wNS0wOVQxNDo1MToyNSswODowMCIgZGM6Zm9ybWF0PSJpbWFnZS9wbmciIHBob3Rvc2hvcDpDb2xvck1vZGU9IjMiIHBob3Rvc2hvcDpJQ0NQcm9maWxlPSJzUkdCIElFQzYxOTY2LTIuMSI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjEyMjVlZWE3LTEyY2QtMTY0NC04ZDAzLWFjOTE2ZTAxZDQ1YyIgc3RSZWY6ZG9jdW1lbnRJRD0idXVpZDoxRDIwNUFGNjZCRDlFNTExOUM5REMwMzg2RjlEQjFGNyIvPiA8eG1wTU06SGlzdG9yeT4gPHJkZjpTZXE+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJzYXZlZCIgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDphYmMzNjIzMy1hOWNkLWNiNDQtODViYi0zZTgyMjEwYmIxMjYiIHN0RXZ0OndoZW49IjIwMTgtMDUtMDlUMTQ6NTE6MjUrMDg6MDAiIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE4IChXaW5kb3dzKSIgc3RFdnQ6Y2hhbmdlZD0iLyIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0ic2F2ZWQiIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6YjAzN2ZiMGItNTU5Mi0xYjRkLWJjZGQtOWU4NGExMDJiMGM2IiBzdEV2dDp3aGVuPSIyMDE4LTA1LTA5VDE0OjUxOjI1KzA4OjAwIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQaG90b3Nob3AgQ0MgMjAxOCAoV2luZG93cykiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPC9yZGY6U2VxPiA8L3htcE1NOkhpc3Rvcnk+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+XCpBoAAApBxJREFUeNrs/cmSI8u2LIipLnMHosnc59Z7jyxhjSg1oggn/EWO+SP8B34JhRyWCItk1at7786MBnBbWoNlZm4OOLrIvc8+t45bCjIQjibQuKuvTlUpCdva1ra2ta3zZdtHsK1tbWtbG0Bua1vb2tYGkNva1ra2tQHktra1rW1tALmtbW1rWxtAbmtb29rWBpDb2ta2trUB5La2ta1tbQC5rW1ta1sbQG5rW9va1gaQ29rWtra1AeS2trWtbW1rA8htbWtb29oAclvb2ta2NoDc1ra2ta0NILe1rW1tawPIbW1rW9vaAHJb29rWtjaA3Na2trWtDSC3ta1tbWsDyG1ta1vb2gByW9va1rY2gNzWtra1rW1tALmtbW1rWxtAbmtb29rWBpDb2ta2trUB5La2ta1tbQC5rW1ta1sbQG5rW9va1gaQ29rWtra1AeS2trWtbW0Aua1tbWtbG0Bua1vb2tY/3xr+o7+Bf/2//z/+1OfPAIgJErGbMj7M8fue+O1A7LLjcxyw+5hwZMbgQnLgKIftRsgMyYUjBYNhOn6AADiMOGDCyIQBCflwwNEdw24HHA5AzhjHJxyQwZTADLgmHJPhDRnfjo6PlPHbNOJDGZgEZsIgOAHPR/yPwxv+28MONOBghIEAiXce8LkzuAG/vRP7o+EzAcMRyNlxoJByxj4T/8su4+UgPE3A++jg5yfe/lvD73/b4eVfM17/zfE//y3h6UjsJ8f/9N8m/Of/Cnz/d0cegHES/t///Q7HHfG/+/8JT0fABGQTzIEkYMyGf/0vBh8N3/99wv/rP/1/sDs6/i//+t8DZhCATOFwzPj4/R3/MhkOmPBz/47dB+CY8LZ/w/NnQh4cu88dppSRU4abQwbQCRPhdDx/PCGbI9f7JLXbRfHpYw+n4MOkPAAUSacBmfv30f/rf+f+8m+GpyPw8Zrhl0IMAmK5KgAOWCY4Ib6r8pO+/hiV/5c/LyyVe6g8TnH5P/3f/q8bwv2zA+TfZ7HtvKbY4ScCOxCU4EaYE04hxb0hOYgEATAJTsGYkP2IQQBocAkkAGMBQcdgA47HA3aMg0cQkhmOGRhEZAMoIpdDhiREQYzXJQBDSQwygFGLdwET2/3c2luLx9fXzjhKk4hs8QTmsd2OAiHkIR4wZmFKxNMRGI7C5xPxt3+Lv+0GvL47/r/fBgBCJpAcYPwVAICbsPsE/v0VSJl49if8+/C/IEMwCIQBcCQLUBeBlOOFi4K5wanyGcgAiPEe5XSApInJsllCQkAVQNFStpTcUjoakxtNZqJIwtIx2XigpUyaG2xSdvPj9/+aPy3zoORuorKVD7OCoZfLxAUgMhegrEBYf1p8x2pYdxUKITVEXIBhewFit21bG0D+HWoQDgJwiERSAF622CFNgpsh5YypHPck4S7YEEcjQQhAsoRj/ixARHiBOVpAhsthNkCKPZwCvNvTB1Ugi7/dnpunr9mQYJjoGGWLOooVUAcDbAWV6CleN9sxJwzOeE/lczgakQ4OkzCNhBuwOwo/n+M+u4Pwsbd4dQLciJefwvR/CLDsgyWVP+SMxx0HgSCe8h7/037CwY7YY1cPeyQzwAxe3j9FeBKSwOf3p7Q7cuQ7d0oYCbPkifvDnqaULNvOhAE0c7p2ACEbTBwIjhCMYIJhAJggWICsMuQTnEdCB7m/7f6rv2XLb2781ITP6bdpSgcrgNhFhTqJChnv9eGosILijKAnCIvlxQsQbwC5AeTfM4IkACdhHtHUlBTxjYSjEYMATxHGEQyQK5GFlZ3daOWsLxgjyiphYAMVJIv9XsIC9xgHg4HIDFBzUxyM5QCUShxBYifDwYSXErlkCkmEkaAcEDFRERUKmCxA0ARMiIN5EHBIcT2JkapPgmVhShHRjZOQU5xExqPw43uNQCOqffp0iEAegDShe9Nz4DUcK6Aa9nmACLylT+ynXYlwC4CbYWLGHoTJzFxj8rTfH8ZnE14pfqP4Ctke0EBoEG0gMJLcK3J2Lx9XIrFz2kjBIhSvpx9NgI6QPgR/B/Qu6YNIo8kHTpYcU0IWcRw+NJ9HIoAjIAroTja/FhWeRIblUoGQHShSZV9J3A7bDSD/jil2xHQgiOTCNJRoToISW9rYsi2tnMZZ7ieHwSINhSJyYyBc7N8J7hmkAS7IAhgFYRRxNGFww2SOEQm5/e2IVZ3AToY3HiEMEfGWtJkIQGRJgfsIEuU1wAzKGUmEM0oHgwMYo3aWJuG4B3IidlNJlQnYFJ/JNMxvfXcUxqNw2AHjJxalgPbpuDAchePOsJsGJAz4Mb7jPx2/zyUAAPsUibbD0+v77nlwvEJ4pfEbHN9o9h20AEnoWcQe5FgvRrIU6wSjCRzNbIRAQBmug9wPcv+A9A66RR4vp7vk7hIyQTc3pckwCjo+C26atIj3r4PhalSIdSBswFeAsAEiojyjRGAgfGQ5LRBRTdjWBpB/F2ic910i9r1oHnQ1vpoml9splFSZ7XkC/AxZ7V5wCAMY4ZviEDMLgByGVEDTYSQkxyji04BnByY49khz8bBEgBkBkP9ucSBaV9+K9DRenxuQLeqC9TnqfZ3AWHJit7IBBmYgHQU8AXkE+AGYRxS5c4AufO6Ap/d4CB14+hA+98Tr74LXskWLeuNV7Y7A5154+knsfI8fw0d/WjIAw+uwG7lLT7T8QscLhb8B/AbxVcI30r6J/E7yReArpReSexhHGEeAVivEIBNrBUWYIP/UlN/o/i53wN3hzHBM5UWCJheY4cwwy0lJOEKi++dTdqUOIS80TuZwv1z3C1FhD4g1KjQ0AFyAoZWovfyhRYq/rQ0g/z4gyZq/IpXTfyYxOqJpYRGZycqODUDuYBoiNS6NmkSDKyOVWqXkAIeIIl1wd1hKyIdPjGNt1EQEeSwR5E8DkgyfzC2lriktSp1y5ylSWyqaQl2xoDaacgHI9h47gFRJ+02R0gNAAiEwABJAHuMPDpOQzcBJSBn4fDK8/MzwFK/l5V34t78ZYHMzCTWYKwXO3Qfw/h349jux0w7/y+7f4HASHEzpaWB64WivML0y41mO7yC+B0DiheR3AN9p9h3CK4QXCi8AX5H4DHJHlWoHlAMUNcl1gPs7MsiELKNzQgaZReS4rwQgR9GYmcQEV3bQkTnZu3Y05fyEI7y8rXujQs2NHdQSiUWKrH0PhoASAwgLxrfnyIiGliKjadu3tQHk32upprGtURN1O2SWRg1hU9QFkUsTptQRo/tNTCU6nKYJYzl8MoQdAJiBk8PlGC1hUmnBqEal0egZakMFbMEHu2OwrgSDIeqMQ9c3NtROdjwyW3SAWdPs2jcuzzeUjj0AmBMTiXSIDnNOhEod8rADcIiGy/ue+M/lL7oRr2+O//9/SS3qHnwZmTuF/Yfwb/9ZSJ7sv3x8p/yZlnZ7s+HVYP9C2t8A+4aBz3A8EfwO4G8k/ybhO8hvAL4B/BvEVwLfALwAeIH4VEJ2h3SE6x3SO+QfpFPQEbIRwo6uSWY7yI9AGgmMyvkIcgA50JjgHEEOFAY6Bk5INJl2BubrjRMuosI5Rdae0EmKXKcJILXHm6sBKaVF/RGurUGzAeRfC5Nexm/MgamOwCgiqADN2qgpoz4EvKS50ahJLXIKkPNlJ7uApTpYLt2Z+LvluKpZcWaN8ro8vkSVgwxHCs9eRnvK7cYAdbQ6ZAC+swSjJYIUHENJ6VVGdI5G2NEjrR5YGjXA23O82vEg/PitSzMNeH4XpgRMI8AM7HNL4xlRnWhZ9t/9D3gaNDz/H//tvzxZGp990Ctov8HSfwbtPwH2G42vAJ8B/Bbb8DfIvpN4AfgC4hniC4AR4gBglJQgOOSfdP0EPcN9kvMIMtFsiHOBEpgGAiZnYsTAiZCJTIASYANMBnmCmQmeIA12QMInjWU0oQGXz40zJEI7LFPkRMhWokKP/SoATw1UI9LUIgI9LQWBceLa1gaQf5dlAHKNwkr9Owk4lu4t5ZBx0XwgCLjXqnzbgdkQyBsaqTRqWhWfAZju5a/WbYzu+ABiStGVzgwQy2T721agdSfDkRkx+CNMc5INenRUss3znZlzJ9tLFJmc8DKuZCIwGGzKSEchjwZPMf9Yu7fjUTiOpVFTXs/uIPvb756ePmT7AwgyARgH8WV0vg6y1+T2Yjb8liz9N0rDd5l9S7TfSuT4n0H7TzT7DeQLYDsAz2B6BflMYF/qi0NpeZeOdE1bBbgTriTCYJYAGKUksv6eKCVQJiiRGkQNoCUQA+GDkBLgAwYlMg0gkkEDMAwpY0xHHc2RwZPGyVh+TwgwPI0Kc9lHSorMRdSpeZi8gqHmUiYsTlK5wLkb4WkDyA0g/6JKpJMYSif7EzO4tC5wqQVaS7GWjRqQIC1mHjG0TraBoAWo9o0aszEaNXUApetk77Ih07HDUEqkpQ1T7r9TwrtN8KlEjCxRbN+oKSMp9HJQ1eiSbI0aMUoHqZQOWDrZ2gF5IMZPlXonbJxg338XRRikJHBH4uX//P/ML0jpGbRXks8mfjOkvxntO5L9zWz4jTb8N0zpPyGlb6Q9C/YK8jst/Q3kd4A7gClCdMb+a8b5xNNNcdaB+DZuVUYFDAMcCcYBsARggDSUKsYAVyIxKvuRRESgwAhwonGQ5QGZOwAThR2TJhsxjsDgUx4+/xs7+rNpngo4AcNpJSos6fHNqLAAbE4xUuY2/+zvvKXZG0D+5SuVs/rMDomzd40ya51IcsASpEIFhJCY4HKk0qxwCKmM4sEFV4z6ZJ+Q0q7UIR1GQ9aEQYZPAs9u+BimBYbXCHIisHNDLiwTw3mjxrpO9pBxdlT27JpMRK1UMaRtk0MJOOwN40e2//SveXg62n50e/6XH3pS4p4Yni3ba5L9C2m/Uek3Mr0AfKHZNzL9C8jfMNg32PAd5DeZ/UZL30R7htmOiXvQ9rUBTVr5cNkiqPa61b3D2qwGoUhLCXII0NOoqCPumHiUcwQ0wG1E0g7EBGCMuiMGug2QBrmPzDiIHAAMoAYyJQMSpGEEh4MVNmUuJZK+cdJHhX2N8hQMLU5W2UpU2IGhuomFuRYJMKul3zWT2dYGkH/n+LFSDlm6hsJkjPGW0pCwfEo5VJthrBGb0TB5xoCumUMAaaYcjmnAYTqU7nZEmQMNDmAsqbFhnXJYj46xDMNlRM0UXce6drLFZSe7giJKpgpUiuPcyXYDhk/x+aenl5++e/7g0+j2bEzfEu03o73S+ULwBbDvNPsbLf2NKX2D2Uu5vIL2HcbfmIZvMPuGZM8wvsDsqTRFDMlIszLmwnlWc65ZtGHyGh/DS4W2lTe8zICnAe4DrKTMZgniyKwjqAGmJNcAq80YT8hIck9wGSkTUjIyRVVYKSJaJINScqTxmBNM2bwUiqUrUWFEhEolRbY5TZZhmSarn4EszRmfh9G9AGpO1kB1WxtA/l0B0k872Q5MKcI18wDI4QhMiWXULiiHaEPlbNxqz3OjRpVewplyyDQuKIf9wWU6jfQ0N2G610sQA6JRM2ruZLNUJU872T3l0MrQuiNqnUcDMsRxorl24/P/7Pv//f/ozyBeYOnV0vDNLP1Gpt9g9g3kE2ivMH6Dpd8wDL8hpW80vsLsGcZXpHJfS68kn2C2gzHBzFCH560Dxu4zmqPIOts0b2ojRLWhYdZ6IDGFj1ZzFDxF+J4S5ImUyd1gTCUFTyQTzJMcieSAXMBRiQGSyaCo/KWjp0xnPVedNk6WtcIZDE+jwqhNFhAsoFgJNW6lLpwMuYIp59Es1Kh1WxtA/r1hMvrOAZCpKNO0up/ZYgh6QTnEspONQuhgNyvMtoPPB39POWx8aUUkN1mkzo16eEI5FImxNGqoITrPIeew6GT3jZqpNmoATCUqHR1042hmuwTuTXjmgO9M9s2Mr6R9o9k3DMN3JPtOS99APsPSC82+I9lvGNJvsPQdZi+MKDHqkSk9wzjAaCyt/Dpu1MqK5Gl42803laICT0QjyvuPOcHCdnJHNGAsmjXuibJSK1WCEF1rIkE00VNoXdAgJgJJ8ZEnSoOSBiolSQNTSiYNhog+RUxrjZOzFPk0KtQ8XF6jQt+xpNlzvVGljlxPoOYqDR6169vaAPLvn2KjU7tx4DCUtFkq2++jHAIGyWFIFyiHgplFo4ZWGjVapxxS2LcBoNJDL42avQw/LEMeZYHcQX0cUGyNGpsbNZRcTjBDu72npxeMLzbaa4omyyuZvtHsN5KvoL0i2SstfUeyfynp8zONLyC/YUi/IdlvTOkVtBeQe5IDzAYYU4sEO3BbhLu12cE5bZ5BspxMvBuuNLaTT2OXKNJsmgFSIpkUnE6L35XgSKIMYoJ8IBlda5bGTulNCxpgliANMB8BO0ApUT6kbImUvX/nQgptnmOMhgxPokIZMaWICltkyXlf6zvcdMHc599PwXDLrjeA/CtX7SgndTxkYQZPLaXRYh4yaIOlxRCMGnfQUmvUNMqhA64TyqELSoKRIYsm4pPAixsOKeOpoxzWRk1QDhMmO8QsZn2Na5TDMr5EIhk5PCENL459Srvn0exvTOk7LX1jslcwvdL4Cto3pBI9WnSckdJvNLZaI81eo76YvpEstcX409FgYddUWUZXC0mcpuZhC5qINPPHu43dvFUB0FrQcxjkA+QDwSRwgJDgSjAOFEYJRzgToKF0vaPLHcdLuc4EMoE0kAOMiWZmE5MdkXiEcYTbpEXjRIz6YB4rGJ5EhZjrln1UOF/O+lEzAHtXm9wCyA0g/8pGDYqSD4r02Th1jRpFo6YBkgtMaKl4pRxmTaVRE3VHcACNsCy4hJQGTIcPjIzmjVI0ZhzCrlAOq7pPTzn0bvRo9FSkttY72RBwHIRjgo0TxidPz8PA55TshUwvNHvlkH4zS39DgF13YYhDmH2LdDkAEuQ3kC8lWnyC2UjaGKjcNVWkReS4TJuxLKrWcSl2qKD+ffeqOZ0ihs/RKI0xhOU0CKkOiUseMmcOA5noPihAb4CYKCaZDYAKmHpEvuIAs5Hyg8xGmI3GNI5HH3cfPn1KftwRXrQsaxe6jwpbp9sjyrWabnfzszqNCl2LSLQ1fFhS+cEi1t3WBpB/9+ixUuhOKYclovREpOM8OmOIiI9cUg5DG/LQmimqrBkGBFbKobyqPtY0PFg2qaMcLnDg5LhIMRY+Uw5rdAtgkNnLgUP6tOF5sv3A9C1Z+s3S8MqUXkh7jXqifceQvsMsmixM30C+wvgK8htSeiH5rTRkvpfbngAOJAmjtWix6zjXmmKNaJvAQz803wPpXFxdnrUUz9X6NewjzWXXO05UMsBGSCNcx4gUbQS0g/sEcgI5wmyEYwS1I5QV23cwTnBOJOu2PYEsINNsGvKQn96P+Zjgb//ZcprYGicBgL6MCCsl9TRF1gyGfVSo0vDRYJGKr4z/bGsDyL8kgmxipyVKi8ZGZUIE5TD4yx3l0NXogbVRQ1oLlAgid5TDFg0VdsxMOZxfR22keO2Ol0ZNTzms0dUow4GOZw9Gt4MmID35sN8d+ZxqpJjSb0zjbxxS7TTXkZzfmNJvsPQadcUWQb7C7HvUIUtaXSLGYJ90tUXyvLi4YIYQ6IByrvXqvKjGC8U2dpVilU+tpuOpfFjugJkRGuW+gyHTLUueg96ECVImmSXlKNsyI2jzU8AzXULcJmSILjED5jRNyZV3U/KXn9nfPvRBufrGyXpUWHjWJ3xqWVAR887K6A9XGz3WcbzNN7GKDSD/Qpis4rlDbdSMNX32og15QjnUFcqhO5g4n/g519tUBqPdc6TSRRuyNnJqJzsJmOgYZI1y6F1cupPhwyYgJ9t5SkTaJeNLYnrhzl4taojfYKk0VNILaS8FAF+R7BtS+h6pdNlGey2/RzptfCK5g1lapMEATnL7lQinn6w/AfhirXAeWhXw8/qZnQBph43tk6c3ewtAA4CnUqrNJF1kjujRIoRXqPqAnGBWwNK9gOZUznnRYyMdNAc9w+B0aH9E/tu/Kr+9+lEzvT5q0bk0V3yuJsRMZKTHbkXG7OQz6wGwB0V2Cj7asusNIP/SGiTqzFmk1VWlJmlGBCLP0l41XSwNnBrZWaEcsnwNHkUwGAsYJsHSCeUQYQDmcOwq5XAyTCaMLYWtaucRNO2VeKQncngelJ5pw0tKqTZXXsg5GsQwfGdKtab4DNoLkn2D2d+i3sgy5M3XEjGGlBhhTXGjfUxcDfRaCl3nWQwz0J1OVGu2mJgbTDYDXzoJx9RHp/GZN8ohu46GEZANkO9Bc8AzaBOoDMKjIMiQOKsgWPkwpIPI7ScoEi4iB5Aym5lrUt7/nqfPQZ6TJssnUWGaxSrWUmSqsLRWokSsRKGN+SRujewNIP8xVqMclpojywFAzLYF9QCt9UMWyqEVyqEtKIcxGM1JrZOd8xEp7Zp1A0lkBaPm3YBnGY6cFplnsXYwN/LZx6fvenrGwG9mwWYpIFi6z/bCxG+gvZYI8ltJoV9gfIbFSA8s7kOzVwD7Uo9LbXrbeAEI+0YLunpi1502Ow8S+yutR8MFcAo6p6csOj5YgCWWQEkQO6iLBJeXDGACmRURY+hE1u3ABDBqlrIR1A7gRNok00TDbsx+fHrD9Pbd8uGbCcLVFPmeqLAHwrO3j3Ppu21tAPn3jyJLSpQ0Uw73uQjjJoKFctgyJPcYncMsLZaYcPTphHLIpk6e5dilAdPxs1EOM4SRhiOEQdEdPaUcgjAmSwlpN5JPNvAbad9Ya4fkK0qUWBoqLzD7VmqPpRljESEanyP9DjsDGF/Aop7DhQrHEhA5lyPmkIjz9M5ippHLuqL6dPvk9xMcpDpFJMxNn/aArs6rOvJTRY2NkGigxgB8ZJBHEDuQE8Bo3AQY7kBWwAwbB3CkcZRzB+IIsylE5tNIYGfExGncPR95PE4+fRimlNF8jf6IqLCnltJLXdznz2VbG0D+3VfrZFfRB5872dGoCSOq44Jy6G2HtmLb2iiH5T5tjLu5HAo0a5TDM7DWMtjyoBymIY27RD6b2XMRh/ge9D/7RvKlpcelpkizVyS8wtIrLH2PWUeWYW97QeJrqHenl7Au6LLeKsWGrhlzFsydjuU02t9y8PviGel2e7Y1d7qm1VyILN+DV0Xuyl2y+DKlAbCR9AFmO8EngCMzR1kBQnEEeJRspDTCtFPSERk7Jkwi9nTPgE/FnWeitMPAPDqm17fJkVxTQvC0L0WF5ReufA5trLOPOisYllFPT8S027jYG0D+hRFk7UnX6mFSiOdWl8PJUjBeOINH72zXLLZoHeT2CuE8mRMMgOUJIFXKYTYVN0Ifnrh/5pBezNIrYw7xpUSKdfzmhbRvAF9h+AZLLzP9j9+Q0jekcjvtOSJIfgP4XCInsAcq8nK9se9anwAie5Ds0+/TGuXiOVdS9v6uNtcYAwwLCFbZotoeVjdyZARgpuwjyD2gieSoKB9kyjKArLBoyCHxWy5uOWZ2zEuLusSGWWB8KXSHAb4/mPBD+v27Phor9EpU2INhBULT/Bm7ET6iSfp6whmne1sbQP5lKXbTdsRMOawuh30kdY/LoVpbZ6Yc1vk+L3ax7jlYN61+WcRzRXyY8zXvxmEYnxKGV6bgPAP2EmISjHojUBkwpdGCOvQdQ93G11DcwbfClnkR8EyzZwCpAZCwmk7fcWa5L2rsgXIBnKdpNpflxh5IF4SbWUC2DlbLrEz1lNCLGmC2j06ZZkNqoa8IYhYYK3VKQTPfvmj4EIGMQax2Mnki8+5Af/7wfNj7wa14KXaZQANC74oTVgBwDBEUH9CJU8yPpUfcSg9bXubtWN0A8q9OtcNhCUlx1OXSlGlJX601VkrfCeXQgRn8aAvKIYvFgmvuZI/DALqCUUMiy/HkRgC7JxueacMrWSLASKVfCLwUEPxeosbCcLHXoqzzjU2CLH6PemM0aEjuEPqHJ5HahaLgSTFiFehqHH62eQU8yfWI8fLZa/X5iE4+7EShe+Z7awQoSF7a3oI89HRi3CdH8E8HmNs2WgYxgdrDFHOVhuICzgnME4H9IOSnT005MWvQlKYKvWWkp6j0TEPRgExdQ6ebHaMDqdIKs5rqz2nJZVsbQP7ljRp0LoFT8WcxlEaNF23Iely7Qna/iUlUvvU55TDm9RS86zRgmt6DEyNvquAC0rNsHDi8KKUXtHlG+4ZQ2SlyZEV2DGVMJwa7X1qjxkKyDAwhW6SWUu/CyuDkzZ+2y09T7AZyXZTG7raODdNG4XtBitOU+xqAXsJmXkEKzlqYsBApDqYTCShSbbMM+QSzHeWThGPpWGcQI2g70CeQR5K7YNRogjiCGgnsREwghpmVo3Fw2+0/NHFPPz7Da91QaaW7XaPJrPaTroUv9ql5Ysdu3w7UDSD/ARo1JUK00smuHO1shOXiKV2sCrIcAzsPmEI5nK5RDov9gjT7ljhE0tLTsHsysxdZegHthWTrQkcEaOHqx0inafY9utB8IdMrUv97F0HGY8e+C3yxccKVSG8BZNbV/dCJTixT7kXz5ioYnozqXIs411g4beZydu/pRTMQJcORKHVIcoK4I3UUORGYRI4gpnafUIkbFaLrE4gjYBOJUcQuuuOaSB5Ndtxljdkx/XiVW52uLN40lmd1cKtakDinIZ6CIRfSaZw52tvaAPKvadQAPeWQjqa6bRKOZhgVZl81nawmXrXmGOm01ZnFmG9slMMyDK04gIOAEY8fPA1DGp4xpG9geo5h79qd5rfSkAnQrCl2cKWDAYMuqmSpSSa+lLnIpwhh1wDn2jYsGttL5e9+5OYEKC81b26B5KXXsjA/6wbDy3fULILMolzRasZR02AEvSlAkVMBvSOAEcQYGj3sxoBahLiDFCNAsB2gwtu2oCiaRkA7unKk2j69f/rEo2T5clS4PA9xtlhozZslGHpRIs+77TjdAPIvhsnwoTEM7kgSDmVqBPKmvFNtEFpXeiYglqeZgbBu9drAqdqQlXKYM4dhGJiGZ6ThG9MQqTLw2mqIQKH/pVdCRZiWryC+weqYj9VI8VsnYPuKiJjGRbh1Jz4uDmNqCZK6kvOuNG/OQPJiyn3ltdWZSz9piplDnfBDWFUUcKwkd6cBGIE6D1l+kkeA8zbDEc49SC8d7glmR7jvC1jGdsOEzBxtlJwJ5HGCf/s3Tp9ppiGupchtTrIAYT84HgrlgO/QLBrax7YVIjeA/MtrkF0SlzyuT12jpkrg991GnVAORcDKrGOl0Dm8MWrC5RBIw2gwjmm3e0EaXsPyFKW22NLpnh/9ihpVlq513IbXIlz7isqeIZ9o3M8E8T5BXQO2C+IRutSn0QozRg8UDnUmc3b6Gshz5K6iwejEMNpAO3UuylsRMpBogHEHVaaMjgj2UDBsGj2RXpo3s8BFNHWmMvw6hdhF5XnT4XTA8tM7nvKLNCUdZyAErPiYz4IVRbNzDMk7txNBI3UfE+fHbGsDyH8YxKw87GzAmJeS/wvKoQNMbJRDVZdDz0iaxXNHFGUeF9xz2j+/7DkML7DU6IEgvoP2CvC5a768wvgbwDnt7uuLxhgIJ56RUhkI53DWjOkaKOuh2uXq7Hz1iv9oHyZWoLKV5s1a9ElejmJ5GuWrWGRrZtAUqbgFolQQrq8h1G1HsIBidKy9ux68a1dwtWdwzIXYlGH0xuUuEmmwlAFOnPLOsk37g46UT5aL9m+JCqN5M4/znEaFvTf2ormDUoPcIsgNIP8hokiiyEfkuVGTo5OtRNh0QjksNgs95dBgOGqmHNYok8k4piGNaffEIYU2YwhEvBZ/6W9zlMiQJwNLBGnfQMQ22jPIb0ypmGgFU4ZRb9xdjgZXLFV5IfVt7L5LIzxYkaY5AUlcS+d5IejklUbOaWNmQVcJ/ndhOHXacUFBdAPoBtoOVqTOqAKMjPEdZybtKPqudLOjgSMbI/G1ifQRxCgxapXhwR12ssQ4HDlOxun9VUesRYX9V2KnJwGe8LUFTw4fHJ62Ls0GkH/xuko5LC6HScCxWTkXymE5SGfKYSqUQzTKoQAmS6Ol4cnSEGM4xm8QX4uvdIkWESk2AijJ2pCxlmaTpcaYwiYhHmv7JiPUj+rwJBLkJYZMB0Z+oeh1rX64FkneYh1eUgVae23dnUktM/MEMBtkRYzYS0Rpc/rPVIRFpKRozIwkByQOoQKkncyOSBopHlWoiNHZxgjwACAFKGIs9d0MsyPkExIzpMnc9uNR+Z3KVDHOxAkrBh3rprxEN4cPOQCxgqI5VBwqt7UB5F8eQVbKocpIT4BhoRy645gGjNVfmlpoQ85DJmod61nFkUZyZ2l8YhpeYYVPXaJFNh41OhC0l07l+3uxO4gh8Jpip3AgLAerLWt8p9YHvCOFxUK/sfeROcNE/YlfxAIQT8d65hdXbW6logvpAOhBpIkRn/iubCZ8SiRlIwyjpFAYN02QTRCiW610hLiDFOmzsBMsQ17qjZhozIJN8LyL+iUUabjnQZaf35Q/XvUZNPK5BinTDIJddOjmjcpawkeYE2lKSNmQctoO0g0g//oUu8magUgufFaXQyxrQ+oyO501GaJjrXAZtKe026dhfMUwvIDptYsOq5rOa6UPkqWDDb5Eio0XgK80fgfTS5Esey2jQK+IjqytR3q4PHR9rdzYOtUn4KhL5lFdmn2JSrhIv3kHOHYAeVKTa7NYrnn+0dTKruEu2LhN85sTUeZ+UmvYBKI6pEwhS6UWaa66Pc50RY08OtlBIqSKOvnMxAndJ+T9IU3TPk+fTz7l8bgAxUVUWJg35gZza2AYF2sSaNvaAPIfDC1nl8PcXA6FUNPyNlAemKBqP9odlobJJ9sPL3sbdt8xDNFpZhn2BkrXGt/mSBKRTgNl3KfYrLINfL8Go4ZhhQDu7qJYPCJ4cDev+s7nuxXFrgnytlopz9N/aT5bEUAimHMrj7S/Ue7DaqpVO9tWJ/stIkSVOmTxD8SsQp5BTbWjXTrWRR4t5iIJTTI7AspwTlDVkfRxEHYvH3b8/PbpP//24Smz2MTaIipM2WCeELfPJYaqi6lSQyU3Js0GkP8gUWQ9GBvlMAG7Y2nUcHY5TPVYlYNIRcNHcDjHYZfM0pMNu1em4RuQvgF4IYpeIxAdaFhEiOQrYK+lKfNalL1fmSK1jm53BUd7KjJlt6PC0/usCVGcguKicX1aT7wkNtEB1K0Zx9XIdm2SWkuwXESf9W/5PPKjlaiVWvjoFM1IIIulNDGRnBRd6bEoHO1ozPI2EjQWDvskaRfzkxoBG2m+A+woaAyQ1L4qmSdhennf+TTiMOSkNFmLFNE1Ymrnmtap02MDxQ0g/wHXrMVYhFClMOwCYS54MlhxOURxOcwusKj/JIHZOI7j/gnD+NpYL80Eq7BegjIY+o1FiKIo8lR71dqMCRuEVLQcgeewL30AHO850IRVIIxSAWbb1VvqPfdEoLzyurjyuk/GgNqoUKcRWcewUJoz9Jmb3eYnuYxKCaSgH2Iq4rpTaL+HwjiJ4GQXaTQVNXJAuejdldS6EAhpcRYtRWk69fJjh/Ew6v3Fj2U4do4KEeImVUVq/QvhSclhWxtA/oURZNOGZIx5mxcwLLWtnIjxEATdefylb9SkYbd7Kt4v6SXmF/FcGDABkORzEY94otkTyKcSMbYLw02w3GbxO7CH2XBTBecRYDytPV7CO115XKvx6f5UfK0Jsxjb6cDx7KEl6gqD8Koc0qjYdQ4ovpvz+ZpOAZMQRgjPBCXWVgpV/gjn1L4PaRWhKFQKoYlMZZzLqRD0cKeihjhm+XGStOPxelTIJpnXAPehesa2NoD8O8BkjUas1CEnq6M/wpGz3L/OFBmQOKQnDOMzhCeATySfQAS4oV7nHrQnxvYKkPvycwZN4xOMzzTW+4wXI8YzrcV7osaTIfCT6FG6cL9rKfc5nK2MDHH9PRjvfOm9M4SKnWy4UM7q5mi2XI1N0/4O+lpkgrAvJkNFOBcOMxQdSQ/JTjljLAGKAcYio1Z/0ilJpEOMmiTcQU6JmJ4n5o8xu6g8fwbF5eK0KYXzkQFtEeQGkP9INci6i6aCG9mAsUnrn1AOBcidwzDuOe6foPwE8Bmw8jOiRViAJsBnEjVafAIQ95nB8gnWRZSw5wBVcE2k9zoonk6F6xzoFpHfnbJkZ2bQddDpWk59X6Tb61JcfHg/62mITlpPOaxeNdWeQZ2orrMMlQcmKhwc90ghmkshy92RKmumMGrkEySnNAEaIeygdJS0AzxHJ5zHYOxwB6RQ/Uk8DoZx0DRNzA4mXYoKtdgHefVr2dYGkH8tWrLrZBeAJBQuh4U1MzqQzEhLe9rwBOkJwhNoBfgUUWMAYWyjngtQ7su2JxBPjIhxD+Kp+FI/wdI+6HEFfR4p3J+msTrpYtwY2VlV4lmjFN5VCL0PHMmVSPNarVKlzGEsNgy589U+oRuiu94MvwofUCKdOxknJAsZNGmibFRSKP84dtGx1g7QEdIEYEdogjBJOsIVohhmpeONEQyfmx0sS8c8UVMnhHceHZ7Ul0UCmyfNBpD/eFFk7WTXRk0Rz7WgHGYL+4RkaWTa7WGpRIn2BHBPtNR5P6fZ2JWO6K7wgvfRNcUeZjuQeyQr221fHPkSfrWj2RcT9Ug4ogduuqNzdNqEIdfvwJO6JK5Ekb14BZfgR2cwbIQyN1ll0Agli3YMPRRGwpU7xHGFidKk0CuZypjPBCiLHt3qiCqPMWBuE6ESbTK3pg6UBTlhnkTfHZWnYXJPJedfqKDXRlPvrU1shoYbQP5DrUWjxkPZJxo1oTnoyTAegUMyaBjsWWnEYPui2B3gZngqPtO7th0FCAMw42K19lhA0Qpg0vaI+44Pz3vwxhjP4x/I1Vrlw6+HNyJHPlBH7SNNI5AtZrl7S9iyrbf3jT5LQBeLwK6QEsE9oMzEo2A7Vt9sY0bmBHkmkVXqklFv9OhsU2WbHJSzno0IIZkAaaDpRaY3TJ9ucNkMiMBS1acGwEmcDb62tQHkXx1BqmvUpFKHPDTKoTAl1mkSM3EH2r6lywX4iC6tZkmnWaLLmGOMNLs1ZSy61i215nOJLtOXQOgWOJ42YLQEPOlK3fIesLr4Oy6o93AdPM/ENFaA1oN2qJo+O8NeFyp9EsyptJe5SYtZRJrHXCQtABNMwLAHsoMUphDlgXtUMkXCS2fdPQDQoj2DuJQPrzPPiYF2FWEnH5h8T/rbqEOmWn/cOjBMiJ+zS/hWhNwA8h8sxe4ph+ooh3Wa91nDSKUn0BrYRW3RajpdfscTWNwEaxMm/GXKOE9cgmfNSifcL5TA7wXEe1LtVXC8kguf1h9P/bFPX9OqVezaS+f1qPEaTbKl1/PraWZZsJB2rNlA0eFkituoMEqbtccK/yk63gS0K6QpaHAieNBOZJfMm64d4YAcromQwz1LyARzKJBjAjDBUAbQ46fRxh25m3TMWT6NMMw0bJW2uWMqFh0bOG4A+Y8Jlc3EK3bQyYB9Lmf03TBEGpyekCLyK9HiC/uZxuIjQ5b7lJlHptLEKVFjzDxiX67vL36XjwDjGUPm/gNt0aC59LgL5cPrjZcr4HitVolrf6uOJ6JjzljURtrrLypFVjjZjjbqQ5TRxdo9T6RgI1xOYBI0gtgh40hpJ8dU5idHACPoY2nYjNGw0RDbWTxtNACFpWMYAe6MnF6AacoH/7Sjq8WJzfyj+alb+betDSD/gaLIGiSx2bzmcsMoJRuG6FqHx/QeQp1ZrHXIaNCgNF/M9rUpQ2tD37sKiESpTQJj0Nh+sSuzNrt4mlqfDHpLK4+/ixlza9ToCqrySgR670fApYDunKYzxnhaYDin2oTHPKOV8aRUHucRFNKYxDQAGEmNiu9lh6yJxhHwSW4jgVHCDtIx5lQ1wRXsHARoAtgXm/QJQBYwkbYbwEnK0xEfbkEuREKCgTAWWKRFOcA2gNwA8h9uFRMvX7gccnSOGNK+RHq7SKWxh7iLg0HRfY665J5QgGMZEI/HcNcAFK2bXZ+TFwGHJ3XBa3XFS2m0n9NjzqJFfaEBczNy5PUI9FdKCD0tEaUeWecdK+HFBPqsGxnzkQZZGbQxQVMZFzKBwgCkndwnShOYJtAnuU9AyjTV2ccJ0qRo0ITIBZSLj01QEUNQPsMQXW6ji/DBzJ+y54Hm7MBQRrgx9jnDNii+AeQ/VgRZlRwr5TA5cEwCmEYwBZhJT3O0aE8kS7OmMGWMzzGAXJkxFg2ZiBqfYfZEoDZnngt4jlebFOgpkV9Io3+VR32j5ngznb4FhsbHQbOfyyzAyPJcKu6SoXbGAnzsZiDLeUIxRM5kwc7xQsFh3pE2KTxpJpBOs6yoPZbh8RjnobsQoz+5FDWn+KrowfVGBjGRFkBpdHLIrwccPwb/zKlojZ7MqVrYr29rA8h/pBX5mpMYSh1yhCUbUpl3tKdCHXwGbE+zfakxPjcWTEodMNY6oz0h8Zm0+b7RvHmOOtVpGZRXE1VV0PA75hUvAKBuWbHeDZzCXfOPi0j4D4gmyeUQfN9EKr6vKCK66lPwWoP00GhsdcrUE4VSAn1PegYti8pw7MOIQxPEDCGLmMpw+B4qTRpoV8QsolZp2JE8hlsiM82OSBjT8Lwz/8xZ05QU6XUCYcUJc2NibwD5D1uDrCuJ6bc87Gcwq6wYhsJOFaGoTZiIEJ9BvsR1vlZzLsaIT+lWl851FPQXbBleAged9DUvpcXSn/8p3RMxPqrecylKvHeUqXc3NBYaYh+SYaZJ1qaNGaDcGY7NlgiiDTGwr0ziKCuRI0LlB9KR4C5Sa2RJRxA7gsX3JgbNy8B51CeNGYk7GDOGNO0nTfspTMSKTBAiDFULcv+2HZobQP4joqUIe9W4DwFbe4Y6Yy3wmSygSQT4mT0jxTaWn61RY71ARTBuYqRnNq3mIynyqUDF2u8rXtX3l2EvRJe90RTvONvwESfFC6/hEkieqpV396vU0LaN8/OEgpu6Jk83azlbnoM0KnMEfQKwD+Xx4q0tZbhCNDcEdZ3QMcCwptUMMI1tU6TXlklGqk1mI48ZyO/5cOizBj74UW1rA8i/WxSplmYPg7E0WIT9TBG0ffhP2x7GPRP3SGkP2B5WWDRmu5kxgx1phWbIXYx9cFd1rXhvSrkGDg/nYV9kwdxMq08Ebe8N0/mYoMWq4O7C0kHLKLcqkPcMG6F0h1WMvkpXuzZ15s+WHNIAZ4jhSjlSawWLxqIG2eYeiX00aJABHEuDLsNKoyaAMaLICp5mu2Q22dtxIgsNkdVJZwPIDSD/QWHSgDSkFNEfuINxT7MdaDskq6M6e7JQDYNPvWNKMzAad4TtQOwa3xqoNMT0JWB8NI3mWp2yalpWa9o7sbM1jHkZ9b4kqvGF2gdPJsd7kKzvuc5F0os1RklcC1cb5mGlES5fpbFTHW87NQ6zEcl3yB4ptWOS5xj1gaLOGJeJqKM+2CG8tUcE72AE609O7THSjsbjmIYj5Idea4PaAHIDyH/ICBI2wHahqMOSInMPS/saHbLOMtZo0orARAx+72gFOIsoBYAAV+OeKEIUD4Kh1sDxFqjpNNqcQ0498jwXwYz3RYf31BxvDoavxKsNEM/rlqTmURmvwGjFilWAF3YNZtpigNMchRYBIIMwyriDa4JppDBA5SdUZlgxgRyg8MsGkOKnxhJRhpd28HkSFD8lDQOYMBWieP06pPVG2rY2gPwLAZID0xApdNrDsGcKYIyOtdWZxT0shWdJ4pw+G4eWRofwRJ193MGwK+A43AuKvxRN9pqPq/Pj/PMaOuSvF9F4DnoXn/I0Cu4iTJKhCVlR1LumjSMUfur8pDSfRBbVAhvoGgAfBA7wAnQqP6kBYgrwU4rvWAlCApliOl2p/NUymEQrKrwGJpMmyiep6vVK2PrYG0D+dWDYFeQ1p4+WjCMtjUgWF9oA4xjgZ9XgaYQVsCMHoPwkRgL19qHwqseiCj4ATOCJOu8jlcNTJsw15syqWvgVHvYlZfJTIy3cEQF+iRXz+G1nJdhe7d0Qw9+Nb118bNgJ1KYaPWJm13hRK2/lhyInTiQYE91NNKNkCoBLpS5DiEbQQFLu1kqJhEVxWzMwtt9BDoNp+jT/OPjSqGxLsjeA/ItCxWkAfIwJm927h0iumTGlAWkYkAL0aBxBG2EcCyAmsl5HEUrFDiw83SpQgHJbjHiMxa41PRoU6FKkeEuxZxVBrmznZdsE3hzVeSCVvicNP7mdVx4X5ly87o1TGzRFeYRC4WHrZHCcMQ95irphY2nyGFLkbOBgIK2oYaQicGyAjMYKoFYiyfgJDfU+BVwHGBOGXfJ0mEArehobOG4A+ffAQi41Wi0BBziOuwQfDGkqFLUJhHGHZDukQhlkAb6oHwXgFQHccmmWoQCLKG67rT52BLhjPP7XyLVfzrhOGjN3p7+88Tt+mT5+Czx5x99r7oY1NWi+NCuCwU1jt+hEOtbl1RbMzBBPA0vKzAJ6YJrBjgXwPLaLA6VB7kOAoyLLqD+BYU7R02jD7pjH4VgkNFone1sbQP6xZS9eEK3uliGMPlnECmQkiB1SKkK3KOM5AXyo3OngU4/dyM6+AiKJuRaJrvZYQZNXmGPSdSy8Gj1ekDKTfg18O8vXuQTY6UX20mP1g+8z8YfNxPA1K9sSPXZVxw4IOxvbM+/sApSmog1ZIshqs7MAyJgcJ5hgSJJGOo6CD6XGOBY7hgG0AEFogDCQHKTSqFFr0ARARkaRICUKw8jBIHn0kTaA3ADyF6PC0+t34UBT6FeR+AM0kLQ0YEi7ovK9Y9QNd4sLuSOxn9PnqsbD9jgQI8wWAEnw60o9a3XDi8PfXALm4ml0OQLVSV5+Zs71B5y57gXpC1Yt7L+8CyB5cUeRgn0IzN40laZoRPBYeuoiAjQbP5qIaNEHuI2UDjAkRmNmiGgSg4SBYhJLFGnZICa6EsTQxJ3rltaiUiE5xAFmyDmMa7VpQm4A+WCK/Idkc4rOJeUNA0amMcAxOtBRY8S+ixR3MIvtZmNLrc0GgANrysSqB9jqlQPjerr5JrsDXGu3XRwKPwFFnYeDelS+rOLkNQXwRdj+i8C49hx1XOfK61sC64qxWKs9ls0dSBKaQdDURYroxn2slzwiYEmUQSpjOrWu6AmA0d0AJXoy0Q1uBriF900YLcDNBI/naPVLkEZzIWE6HsGNib0B5B8YFX6lIkcBYwYSaGZWO9Q90M21ImAgNLRu9HzbSNYuNUMgFYxmjWEHcQcrvtbXIqCLDZcLmo6n97klcnsRhGrNYaWux2vK4Q8yYK7dfmV+kvfc/+SxrWnTK483OmEAYz0zUjOaVnzkqUZmD7gSaR6gFl3qBJcBiapGN9HxNkZDx1TVMQxW5KJsblGrXI+fTAkKVd+tgb0BZPcG/s7voA5Q2OQYLaV5DKcAnjCC6tPkWdKs2ioUx0IBT5T2MDyXbVXt5xnEc6k73QRD3QOO9wLrCtjpUpf3KjCuRYg36H+PjOzcy0rUHRRGnYIkTmwjsBCl6BBxlkqrVUyd2EzMNxlESgrZHclAFRsuWknkQ1ySMe6D2sQJDmupenO5LVL0xGFIPljxscWfGyVsALmta2l2MgJmI20oplpVrYcBbGG+9QyEYo9gz6xKPuQLwBfAXsr9Q9ACKD419sx4vuER0NaltHuOYG7XKq+A5EMp96Wi4C997idAJ6yn7F9J17lSp23beSKHdgKcpuUMJbCsSc7fA+GWSJnkBi+D34YEZyJkmoEwle//jDnTmjRAbeiUcR8bOOwM8jAP29YGkH8JPgoY05CQdk+0IaTLtJAvewaKbmOA5p5W1Xj4VMy1omFjnJXBg01T2DYcFuhSDzZeBrbFMf4IFXAVYR8tcXwBCPkFIHs0erw3vV7ch3NTB7boSuuEU77obosnNcyz8wVb53nuQg8dGI5lznEGR2ko87ED5P32erFGPwQGmiVNPgnaypAbQP5lywDbFwHbJ0j7rimzbyl1a9hUr+syMA6OIV6BodALB7BrzLDOx50cuZcGtE/51l8uHOhO1HxQoeLB2uHN7V9t6twKaO00NT4X0uBC/af8Ts5Ne52re/cKPyUljrEdMIGNUhiRYwVQ1rlJWLGGteiEy0p3qBhzK81VH4cEunubpNrWBpB/fs2x1sRn/2VDSkEFlAojJlgysZPTQCaalaYNE2gh+wwayaCRkWUouLgvRWXKVg9jPhjp3dJxvJom8wFQvXHbvdasX603XhCiWE3L7wFldrYUXAHW03lNzEDZmuF9CHmqOVlmuCkyOtp1XKcMjKr8XHzdbShTi9NhdCPLrJkXnrhhom/1xw0g/xQoLPtVB4ZsvvJRfspAolk545ezeJjKtR29zqhJhBnLfYNeRrGMZ3B+DIJjrQKY/Bpj5o8f7tAV7NXt9NpOo7A/MJ0mb9+NvBtYr95+OrzOlQ+9NHfOt+NUBINoTyMJjIFa95i3JCGSgYrtxCyYAe5xCoV1NWUS8jKWK8BlFGgubVXIDSB/JSyctbhXgFAUvOxh6lhoMXRBErQQFKgRISsoVtCLCFFIhWdbo8WhCBeMUTdSAi0Vb5lyPz02p3Ft0Plsu9aBULeB8XrN8YKT4iPp8D3p9DVg5BfHh8g7ouprn/MMknM0WbnoPI9mibC89Fbu5Dw42g2kspyxFyk1SroNwj24CiqD6xIJYcj4k60zNoD8326KjCUYegHDyhI79XCqwNiuG81gg1TmG9l3EzH0Iz8QhmL6XpV5BoEDIzVPqCl4KbwTLFqAN470K6Hi8qYbPtdn2++tN57pg11Opx+NGB+sL/KR57p3jrSf1TxLtbl8rtNJgf57WB/SVzG/nOV2GkUHlPt8ShYgiY3DqFhF7LFPe+IOwxA6P0cD8nFLszeAvJYir0eFqiUbroBff8x3B5PIJmYwZJjYgGyUOHKuPRZJMo6k1WHwrkPJgf2wONBJoDVhitvptc4P8NU5yNUBcF4AO8xNilMwuUgb5IoSz+m2B6M6PQBsuNF3+cqUEU8+5C+m6GcBec+o0QnALd/n7DfLk+InSRpNDkIl3fYyLG5R1yYH2n4H7HdhR7utDSAjQ12PCtu5+VJUuJDbZwFPzqDYgSMgmhfmy6z8XJkzvTx+6jrTPasmGjhWbouIMYEYCKujGnb3kXcPg+ZWqtiGn3GiIM4rEavujE7u6SzrHHAeALaH8O+ujjgvn4luTBEsyjenJ63ZZpYldSak+GmVHWOxzRHy5aDRRLkZVIbHi2aajISMoUOJMmAOg5HcDxS5dbE3gIx1HJcp8mlxmheiQnRAqH57N6ZBAKmoSJvLQvCspdKJxjTLWC3GdEpUiQSL+iNtTqeL1NUQ4MiQ14/n5FVQPEv3tLR17g/GPqpbOYjPUsirh5TuRCWtp6fXRn7uif5Wosi7qYRfHiBf4VaudbYXpmOYudv9/qTF37NyojR6EG+KmTUZ0kAsjyNoRnoR5ymm1yajF+YNW/sw6pIpmaaJG9dwA8h5t+VJinwSlaxFhOJJSFBEpM0FK/oDptn8aKKQHBYAaKns5DHH2BTBm0J4iRyt/R56joWvzSJYYZzT686p8CwK5LVj90KD4ZKd66Vo8lFfmVtAdJVeyMfCwXsbMw9NJz0CIPfRLBdNlr5hc16LtK4OWZy2C32QNBiIXFzDWFNoI1yRSjsMFg1Bqj4WRiKBljrtoW1tANkD5bWocN7RKcA8GomnQMgTycIWLAikONCsT5lDXKLWGFvKXRR4qPn2XsgCqhYLJaLkWNRZ/rjT/urICW/PP+pe2s0VsLiHT303mF3zkuHjdcIvf8KXBukxa1+e1mD7z9JOuYow0AymBIGwAoSOUPThDHwwhTQakYSSkgtGIUGWGIrk/aiZxQGwoeQGkADyMNxMkXsgbNRZ4YxxIK6DTXIlkDtBA6WhjeXM4DgCGJt0mTQuQJClo92zZsCui91Jml0DKd4ZMX7l2OdKREqe1wm/0rj4EhXxzsfoDpDmpajwkVoq7wRPXa5Hxv5pkKWoM2IeFu91Ho0JXsbGWHxoiKo8Ps/gAjXKjG2EGcyU86Z5tgFkLLdo+FEFDNEBoS5HhdeODXV1S/OJgAXIteaMauQ3G2+BdXsFvXkUqHa40XFv5/pjHBiXAO6s06uLL5h9HXIBdDitgy2FFewKcNyTxv5BPOqz90RexMA/Bowvdfj5hcc/9Ak08kDQCWmwwqxRFwkGOLL9nEE0tVTd0bTtY04SxLSN+WwAWdbT8Twq7Hdd8fZxeP1go4E2AJYgjFKbf0yd5mPqQHFu0MxjPgvQnB/TUnTe9QJ1JeO7dbgu5pD14AdxAzOkP/6AvJZeX3xdj6TVp/Oc94Kj7svAL/9ZFuZURH8qHOsZFFmHvsvJrvpWnEvhVtXezuZVBhzp3AByA8go7+jBqPCBIEcAYSmBqZgkoShCl2gxmi61ez2Uxk0vPNHVK2v90cYSPVbHwvRYoKIl6i/k9blus3Dtg5BWZiVX/rBuRGePguRaNLvaqeb1RtXNCPfRbvUDe8c1kY+T5vb8aTbB21rADAa2Y/4ioxvOLpVe/7wXX3yVIaLlTTN3A8gvR4VXoKAOkTvisiMY9aLqIseRxgp01dq1gKLNzZdeJTy8sUvE2SLHoUuV+Hj6ttJ51pXHPDIzeZaW4yaQPYota4rjIq+PJf5qTfOPqH8uPi9bfkDsPzeenzSk5dxEhIg1mmQbEq9CAIboXMeJKWYd1aXntTZZapJSMYkQaLOq77b+2QHyUTCsd6+kLqEMl+O81O6CJXBUrTHS0gx0HNFqiJyFTsnOxlPWakPzdjuPDPRARrfWkOHSJfAMYO7kG6/1Gppg7B0D6GvVQi6UkC5yp+8Gx2sR62ogrMeemFfS7TUOum7UPU6mCBimg31qXT4dUqYY41EXPc71x46euGDicI5LCZqBoHKeNnTbAPL+qFAnoLh22NTj2CTICIrE1DyNizhplSsDQJiExFm6qqn7FJv5viBfo0VbKPl8hRN3j0DFPbKNq7YC10B2BZTWbBZOwfFugDulOGKdHdlTIi+Bl+6oT34Jmb9Yt7l8X56dmYoMRciZuYAOMpuquc+WOL04iMXsubtv6LYB5BIHBCBzmSpfih+s7VMsx7Ha9O5hHLH7PMIMJlZA88Q4PacuEizyZEyFDdFGNQTYkqfdUqOTbXdENLoNkjc72NeA9e763BdrjJcaLpcYPmtR4d0iu3du/MPTdD12xz7gLkXI9rpcVRCX89kr2DSEF7k5XiiJOpMl2++f8wZvG0DiwPuiwqYt1YFhm4sIBYD2oB/jC/afR+Pk0b1m6DRKlbFQ5xlhbGl3qz+WGqSlpbshRzCUxFl52v1efrXWt5L7drOLPB3z+VLEswaouCNqvAaMV8DxV0aD+IvRIHm5pnpt21dwUme/Fi72EiVrs3px0psp3IRbFH1IwJqlrOYsoLowpqZfsa0NIJG7E2kfFTatUVRAzFHJlhpAzjvtfDCYVIWaDY4EFukyVNWdWaWH4A7V55rdIDg4kph9sVGvY8fZ7XBYrQmsAcDpAX1Bv1H3pOE9uko3gOYXOtO883638OxeaiAfiHLXOvlfiW4vPXYxd7oMgVnGcjo6Q1ghigyd8bIne7FwDXL36Q67/GvdmE8VDMKWYm8ACQCJpylyiQyltl/VfUtLg86L2LH/PNBypQpyrBauNNsBCN8Zsxn8gF340mBPYA8rBlzEvt2/XcceAay8O51ezEKuN1x0K6I5HeW5ysZZYc18RYX7RmPmLNW8P2e+oXN2B1heGsDnF+rBa6UA6kQhafESy47JdTk6dc2Y5rsQE0FyoRfJbT/bexDhkvKWYW8ACWDHY4sKy+n0fjA8jagAOA1Pb5+jkPYweyqgtouLdqAVUNSumHPtYWHa1UWHBTzbTGQqqfUsiXb+p3EzT66jPLpR/bo1C4k7WTtfSalv1R1X73sniN2FXbz/5hO5u19aC7C7cPJZloytT3xQxyCFogXZCeqqbicj2jx5N2xpE2snG1sXewPISIn95NDnHQWibla3tmbUthHwofKrq64j4/cdemZMa7hYKIWH7Fk1dK/d6jR3wUHQbrdpz7rJt7UJL+LqqljFhbGgPxg077ZD+EPAsRmAX3+AVj7TSxMBX0fL5d9YNsy4SAeqsk+Z/xG7HZlGmLMIWbCNCVVVn8rL6XdgiUyJrfa0rX9ugLwnKqyKugsgXMPMODCsqPDOIraVI1tNucjEBnizswhqx7tuJQkjgyXGfrznygtYi8wYrnUV1E4aCGemh6fNnUuKPmu/X/0cb0WCvI1n/IWvc7XWqMdS6z9zXfp8z8evoj8YquBVAr9IniHEcOmEifQQk2qRI0m6OH/tZKMq1hkgS3bUBpAbQK4dOeJ5VHjxroxR7sL+EoHkIkWr6Uox5uIcAVZV6AKYpBGsoz7N9rUOlbPnZkc0ao+hRnnRlRxxqi94r+nUQxHiHSn4nZj5kMTZ3f7W/PPB8F7q5EWlcb/6RkPbWTXUbj41JZCs8va92s/SETMAc75NRUKNSjAzsw0gN4AEil8WT/jJK5hZTszhT3MlvpEPQNsxh9nUvamGJ4KpU+cJebPmca2hVwwXMYRgbk3NT10L7ykJ4Ob4SK1irT7naqNGjxUF76xD8lfS1EugxDsB/HbH506Au6d+eSGj5ok82pmKSnUshAXf2sIopPqlCwZ4YV3V7QrFHyBhJiWksu/V/bPN6BJIiXMLfFv/zBGk22pUWCNC8Xqoo05SyzwTk1LImFnQC10JVpwIyQHSKGKg2PxoNDsczp1vFWEKYWw+NPPA+OMBcg9w0nWsWHMrvGrt+ovRxq1o6+8WzDyozMNTEMPFsaKeP64awbMpRMzbVofyT9TGVeTJWKiq3tLrsAaGJdDjpAwZScqQiklXCnJse5FF+kzsMpxC5trWPz1AeloqiF88dDh7setCWsmMZMIoFFuEohAuYmR0pkvDxsIywZpi+FjmHMcmacbF3GQ19Upf1hpcUwk/w6EiknVmWK91Tve90dZpFHTP4PZXx2UeCvluhXRrz3+RmnM9Ib7y++WXd6kmiSpO0UWDpc7YG7abAgtZOoq0SN2tRJ3ejQN1zSe5/lCB+g0g/0MHkHYeFTb/64f8i5ico2wItR40t8KRVbexeV1rDMmz4o+96GxjBsTwu65GX8MsWVP3ZrsJemcH1+nBfNKNXoBk+1M8twZYmkrcD9r3sGp+ZWD8y3NB9848Pj46JF0GHOmKZ40uRKuVPCNCQYid3dfqV7XouGmefGDYxrJeiRfnZUaoDEIKWZuazwaQAGRcgOJXFiWkyQdkjS2VXgjhdhcV/nWzcsWsCr6sVyY2znb5yXs7rTeYHbr1qD461B0NnBuva9EMwtd1H/jAjOKXc3R+3ZPrSpAprZ1QrnwYZ/Jz5xlAU7qdwbDTV5EroNJBeCGUFnkBOtpj58fEdUqkMnxDyA0gC0A+CIarx9Qhl0J4a7DM4MYGfkvAi/GfVFKg0rjp71drRqj374I3XbVhvr3tRm2xDZX/icfJWnPmq6K6X8mwLz7HtRT8yoe+ep7glRrnLbDvgHQ5dtPoL6IVcJMHJs5A18bIPdKOyLBNwYf1yBZK7LiY9fKA0G1tAPkYEK6AjaQoZwtUdqNZmVMMYCRP/ENYZcpi7ILhIpfa0DiUoBjtERkD5EAq3iI3lLmvHP2L8Z4HdB1PZ/CEO8ED66rdX60xfukxl17PtaBXD551eAEd/6D5yiage8auEYxOD8LgLGWG6heLMuRaxAHiu6dFbAkxvA1rfbkSyIwCo7W9rQ0gr4Ph6X4uzYopXUOYkBmQZEWZp3aohehYg0Mx6Jq71IV6qHAzLE0dVvrhrt2XqmwcnqdmvP6ia71SVw74K6r/NzFHVw78O2uHD2XFd4/x3F95uIbv94ejK9+Fvo6JF6PJWXNzKT61vNYjnpbbOz4tIYii0ZVLHRJFCy2I2FsMuQHkBXAsALgAwwXIsDPOJDD5oBCcGKHCsxYHUDGmEw2bHRoQYoxokWnuWvdpOVhqk0Nzp2slpu6o46zAcl/080gKvlK7/MU0+tJLeIhSeEkJ/I8Aopugtian/EAn/JGywZlljU7UfSpItp99XdEhOUOYJzTGQcHhkBykg/BIyymaMkSX3CHP0M2hjm3900SQfh4VLk++TWm5sGYsrrNofrvMjrl4zqgyYJoPMecmTKUZ2syWQSKZYDSYRb3RYqCcjVVTa5RXOrvU3Zh4KVLUtcaO/mDQ6UDhvDFzi5r4R7sfXgLGW2NMt8YGTk5e7GuJuuN0sVbWaFe8NVoIDyJpAT15Ab8KkswQPBo0AY4MSy8XrQBmbexQ8vi52XZtABm73NSFhyWLlYWoaBsaZ9fpLjtq7f2Zy5jdJBqNQ6EEhgCFWYBfAGKwaKzUG60waqqALjqmDdmeo/jXnKo3rId7l2qEPHEt/DNt4R8Yy7kYOf4ZPtlr970YMfL8hgVWfkWk4/og+fl31mcK3UmbnKNHwaFIjVnEywCbz/i19lhri8FOjG3mdQBIceYPnxBCFElY2tBtA0hAA5dRYZWw73ZslsEIkxfR3Dk1H4/ZPCPNEV9REDdLsOJIWMd2mnpPsX61JmjRHAvZ0xKtWTA8UFC748B9NG3mFzLIlVnGi6rgizHDP7E9cFfPhdcdHk8/mBrxrvgG19nHanFwxqY5+6iW85Y6He5fUnYCAJtu5On303X01LFkmoFXgceS6TSHQ0shZDEMG7ptAAnk3XBWj6Q7rIBgD4YrxwddiLTainyZMQFWALPUGclEa4yH1HnP9I6GBhYvGslmjZ8yyc47wFEXNuoLNcVrA8w3QeNPSodvFjEfuvH6+76HT306m7j4CHgGlGvguZpWN5nGc0AlyXK9eln3dq48uZw6Gp46YgZQxnhQsfqSYJTn6c/MMzaA/I+yzL2BYAXEi4d+BUvNdi4MSleCGZGSlf26SpOxjfbADLQibmZF4ac4fs3PVpV/ak5vV6zfrwDjg/7WX6kl6ko6eepw2PHVV7FngREX5NOuzUBeba58QXziUvR8IRXnH6L9+Gi9YAmG0upkeedSLM0/1f+eQTgc0bmWe9bkRz9s4LgBJDBMvgqEqNFjtzuKgFI0ZzwRzMJwFGXNuJ3hXMim5QgjaVX+DAajFVwttcnZxpWzrWvXwb5w1FxNlS+RrU9mGr0eSbrjWDxt2PDOKOtGtHaNYXPL+6XXS7yKhV+YublBtebf2dRqEXESKjaGcSEcKqZJUgE9eeEhZoV2Wq6/g20UPDMaOJqfR06XzLZJyA0g16LCCoala+1V79FWSnBGkyE1KalZt7E2WWIQPDKZ2qFOMzCWbjaaDuRyW7BoLqerp34li1rUyTykLoAkihL12X1XuqlnSHEqvou7vF5KRe48FD0zqlrDuC+6BT4KiLgs/vvXCjm0dnjpSiNDyCRdXoASZZyn3E5Et1qUR+OGFUgFg+hwGRyCi5JMGLYmzQaQsbsJSCFt5la71idgWDvWJSmJpo2DjgTHrBzulWddtqnxsZv4RPzUiFD8GcLQCyOBHVS8a6CxGHqlS+DYWXqeBHo9YPIc4NZEc9GJVKxg4GVOMK9ni8Kyr3B3VFnPUmvOgCcozF8MY3mlhoq/Nmq88AF5ix5Jh6uY0eCEl12iwlJX1GJESJWTXW5D7YoLDplxS683gIw1PdnZuRmO0qRpu9GZcTZJ45SHxpqpA+DCDqoApzDoUpEuqw6Gdai8SpyRO5jV7btuqJxtwucKW0+6lnrzel2yA7MFSN6Vyt9Rs1yJKolbKuG8An4XwPFXxn0Wf/NaevsPkvOwgOL8ZblqxNgAsESKrdZYLl6hsNYiG4hW+HRgA8gNIMuyTt+kgeGlslV/3TXAa8SHoA5WjUez6kg4CtzNWpDYlVnHIYCzsmwwRByLENlVEca90qOYfy8Ubd0ztHwFxNaz4a+B4yob8E7zrlVWyVdMsW4p5VyLcpdpfnzW1040f2cAVQXBGk0uBI57hk2fKFVQVJ8WqEalNS1nliH9uSIlG0D+BwLIw4V9fKV7qTIjScDsU4OEwrFuQrdBIZRi7AelPknFthiwTC0F78cupNLcOTHl6pBxrWcxzwI/AGjSdcuFtZrlnRxo4lFJssvAdFY6uPakq32Yex0KT3FVN17jX5thY71bXSPFHiAdkAvKi/ucAmywbkJ6xSUdPzd03ADyQgbaWS+0znWvE0GAWUxZqUmYVfMttmZNdZAraj5tdIctWLE2lF7+ryOPDYV5T6S0ihu6JFfzgHzZmar4bYxo9gFNE4G3Azud1DfuPTRPRojuxq4HS5ZcZcTcW9/kymvm+kjT/ZWLXtOxASJJV4seC2smrCyjBVc711oAqkhIEEhTONeEqt7GpNkAcg4+yNnW+oa5VN3FZXUEh8V/2KqBfMhH22JbBURidjhsQEhyHuSdx35mhmFpTlzPovs0esXLpAeUX6UbCqtU5dP65UWgXO1IzyW2i5YHa6B4ExzvFLa45Fe2qgauO2qla5kIV/je95zxzj6HCoTxzITgJbKMlGJu2BTAZFE4mzUi6/6nOssbFgyWaC/fsXGxN4AEAORhvTOpAmxVtb6Zc5FIx0N/pHGOJGcv64UWZBGdYGXNWFUUX3Cwa0pe+dxnB+Tj/RLhTyNDXO35PKD/eM94zb12rldT+A7R7xkf5Z0fwrXONtd8ePQ1YDx/iVzJCrrh8YrGoRYpNJvXer/Um71LKrNsAty3GuQGkCtgeGLepc6wqqMsIOUc9UMVIy0plfQ6LFzFkVzImI0hfMulCVf1p0Hrco/F9vVB58Lbhlz3HXwnXexbPlX31h5PRR74SO6LFVWha6LAN/723X+aVyLHa4B/h7/u2gd699mvKegu+dWz2+HyzlqJn7VA1tK1DkVy5UnyjI1luAFkiSCHhZxir+NiVcG+bScsHxOFQUxhzmWMBg05NqtXY2ynjZ1d6wD2ornVpIvVqKuyZ9KXHP1upmZ/wD5/BShVHOlPr68Cxa2Gyj0WOLwRYd4Lwv0A/NX0erVDhou2C3fVQ0+sFO4CyVY+7LQgq9CtuvGdnlqIbvynXTKADMil+AnPDmaBxy3F3gByXuatldzA8HTyo2mgOA2OAMcqU2YYGghajR41G3KxRpJVvWc25wqFn6oPaamfRr7lVKC7rBF+ATR1AZUu1etuiWjw2vNfaQRdA527mjT3AKge17ZY6+4/7AqxpkPKi1+I1M0uFoADCl2QhU4YIz25aD2WrjVDIDfmHHOhFQqkk3A4Y5Yynn9bG0DGGl0LMKwsOy/FbHG+mDuHrEEqijxmiUXDMWiEmPUeOdcbuRDJpVWNSLYOeDP3Cmner568V0HyJDzWSqSyBpT3AOwvWRXgPGy/9MRnKTrP8/9HP7Rbc673ft6/XN956ENXAFvpYFfuC+BBNSwjO0AuXe4MZ24CFV7AUl0nXLEKrDozvXIUtrUBJICiNlophuyzHi2yGicBVxOZYDRkAtwC9NhGdyoQVlfCyr+e5x+LU6FCO7JSEzmrq50yZVaZMxfrdHfWLO+OLrl+261ZSF5Lp7+wbS3l5bUX9PUD/SKD5lpK/+hJozfbuvn9UXFqK5FhAFzhxhRlcK/pNWfjrn4+cp4pnS0aamqefaXTvq1/aoCcxhUwRG3YpKYs7pbw/O9vJkcqQ91prh0yNdtWIYGyMjgeArhAgntEmVbuAyWhCO2q528vpHqv49rdncYb4HnLoEuXcYf4RRvWR2urWukc64Fojn/Sa730XGs1kdNm0lod9MJ3q8aG6QAOHVGQlYKoZYtG1air/ITUWjas/pwSubVnNoA83elood5DK9dt7mq3QmVEj8xuIge4AhSNEQUCBlNv1Tor/Aizko8asNaa5BD1TMRjtHKQ3Eu/u1cX8lqAtsrHvvYUus2e+fIXc6mm6RdA8o/A5Dv9cPilJ7+vPnHxxNc1XNTnNn2jpt5NfnZ78bDpeKnqTbw8IeeKrAReN3zbAPK4f17OPCJGeSw7UnaknJGmHDHl5ElQbbQEGNbmTHSyB6KCXlwEVMAs9ymKPlG/HNs8pJgekoshz4Vp7wHD01T8zwgX/ki8PIu0LoS1d81T/kGvlV8BxItpwFKeTteUiWs6XJ5IRf9xaQMroNYdUW+fa44sgOheFYEESSSzAGXiLo3mbf0TRZBpygGIU0bKcd2yN53IMh9JuEZZkSkjB0ZKPDQPmRi+XUaJqBJo9fZmuVAFKazjZl8cX1mrP9JOJc/0ZcDTFx94V/T4q0fbaf2SvAGOXwPGu2qOvFAGeMhojJdnO9ttJyZfVTGcFOSzOk/cEh1rMFwN4wWFhSuQQTojN3e4qud1GfOBE8hyd/Pso4JUswHkBpAAgO//9XfQQ0GqORcWwdxc0m2RGPKUMJWxHfWeMq12WFJpW6TXxblw3lYEdTtzruZbczP6wGXxmzYhYl1StSaa+1X5skejPq78fknz4dG5x7UH6aSW92DOzWszVbzzS3gkqlwTO16tvS46hl2HujZelAlkkRnS1EZ9oAyyiudOAiZIE8AM+YT4/SjpCPcJ0zTR5WmDxg0gT5enqEF6cTaUnbFqOExT1BFDFDeRNszq4JzBLrrSQwd6qabfkUJzjjgDHOuw+Fm4yFu83e7IimboykjPpZy1YUh5vPqaol2sNfaRJq8XJ5cv/StjRLhQsjtr62NF8fw+pfObUeMtcPy1guf8Xio/+vR9zL8L0gQhLsAE6AjgWMEO0BHSJ6BPCAdIB7gfJB0W24RPAAep3N/9U56Pmw7kBpBn6/N5V8Z6Ouvp6iBXJiaSaMhIcnXWrR0DRphTbHbWC5I1a9e5822ts02VIfGiAHTxOOSN/PESV/tC6NYrj2vpvXzRAqcDR+JP8q2+67n460/+iGXtrzZ/bllE9Ldbdz+enJ0CAD/ni39C+IR0EPAZQKcDgOMMhDoIOEA6QjjGNi9A6cfYrsmPH0cKXns3y5Lmtv7pI0ieNv1avhoTteMEQ5ZBSOGuXmYbGyMmhCoC+MxiqpJW9Mti7CfMvGqqXeXMbP6dC/y6HwC0PPZ0MvG+Kvx4uwN+Sh3s7yNqFThXwXM1urtEmH5Ad5G8DwH5YFr95b955+23yhur340yoINchwKUBziOkI4Cjg0AI4KcCosmrkeEeQQ0xQUZqCm3H5F9gmtyuf6hdC83gPxHya+nJdB0sSSL6i2nCXKVKI8sAtPs6ooGyESLMdvCnAn716Z3ZiFs1plzwdgcEBe7Ja8Firfz1DVRh0td7K6Lekmu7OxPLWjTN1Ju3vGaz6hM/ZnrEhCtjUDdoP3xVs1xBVx5AzBugaIe9ONZ/biUpVJDjPQ6n4BhLtzqqQDjcVl3RI0gSyqOCcIBjklTPiq7B3izjKJzyRHf1j93BBm7fyphXS/qbaBPpI6mascKVS51ifysPICh6GOFXNhRChu1cGbYVMphUBOvna7/iP1UuANwq9/TnxlFXJqvXKM96vbnwQs58BprZzERsMK86V8L+cd+Cfc2xtbv5129sUSBOqIBZr1eAbBFluU6Jni77xTCFIhmDe0IV+Y06E8tjWwA+R/5DewaLC4Py6IFQBBmiUkGs6glwlIBvQRjpNxxfYDZwFJr7JoxVawilH5Y1H/QzL7srvTwLBOdN8z9in7kh3MkpjVgPBe3OB8Uv8D+uLc+95UaHq+lsHdIgvfOiLiXOscLAPzFyLHVFXnh9fFyTXK5vUSGNRrUsVi7TiLL9ZY+RxcbFp1qVb9sOMQM2kQoKyLO2gnPs5Yf54SHG0JuAAmUjq1m/v6CgABQMMgGmIZIk+sMYxhxhVgFxhn0GLeBxaWQI2A7Ll0NRwgjDDuBA8+Q5AaqrPKku0ZNa750Q8jU8qkXIz9d46YdLbqetp4Fg3/Pxs2tz+ce1L6Rkv8KdfHa/fq51btAUiWCRIztCA4pg3AKLiKAkJyNtyr4sSn/eB0sb4o9ksuzABN3dr1EvK1/4hRbhw4QV+gYk3bhXsgKbvsW+Tl2gu9oFo6FYe+6EzAGS6YAIYsd7GzutWuD5JLNDgR6DGS0fgTyNMjsGzYtEjw14ekroBfGxq+U+/5UyuEquGkh6r4uxssruHnFW/tekYq7rWk4s/vOhgp4rbutEiF2M5DwOuuodjZvdciq8uMtNZcyXBOEEjnWGiYmuB/L/TZg3ADynmii832lwImGSaEEHkA3NPdCFf40rQJgGfvRQHIsjJo2ChSUQwxFQbyojyOtkwt5O5o5HwX5wwqUuizLvdJE4e0I8tLg+MMv9RI3vYt8r7m96s/1uOYVcA2QrDXOcu/bMk25gV/Vd4wGTC51xwx5BceoOTqOqg0cV03LJ6l0wFVS8ZyPcB1Xm39bdr0B5LwzOLBmMwAQ8koJ7PjVTSh3gCGxCU8ggRqIVBV+hqb4Y8WPJlg0s1iunU5kn5hA8cGj80QBTCHPdn6nvra2oMmpzULqFBG1gjx6QBrrHpB8uD/EyyDOL6TYpzXCO6LHBeDeaMbEzY+MXilDiFGeiPxqB/ooV5lrxBHAAW1YHLEtRoLiAh2IyprBAfADPB9KpLkB4gaQ144xLVTsZ784gblZI6SZBYNZARyc5x2jITOL387zjbNj4Rny8TKN95Fh5j6i7A5A1oSbV+TOzM6HxtdA5M+wbBBuj0BeVde5p9N9y5EQWHSuLzFneB4RXkHBGyB5T8hfZhmhI6WD6vA3yhwkcADL8HcbDkdcJw4ga9c7AJM8wOwT1AHOg1zThowbQN4+Zo9+pmxTsILR3yMQBl02k51bRmkhhCJBFBT+muxTvarAZ12bmTBoFsa9O4q5lXp2L77ZxBKPmRt2jBpdYuA8gOSr7JtLwPhQLru2gV3aryvnlNPz1Bci9lvfw33FyUv1R5V5x0MBwwnEAWAZCMeR0FHAAeBnA8w6FK4aXepQR4BU0233I7IfQ/FnWxtA3lrela8SIYtJR5tITAC85pHNpIlN1eLU0zqGOsKooabS89xk6lR76vULGKjHQfJXapEXvLLnuchr4eMXClhflR27aMTFk4hSq0pIt/8Q74oeH4rsV0C0Rp/qJwn6OmTImB1r9Cfw2FEDD5COoo7I/Sxk/BS81h5z2+YFGKUM9ymix21tAHnHmp5tNtEsO6iMGKaWFs8WCbX2uFDgYQKtn28cFiZdYacwLoBxlkI7H3r80qjJuhdNSP2t1yhX5yEbuGAxF4k+ab/kRHiFw/046OHBjrG+9rn17+dGzZH8ol/3F3fLuaGiaKaoRoCaShMmQBMdtXBmzFQ+dtQdm6iFPkE/gnRcqoX+qUKhG0D+x0uxGxIYNBAaEmzK4O/HBC+qPNXHGp3mo5V65Oxa2AlVWCqPi+ZObdY0cV2kk+r+18HxztrX5XR6pTOs00YOznnZJy94bcxHXS0U96bY10SLeC+6PoDEQjfMfQFD/whwPPluVuuQsTHP7BgdJU2AH1rq3FJobw2bkl4fCnDOQhVz5/oQXG4/UDqSRR1yA8MNIG9m2P/yBCUL9xgLkLTfD8Z8nO0QwKrzWGTNMIamY4sYUxHQ7VkzKTyx63gPYjyIHGkc54mTC/WwK/XBy+BymiqfRJFroSR5/lwL1sytdvP8vIKfgKQW/7OPNM+e9nQuU3cOfK+NIC0fG091Wk/l8iRB/lpq/YVT8wUgnapkWSjx1NpidKhVa40hThE1ygqkrgPcPwF8tqaNynX3A7IfJc/96OO2NoC8DpAvI+gCJgc/DrBDRvr0iBrnwe5xjiKDNUOWuciwTRhZwK88prJoBiJuh3EE4iLQVjUW7vE86UGSF0DS9QdFl10auqAiXjrQuYDE9UHNa/7aK3OMp0ZXZySfJjF0Ho3dq6t5Lzj+Skp96TtYbnLUMZ1FswXdxQ9wfZbmzOcCBOvYT02tu2gSWdGcsQ20NoB85A38D/8OfE7g0YHsIMDENEppBH0IlkxLjWcGTFAKi/0C+tpkNzepoUu1E8LzOqlxr3/BEfCa9estwYc1ZF1THL9rtId3bzsFVi6iyRUAxBVAuUXJPgPHr0WIJP+4euMaSHIRaJdutA4xx1ilygIcBR0A1qixgWE3+jMB7H+v85OTTlkz29oA8q599t8/owZFADsLWbNPTyWtTmLpTLPYLKjVHYuTdtlmtZEDxM9WvCpajyQIqgqlrUUmq5HOSs3vhjXoldLXjed/JOK8ZC7FO4qHfv46pMv12EdOII/WKq/InvGesscXQXJm1rTPzkMBPOqMRei21h472bKm6Vhpg5U6WH7XVOwWqlnXBOUMuD801L+tDSABQE+AzOdR7p8Oz8aUShIb1AeDe5U2qxaILKDImW1HFo/rGVADNGtUWQaJuFJ7vDcauzD0rXPtxjMR3a8cCSuzj6dNFy3437r776h52dt5in32UxfqpZfqkXH/q6XMS4ybZkXxdxukVtAFC9AFIHq7XoEweNmOxqmO29Ru96roE11s6AgqhsWJfNd5jjGYts2QbwAZ+8fYMWlcUFbxufZwJwwxiWK0pdqdHgQNFBOoAeIQu5UGVK8a1e42xy7FTgLTZQ1WXQfFh87+OteluJU2L+p7p1zhy2wc/uLU90WhC30xijw7d+gKB/sXgHDNTuEyr3plu/qQulAJe6FbNb8ZoSmGH4DwlEFr4hQrhZqeS5+oPjSeP5w6inTzrnRSVZ9Wrm9R5AaQ8/rwaGqENgpxQKKQJCay2LqiORmGKZercK2VIFaLhSFAUXVGcqYbNuXxe3yveSMdPh2KPk2/1WWwhQ/Dk71+ofBz5WiQ7gYs3YVmOolBr8mN3UiDr4HdWtR5+r7Iy+aH1/72XUo/V0zTVssXytVgC+EvcwDwgeo1IxzCg8Y/IXwUIIzbomP9WWqTnw08VYCSJQW3IhRuOPc105ZebwB5aR1yJxYKs1DlMULWjLbAct2smGwt2DOFk113NyupuZFWZMlbQbI89pLU1o3h6F4cQpcOyEK36+mGF0HukqXCrwDjtZok78K3i0D9R5pprX3+Z6rjayDbvS/eqAPfx1/PDfDAg1TNuEqK3CJBHdq2efwnhCeqkddML2zNHicOcq/8rg0MN4B88PjYpWIZQ+h9osGMZgGG8bNAYbFTICqNkFCxU5hBswJlZd70kaQBNJWk8r6o6BQwa4SkyzVJab2DrTVbgxtH8AUK4sWIUWsAchkbr2pIfgkAeWWKp4++2U6Kp+BIu3Oy4FID55pa+Mn3QFKdKs8B0JHAUdAB1AFZnxA+BR3n7nR1KVRv2rWgHAa1sNYfuek9/oXrP/5U1VCGxAkYzSwlo6UARzPCaDQbWP1larOFtNJdKOztav2qjk0j621g1SQreG6itboHC1e72Fcz87mBXpvo9USwvD8Xdal7S6C3DbqW7pAzcF95Dt4Z6Z3dd4XqeGYbcAKOa899z+zjLTsCPiRZ52iug40Rc+y8rzu2jFehimmejSxdbyH418BRxdpVjOfiowXbbW0R5GJ/noeqabPBVqMNkhiaf3UFvgZ6TGHAhRkIK0ebSoD14hQ2d7BPIhDeAkDdTotuNGIemty50f2+Wm/kWjSJs7opT8PLR3yyeKUksSpSwfO/swJyXxPTvTUuheVY1vw3pBCQ6CPCT6mly58I+uAnpA84Ptp24UPuH4DeIb1DeoPwJukNQFyID6hEj18hCmxrA8ioALGzn0HiYkRH0XWOIydBMJhSeFyjDkMYYSGHZquqDXNnhAUNLx6kl6hzuA2ci6jt/HZdtH29kAKe3E/35GcPNdv78Z5H6oQrH8ZVcsyJ7uMjij28hwaq2/jZK4mH7miNHN8AvTdQA94hvEF8A/QzruMNqMCnN7h+SqiP+QnpHe5v3e8/RXwQyDorpWyR5AaQj9YISmWQgvBujECvHA0x1xguIE3PkUXh8VTNwcpQXwPC0sohTw4VnnVZT6lz4mMAtKo5oJUMfsUTu0/2TgFWt+qND65+hKgYpXE1Pb6vJPv1tOGOv8c7OfLkzVrjSUQvAJOkn5AC9GoECL0HYOoNKj/h76iA6HiD9EZ43Dc62u+IjvcH5B8wfbqUU+Xiw0+G0re11SAfeQOjKhmQ5iEkXgbCOxvMDjAZDtddPaoU+3oFBNVHVVXxohP5F64FOAqL5o5OwFEXwFG4Lr4rLS/9trPS6ok6kK6UXqWV7dc78NIDYIYV64SvAO09tcuQYQ4gdA9wE94h/4AUaTP8A23Mp4AfFD/JD8A+AH5A5feUPgB/B/wT7tOlevS2tgjy8eUejnNOIlUXhSJ+Ww2zSYJi8cCu7JhozvTjP8G/jtojS42y1SA5T6DxzrraJXaNVmh+K4igs872pchTqym67qp96jYo87bqeFNh77UddeGxp9niPaOKq5xqfp3SSN4HoEtBTi8jPB8N+CI6/ATxAcc7xAJ++oiIEnGRYpvwEdFliRxj+zukDxmOm074BpB/bGDlpY491Q61J8CMTAFqrOITTICZiBggD6HcuG5NC9KKFmTtdtuSt80rMv93AOMaUtyTOpEX0+cz6bPFoHlnvXBt8PkaWJ4qZuMEBNs7rf7cK7XFS1x1YkXYdqX2yAuAZleix2up9SXVJV07kckrmKkAGsh3ZH+H9CZXSaXL71FvfIN7pOLSm2qt0fM7XFFzdH9TAOYn2H1zveRdzWm2PHsDyC+VoyiCKr4zMbsowVjtEjiP+LAOhluNIrs5x4gqZ/fCGDInybToSNwyiLp48K0wYarp2ClbRmwaiE3af20o8XTOcUHW+QPSMq3YR3AJwOu89BsnkrvA8Zyb/VAK/QeehiH/gONN8gA+6CdcPyF/l1rNMYDP9Q55qUe2CPK9dK1r1PkO+bsT7xA+KeW6P9RznJ3tTBtAbjXIB1eMQBKQzeM6kpGaf2+K4epmHzmgDYNXhg0NZrUTXofF7aRpcxIlnhgeXioZ9ffXlRLTyuwfr3XNeULA7eqMKv/W6466UHO8o1Z5Mde/M429qWbUg7Ju1GN/5ex663cCgVWfMaaD2oSpqfFHuV4aMnqLWqMHILoq3fBdro8ATr3D/UM5vyvnGP2xEKKoPILZbk1BvpI2gNwiyK+tLECi8WhWhCZK5NdTCGuNsVi8miWYxb5IskWYNGNr5sQgOSsPe+m4ff3AWmRml0xl1hof511qnd7WR6OnNUi/0JTB/dTDPybgwhckzf6A+15K7R+pPfKstnssM43vgn8E6KmvKb61mqTrQ7W+qDL60yLKOvIzjwQ58GHHnH0/gtnL2y2ptGEx4hOd7K1Rs0WQD67jETge3NxlkKKK46TUUwRVj436e+FVlzaO5u0z5bAdTWnOJHkCPKdRzUno5Vh4dp8Blq7dXp9jJbo7BcdyEe7oFusLYHdl8FxnrXPdPzT+iHNhrz7eRfEXu9e3GDQ8id65EtGTxxIhvrX0GfgJcZ5vjJ8/44J3BjjW1PoNLPOR1BtYZiapN98PH++/PU88PfHxsn3atjaAfHj5JOggImdTdsKzQTlOtyqgCYQEmkpxL/LcLjJUE4xSO02HZqTQuSOdjbzocqqoS2i0NhZz/pyX/tQS8C50qa9R8dYuX4kQv3THP8or5gbS33p9vCsTmKK7vIz6ECM7AXQqg+JCzDRKb0LMOqJ2rt3fJY8aJfEO9w8of+YxrFv9SmQrbiC5AeSvLgrMgLwbfBQICXKVESBhYdAndpW5vpvKJh8ewCrd7d7HOw/CP6qetsJlJjqhonrAmS0jqEsK3PeMy/CLaHrJgkF64D12G8R1Tva15763AxzPmbtU+r3VGBstMK6rRYv1PmWER/goM5LvAD5IvoN8h/guw7uOPNokwQBPFlJ9Z4SDRRW6jfJudcgNIB88/gikKtJTJa5ttqhqyi+n6SB7qdEGtkvQYC/c3wHNnRHRvSC5Ej2uRn+4Ehl2f5S40e3lg+K2N0BmOSzOE2bQg3YJV+9zp9cOcbtBdPnG3KLEOs4DvSkaLrUL/dkaNXUAPABznnFUHSDHu0okiZzfAXwSzMxB2vKUYO49RyFeSWfcJt7xWW5rA8jVlRIwGpjI6MWUoXAyBnjO9qzS9tZZTlrDMHUeo7Ng7mkN8mIYdhKOXaoHXuxac0XI5o6pagIrhc3zlPwSM+ZLafalfP0atfHe/PfGbRfnOu8E49XoVCgqOx+l5hjgOA9zl3S6zkKiRZiS3gqn+h3yMgbkP+X5J6b8A+4/M/yD7i4jMAmUkAcDszdR5DrzSADe8c8JfVGMY1u/sv7jM2liONrU8WZa8wWsLJly16L1KAbdcEYiNiyZc1ScbLsgvnriQb0Y51lTAF/h+J5ZItTOJc5x/OIws84juq+C3yUguSD2wLvsBbsrtxTDcf4R34yebjVobj6FVMDxDfKYcQxw/AnXDyiEJgog/oTjB+Q/4rpmsQn3H5B+RNRZnsfw5gnHnM3TMUfGMzlMQh7SPMta369da9RsILkB5EMlSAKfYbsgiEwdvUJ9Os1uCLFFUiyD4pwLW7Bm3FVG0Ll2ILcDt5tR40oqiAuRyuUM+3Kt7rSxc0JF1L0K45dR6E5NxTVw1PVa5dnn9Wggecfj7vXCPt+US9r8E0K9/IDwBsdPAD8A/Kwd6xjlUWxz/JACTDE3c4qQhf+E4S27Dlac0VTyEjpgckxp2KqKW4r9J69cGjJQHRarTZYiXrEQngj71joCpBZ3WgNSluexahlLnnWJ761D3lX7uqPk14PnJaD8cubKXwxO+Pgb1Ree+uxl8/bzaeVktbzvVGqLP+D6HfAf8ADEAnw/5yjR30u6HR3sOv5TfWXcP8t85CfcP+D6nAY7tsriaTk7x0nFjcVlg2ejsmJfW8ZfwCLaAPI/9nIRZkXXkT0DhnX4u9QQa2ExBsIjJS/WC6hMmTmSZFP8Ifo5yLV5vYV4Lq+ne9eOet6BCuq0AQn0g3NdjaEDvI5tc0tNG7g843lhpEiLB1xRnXj0hHIt8taF8alrQeb6ZJBDOMCLaERT39FneMtoeUEMg9f7QPhQ3d5Ue0qNkniX/CDJK/CRpa5YXBobQCYD3We1+PJ2rXy6vDcD2dYGkGd7OEGYrMWJ5FxHjNpeiR/JYrOADi1mVKkPIM87D+R94HgWld0h338m6DC3vmdcK1YLaymqnUSAXMQb654r9wPIDaA/tV040zm7O0y+aE62EABeRozShWbQtRGfudMeNUfXrKgTUV+hA84NmK6TXSJHfy/36+qO+Sfcf8L9DdJPAB8yxSC4ca5AWBSWZQCn0skeEpDnTjZ7c7fynS8ph1sUuQHk/YkoNbkBTnXGmKzRYMz5GJeodaoBybBqqGk4ToHyesTXBZv95TrAnIg8cA3oeN6fuCcK/NrnONcReSMn/qXZzpPbSPyhmeNdTfLarcY74D+hqriD2ph5gwrQlYvq/GNjx+hNtYsNvEN8g6U30GIkSMikgYoZx9J7gYyooMkMJHl0st07e1+0gqVOPvStk70B5MOZl1zwRhdEh1JmcyiGTkT3RNeR61JlhZpd65ZLYOseuwqIJ4B5GVxuq49L1248j5CaSMUlAHwgQvylIuqvPt1qFPmF5z2NzoVjRIb+BqFEg0EPVFUEb8IUqOK25bp/tBlHKFTA5R/w/KHp+CHPn2JRdSSBMuMYjWrBYfE2LFJsSvCUzt/3RjncAPIPCRi8ZsblrIszQNIqKM2gSZBkY2dYBbfZWJnSzRrbH/aGdBkle842dBEcV8HzHjXxvt54bVbykijvpec7y77PueTShTRdv/h5n08fZMg/y4B3SZ/xIeld7nONcRageJd7Fad4g4f2o9zf4TlmH7MH2Hp+B3Xsx7dYRniEWa2nLyUyR7vQr4w9nVEOaRtybQB55zoqZnGiLzMPeVcz5T56YJuVLFhqs5xEISgWemEcsmHO5NCJ5tYciT6W8nDFovWe6PHUH+VujxldzzsvgeGlF3UPk0b3Fjh1JoQhXXpDDzB/TlXMe+R1TQUQ30rNMcRt5TWlDvWdSKd/yovTYMw//oDrp2YR3JmnTfz0Ib37uD9erEU06ueMjgRgFSBtTscXZpHqObLEZgO7AeRjAYLDzcyN5hbAJRBeZLSLZVf5GfZdBfSUS5XfEfSy+rNen+I6w+kGd47CXKgR8pf4zLhguX0D+BaR4wX9x1vRrHTX61k3BtPV6HMtlZb6AFPr0W0HyFf/7nJNQR8s9UYvIBhD30X8Vm8BhB6R4SyO+wHXZ6k3vjUnwsawwYfIg8xcZ8xUgvIGfIYY60FNs6cASh+sdLVPKIf9x0M8wEja1gaQAGwwYKCnZBlpyDTzADVmMMCOPQCKGWAG6304hRETc4AnM4CJLPcBpgKSCwAkVyKER42jLo2+XFLjuWigdVp35P3SZmusRN1ZAtAdkeQCqE/BeaHu2+4jrQhc6EJN9aa1LsKmNUZ15igRKhzpTunb9Q7XAdLHnG4rdB7dSwpeZh2hz6g96gOuA13zFFlPvyKbGIU6gKQEGYGswqgZViiHRXD+jHJoWxS5AeSd6297IZkwJGcyhzHDLCMxIzEAk8yxnZlEhtEL+DkIESXqLL93qbaXUXL1ALgAxzWdwQs867Mo8gwEsNB8bJjgK3OIHYjoatPmMqhejeZugvraTXdYqN4TnV56mHTfizk/OR0h/4TrE9BB0kGuzxIV1p8fkH9I+lDW7EQo/4gaZJmBLGk5XG/K/ib4Z4SI8YGq1AfFckomy4xjd64ojcXWqIHDh6KQe8vwbFt/1/W/AS42wNEUUz5ymEUdklSJ/HxpS1CPtHafAohAScnLVMbZYOEVSfH7cmStCs9qBdhW7kssGzVrUdtdwPRrn/Wa7sfNeutdKHuDSviQCrnmGnQogr/VrrMcVVSiKn6/V0ZMqIN7UA0jlf4Jb9TB+RJqPT8BfgDKoGBCqetwmRe3Rk2dcdQ8EF4ph1mYjI99NZuJ1xZB3rNSNFBcYW9Y8jNUoEMDQqOzryfOCFLqi5yTPLFr2sDBUJs8K0Je4hzfm9reAi1dF4XVNfHdS4/lvUCIx/Uj7xXhvZKmX/wsHrFomM8yUwPAqDf+CBEKdHXIMvvYQLCK4OoNjiqAW71oYvzH/d2NH27IrcVcxniunRh63Y2+M9062daBad/qWaMcbin2BpD3LC+QBlekyiUKXKTFkT4rmNmmqD+W5s0MhHMtnK2gpy5M+3NP19Klwt7y570isdcGynkB1G4BH3gvOAF/5kem0/Jkb/LVPoupsF7eivNgY8QA6IVw3+dZyMaqeYtUus44+kfrXHuRQSNOOtY+T4OdfMAsr61RDjHbuC4phwn0UptcHKEb5XADyC+urAxPLOGiz23OVtlWG+VhPZpUDFxqtBldAV+0SFndFq60Lh5KcXgBRHCZecIVpZxuO/GgB/Q9UeDVx+m6OPA9jJ+rTKDzcoO0UpPjIoxee4oc3OgARnnpOlePai/daXmdaZy3ZY/aosclHuM/4flDefp5HPWWTYca6WklRFQnX0edpNknAFkph4bQhkTOS8oh+vnJmXJIbpTDrQZ5T4oNAAPhR4c0t0mLRtnpkLg6l/v+4ic/T7ZHj/LhmvkagNbi/cV60ppm5Eq0wAtg+0cHFhcrCnw8/b33j63RyGsN1ri8w+ksqtS8ZKRSa5QqMP4EUMRt53lHSD/Ue10DP+G58Kz1A/I3UD8s4f34mvLwE7JjV0tsFey5UWPwWeezNGrcEpQjKslkixaZBZPDhwS+H+DsReRYGDinX/wGjhtA3pVtCTA45C4t0uwKbn0K3YMgVmW6aspeAbaELl9qKJ4U0tuvbe/v0Ixcj4guRUq/8DrujhoX4Mj1TH9VUJfXhTmuojAuK6iTp9W808/pGPxo/9HADwpNR+n39rtQ5Mv0E9CPEJmYwbKJUKjOTeIHdukdUh6Ojjwadp8hfHsuoza/NnURZE85NJSmzKR4jslBL/40p+c8u3VC2dLsLcW+cUwHQzBpRV6i1BKrZkWvAhG5SnBkej2wQFj0nMVL9beHDLB0FxCtR6C8opDWh1u8et+HI17Nf6UfTSSuKRf9QnDDe7af/4FSNTkUlsu/F7HbuGT8gPRDRd9RGbVR81YEcd+lYtG6cC3UR2HKvOeRnx8vYyaANDl8mP3cVKVHGefUlj6fjHv1lEOcUA5j3qJSDnlOOVzOjne75BZFbhHkrXUsvVySCmEIsXEAixN2LXLPdgitey1SpArDhg6DszZyULZJ3gpB/AP0DB8LkW9H0Lce8NVxkL7Wx5XuKW+96Fuf1ZpP9cmsaf/zNLKcf53g/lFA7iM8YYpxFqraTp1txCeAz9Kk+ZzdCKvJlj4BfhQ/mg+RH0opO0KJxyYsmyirpQ6767Ot3jONcjgCnggrg+W9cVeVOjtRWdkQbAPIG/vZVMtTcpbmi6KWXUFPEMpgeO1el6FwwIN2TZURtgqGHo+J+iNmCqL9KfulLgeOa4IUd9c7vxKOr26+y7bggc/lcqjIi+wirpQdyoSCilBtdRrU7C6oar7V7uPFbMs/VOuQdS7SS0oNvMv1k8QHyANLnqGi/B0dZ658Fyp86qU6eFXVozzAVcVviJ30WaUcpoQ0Zagq/Ih1unI29+D8vUhbPXJLsa8daglggpDkytmVsxDlSBWKWeVe1+tFhEIVJINmWOmIXABijkHgBbiup5aXMGAtnb7Kb75jRrDLd4kVAP2Kx/aFtJ9r9cCzzwCXZdxuybudamFeCrp1Qv+J1+WzbFkRlYhB8PeuW915WfsbXD/k/lOOyr3+aPcN+bM3SD+ZWCxaJRZfdU9Fe9mBnEqE11sfLb4zw8LUrVEOraMcYh7rqZTDMTjZ6j++Zskw5+ebeO4WQd4XfNlchnLPbp6DbghOgDKkCoAV+KYOEOMS95nm3wtQCoWfXbncF1q6p+oxrY50ClacIwC/rHq93lPR12vyPZf7nojuDBx5G/i/ElryQRBffl4TgEM0Vprg7ZsiAnxrArgqzZg6BB4iE8WZsEaOsU3AG4U3GN58sAOP7vQYnTWPzvNAwrLDR4CTlzN0y4O7TnZUdyqfukWQyQoYxvNJDli4HFKOnIrRQk9H3TBwiyC/DJDeJhjdhawpT8hyZA+Ac8Ul1HscLofcIWa4XFXRRyWylDug3M9PwiXJPQbScdua4BSI7klRydvD2LqVm19Jvy8yay7wyNeC0UfB8cuzerfkzZQhHcps4zty2CGERqPeI5Jsw95vcP8os40/y0zkT7iX2qT/lMKilZ5/wvATAz4Bzco8EswVKjwk0hSdbPjcqFmQVde8W9lHnJztF8pRSAfMHTI713+89iltjZotgrwOkG3P9AxkTtmJKVNDFrKYTHAINJcj0+QQwycWdIgudy+iFg7BFQpABSgX6fac2N47GHlv1Cfdi4o3tv9CzVHL6FEP4dhXm1eX3tvFJ4oh8JpGR3f6DTVyjFnHn5VFI/Bns0qIFPpH+92L1Bnwg8BPGd5IHQVTSJTNSt/MQB4JJSJlx+feFm9dYi8n2kQr1r7/3m2it5+xDGCHuUHDpbd6S7P1lR1sW/+UANkFehLl2U3MdDM6RZeQSTocGSYXlANLmcGUIU0gs6RM9wxahinLPRfJs5BNE7KgieTw8LH+0H11G5BOjpJWrP/VY4W38e/+iIX333TmS3OpfIEM4KOkxAUcy5xim3FU52GNLv1W8bfWLEQBvcHwRuGHkr1DfigsK5CKkZsughQYnexjRH26MM5F1dmCK5RDF5jmRg1JYBKwDxOvwb0Nkfe1axXjpHaS3gbHN4C8ttwzOv0v1zFnuKZkyInIQIp0OiHTzUG5DJnQrA3pNsGKQC5V65BRl3SV26KmKSgTSHcNX+vO0HIBbCVpaxYSOhe2YH+AXHD3uxqVXgetGj3yEZC7J3q84Fixqux1/lxTmU382YRuZ6Otny0iFH4KnSBFb7bVvKzxBvINxDtyflPiu5NHy9D6CUmojRqRSCWV9mEeyVHv7KEKoHOmUdXCm5qP65xymGfK4fBxBNLQTogxdB73g9Rqm3Fy3MBxA8iLmWme6dXumZMmZWTCMpyTgRNTngBkGSfCj4DtRE6ET6BNMGUIk8gj3ScwTQAmSZnABPEIqDRxlEHaXEj6hWjtCpNGrXZ4AqjX1Hr0x4EjHq09nukYLihDJ2k4V84fa42gdj1D+Kwd5qKwMxtnodgfFOMtAFXpe770s5BVscc9ZM6YjrXmSHX+2pxBLchVQLYASHNHHgg76Ezfk00kykBM867SUw5RTLzKiE9POczJQFejHDbxXGCjHG4A+diajgd0jn0OQ/YjciYzwcmNE8mJ5BFAAKLziIQBwgRognyCpwxqAnmMtBtHiEcQA6QxHssD5AOEATBC/EKbawXg1uwTqu5GL6rr54+V9Dg4XnBgXELZjZriqngElhxEXg4Hr0aMy+cN/2pVCbKmwlNVed6KKviboDamM/Os8R4ca48UO1LwN8rfNNibMg6QO8y6z25W766ZQhvvsfAotwnw0cCPE8ohZ1M19ba9RTy3Ug5dQBIw1fJIMuDoMfaThlURjF8vdG/rnw4gzRZ0PGmfJ590yBNHJhtt4tGSHUCONBwhDBCPkI0AjqCOAI+AHyAbQB4AjIAGyA8SR9KOAA4QBpAHAWODxms776P7bXMrvGBw9WhkeAscb9EX7wTXu/Jr3ik8fFpzlA6RVntnoOU/OyCMlBuqArc/CpMm6o3Bjvkp9+BdQz9p/Jl3fPdkx+E9O0rNUJ2orcqsoTMhwVua7QmAEcPk+HxKJ5TDYol0Sjk8E8/FarQcICwgoQ2UgyelmGX1eZGmb2sDyAuRDBoL0J45Zddxes8H5mnAYMndBjM7SjywGDRAGgsYDpAGkAnAIGAg9AlxgHEAeICQQAzl80rxWE8xwMbLc5CLTOi0qP4nrgcPGOICz/rasPvddUlewNabfyfog9K7QmXnR5ldLDVIvEUUqR9t3rEOgwMlWvTCtVZT9SHxU4O9fb7sj8PxqDrAjVbuY9WVj2jQorACCZaFvLPSqPEis3fpZHiDcthVG3rKISeAY7gcRn2zcLlKOYaru9CWZv9pAdh/+DewE1K9jILtTPbEo2M65Hw8ep6O7joKOkA6AjoKfoR0UMjxHyOS5IT+d7BeP8TvmK8HsB5XkY68EWndXVy96Xx6H2hxeVnW9hav9Rwc7zEi++qs41XKTy7gWFXA30ok+Napfhf2TBG/rRYKYAXDD4jvIN5IvtP4DvJDg30AOnoaJM6RGlek406rsfQiB2VETVyaQ+FJFtDEKZqHdbNgby6HKtQDL40XpEI5lEod0mef9laHnMVza+OG3FLsLYK8BJCpYEkGPAvKDj8o03T0KR91nBIGH5X9aGYHSiOFI4QjpAPIMdJnpRpFImQmR8RITzq59BGnQRgf4yD7eQTQF6pCzRJAl14tfscJ64ZzLZKo6hVepkHqK6u0SpaTIvu5RV1Jh2+D4/XokUtq4JXoEfPrlz6B2ljB+wyIeINY6o8VKFEB8Ue5/hPgG4gfIH7WrjeMPwG8H16fDvvf38TSfcZCvduiRrj2VqoCngIUU6lJaiAsX+hkd99ri0wLi0rGkDkDoxmTyzYPCQAfEniY4ENnhV6637WTvcxKtihyA8iVdfjXDGXN7T0SNML2Non8lMs854E+JAgGcCincisgsgBARofaQCWI6ew+PTiiXpddract0m2WQeJaY7JFYwAxagSSptlOrB9U7529Cs+8DLVLXuKc3LjmTWuVA8g9yD2APaChhSc4bcqcyqytRJb31ijXujGXGzK50QCln3L9LDTBt6bLCP8RIz6oVMEy0tPMtspjUPQfY0DczT7pONYBbHOHm0HV0be4DKq6EGq2Kop0NywVzDEzanJ0soejA4PNJz7TiXhu7mTOLGqcRfvRpGj8TA4kgx0AEzANtkpG2GBwA8gHMzWGN3ayIPUbIxJIzPjUp78refaU3JO7zKCBgsV7ZwI4BFjIACVAKSLHiCzZgBEJ1Bg1SSUJicYR8AGw3dVUmVgfAm9KE5ogHYv81iel4H6H104uKtkZkiTl0ryYWgtbqHYRtUyQy8FlAeTcw7gH+AzwFeALyCcQewDDdeuGK1Ei76k13tGQYetUf0D+U1Fv/H0xx+h6E/QDrh9w/xHRZXEYRBkUlxqLRmUwnEN6d/BTxEQA9OBD2+SYdgYZYHUWsSspFJ3Qs8idLuQhIs90dBzGVKLO2dyItVZYT3onI1DMGcAAR0SiTfCi/jl3KA3wByiH2jrZG0Cuptjf9pF6LJolpYa0t6zJP3VUgmsgMDD0ACvoDaIOhA0tfa7ptXAAkQQNEAZSR8A+y30MwqCsAw0DTLHttFmzLGkt/a4jXfPC3vgJ11sHDB+QH1EiGwUYTp2fDjplovnZGq9czqAWDTQ8AfYMyGFGgAYpomdjKscoF2lhjVz6aPLOmirvUe9ZRpEO4VDYMT/lTQn8Z2nKvKt0sQtjpjBlqiJ47WZjBkjgJ4kfMLzJcFBKGR5eB5wETwabMrDfwQ1IXVNr1k9WSSQc6shT5mU0x4poRerg6UR9aEE5vFCFRU0iFpRDL51smymHuEQ55Jcac9v6Z4kgB1sAUJy5rSqoCHtOBA5yHwAfIA2CDoRGQEeAB0BjRJI4SBjoOoA+QBzhPIJIcR0DoAMMQzRrcAA4wnEAtUcvaHi6w57vvI4A65n2xtaJrV3ZrAakcrhrBlZ1zyx0JmRepoIMxJPAEZBTRZ0I6iTdpBq+8bS5dNpx1u365FVw7G+z9n1lQMezUZ0yjlOYMe9AU+uZARKa02vgJ4g3gIVVo59I9gboE9PkTLtSqiPoGT6OSJ8HCPsyilNqf2ym6K3eSHZ+MKWTfUo5dLsAfxdcDufMogfXQjms2pB7BKMmd5TD2lnvKIdq8nnb4PgGkGsRi1tzf8NaFjvQkXDIP6fRjuloKR1gNpZ0NhoujkNJsweYjoKOhB0hHICIsiR8Ej6AVuYkIxKNmUgNBWCHs3BKOrtetFRj+Jkh66+Z8fEB4gPSm6KbPgNffX/qxsNVwdFP7Wn34cwIsdjeloPSu6ZNGSDpEO4kCsc1Pch7ZiIv39cBHIoXTAXEt9aAKWM9wZrBO+roDvGjCEzUBs0PkOUEwzfQfmiwt2k3fI5vH4Ln9kLUWCvBhAGii131GC9mqDZ/f32jZihA6olItenTzaxSpXBDCwZr525I96h5rlIOUTrZCePxABXKYYXTnnJYB9pZ/G62tQHkCUAuR1eYYoSbsye2IOT8Nh3S5KOmHLONZCIYg+J1OFyqTZjobMfnM0I6lo72saTfE9i0I48gpjjgpbMuBMtZ3xcQfmwK1+UnAySrVcA7xA9An6hOjcX7W65KqSmhTGgVBTi2sGSAcQToJIv/d/sZYVGUJcLkjFgR/+UFtYpbNcdbne2aVhd6YIkANfOq39rMY40U222In8TP0s0uQFnGfKSfID60Hw4AhcHiG+v/fKfAba6QFzOfy8EkziiHmC0Q5OXrLN1vy8GdTodZPJeLv1XnIXPX2C5D6ClB2ZuJV6UcIntQDocl5bBXUfPVD3aLHjeAPN0tdqUx05lWRZBVSPwl1dZOx3z0Q8p5sJSOlEZAJRpkoRKiCueWmh+DfghGk4Q2FXAs98FEFn62MJXmzrr4I5u69CR5HVWpcv9lmLnS6BCG9q4PSBnRVS3FS69SMdXb+6SqxRhqJ6NSujh+OrfHCq88rYrdYsTgJEU8bbZqmZYT551qFF510P/CnnUxyhOGWZFye40UP0paHXxqcjbZCguFNyS+6+ifcDmSNWYMWh2v/J4DGC1neLJS/zuRsOsGBqwCZG3ANMqhIU3RtOGHN8qhRNA6Xn1/7llQDlvTO1L7QjnksbB5Unqw7bI1ajaAPEt/xjib+orlaOXFZgmkO3zyacpMadKQJqoAG1QUyDFVdXEBmVGnm4qyT1XyqeCYQWQFMB5Zt0F2rrPYdtpJ0EfxPnmr3imK0ZYPyD/g+pD0AffPApClm918vxEeOt6n2HMySFlMIDW8U/vXW+vx3CTgOjhqCXr3oOip8Va8+ENT1AHepeoRow4gUeuRc+RYa47Ez8Ke+YFasyR/YkhvMBx4cEd2YEgxYkOGBnJKc+/JVTrZGXkYI62t84lpSTmsqkmt2VLFcwvlMGXH8ckWlMP60bI1as6jb0qXe1maTbxmyiHOND82yuEGkDeXuoo/JMC9zEWWSwWKRAeR8zRNtJQ5DBMteYyX20RoghjRYWhEltEbjiFcoQmOCYYMx7HIo0XKHduPEAdQyyhyBjCH/Aj3zwAJHOI6jnAcIP8soy7zBfgEkeGiFh1s1zzis5CwHnFufUsYCGOxsS0lx4U/1q+6D14Ax6VKei7g+BOuH6pzi637rJ9FiOJHAcffw6O6Ct2q8KvrAHi5zfAG4kNDOgRGZKA0OVSEJeABmDV6s5zhYwCk2DdqOhGQEjGq6Yp1e1wG8o5RyzwI+jLlcAY+Wkc5ZEifcQfkZEhZpY7pG+VwA8gHAfJjmsGwP6MaYh6y7vxGgD5pOh5Rx2ZQABA6llriLrZzQti6TwxFn7HcfpRwJNsYUKTmWGyfAI1L5BAgHBWNoUMwRQIAJX0A/gHwE/JP1RSy1iIhL2XIiALdl+5VLK0AcQfaGKM8wMyjYU2t48JWo43Kvp0i3cnrfuj44xJAa70xhtirXNnvcP8x0wabX8xPQFGLDL717xB+LzXKSiX8CeB3CD9g/ImU3ny0I4UJU1HVMQDZ54jKDJxyeTcsTRBH3o8Y8zHuZ5hZLJojyNZUOzFSYxHPdSt0pVKTpE4LFbPLYSCgt1vYpM/KEHpJgpL3LodRpxwOEzSkGX85C2pYBXP55nK4AeTKymVEpR4cNVA6H1sRyMxRUUfMPinrSOoIV+hDUtGYCWm0yr3eYeZi95exu89A4oiafsfn2u+lh9AtxGLGr4i+Ric7+MY/Cbwp0swfxcY0NxLbPPtYjr5m1r2DcZg1/1mSLgOMmgGSABm+3/H4akaW1hHwktzPnQrgdXB9LikEt1repchebA/0ozVq4vI7gN9Lal3qjfoB8HcQP0F+YLCJoGTBSHEi6tFTLko8hTSg6SS99VIWDgBzsxhwXH8PbVMbxVE03dyIVBsuAzEUyuEseTajpWNp4qUTERMDka1SDg3M8R7yYOBneW8tID2hHK4IaG5rA8gIlHbDuRDDSgBED7NM7McJH9MROY+Y8hGDHeE8MJWONVrqXDrWOrYmTnVFjJbk1KJOICwboqFTHRRTY8nUCGhWtn6H8NbAEDPfWHNkVTyclVXVc+WnHRmV1zy07nR0q3P3OryAoXfujj43bOgPCWFcGxi3xWs71uaJvNNndMwzjkABxTLb6K1J86PMQv5YcK6JMNUCPpDdgx6IODlWsLESqVWhh3RBtrw0biog1fT2EuWw8amLTmdQDuMNh4kXMR6LFlTLm7UQzwVzVxuO59eYutGdSjlEa9R42iiHG0D+ykp2BoS1P8PTZoERGpn96Ee6T0l5gg8ZVtTD59pjdKZh4UnjPsGsNHSaN01YNsiatazMQ8k8ut+pdLc/AH9XE3rFB1zvUjG5b+rX+igp+EfUH3UohvdBG3QthsPLAVMc6QvQRZLnnD28Z7/vGRgdzdq2ejTyel62EAe/aVZWxSaqNFk1yXqfU+ei0hP1xbkO2TNoajodohPxeOOHxnTgMftcuuCi9qdSYaAXsKqpfp07VKnzlREfmzKmfWqUQxWAPKMcVt58bb64kAtBNWUVyuFUSsGCnKX6cVKH7CJHypdVyp5y6EByx1Q72Xf0XjbK4QaQ50FL7vt4Xe2rCH7Hzt6lhYmuwbI+pknZM7JPNGVQM0gCAXJh3jXBLFPdOI8x6pOzp3ZElsIkKJNe/G5wAPSpaL58QvqE+6GrRZbtOAj6BPDZcbIPAA6Kn3O9Mfo0zpD82UXdlLk5MJJFqIIdOCqHg6NUPL8FFnYO6Lfw8TprZsGn9tnKAL8rao0/Oz71T0F1249gyhTmzMJjBm+AfofxB8AfSPah/XBQknOSN+pdEZeNHcFQI0oC0OTBISqdbBR+c2tnucOHGPUBh0hXq/oQTymHkR7n7sSQPGorbVzoaR2e5k725Q+1dZ87yiERjRokwJv02brLITfK4QaQF49dCwHTFimw7uhrgU6Zud7R/ZOZk6Y0eFbyicaSNndAozrmozmKpAplD1O5Tx0Uz+Wxk4BjKZfPHWvUDjU+55/4LKM+8wXNV6WaS310w+KuSPEowwhYIpBnsAt/bzFUfCgKJhUQDNAUlja31bwsuu+PpdTz6E6uYhOaVXZ+j1qjfkgFNGv6XKLIOWLELFVGVJCs4PgOw6RkChHG3Im4FWfAEjkyR9SIMmyNrlGD0ghplMPs8GFAOh6j4dJRDtFFczEwXoyra6m2mnjBADPYMV7TLcqhmnJT9yF3lMO54VKAfsJMOZxCZGONctgAeKMcbgB5tvvt0gUFLp1V2VvzZs+MT59wKPau7i63ifQsWKZhAkszh8yQjiJHBqOmzDsiSzoyxnxi7CduOzanGLX6Y+vUqgLBzDn+0Qm+/ixMkd9jkBo/QHyUlBjK2RESgns4ExjIyVpjnIfAvTRswtHRTrbV6DLKZd7Cpjlpn+UGaxf3koxZiAp/FKGJ9yYiESD4e0mr3zuLhBjVAWJ+EfwJlt/lbyCjeUP8REqf8d69dXx7Be7WZVbt/Hp8LAUgiVLXMwOmYwMmGcFjSbFr57qnHPqVWsMFyqF5NGpS73K4VLmbO+Id5dDkcFoTz50ph1ZMvKKTzUOGRps79AvKYc2hNsrhBpBn3cWVUZQKhqdSU01CUcIuTZ6niXk6YmIAHYYcpl08wD0sF5SGYtwVHWvHAEMRy2W1Ykhh5KVqYwdUybKQH/sA8KNZlM4Uux+dkX0Flx+ztmGZDXSflCfAS1ods5klnGqgV2uKGVBudUir21BMySxHw6bVJ+N1XhAP77FzRtCYHyifyRukH/LOWjXkx36H63dVemDxse7UeCqVcAZM4A3UTyR+Kg1HTkVBApESR/eim0usxmaOiK5qt9oIHLzR9Joobi803I9ZqzZqfNEpPqUckieUQy9RI1kA0pA+Qhl80divDl2wEuTPlEPUIfaMVcohFaUASk3xeKMcbgD5QIrNfuZuPhBUpmLWbVLlO8uY0oGTUsqeYNmC2yVKSkQTzo04qyFumzCMU7Xq3krCdSyUippuF1TGISJJ/WTzbW6c4zcFYLzP+ocxHK1Cs5PxSNIElY51bbjAyRK5ogAhkUurqgNA5jbqE6XZHC3WmadNzpI+yz7MWdpddSc/K+BJ/vv/2t7V9cax5cYiT/eMfDfJBkHy/39dkJcAC3sszUf3YeWBPB89GvlugnvzsixA8FiS7RlrupqHxSoGoU9rEXgZ/cZpZ4yP7rz3XTKNJBUfUL1S+BDSq96m/hrGnOvsG+///08/fx2WQizq5Bk/iIPlMAQZ3Q22SI899g7F85bDIFLRbjlUA+oSBBmWwxNdPe9LvCbLoak6TwLDclgNWF5ZDj1nSo1DqPmFhvZKrkkkQaKPBxq+3hkt4ndpUUDj11Iql+2G6wZsFsPmpqDGEmThRIQa/R7x012vKoxN4TR7+GUaPcpYfTDNDm9xzLyOAAbeYjD6NoQMu4K80uwGq1cAV57XTXZZoVKc5NQAWAx7N8NwRVs3JTEjOX+dJPr8Y1MT/HXKU8P2FytZW0TbdeyLsZhZ7MnfXlG2FastqWfYBb1iVLkA+BDgnaVcAdxRZIeFVfATC0xZHLOzZc4vKuLVZMt3rwasxas+CcIs2v8az3Ms0Lqjrs1y2KyJOinZrfrjYYhcjdjFe+DLbth+myyHc4RjE2qeHTXyYn/kcyfD3HJobfaxizKvCsW0HCZBPl83ez0SoQioJVw0BZzdNNPFRhJyWkxE7/W6sWzWqMT85h9bjdkrEvd5kQS15+cEBT4AKiXcLl5hHYePSAuXzS1UaxdlYnNfe0yzCKkIoixyExoJlilwAuI9xzbw7aM6GiM77NXiUAlcufavuSjQxoIYqvgUCnm4+jgJUN4q8JCJUKLtfQgyuLIn8OAC8scQXPARARN+/FZXp+23012u24baQziexItJkCEH2fW5HnbxhdpixIIhnx01Zu5IibOqVvtsOexHW/RVsEP2OFoO2xIvqleQVHmhVj/VeS+Ku5nUDpZDhPC0ArUULO21Vet/UbcKpOUwCfLl225Z/UijGsO4+qnv+Kqq7BfVIrWe17vKJrRKmAxnTjteGemOFJVICFKhRWQLbiB9tUGM4ThB0qZ8xpb0TQA76eM/MPuA8RKpPje2QWnwHcL3el5udtLtdDMxKEEbA96zfRBzlYgh3LSESM+FRA+s8IO2QKWZjeWT88gvvBrq+w3Ala5EX7oThu33/MlWKbog03qNP4AgSeEVIu/xcbWl3Ki6q6o3NHaO2Ju+2AqHRO3WK8Qs1Ng0ky8K2A6WEGr2I0Fir2OHdRChnRec6uNoOayfhKjPwjBjDKeF58aXrUgfu+F0j2qWQ0YfclgO4zXE0bptOSzmHm/Z/a3HpUDuD1hZnDw5LIe+uoHdcpijPkmQk4r99kSA/GX7hc9dGnomOJflbtedhUZYrVAYqfTVWVJBMRh9pKZWUmSL0KuWzK2hKVaANxg2F0u8XoWItbWzMGwC3tiO24Ir4Z5sAW5U3MWw72fd67nwdDcV9ZyJXoeQU1+UfuXFDhoRicfxIVLiPFdi1YL0ZWQq/v3H814kfbvy3N0ubXwn5htjedYlfNM/ew/Sj9Q/AX73X+VdRK4+siMPQva6ngiaB9c+Dft3IWR2kUQMJosc2ojHcFrpfTyoeGgFJ6FmJo0DmYzB8e40AL+wHHJYDqOK9C2HEtmQ7qhheTr+t2AgUShsshzGjKYWYJ8sh5t1JbtZGeX6dAOLYzf06bzyOccu8Q/bg/zFnZJPup6EAaU/ji/6amOpOJW7VewKbKA9hHaVqu9c8AbRM0ROEC7i1sNCgRn4gKAKpIrRKKgg7lTuVLGISNtgMAEqBcYTSBEDsSuxoaJSQVsLuVU73WEQwXo3qBd7AmGBShEnQlfRPWjCfy+d6BQaBDk+BCoqUAmCDEIUFVXt1xRaxWi3WHz1AzWGvSPxuy/OQh/2bip080239O8LIBcUuXBd7lyXB24P27XgZEatFbUUoO5dRBlhYd7K9dZGWAaDxA5K+izUEE60XagJD3azHKq+Prq3SqwarCnXk4BztBxOS7xCQW/ZkKu45dBWgdyj1/nKctie+7TCQo2oImN0pz0/lUmo0S/lmEQS5K858unN0lVGweFeKl+pfu34pGImYjBUtfrx+Ouy1DeV8w+LQCtTCtRUhQUGwSaGXSopoNgqShGiyGZCEwK607VlFewnH1zU4tPc2OkFSVwoPBV3FN5DXTVC72yySqvyIomik2OrFqNtJfPnYqshopJEGStrpUh77K2BD4A3GtwSSbuA/N5aAGOZFhpBjrEl4OLH6e6Z/gmRDyzLhwgeti7GtxXl+hjzgI0IdgKrfp5vfnXfo40fpE7HAE6WQ5Wj5bDGUgyVrkuN+HlfvcBSUMywLQqW2HLYwiAOlsMnJZuecWGL/7taif1cAO5dqHm2HPZcyTajo3EzkC8shxzP0eaAi5eNzPlhUmcSJHx2bEQPEvKLa4y/w7JT0opJBfZvpW7/suB8uaOqop78QrKpiJmb7BYXZ7t4ugVMSDH67pwWEdFOzO1ardPOZSVsWfvFqY9NYaZh5ShRUpW2Lwf49DF2eRMFisXX14qvtKX4LKeKq9KMpCGzdxg+YHyH2QXghd5vfA8xZqxCYFuLwAtELhBcAPmA4Iql3LmWh/37P9vyX9/pA9xy3H562CLYKj4OkjN87vtZOwoH6cgQasYbQnr1JxKWw1PshVF30HBZRkFYrYfn4rxENJm0UKRPlkNBHNnj2at5cjJVvILU1yM2Q8l+rvtGn/Ol5TDeG1jgA+M2hWZgCDTWyBXyxShC4h+SIFfhJ/L7P7enZYQSUIH1suP2b+sYreDrcpWRUi3H5MBR6XzlzJBXcfxAXRcnWLe9KSoH8am2x4uvbVUF4NWg+lEbbX2tf659X/HSSAjVHYKrLweLY7XZO5vNUXiF4gcMPwD8iNTuadCbF0gE2raUndPyjmp3nIuhokZuJbAUSBvbKXGEfCJIXy/g7pZP7ZMuOERKz3xE/sJyqHv07GbLoWpXgH3PY/Qhd4O9LVgeDxBvo1+5W6/WPlsOx/NTa1sOFcqwHJZZ5JmbkOwC07PlUF5ZDs3XDckOyJuH5667jVbCZDls/09Hy2EiRZo/thzt7zuKYLmbX5fFL7rf5dev9CF5+vqwUhxegZi5lxiGcucQwQmgLCJFWzJ4FLzhq9CwGWqp0wykQWQXwQbRe5TYG0R/Ts/Jwn5yR5EPMdypvIPyAcN3KP8mJt+hbcOgfGDRd8B+Anpl0TvWcofIXv/jX/fyn/9NOStwoxNM9Tgv2asfWZcC2W2IHOY3I4ldLNhqDzzvQk3zWE+OGivlF5ZDBWzzJZMHyyE+Ww7Fd1tX1ch5xPD1/96baxKODpZDErUIFmMfJejH85jR9JavHSyHQLh5wmreXjeLTEJNgT521LX45kMMy6HJk0STFWQS5J8KAXQjJOL1deexx8OD+vMkVeJpNUFcwMaRTwgee00x2lKqoLxXsEjkGRZj0U0hdxRViBYAqhJVZJ+BkeqhGSKxfOzDY6tbD5LFa1R7RJL61lPVgQcgV4CbgBvBW/ijf2DVd+pyheABq5vsVqnrg0UqBGQp3j7YK3BagccDKAWyAdirE+SHzxxy8WAHU0GJ3poVhVY77jfvQkbbRTCtJujOmaiedAgm3ntUHFZJWFgO8cJy+LzE0ax7sjvxfmU5bCERfLIc7m45xM1dPAfLYQ+tkGPLtVWLbW9OO8Yz5h73seXwuGsd3XKIlG+SIP8/SLG3hMSDC8rdUM+C9d2DA+bj0fNBRuaRPBkdJxeMpy13h0GMoYwKFpSq4D+th0xCCDZ5e3vH9e6rIlQegNwiJ/HUeosCFgrWMQYpTvEiuwA7jBU0Tz5XqVQxz7zEQ8gHRYzW9kxpRdG7lWXzz1TI3cTKAn77jVIfwOMeJ/wgw/MJ8uMGfIs9zlsFz6u/4r3C1oLCR8SGEQrDJotXmqclqJ5jsL/aMB+Hkv3Zcng8wf7SctjCLvhiy2FUk7YoqNUPExyTjJhWkwvaCE6zHPp4jy/xIrZVIB8Vgs+WQ4G5UDO3VVQh+94th4XA3m6ecap3JVv+l5bDRBLkH6/6RNq0Xz/lWrF/8/FGCcVSnm7iLUdwVIife0DsjXrBPPHB3oeU+HFwJHPP1slS9kjeeUDlHYIikMWrRHfVmKgRpkrxIXbFAyoGwmBEPa9ENUqt7DtppqdoywKaQR97PAeOPSo+s+clU/WAhd4BEIFsO/i2An+zsfpiq+Bfzi6YVAPfTsOhMis0babv7zkWPlsOD5+fxmPMWyMC+HF/Le6FboPZZTlYDlkKyl7dctiFmhgRmpRsQkevr/chg9BCqHmc9XjT5bGC/Luqu2fLYcuGjNxLfrUZsSf7JJIg/4SGpr/xgrgUWD4qHn9dQd1iWZN6ehifK85hESZfVKXyC7HmUAJ98bzMIKoGFdJtP9N2Kb9eawxc624vpXxfAuVN//CAHKJ6JBTduTqW6SYAVU90a1sCp2Oo7BX2l2/HP7jXQx7jc0jnEGqmER3j1JrAi7nFZ8thzOabQYovAmeJf09jT1FkQTpxayjZ6NKvVoOd/PhPOY9tiC8sh17sz8/JCbJbDreIO/tqkSEm0n1auCvTCaVbDsMB6q4dwBbFEq0A1OEzbJkYmlfxH3uoZFqSEolE4ssDZSKRSCSSIBOJRCIJMpFIJJIgE4lEIgkykUgkkiATiUQiCTKRSCSSIBOJRCIJMpFIJJIgE4lEIgkykUgkkiATiUQikQSZSCQSSZCJRCKRBJlIJBJJkIlEIpEEmUgkEkmQiUQikQSZSCQSSZCJRCKRBJlIJBJJkIlEIpEEmUgkEokkyEQikUiCTCQSiSTIRCKRSIJMJBKJJMhEIpFIgkwkEokkyEQikUiCTCQSiSTIRCKRSIJMJBKJJMhEIpFIJEEmEolEEmQikUgkQSYSiUQSZCKRSPzZ+B+GrlwhibMxxQAAAABJRU5ErkJggg==&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Sakura</span>(<span class="params">x, y, s, r, fn</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.x = x;</span><br><span class="line">    <span class="built_in">this</span>.y = y;</span><br><span class="line">    <span class="built_in">this</span>.s = s;</span><br><span class="line">    <span class="built_in">this</span>.r = r;</span><br><span class="line">    <span class="built_in">this</span>.fn = fn;</span><br><span class="line">&#125;</span><br><span class="line">Sakura.prototype.draw = <span class="function"><span class="keyword">function</span> (<span class="params">cxt</span>) </span>&#123;</span><br><span class="line">    cxt.save();</span><br><span class="line">    <span class="keyword">var</span> xc = <span class="number">40</span> * <span class="built_in">this</span>.s / <span class="number">4</span>;</span><br><span class="line">    cxt.translate(<span class="built_in">this</span>.x, <span class="built_in">this</span>.y);</span><br><span class="line">    cxt.rotate(<span class="built_in">this</span>.r);</span><br><span class="line">    cxt.drawImage(img, <span class="number">0</span>, <span class="number">0</span>, <span class="number">40</span> * <span class="built_in">this</span>.s, <span class="number">40</span> * <span class="built_in">this</span>.s)</span><br><span class="line">    cxt.restore();</span><br><span class="line">&#125;</span><br><span class="line">Sakura.prototype.update = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.x = <span class="built_in">this</span>.fn.x(<span class="built_in">this</span>.x, <span class="built_in">this</span>.y);</span><br><span class="line">    <span class="built_in">this</span>.y = <span class="built_in">this</span>.fn.y(<span class="built_in">this</span>.y, <span class="built_in">this</span>.y);</span><br><span class="line">    <span class="built_in">this</span>.r = <span class="built_in">this</span>.fn.r(<span class="built_in">this</span>.r);</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.x &gt; <span class="built_in">window</span>.innerWidth || <span class="built_in">this</span>.x &lt; <span class="number">0</span> || <span class="built_in">this</span>.y &gt; <span class="built_in">window</span>.innerHeight || <span class="built_in">this</span>.y &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">this</span>.r = getRandom(<span class="string">&#x27;fnr&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">Math</span>.random() &gt; <span class="number">0.4</span>) &#123;</span><br><span class="line">            <span class="built_in">this</span>.x = getRandom(<span class="string">&#x27;x&#x27;</span>);</span><br><span class="line">            <span class="built_in">this</span>.y = <span class="number">0</span>;</span><br><span class="line">            <span class="built_in">this</span>.s = getRandom(<span class="string">&#x27;s&#x27;</span>);</span><br><span class="line">            <span class="built_in">this</span>.r = getRandom(<span class="string">&#x27;r&#x27;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.x = <span class="built_in">window</span>.innerWidth;</span><br><span class="line">            <span class="built_in">this</span>.y = getRandom(<span class="string">&#x27;y&#x27;</span>);</span><br><span class="line">            <span class="built_in">this</span>.s = getRandom(<span class="string">&#x27;s&#x27;</span>);</span><br><span class="line">            <span class="built_in">this</span>.r = getRandom(<span class="string">&#x27;r&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">SakuraList = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.list = [];</span><br><span class="line">&#125;</span><br><span class="line">SakuraList.prototype.push = <span class="function"><span class="keyword">function</span> (<span class="params">sakura</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.list.push(sakura);</span><br><span class="line">&#125;</span><br><span class="line">SakuraList.prototype.update = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, len = <span class="built_in">this</span>.list.length; i &lt; len; i++) &#123;</span><br><span class="line">        <span class="built_in">this</span>.list[i].update();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">SakuraList.prototype.draw = <span class="function"><span class="keyword">function</span> (<span class="params">cxt</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, len = <span class="built_in">this</span>.list.length; i &lt; len; i++) &#123;</span><br><span class="line">        <span class="built_in">this</span>.list[i].draw(cxt);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">SakuraList.prototype.get = <span class="function"><span class="keyword">function</span> (<span class="params">i</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.list[i];</span><br><span class="line">&#125;</span><br><span class="line">SakuraList.prototype.size = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.list.length;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getRandom</span>(<span class="params">option</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> ret, random;</span><br><span class="line">    <span class="keyword">switch</span> (option) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;x&#x27;</span>:</span><br><span class="line">            ret = <span class="built_in">Math</span>.random() * <span class="built_in">window</span>.innerWidth;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;y&#x27;</span>:</span><br><span class="line">            ret = <span class="built_in">Math</span>.random() * <span class="built_in">window</span>.innerHeight;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;s&#x27;</span>:</span><br><span class="line">            ret = <span class="built_in">Math</span>.random();</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;r&#x27;</span>:</span><br><span class="line">            ret = <span class="built_in">Math</span>.random() * <span class="number">6</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;fnx&#x27;</span>:</span><br><span class="line">            random = -<span class="number">0.5</span> + <span class="built_in">Math</span>.random() * <span class="number">1</span>;</span><br><span class="line">            ret = <span class="function"><span class="keyword">function</span> (<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> x + <span class="number">0.5</span> * random - <span class="number">1.7</span>;</span><br><span class="line">            &#125;;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;fny&#x27;</span>:</span><br><span class="line">            random = <span class="number">1.5</span> + <span class="built_in">Math</span>.random() * <span class="number">0.7</span></span><br><span class="line">            ret = <span class="function"><span class="keyword">function</span> (<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> y + random;</span><br><span class="line">            &#125;;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;fnr&#x27;</span>:</span><br><span class="line">            random = <span class="built_in">Math</span>.random() * <span class="number">0.03</span>;</span><br><span class="line">            ret = <span class="function"><span class="keyword">function</span> (<span class="params">r</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> r + random;</span><br><span class="line">            &#125;;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">startSakura</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    requestAnimationFrame = <span class="built_in">window</span>.requestAnimationFrame || <span class="built_in">window</span>.mozRequestAnimationFrame || <span class="built_in">window</span>.webkitRequestAnimationFrame || <span class="built_in">window</span>.msRequestAnimationFrame || <span class="built_in">window</span>.oRequestAnimationFrame;</span><br><span class="line">    <span class="keyword">var</span> canvas = <span class="built_in">document</span>.createElement(<span class="string">&#x27;canvas&#x27;</span>),</span><br><span class="line">        cxt;</span><br><span class="line">    staticx = <span class="literal">true</span>;</span><br><span class="line">    canvas.height = <span class="built_in">window</span>.innerHeight;</span><br><span class="line">    canvas.width = <span class="built_in">window</span>.innerWidth;</span><br><span class="line">    canvas.setAttribute(<span class="string">&#x27;style&#x27;</span>, <span class="string">&#x27;position: fixed;left: 0;top: 0;pointer-events: none;&#x27;</span>);</span><br><span class="line">    canvas.setAttribute(<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;canvas_sakura&#x27;</span>);</span><br><span class="line">    <span class="built_in">document</span>.getElementsByTagName(<span class="string">&#x27;body&#x27;</span>)[<span class="number">0</span>].appendChild(canvas);</span><br><span class="line">    cxt = canvas.getContext(<span class="string">&#x27;2d&#x27;</span>);</span><br><span class="line">    <span class="keyword">var</span> sakuraList = <span class="keyword">new</span> SakuraList();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">50</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">var</span> sakura, randomX, randomY, randomS, randomR, randomFnx, randomFny;</span><br><span class="line">        randomX = getRandom(<span class="string">&#x27;x&#x27;</span>);</span><br><span class="line">        randomY = getRandom(<span class="string">&#x27;y&#x27;</span>);</span><br><span class="line">        randomR = getRandom(<span class="string">&#x27;r&#x27;</span>);</span><br><span class="line">        randomS = getRandom(<span class="string">&#x27;s&#x27;</span>);</span><br><span class="line">        randomFnx = getRandom(<span class="string">&#x27;fnx&#x27;</span>);</span><br><span class="line">        randomFny = getRandom(<span class="string">&#x27;fny&#x27;</span>);</span><br><span class="line">        randomFnR = getRandom(<span class="string">&#x27;fnr&#x27;</span>);</span><br><span class="line">        sakura = <span class="keyword">new</span> Sakura(randomX, randomY, randomS, randomR, &#123;</span><br><span class="line">            x: randomFnx,</span><br><span class="line">            y: randomFny,</span><br><span class="line">            r: randomFnR</span><br><span class="line">        &#125;);</span><br><span class="line">        sakura.draw(cxt);</span><br><span class="line">        sakuraList.push(sakura);</span><br><span class="line">    &#125;</span><br><span class="line">    stop = requestAnimationFrame(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        cxt.clearRect(<span class="number">0</span>, <span class="number">0</span>, canvas.width, canvas.height);</span><br><span class="line">        sakuraList.update();</span><br><span class="line">        sakuraList.draw(cxt);</span><br><span class="line">        stop = requestAnimationFrame(<span class="built_in">arguments</span>.callee);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">window</span>.onresize = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> canvasSnow = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;canvas_snow&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line">img.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    startSakura();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">stopp</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (staticx) &#123;</span><br><span class="line">        <span class="keyword">var</span> child = <span class="built_in">document</span>.getElementById(<span class="string">&quot;canvas_sakura&quot;</span>);</span><br><span class="line">        child.parentNode.removeChild(child);</span><br><span class="line">        <span class="built_in">window</span>.cancelAnimationFrame(stop);</span><br><span class="line">        staticx = <span class="literal">false</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        startSakura();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后将该文件引入到<code>inject</code>的<code>bottom</code>处：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="string">&lt;script</span> <span class="string">src=&quot;/js/sakura.js&quot;&gt;&lt;/script&gt;</span></span><br></pre></td></tr></table></figure>
<p>如果想更换漂浮物样式，可以在<code>img.src = &quot;xxx&quot;;</code>处直接修改图片链接。</p>
<hr>
<h1>结尾</h1>
<p>没得结尾</p>
]]></content>
      <categories>
        <category>博客</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>操作系统学习笔记-并发性：互斥和同步</title>
    <url>/2021/04/21/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E5%B9%B6%E5%8F%91%E6%80%A7%EF%BC%9A%E4%BA%92%E6%96%A5%E5%92%8C%E5%90%8C%E6%AD%A5/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\css\APlayer.min.css"><script src="\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\js\Meting.min.js"></script><h1>前言</h1>
<p><em>正在学习操作系统，记录笔记。</em></p>
<blockquote>
<p>参考资料：</p>
<p>《操作系统（精髓与设计原理 第6版） 》</p>
</blockquote>
<hr>
<h1>第五章：并发性：互斥和同步</h1>
<p>操纵系统设计中的核心问题就是关于进程和线程的管理（包括以下三个方面）：</p>
<ul>
<li>多道程序设计技术：管理单处理器系统中的多个进程。</li>
<li>多处理技术：管理多处理器系统中的多个进程。</li>
<li>分布式处理技术：管理多台分布式计算机系统中多个进程的执行。</li>
</ul>
<p>支持并发进程的基本要求是加强**互斥（Mutual exclusion）**的能力（即排他性），具体表现为：当一个进程被授予互斥能力时，在该进程的访问共享资源（如文件、I/O访问）的活动期间，不允许其它进程访问该资源。</p>
<p>为了实现互斥，根据上述提到的三类多进程技术，这里会介绍三种实现互斥的方案：<strong>信号量（Semaphores）、管程（Monitors）、消息传递（Message Passing）</strong>。</p>
<p>在正式介绍本章内容之前先理解以下两个部分的内容👇👇👇👇</p>
<p>首先要了解并发可以在三种平台以三种方式进行：</p>
<ul>
<li>
<p>三种平台：</p>
<ol>
<li>在单处理器上，并发执行（交替）；</li>
<li>在多处理器平台上，并行执行；</li>
<li>在分布式系统中，并行执行。</li>
</ol>
</li>
<li>
<p>三种执行方式：</p>
<ol>
<li>
<p>多个应用程序，并发执行，以提升计算机系统的运行效率。</p>
<blockquote>
<p>比如开着QQ音乐，浏览新闻，同时开着微信与朋友聊天。</p>
</blockquote>
</li>
<li>
<p>结构化程序：将一个程序采用模块化设计，然后用多线程的方式并发执行。</p>
<blockquote>
<p>比如色情图像检测模块，我们分为关键帧抽取模块，检测模块与用户响应模块，将三个模块并发执行减少系统的响应时间。</p>
</blockquote>
</li>
<li>
<p>在操作系统中采用并发方式，提升操作系统的效率；</p>
</li>
</ol>
</li>
</ul>
<p>接着了解下和并发相关的关键术语：</p>
<table>
<thead>
<tr>
<th>术语</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>原子操作（Atomic operation）</td>
<td>一个或多个指令的序列，对外是不可分的；即没有其他进程可以看到其中间状态或者中断此操作（指令集合在执行时不允许被中断，要么就全部执行，要么就不执行）</td>
</tr>
<tr>
<td>临界区（Critical section）</td>
<td>是一段代码，在这段代码中进程将访问共享资源，当另外一个进程已经在这段代码中运行时，这个进程就不能在这段代码中执行</td>
</tr>
<tr>
<td>死锁（Deadlock）</td>
<td>两个或两个以上的进程因其中的每个进程都在等待其他进程做完某些事情而不能继续执行，这样的情形叫做死锁（比如只能通过一辆汽车的公路上，两辆汽车相向而行）</td>
</tr>
<tr>
<td>活锁（Livelock）</td>
<td>两个或两个以上进程为了响应其他进程中的变化而持续改变自己的状态但不做有用的工作，这样的情形叫做活锁（同样是两个并发的进程可能会死锁，但是其中一个进程会主动改变状态）</td>
</tr>
<tr>
<td>互斥（Mutual exclusion）</td>
<td>当一个进程在临界区访问共享资源时，其他进程不能进入该临界区访问任何共享资源，这种情形叫做互斥（排他性）</td>
</tr>
<tr>
<td>竞争条件（Race condition）</td>
<td>多个线程或者进程在读写一个共享数据时，结果依赖于它们执行的相对时间，这种情形叫做竞争（共享资源的状态由最后执行的进程决定的情形）</td>
</tr>
<tr>
<td>饥饿（Starvation）</td>
<td>是指一个可运行的进程尽管能继续执行，但被调度器无限期地忽视，而不能被调度执行的情况</td>
</tr>
</tbody>
</table>
<blockquote>
<p>从临界区中我们又可以引出<strong>临界资源</strong>的概念：两个或多个进程需要访问的一个不可共享的资源。</p>
</blockquote>
<h2 id="并发的原理">并发的原理</h2>
<p>在操作系统中引入并发的<strong>根本目的是为了提高计算机的运行效率</strong>，并发在三种硬件平台上有两种形式：<code>Concurrency（并发）</code>与<code>Parallel（并行）</code>,：</p>
<ul>
<li>并发：指的是在同一个时间段内有多个进程在CPU上交替执行，因为计算机执行速度快，人的反应慢，并发给人一种错觉就是在这个时间段内多个程序同时进行。</li>
<li>并行：指的是在同一个时刻多个进程同时在执行，这个同时执行就是物理存在而不是虚拟的。</li>
</ul>
<p>下面两张图可以较为直观的理解并发的原理：</p>
<ul>
<li>
<p>在单处理器多道程序设计系统中（图左，<strong>并发</strong>）：进程交替执行，表现出一种同时执行的外部特征。（并未实现真正意义上的并行处理）</p>
<blockquote>
<p>即使不能实现真正的并行处理，并且在进程间来回切换也需要一定的开销，交替执行在处理效率和程序结构上还是带来了重要的好处。</p>
</blockquote>
</li>
<li>
<p>在多处理系统中（图右，<strong>并行</strong>）：进程不仅可以交替执行，而且可以重叠执行。（能够实现真正意义上的并行处理）</p>
<blockquote>
<p>从表面上看，交替和重叠代表了完全不同的执行模式和不同的问题。但实际上两种技术都可以看做是并发处理的一个实例，且都代表了同样的问题。</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E5%B9%B6%E8%A1%8C%E5%A4%84%E7%90%86%E8%BF%9B%E7%A8%8B.png" alt=""></p>
</li>
</ul>
<p>由于多道程序设计系统的一个基本特性：进程的相对执行速度不可预测。（它取决于其他进程的活动、操作系统处理中断的方式、操作系统的调度策略）会导致并发面临以下问题：</p>
<ul>
<li>中断性（破坏了连续性）：为了实现并发，进程交替执行，所以在进程并发执行过程中，进程的执行是走走停停的；</li>
<li>失去了封闭性：计算机资源在一个时间段内是为所有的进程所独有；</li>
<li>执行的不一致性：在相同的输入下，进程执行可能会产生不同的结果。</li>
</ul>
<h3 id="简单案例及分析">简单案例及分析</h3>
<p>为了更好理解这章的关键，考虑下面一个简单的程序：</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">echo</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	chin = getchar();</span><br><span class="line">	chout = chin;</span><br><span class="line">	<span class="built_in">putchar</span>(chout);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>这个过程显示了字符回显程序的基本步骤，每当击一下键，就可从键盘获得输入。每个输入字符就保存在变量chin中，然后传送给变量chout，并回送给显示器。任何程序可以重复地调用这个过程，接收用户输入，并在屏幕上显示。</p>
</blockquote>
<p>假定博主本人使用的是一个支持单用户的单处理器多道程序设计系统，我要同时使用多个应用程序，而且每个应用程序都要使用同一个键盘输入，同一块显示器输出，因此每个应用程序都需要使用这个<code>echo()</code>函数。为了节省空间，我会把这个程序载入到一个所有应用程序都可以访问的全局存储区域。这种设计一方面节省了空间，另一方面允许各个进程间有效而紧密的交互。但是这样的设计也会带来一些问题，考虑以下P1和P2进程的执行顺序：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E6%A1%88%E4%BE%8B%E8%BF%87%E7%A8%8B%E4%B8%80.png" alt=""></p>
<ol>
<li>进程P1调用echo过程，并在getchar返回它的值以及将该值存储于chin后立即被中断，此时，最近输入的字符x保存在变量chin中。</li>
<li>进程P2被激活并调用echo过程，echo过程运行得出结果，输入，然后在屏幕上显示单个的字符y。</li>
<li>进程P1被恢复。此时chin中的值x被写覆盖，因此已丢失，而chin中的值y被传送给chout并显示出来。</li>
</ol>
<p>最终造成的结果就是第一个字符x丢失，第二个字符y被显示了两次。</p>
<blockquote>
<p>问题的本质在于共享全局变量chin。多个进程访问这个全局变量，如果一个进程修改了它，然后被中断，那么另一个进程可能在第一个进程使用它的值之前又修改了这个变量。</p>
</blockquote>
<p>假设在这个过程中一次只可以有一个进程，那么前面的顺序会产生如下结果：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E6%A1%88%E4%BE%8B%E8%BF%87%E7%A8%8B%E4%BA%8C.png" alt=""></p>
<ol>
<li>进程P1调用echo过程，并在输入函数取得结果后立即被中断，此时，最近输入的字符x保存在变量chin中。</li>
<li>进程P2被激活并调用echo过程。但是，由于P1仍然在echo过程中，尽管当前P1处于挂起状态，P2仍被阻塞，不能进入这个过程。因此，P2被挂起，等待echo过程可用。</li>
<li>一段时间后，进程P1被恢复，完成echo的执行，并显示出正确的字符x。</li>
<li>当P1退出echo后，解除了对P2的阻塞，P2被恢复，成功地调用echo过程。</li>
</ol>
<p>这样的输出结果是我们所希望的。</p>
<p>上述这个简单的案例说明，如果需要保护共享的全局变量（以及其他共享的全局资源），唯一的办法是控制访问该变量的代码。如果我们定义了一条规则，一次只允许一个进程进入echo，并且只有在echo过程运行结束后它才对另一个进程是可用的，那么刚才讨论的那类错误就不会发生了。</p>
<p>如何实施此规则是本章的重要内容！！！！</p>
<blockquote>
<p>上述我们讨论的情况是在单处理器多道程序设计系统中，但其实在多处理器系统中，同样也存在保护共享资源的问题，其解决方法也是相同的：<strong>控制对共享资源的访问</strong>。</p>
</blockquote>
<h3 id="竞争条件">竞争条件</h3>
<p>竞争条件发生在多个进程或线程读写数据时，其最终的结果依赖于多个进程的<strong>指令执行顺序</strong>。</p>
<blockquote>
<p>考虑下面两个简单的例子：</p>
<ul>
<li>
<p>案例一：</p>
<p>假设两个进程P1和P2共享全局变量a。在某一执行时刻，P1更新a为1，在执行的另外某一时刻，P2更新a为2。因此，两个任务竞争更新变量a。</p>
<p>（在本例中，竞争的“失败者”（也就是最后更新全局变量a的进程）决定了变量a的最终值。）</p>
</li>
<li>
<p>案例二：</p>
<p>考虑两个进程P3和P4共享全局变量b和c，并且初始值b=1，c=2。在某一执行时刻，P3执行赋值语句b=b+c，在另一执行时刻，P4执行赋值语句 c=b+c。两个进程更新不同的变量，但两个变量的最终值依赖于两个进程执行赋值语句的顺序。如果P3首先执行赋值语句，那么最终的值为b=3，c=5。如果P4首先执行赋值语句，那么最终的值为b=4，c=3。</p>
</li>
</ul>
</blockquote>
<h3 id="操作系统关注的问题">操作系统关注的问题</h3>
<p>并发会带来如下设计和管理问题：</p>
<ol>
<li>
<p>操作系统需要进程控制块（PCB）来记住各个活跃的进程。</p>
</li>
<li>
<p>操作系统必须为每个活跃进程分配和释放各种资源（因为进程是资源的分配单位），这些资源包括：</p>
<ul>
<li>处理器时间：这是调度功能。</li>
<li>存储器：大多数操作系统使用虚拟存储方案。</li>
<li>文件</li>
<li>I/O设备</li>
</ul>
</li>
<li>
<p>操作系统必须保护每个进程的数据和物理资源，避免其他进程的无意干涉。</p>
</li>
<li>
<p>一个进程的功能和输出结果必须与执行速度（相对于其他并发进程的执行速度）无关。【本章关键就是介绍如何实现这一点】</p>
<blockquote>
<p>关于如何实现上述第四点，这里给出两种解决方案：</p>
<ul>
<li>取消共享资源：每个进程和每个线程所用到的资源都是独享的，这种方法能够解决前面的问题，但是和操作系统的设计目标不符合（操作系统是资源的管理者，要让计算机系统中的资源得到充分使用）</li>
<li>让进程和线程的执行顺序满足一定的条件（同步和互斥，核心概念是互斥）</li>
</ul>
</blockquote>
</li>
</ol>
<h3 id="进程的交互">进程的交互</h3>
<p>根据进程相互间是否指导对方存在的程度，对进程间的交互方式进行如下三种分类：</p>
<ul>
<li>
<p>进程之间相互不知道对方的存在</p>
<p>这是一些独立的进程，它们不会一起工作。关于这种情况的最好例子是多个独立进程的多道程序设计，可以是批处理作业，也可以是交互式的会话，或者是两者的混合。尽管这些进程不会一起工作，但操作系统需要知道它们对资源的竞争情况。（例如，两个无关的应用程序可能都想访问同一个磁盘、文件或打印机，操作系统必须控制这样的访问）</p>
</li>
<li>
<p>进程间接知道对方的存在</p>
<p>这些进程并不需要知道对方的进程ID，但它们共享某些对象，如一个I/O缓冲区。这类进程在共享同一个对象时表现出合作行为。</p>
</li>
<li>
<p>进程直接知道对方的存在</p>
<p>这些进程可以通过进程ID互相通信，用于合作完成某些活动。同样，这类进程表现出合作行为。</p>
</li>
</ul>
<p>下面的表格更为详细地说明了进程间的三种交互方式：</p>
<table>
<thead>
<tr>
<th>知晓程度</th>
<th>关系</th>
<th>一个进程对其他进程的影响</th>
<th>潜在的控制问题</th>
</tr>
</thead>
<tbody>
<tr>
<td>进程之间相互不知道对方的存在</td>
<td>竞争</td>
<td>·一个进程的结果与其他进程的活动无关<br/>·进程的执行时间可能会受到影响</td>
<td>·互斥<br/>·死锁（可复用的资源）<br/>·饥饿</td>
</tr>
<tr>
<td>进程间接知道对方的存在（如共享对象）</td>
<td>通过共享合作</td>
<td>·一个进程的结果可能依赖于从其他进程获得的信息<br/>·进程的执行时间可能会受到影响</td>
<td>·互斥<br/>·死锁（可复用的资源）<br/>·饥饿<br/>·数据一致性</td>
</tr>
<tr>
<td>进程直接知道对方的存在（它们有可用的通信原语）</td>
<td>通过通信合作</td>
<td>·一个进程的结果可能依赖于从其他进程获得的信息<br/>·进程的计时可能会受到影响</td>
<td>·死锁（可消费的资源）<br/>·饥饿</td>
</tr>
</tbody>
</table>
<blockquote>
<p>对上述表格中不同关系存在的控制问题做一个详细补充：</p>
<ul>
<li>进程之间相互不知道对方的存在：
<ul>
<li>互斥：虽然进程互不知道，但是由于在同一个计算机系统中，对于临界资源需要互斥访问；</li>
<li>死锁：互斥的进程相互竞争资源，导致所需的资源无法有效释放；</li>
<li>饥饿：进程具备执行条件，但是由于得不到资源无法执行（低优先级的进程在执行时，前面老有高优先级的进程。）</li>
</ul>
</li>
<li>进程间接知道对方的存在：
<ul>
<li>因为进程间存在共享资源的关系，所以“互不知道关系”的三个问题它都具有；</li>
<li>同时它还多了一个数据的不一致性问题（条件竞争）</li>
</ul>
</li>
<li>进程直接知道对方的存在：
<ul>
<li>死锁：错误的同步，导致两个进程同时等待对方发消息；</li>
<li>饥饿：多个并发执行的进程，某一个进程始终没有得到让他启动的消息。</li>
</ul>
</li>
</ul>
<p>实际条件并不总是像上表中给出的那么清晰，几个进程可能既表现出竞争，又表现出合作。然而，对操作系统而言，分别检查表中的每一项并确定它们的本质是必要的。</p>
</blockquote>
<h4 id="进程间的资源竞争">进程间的资源竞争</h4>
<p>当并发进程竞争使用同一资源时，它们之间就会发生冲突。（这类资源包括I/O设备、存储器、处理器时间和时钟）</p>
<p>竞争进程面临以下三个控制问题：</p>
<ul>
<li>
<p>互斥：</p>
<p>一次只允许有一个程序在临界区中。（例如，每次只允许一个进程向打印机发送命令）</p>
</li>
<li>
<p>死锁：</p>
<p>考虑两个进程P1和P2，以及两个资源R1和R2。假设每个进程为执行部分功能都需要访问这两个资源，那么就有可能出现下列情况：操作系统把R1分配给P2，把R2分配给P1，每个进程都在等待另一个资源，且在获得其他资源并完成功能前，谁都不会释放自己已经拥有的资源。这两个进程发生死锁。</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E7%AB%9E%E4%BA%89.png" alt=""></p>
</li>
<li>
<p>饥饿：</p>
<p>假设有三个进程（P1、P2和P3），每个进程都周期性地访问资源R。考虑这种情况，P1拥有资源，P2和P3都被延迟，等待这个资源。当P1退出它的临界区时，P2和P3都被允许访问R。假设操作系统把访问权授予P3，并且在P3完成临界区之前P1又需要访问该临界区。如果在P3结束后操作系统又把访问权授予P1，并且接下来把访问权轮流授予P1和P3，那么即使没有死锁，P2也可能被无限期地拒绝访问资源。</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E9%A5%A5%E9%A5%BF.png" alt=""></p>
</li>
</ul>
<blockquote>
<p>下图用抽象术语给出了互斥机制。假设有n个进程并发执行，每个进程都包括了在某资源Ra上操作的临界区以及不涉及资源Ra的替它代码。因为所有的进程都需要访问同一个资源Ra，因此在某一时刻只有一个进程在临界区是很重要的。</p>
<p>为实施互斥，需要两个函数：<code>entercritical</code>和<code>exitcritical</code>。每个函数的参数都是竞争使用的资源名。如果一个进程在它的临界区中，那么其他任何试图进入临界区的进程都必须等待。</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E7%AB%9E%E4%BA%892.png" alt=""></p>
</blockquote>
<h4 id="进程间通过共享合作">进程间通过共享合作</h4>
<p>通过共享进行合作的情况，包括进程间在互相并不确切知道对方的情况下进行交互。</p>
<p>例如，多个进程可能访问一个共享变量、共享文件或数据库，进程可能使用并修改共享变量而不涉及其他进程，但却知道其他进程也可能访问同一个数据。因此，这些进程必须合作，以确保它们共享的数据得到正确的管理。控制机制必须必须确保共享数据的完整性。</p>
<h4 id="进程间通过通信合作">进程间通过通信合作</h4>
<p>当进程通过通信进行合作时，各个进程都与其他进程进行连接，通信提供了同步和协调各种活动的方法。</p>
<blockquote>
<p>在典型情况下，通信可由各种类型的消息组成，发送消息和接收消息的原语由程序设计语言提供，或者由操作系统的内核提供。</p>
<p>由于在传递消息的过程中进程间没有共享任何对象，因而这类合作不需要互斥，但是仍然存在死锁和饥饿的问题。</p>
</blockquote>
<h3 id="互斥的要求">互斥的要求</h3>
<p>为了提供对互斥的支持，必须满足以下要求（十六字简记）：</p>
<ul>
<li>
<p>空闲让进：如果没有进程访问临界资源，如果没有进程访问，可以允许访问；</p>
</li>
<li>
<p>忙则等待：如果有进程访问，则申请访资源的进程保持等待；</p>
</li>
<li>
<p>有限等待：对于申请访问临界资源的进程，应该在有限的时间内实现对临界资源的访问，避免死锁和饥饿的发生；</p>
</li>
<li>
<p>让权等待：申请临界资源的进程如果不能马上访问临界资源，应该立即释放CPU的使用权给其他进程。</p>
<blockquote>
<p>能过满足以上互斥要求的方法主要有三类：</p>
<ul>
<li>
<p>方法一：让由并发执行的进程担负这个责任。（软件方法）</p>
<p>这类进程，不论是系统程序还是应用程序，都需要与另一个进程合作，而不需要程序设计语言或操作系统提供任何支持来实施互斥。（该方法已被证明会增加开销和缺陷）</p>
</li>
<li>
<p>方法二：专用的机器指令，保证原子操作实现互斥。（硬件方法）</p>
<p>这种方法的优点是可以减少开销，但却很难成为一种通用的解决方案。</p>
</li>
<li>
<p>方法三：由操作系统或编译器提供工具或方法实现，主要有三种：信号量，管程和消息。</p>
</li>
</ul>
</blockquote>
</li>
</ul>
<h2 id="互斥：硬件的支持">互斥：硬件的支持</h2>
<p>许多增强互斥的软件算法已经开发出来了。软件方法会带来高开销并且很容易产生逻辑错误。这一部分我们来讨论提供互斥的硬件支持。</p>
<h3 id="中断禁用">中断禁用</h3>
<p>前文介绍过，在单处理机器中，并发进程不能重叠，只能交替。一个进程直到它调用了一个操作系统服务或者被中断，它将一直运行。因此为了保证互斥，只需要保证一个进程不被中断就可以了。</p>
<blockquote>
<p>思路：</p>
<ol>
<li>进入访问临界资源之前，让中断失效；</li>
<li>访问完临界资源之后，使能中断；</li>
</ol>
</blockquote>
<p>这种能力可以通过系统内核为启用和禁用中断定义的原语来提供。一个进程可以通过下面的方法实施互斥：</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">while</span>(<span class="literal">true</span>)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">/*disable interrupts（禁用中断）*/</span></span><br><span class="line">	<span class="comment">/*critical section（临界区）*/</span></span><br><span class="line">	<span class="comment">/*enable interrupts（启用中断）*/</span></span><br><span class="line">	<span class="comment">/*remainder（其余部分）*/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>中断禁用的方法使得程序执行到临界区之前不能被其他进程打断，因此可以保证互斥。但是这种方法也有两种缺陷：</p>
<ul>
<li>限制了进程的并发执行：这会导致计算机系统的执行效率有明显的降低。（与原本并发的初衷相悖）</li>
<li>在多核计算机或分布式系统中，这种方法可能失效，因为屏蔽中断需要向多个CPU同时发起，屏蔽中断信号的发送有一个时延，这个时延可能导致互斥的失效；</li>
</ul>
<h3 id="专用机器指令">专用机器指令</h3>
<p>在多处理器系统中，多个处理器共享内存，这种情况处理器之间的行为是无关的，它们之间也没有支持互斥的中断机制。但是在硬件级别上，我们可以追求对存储单元的访问排斥对相同单元的其他访问。基于这一点，处理器的设计者提出了一些机器指令，用于保证两个动作的原子性。</p>
<blockquote>
<p>原子性：“原子”表示不能被中断的单个步骤的指令。</p>
<p>例如在一个取指令周期中对一个存储器单元的读和写或者读和测试。在该指令执行的过程中，任何其他的指令访问内存将被阻止。而这些动作在一个指令周期中完成。</p>
</blockquote>
<p>接下来会介绍两种常见的指令：</p>
<h4 id="compare-and-swap（比较和交换指令）">compare_and_swap（比较和交换指令）</h4>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">compare_and_swap</span> <span class="params">(<span class="keyword">int</span> *word, <span class="keyword">int</span> testval, <span class="keyword">int</span> newval)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> oldval;</span><br><span class="line">    oldval = *word;</span><br><span class="line">    <span class="keyword">if</span> (oldval == testval) *word = newval;</span><br><span class="line">    <span class="keyword">return</span> oldval;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>以上代码为<code>比较和交换</code>指令的一个版本：</p>
<ul>
<li>用一个测试值（teatval）检查一个内存单元（*word）。如果该内存单元的当前值是testval，就用newval取代该值；否则保持不变。</li>
<li>该指令总是返回旧内存值；因此，如果返回值与测试值相同，则表示该内存单元已被更新。</li>
<li>（这个原子指令由两个部分组成：比较内存单元值和测试值；如果值有差异，则产生交换。整个比较和交换功能按原子操作执行，即它不接受中断。）</li>
</ul>
<p>该指令的另一个版本返回一个布尔（Boolean）值：交换发生时为真（true）；否则为假（false）。</p>
<p>（几乎所有处理器家族（x86、IA64、sparc、/390等）中都支持该指令的某个版本，而且多数操作系统都利用该指令支持并发。）</p>
</blockquote>
<p>下面的代码将展示基于使用<code>比较和交换</code>指令的互斥规程：</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*program mutualexclusion*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> n = <span class="comment">/*进程个数*/</span>;</span><br><span class="line"><span class="keyword">int</span> bolt; <span class="comment">/*共享变量*/</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">p</span><span class="params">(<span class="keyword">int</span> i)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>)&#123;</span><br><span class="line">        <span class="keyword">while</span> (compare_and_swap(bolt,<span class="number">0</span>,<span class="number">1</span>) == <span class="number">1</span>)&#123;</span><br><span class="line">            <span class="comment">/*不做任何事*/</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/*临界区*/</span>;</span><br><span class="line">        bolt = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">/*其余部分*/</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    bolt = o; <span class="comment">/*初始化共享变量*/</span></span><br><span class="line">    parbegin (P(<span class="number">1</span>), P(<span class="number">2</span>),...,P(n)); <span class="comment">/*多个进程并发*/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>共享变量bolt被初始化为0。唯一可以进入临界区的进程是发现bolt等于0的那个进程。所有试图进入临界区的其他进程进入忙等待模式。</p>
<p>忙等待（busy waiting）/自旋等待（spin waiting）：</p>
<p>进程在得到临界区访问权之前，它只能继续执行测试变量的指令来得到访问权，除此之外不能做其他事情。</p>
<p>当一个进程离开临界区时，它把bolt重置为0，此时只有一个等待进程被允许进入临界区。进程的选择取决于哪个进程正好执行紧接着的<code>比较和交换</code>指令。</p>
</blockquote>
<h4 id="exchange（交换指令）">exchange（交换指令）</h4>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">exchange</span><span class="params">(<span class="keyword">int</span> <span class="keyword">register</span>, <span class="keyword">int</span> memory)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> temp;</span><br><span class="line">    temp = memory;</span><br><span class="line">    memory = <span class="keyword">register</span>;</span><br><span class="line">    <span class="keyword">register</span> = temp;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>该指令交换一个寄存器的内容和一个存储单元的内容。</p>
</blockquote>
<p>下面的代码将展示基于<code>exchange</code>指令的互斥协议：</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*program mutualexclusion*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> <span class="keyword">const</span> n = <span class="comment">/*进程个数*/</span>;</span><br><span class="line"><span class="keyword">int</span> bolt; <span class="comment">/*共享变量*/</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">p</span><span class="params">(<span class="keyword">int</span> i)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> keyi = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>)&#123;</span><br><span class="line">        <span class="function"><span class="keyword">do</span> <span class="title">exchange</span> <span class="params">(keyi, bolt)</span></span></span><br><span class="line"><span class="function">        <span class="title">while</span> <span class="params">(keyi != <span class="number">0</span>)</span></span>;</span><br><span class="line">        <span class="comment">/*临界区*/</span>;</span><br><span class="line">        bolt = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">/*其余部分*/</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    bolt = o; <span class="comment">/*初始化共享变量*/</span></span><br><span class="line">    parbegin (P(<span class="number">1</span>), P(<span class="number">2</span>),...,P(n)); <span class="comment">/*多个进程并发*/</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<blockquote>
<p>共享变量bolt被初始化为0，每个进程都使用一个局部变量key且初始化为1。唯一可以进入临界区的进程是发现bolt等于0的那个进程。它通过把bolt置为1排斥所有其他进程进入临界区。当一个进程离开临界区时，它把bolt重置为0，允许另一个进程进入它的临界区。</p>
</blockquote>
<p>机器指令方法的优点：</p>
<ul>
<li>适用于在单处理器或共享内存的多处理器上的任何数目的进程。</li>
<li>非常简单且易于实现。</li>
<li>可用于支持多个临界区，每个临界区可以用它自己的变量定义。</li>
</ul>
<p>机器指令方法的缺点：</p>
<ul>
<li>
<p>使用了忙等待：</p>
<p>当一个进程正在等待进入临界区时，它会继续消耗处理器时间。</p>
</li>
<li>
<p>可能导致饥饿：</p>
<p>当一个进程离开一个临界区并且有多个进程正在等待时，选择哪一个等待进程是任意的，因此，某些进程可能被无限期地拒绝进入。</p>
</li>
<li>
<p>可能导致死锁：</p>
<p>考虑单处理器中的下列情况。进程P1执行专门指令（如compare&amp;swap、exchange）并进入临界区，然后P1被中断并把处理器让给具有更高优先级的P2。如果P2试图使用同一资源，由于互斥机制，它将被拒绝访问。因此，它会进入忙等待循环。但是，由于P1比P2的优先级低，它将永远不会被调度执行。</p>
</li>
</ul>
<h2 id="信号量">信号量</h2>
<p><em>敲黑板！！！！（重点来啦！！！！</em></p>
<p>信号量是1965年由荷兰科学家迪杰斯特拉提出来的（数据结构最短路径算法的提出者），信号量的本质是一种数据结构，用来处理并发进程之间的互斥与同步的。</p>
<blockquote>
<p>在详细介绍信号量之前我们先了解一下常用的并发机制：</p>
<table>
<thead>
<tr>
<th>并发机制</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>信号量（Semaphore）</td>
<td>用于进程间传递信号的一个整数值。在信号量上只有三种操作可以进行，<strong>初始化</strong>、<strong>递减</strong>和<strong>增加</strong>，这三种操作都是原子操作。递减操作可以用于阻塞一个进程，增加操作可以用于解除阻塞一个进程。也称为<strong>计数信号量</strong>或<strong>一般信号量</strong></td>
</tr>
<tr>
<td>二元信号量（Binary semaphore）</td>
<td>只取0值和1值的信号量</td>
</tr>
<tr>
<td>互斥量（Mutex）</td>
<td>类似于二元信号量。关键区别在于为其加锁（设定值为0）的进程和为其解锁（设定值为1）的进程必须为同一个进程</td>
</tr>
<tr>
<td>条件变量（Condition variable）</td>
<td>一种数据类型。用于阻塞进程或者线程，直到特定的条件为真</td>
</tr>
<tr>
<td>管程（Monitor）</td>
<td>一种编程语言结构，在一个抽象数据类型中封装了变量、访问过程和初始化代码。管程的变量只能由管程自己的访问过程来访问，每次只能有一个进程在其中执行。访问过程即临界区。管程可以有一个等待进程队列</td>
</tr>
<tr>
<td>事件标志（Event flags）</td>
<td>作为同步机制的一个内存字。应用程序代码可以为标志中的每个位关联不同的事件。通过测试相关的一个或多个位，线程可以等待一个事件或多个事件。在全部的所需位都被设定（AND）或者至少一个位被设定（OR）之前线程会一直被阻塞</td>
</tr>
<tr>
<td>信箱/消息（Mailboxes/messages）</td>
<td>两个进程交换信息的一种方法，也可以用于同步</td>
</tr>
<tr>
<td>自旋锁（Spinlocks）</td>
<td>一种互斥机制，进程在一个无条件循环中执行，等待锁变量的值变为可用</td>
</tr>
</tbody>
</table>
</blockquote>
<h3 id="基本原理">基本原理</h3>
<p>两个或多个进程可以通过简单的信号进行合作，一个进程可以被迫在某一位置停止，直到它接收到一个特定的信号。（任何复杂的合作需求都可以通过适当的信号结构得到满足）</p>
<h3 id="信号量的结构">信号量的结构</h3>
<p>信号量的结构包括两个成员和两个原子操作：</p>
<ul>
<li>
<p>两个成员：</p>
<ul>
<li>整形变量count：我们可以对这个信号量进行初始化，用来表明共享资源的数目或者是进程执行的状态。</li>
<li>队列：用来存放因为使用了某种操作导致进程阻塞在该信号量的进程。</li>
</ul>
</li>
<li>
<p>两个原子操作：</p>
<ul>
<li><code>semWait(x)</code>: semWait 对 count 进行<strong>减一</strong>操作，如果操作结果为负数（<strong>小于零</strong>)，执行semWait 的进程会被阻塞到队列上；</li>
<li><code>semSingal(x)</code>:semsignal对count进行<strong>加一</strong>操作，如果执行后的结果<strong>小于等于零</strong>，会从阻塞队列的队首的进程出队，并变为就绪状态。</li>
</ul>
<blockquote>
<p>上面的概念定义了一般信号量的概念，下面还有几个衍生的概念：</p>
<ul>
<li>计数信号量：如果count的取值是整个整数空间；</li>
<li>二元信号量：如果count的取值仅限于0和1；</li>
<li>互斥信号量：如果信号量中的semWait和semSignal操作在一个进程之内；</li>
<li>强信号量：信号量中阻塞的进程拥有明确的出队队列；</li>
<li>弱信号量：阻塞进程的出队策略不明确（一会FIFO，一会基于优先级）</li>
</ul>
</blockquote>
</li>
</ul>
<p>说明：</p>
<p>对以上操作的解释如下：</p>
<ul>
<li>
<p>开始时，信号量的值为零或者是正数；</p>
</li>
<li>
<p>如果该值为正数，则该值等于发出semWait操作后可立即继续执行的进程的数量；</p>
</li>
<li>
<p>如果该值为零（或者由于初始化，或者由于有等于信号量初值的进程已经等待），则发出semWait操作的下一个进程会被阻塞，此时该信号量的值变为负值。（之后，每个后续的semWait操作都会使信号量的负值更大，）该负值等于正在等待解除阻塞的进程的数量；</p>
</li>
<li>
<p>在信号量为负值的情形下，每一个semSignal操作都会将等待进程中的一个进程解除阻塞。</p>
<blockquote>
<p>关于信号量定义的结论：</p>
<ul>
<li>通常，在进程对信号量减1之前，无法提前知道该信号量是否会被阻塞。</li>
<li>当进程对一个信号量加1之后，另一个进程会被唤醒，两个进程继续并发运行。而在一个单处理器系统中，同样无法知道哪一个进程会立即继续运行。</li>
<li>在向信号量发出信号后，不需要知道是否有另一个进程正在等待，被解除阻塞的进程数量或者没有或者是1个。</li>
</ul>
</blockquote>
</li>
</ul>
<h3 id="信号量的使用">信号量的使用</h3>
<p>如上文所述，引入信号量的的目的是实现同步互斥的，使用信号量的操作一般包含以下两个步骤：</p>
<ol>
<li>分析问题之间进程的关系和种类；</li>
<li>根据进程的关系定义信号量并实现；</li>
</ol>
<p>对于不同的关系，操作方法不同：</p>
<ul>
<li>对于互斥关系：
<ol>
<li>有几个临界资源，就定义几个信号量；</li>
<li>根据问题对信号进行初始化；</li>
<li>使用semWait和semSignal实现对信号量的互斥访问；</li>
</ol>
</li>
<li>对于同步关系（一个进程的执行是另外一个进程执行的先决条件）：
<ol>
<li>分析进程之间的同步关系，有几种关系就定义几个信号量；</li>
<li>根据问题的条件对信号量进行初始化；</li>
<li>调用semwait和semsinal实现同步；（一般两个操作不在相同的进程内）</li>
</ol>
</li>
</ul>
<h3 id="信号量原语的定义">信号量原语的定义</h3>
<p>以下代码给出了关于信号原语更规范的定义。（semWait和semsignal原语被假设是原子操作）</p>
<p>（非二元信号量常常也称为<strong>计数信号量</strong>或者<strong>一般信号量</strong>）</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*semaphore*/</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">semaphore</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> count;</span><br><span class="line">    queueType <span class="built_in">queue</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*semWait*/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">semWait</span><span class="params">(semaphore s)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    s.count--;</span><br><span class="line">    <span class="keyword">if</span> (s.count &lt; <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="comment">/*把当前进程插入到阻塞队列当中*/</span>;</span><br><span class="line">        <span class="comment">/*阻塞当前进程*/</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*semSignal*/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">semSignal</span><span class="params">(semaphore s)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    s.count++;</span><br><span class="line">    <span class="keyword">if</span> (s.count &lt;= <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="comment">/*把进程p从阻塞队列当中移除*/</span>;</span><br><span class="line">        <span class="comment">/*把进程p插入到就绪队列*/</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="二元信号量">二元信号量</h3>
<p>以下代码定义了信号量更为严格的形式，信号量的值只能为0或1。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*binary_semaphore*/</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">binary_semaphore</span>&#123;</span></span><br><span class="line">    <span class="class"><span class="keyword">enum</span> &#123;</span>zero, one&#125; value;</span><br><span class="line">    queueType <span class="built_in">queue</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*semWaitB*/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">semWaitB</span><span class="params">(binary_semaphore s)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (s.value == one)&#123;</span><br><span class="line">        s.value = zero;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">/*把当前进程插入到阻塞队列当中*/</span>;</span><br><span class="line">        <span class="comment">/*阻塞当前进程*/</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*semSignalB*/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">semSignalB</span><span class="params">(semaphore s)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (s.<span class="built_in">queue</span> is empty())&#123;</span><br><span class="line">        s.value = one;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">/*把进程p从阻塞队列中移除*/</span>;</span><br><span class="line">        <span class="comment">/*把进程p插入到就绪队列*/</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>说明：</p>
<ul>
<li>一个二元信号量可以初始化成0或1。</li>
<li>semWaitB操作检查信号的值，如果值为0，那么进程执行aemwaitB就会受阻。如果值为1，那么将值改变为0，并且继续执行该进程。</li>
<li>semSignalB操作检查是否有任何进程在该信号上受阻，如果有，那么通过semWaitB操作，受阻的进程就会被唤醒，如果没有进程受阻，那么值被设置为1。</li>
</ul>
</blockquote>
<h3 id="强、弱信号量">强、弱信号量</h3>
<p>不论是哪一种信号量，都需要使用队列来保存在信号量上等待的进程。这就会产生一个问题：进程按照什么顺序从队列中移出？</p>
<ul>
<li>
<p>强信号量：</p>
<p>最公平的策略是先进先出（FIFO）：被阻塞时间最久的进程最先从队列释放。采用这个策略定义的信号量称为强信号量（strong semaphore）。</p>
</li>
<li>
<p>弱信号量：</p>
<p>没有规定进程从队列中移出顺序的信号量称为弱信号量（weak semaphore）。</p>
</li>
</ul>
<p>下图将展示（强）信号量机制的一个例子：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E5%BC%BA%E4%BF%A1%E5%8F%B7%E9%87%8F.png" alt=""></p>
<blockquote>
<p>说明：</p>
<ul>
<li>初始时刻①，A正在运行，B、D和C就绪，信号量为1。当A执行一条semWait指令后，信号量减为0，A能继续执行，随后它加入就绪队列。</li>
<li>然后在时刻②时，B正在运行，最终执行一条semWait指令，并被挂起（此时信号量为-1）。</li>
<li>在时刻③时，D被允许运行。</li>
<li>在时刻④时，当D完成一个新结果后，它执行一条semSignal指令，允许B移到就绪队列中。</li>
<li>在时刻⑤时，D加入就绪队列，C开始运行，当它执行semWait指令时被挂起。</li>
<li>类似地，在时刻⑥，A和B运行，且被挂起在这个信号量上，允许D恢复执行。</li>
<li>在时刻⑦，当D有一个结果后，执行一条semSlgnal指令，把C移到就绪队列中。</li>
</ul>
</blockquote>
<h3 id="互斥">互斥</h3>
<p>以下代码给出了一种使用信号量s解决互斥问题的方法：</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*program mutualexclusion*/</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> n = <span class="comment">/*进程数*/</span>;</span><br><span class="line">semaphore s = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">P</span><span class="params">(<span class="keyword">int</span> i)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>)&#123;</span><br><span class="line">        semWait(s);</span><br><span class="line">        <span class="comment">/*临界区*/</span>;</span><br><span class="line">        semSignal(s);</span><br><span class="line">        <span class="comment">/*其他部分*/</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    parbegin (P(<span class="number">1</span>), P(<span class="number">2</span>),...,P(n)); <span class="comment">/*多进程并发执行*/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>说明：</p>
<p>设有n个进程，用数组P(i)表示，所有的进程都需要访问共享资源。每个进程中进入临界区前执行semWait(s)，如果s的值为负，则进程被挂起；如果值为1，则s被减为0，进程立即进人临界区；由于s不再为正，因而其他任何进程都不能进入临界区。</p>
<p>可以这样理解，当一个进程想要调用公共资源时，就要发出<code>semWait(s)</code>指令，以获取资源，如果获取不到，则一直调用该指令；一旦获取了该资源，则其他进程无法使用；等到该进程使用完资源后，就会调用<code>semSignal(s)</code>指令，告诉其它进程：“我用完啦，并且把资源交还回公共区域啦。”</p>
<ul>
<li><code>s.count ≥ 0</code>：s.count是可以执行semWait(s)而不被挂起的进程数（如果其间没有semSignal(a)被执行）。这种情形允许信号量支持同步与互斥。</li>
<li><code>s.count&lt;0</code>：s.count的大小是挂起在s.queue队列中的进程数.</li>
</ul>
<p>下图给出了信号量机制执行过程的另一种表述，这里不再说明（<em>看得懂，应该看得懂</em>）</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E4%BF%A1%E5%8F%B7%E9%87%8F%E8%AF%B4%E6%98%8E.png" alt=""></p>
</blockquote>
<h3 id="信号量问题">信号量问题</h3>
<p><em>（为了使得文章整体结构看起来不那么混乱，这里用另一篇文章去综合一些关于信号量的问题，点击下方按钮跳转）</em></p>
<div class="btn-center">
<a class="btn-beautify button--animated block outline orange larger" href="/2021/04/25/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E4%BF%A1%E5%8F%B7%E9%87%8F%E7%9B%B8%E5%85%B3%E9%97%AE%E9%A2%98/" 
  title="点击跳转 至 《信号量相关问题》"><i class="far fa-hand-point-right"></i><span>点击跳转 至 《信号量相关问题》</span></a>
</div>
<h3 id="信号量的实现">信号量的实现</h3>
<p><code>semWait</code>和<code>semSignal</code>操作必须作为原子原语实现。可以通过以下三种方式：</p>
<ul>
<li>通过硬件或固件实现。</li>
<li>通过软件方案实现。（这会伴随处理开销）</li>
<li>对于单处理器系统，可以通过禁用中断的方式实现。</li>
</ul>
<h2 id="管程">管程</h2>
<p>从上述内容可以看出信号量有效地提供了进程间互斥与合作的支持，但实际上信号量对于编写者来说是很困难的，用信号量设计一个正确的程序并非易事：由于信号量分布在整个程序中，使用不当，可能造成程序错误，甚至死锁。下面来看三个错误案例：</p>
<ul>
<li>
<p>错误一：在利用信号量互斥时，误将 semWait与semSignal的顺序颠倒：</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">semSignal(mutex)</span><br><span class="line"> critical area</span><br><span class="line">semWait(mutex)</span><br></pre></td></tr></table></figure>
<p>这会导致临界访问失效。</p>
</li>
<li>
<p>错误二：在实现互斥时，误将semSigal 写成semWait, 或误将semWait写成semSigal, 导致临界区无法访问，或者临界区被多次访问；</p>
</li>
<li>
<p>错误三: 实现互斥访问的时候，程序遗漏了semWait，操作临界区失效；</p>
</li>
</ul>
<p>基于这种情况，DJstra在1971年提出为每一个共享的资源设立一个秘书管理他的访问的思想。即：一切进程访问共享资源时，必须通过设立的秘书，秘书一次只允许一个进程访问共享资源，通过这种方式，即实现了资源的共享，同时也保证了资源的互斥访问与同步。1973年，汉森和霍尔又将秘书的概念发展成为管程。</p>
<p>管程定义了一组局部数据和内部操作，只有内部操作才能使用局部变量，访问管程的进程通过内部操作访问或修改内容数据，从而实现进程间的互斥与访问。</p>
<blockquote>
<p>管程允许程序员用其锁定任何对象（对类似于链表之类的对象，可以用一个锁锁住整个链表，也可以每个表用一个锁，还可以为表中的每一个元素用一个锁）。</p>
<p>管程天生具有排他性（互斥）。因此程序员只需要在管程当中解决好同步问题，互斥的工作可以完全交由编译器处理。</p>
<p>关于实现管程的同步的措施：</p>
<ol>
<li>一个进程调用管程内的内部操作进入管程后，在管程驻留期间，如果该进程要求的共享资源不满足进程执行的条件，需要将进程阻塞在阻塞队列上，并释放管程的使用权；</li>
<li>当阻塞进程等待的条件满足时，需要将该进程从阻塞队列中移除到就绪队列中，允许该进程能够再次进入管程执行。</li>
</ol>
<p>上述两种机制的实现时通过条件变量和两个内部操作<code>cwait</code> 和<code>csignal</code>实现的（下文将详细介绍）：</p>
<ol>
<li>在管程内设置若干条件变量用来区分不同的条件；</li>
<li>针对条件变量的两个操作 cwait和csignal,cwait 是用来将进程阻塞到对应的条件变量阻塞队列中，csignal是用来将进程从对应的阻塞队列中恢复到就绪队列。</li>
</ol>
</blockquote>
<p>管程本质上也是一种数据结构，包含5个部分：</p>
<ol>
<li>局部变量</li>
<li>内部过程</li>
<li>初始化操作</li>
<li>条件变量</li>
<li>阻塞队列</li>
</ol>
<p>管程具有三个特性：</p>
<ol>
<li>管程的内部数据只能被管程内部的操作访问；</li>
<li>一个进程只能通过管程的内部过程对管程进行访问；</li>
<li>每次最多允许一个进程使用管程的内部操作，即进程互斥的调用内部过程进入管程，其他想进入管程的进程必须在阻塞队列中等待。</li>
</ol>
<h3 id="使用信号的管程">使用信号的管程</h3>
<p>管程是由一个或多个过程、一个初始化序列和局部数据组成的软件模块，其主要特点如下：</p>
<ul>
<li>局部数据变量只能被管程的过程访问，任何外部过程都不能访问。</li>
<li>一个进程通过调用管程的一个过程进入管程。</li>
<li>在任何时候，只能有一个进程在管程中执行，调用管程的任何其他进程都被阻塞，以等待管程可用。</li>
</ul>
<p>为了进行并发处理，管程必须包含同步工具。</p>
<blockquote>
<p>例如，假设一个进程调用了管程，并且当它在管程中时必须被挂起，直到满足某些条件。这就需要一种机制，使得该进程不仅被挂起，而且能释放这个管程，以便某些其他的进程可以进入。以后，当条件满足并且管程再次可用时，需要恢复该进程并允许它在挂起点重新进入管程。</p>
</blockquote>
<p>管程通过使用条件变量提供对同步的支持，这些条件变量包含在管程中，并且只有在管程中才能被访问。有两个函数可以操作条件变量：</p>
<ul>
<li>
<p><code>cwait(c)</code>：调用进程的执行在条件c上挂起，管程现在可被另一个进程使用。</p>
</li>
<li>
<p><code>csignal(c)</code>：恢复执行在cwait之后因为某些条件而挂起的进程。如果有多个这样的进程，选择其中一个；如果没有这样的进程，什么也不做。</p>
<blockquote>
<p>注意管程的<code>wait</code>和<code>signal</code>操作与信号量不同：</p>
<p>如果在管程中的一个进程发信号，但没有在这个条件变量上等待的任务，则丢弃这个信号。</p>
</blockquote>
</li>
</ul>
<p>下图给出了一个管程的结构：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E7%AE%A1%E7%A8%8B.png" alt=""></p>
<blockquote>
<p>说明：</p>
<p>尽管一个进程可以通过调用管程的任何一个过程进入管程，但我们仍可以把管程想像成具有一个入口点，并保证一次只有一个进程可以进入。其他试图进入管程的进程被阻塞并加入等待管程可用的进程队列中。当一个进程在管程中时，它可能会通过发送cwalt(x)<br>
把自己暂时阻塞在条件x上，随后它被放入等待条件改变以重新进入管程的进程队列中，在cwalt(x)调用的下一条指令开始恢复执行。</p>
<p>如果在管程中执行的一个进程发现条件变量x发生了变化，它发送csignal(x)，通知相应的条件队列条件已改变。</p>
</blockquote>
<p>以下代码给出了一个使用管程的例子，再次考虑生产者/消费者问题：</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*program producerconsumer*/</span></span><br><span class="line">monitor boundedbuffer;          </span><br><span class="line"><span class="keyword">char</span> buffer [N];          <span class="comment">/*分配N个数据项空间*/</span></span><br><span class="line"><span class="keyword">int</span> nextin, nextout;          <span class="comment">/*缓冲区指针*/</span></span><br><span class="line"><span class="keyword">int</span> count;          <span class="comment">/*缓冲区中数据项个数*/</span></span><br><span class="line">cond notfull, notempty;          <span class="comment">/*为同步设置的条件变量*/</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">append</span><span class="params">(<span class="keyword">char</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (count == N)&#123;</span><br><span class="line">        cwait(notfull);          <span class="comment">/*缓冲区满，防止溢出*/</span></span><br><span class="line">    &#125;</span><br><span class="line">    buffer[nextin] = x;</span><br><span class="line">    nextin = (nextin + <span class="number">1</span>) % N;</span><br><span class="line">    count++;</span><br><span class="line">    <span class="comment">/*缓冲区中数据项个数加一*/</span></span><br><span class="line">    csignal(nonempty);          <span class="comment">/*释放任何一个等待的进程*/</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">take</span><span class="params">(<span class="keyword">char</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (count == <span class="number">0</span>)&#123;</span><br><span class="line">        cwait(notempty);          <span class="comment">/*缓冲区空，防止下溢*/</span></span><br><span class="line">    &#125;</span><br><span class="line">    x = buffer[nextout];</span><br><span class="line">    nextout = (nextout + <span class="number">1</span>) % N;</span><br><span class="line">    count--;          <span class="comment">/*缓冲区中数据项个数减一*/</span></span><br><span class="line">    csignal(notfull);          <span class="comment">/*释放任何一个等待的进程*/</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#123;          <span class="comment">/*管程体*/</span></span><br><span class="line">    nextin = <span class="number">0</span>; nextout = <span class="number">0</span>; count = <span class="number">0</span>;          <span class="comment">/*缓冲区初始化为空*/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*producer*/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">producer</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> x;</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>)&#123;</span><br><span class="line">        produce(x);</span><br><span class="line">        append(x);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*consumer*/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">consumer</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> x;</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>)&#123;</span><br><span class="line">        take(x);</span><br><span class="line">        consume(x);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    parbegin(producer, consumer);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>说明：</p>
<p>管程模块boundedbuffer控制着用于保存和取回字符的缓冲区，管程中有两个条件变量（使用结构cond声明）：当缓冲区中至少有增加一个字符的空间时，notfull为真；当缓冲区中至少有一个字符时，notempty为真。</p>
<p>生产者可以通过管程中的过程append往缓冲区中增加字符，它不能直接访问buffer。该过程首先检查条件notfiull，以确定缓冲区是否还有可用空间。如果没有，执行管程的进程在这个条件上被阻塞。其他某个进程（生产者或消费者）现在可以进入管程。然后，当缓冲区不再满时，被阻塞进程可以从队列中移出，重新被激活，并恢复处理。在往缓冲区中放置了一个字符后，该进程发送notempty条件信号。对消费者函数也可以进行类似的描述。</p>
</blockquote>
<h3 id="使用通知和广播的管程">使用通知和广播的管程</h3>
<p>Hoare关于管程的定义[HOAR74]要求在条件队列中至少有一个进程，当另一个进程为该条件产生caigna1时，该队列中的一个进程立即运行。因此，产生caigna1的进程必须立即退出管程，或者阻塞在管程上。</p>
<p>这种方法有两个缺陷：</p>
<ul>
<li>如果产生csignal的进程在管程内还没有结束，则需要两个额外的进程切换：阻塞这个进程需要一次切换，当管程可用时恢复这个进程又需要一次切换。</li>
<li>与信号相关的进程调度必须非常可靠。当产生一个csignal时，来自相应条件队列中的一个进程必须立即被激活，调度程序必须确保在激活前没有其他进程进入管程，否则，进程被激活的条件又会改变。</li>
</ul>
<p>因此又开发出了一种不同的管程以解决以上问题：</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">append</span><span class="params">(<span class="keyword">char</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (count == N)&#123;</span><br><span class="line">        cwait(notfull);          <span class="comment">/*缓冲区满，防止溢出*/</span></span><br><span class="line">    &#125;</span><br><span class="line">    buffer[nextin] = x;</span><br><span class="line">    nextin = (nextin + <span class="number">1</span>) % N;</span><br><span class="line">    count++;          <span class="comment">/*缓冲区中数据项个数加一*/</span></span><br><span class="line">    cnotify(notempty);          <span class="comment">/*通知正在等待的进程*/</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">take</span><span class="params">(<span class="keyword">char</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (count == <span class="number">0</span>)&#123;</span><br><span class="line">        cwait(notempty);          <span class="comment">/*缓冲区空，防止下溢*/</span></span><br><span class="line">    &#125;</span><br><span class="line">    x = buffer[nextout];</span><br><span class="line">    nextout = (nextout + <span class="number">1</span>) % N;</span><br><span class="line">    count--;          <span class="comment">/*缓冲区中数据项个数减一*/</span></span><br><span class="line">    cnotify(notfull);          <span class="comment">/*通知正在等待的进程*/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>说明：</p>
<p>csignal原语被 cnotify取代。当一个正在管程中的进程执行cnotify(x)时，它使得x条件队列得到通知，但发信号的进程继续执行。通知的结果是使得位于条件队列头的进程在将来合适的时候且当处理器可用时被恢复执行。但是，由于不能保证在它之前没有其他进程进入管程，因而这个等待进程必须重新检查条件。</p>
<p>if语句被 while循环取代，因此，这个方案导致对条件变量至少多一次额外的检测。作为回报，它不再有额外的进程切换，并且对等待进程在cnotify之后什么时候运行没有任何限制。</p>
</blockquote>
<h2 id="消息传递">消息传递</h2>
<p>进程交互式，必须满足两个基本要求：同步和通信。为实施互斥，进程间需要同步；为了合作，进程间需要交换信息。之前介绍的两种机制（信号量以及管程）可以在单处理器系统以及多处理器系统中实现，但是对于分布式系统而言，没有办法提供支持。此外，管程对编译器有依赖，而很多编程语言的编译器并没有提供对管程的支持（比如gcc）。为此，引入了消息传递。</p>
<p>消息传递的实际功能以一对原语的形式提供：</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">send(destination, message)</span><br><span class="line">receive(source, message)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>说明：</p>
<p>这是进程间进行消息传递所需要的最小操作集。一个进程以消息(message)的形式给另一个指定的目标(destination)进程发送信息；进程通过执行receive原语接收信息，receive原语中指明发送消息的源进程(source)和消息。</p>
<p>send与receive操作既可以是阻塞操作也可以是非阻塞操作：</p>
<ul>
<li>
<p>阻塞操作：在执行一个指令时，在获得这个指令的结果之前，程序不得向下推进；</p>
</li>
<li>
<p>非阻塞操作：在执行一个指令时，在调用这条指令后，不待指令的结果返回，程序可以立即执行下一条指令的操作方式成为非阻塞方。</p>
</li>
</ul>
<blockquote>
<p>因此对于阻塞send 而言，当程序调用了这条指令后，在send中的消息传送给指定进程之前，程序始终停留在send指令上，不向后推进；</p>
<p>而对于非阻塞send,当程序调用这条指令后，指令马上返回，立即执行后面的指令；</p>
<p>同理，对于receive也是如此，阻塞的receive在收到消息之前，程序停留在这条指令之上不会向下执行，非阻塞receive则是调用指令后，立即向下执行。</p>
</blockquote>
</blockquote>
<h3 id="同步（Synchronization）">同步（Synchronization）</h3>
<p>两个进程间的消息通信隐含着某种同步的信息：只有当一个进程发送消息之后，接收者才能接收消息。</p>
<p>当一个进程执行时，在它发送<code>send</code>或<code>receive</code>原语时，都有阻塞或不阻塞两种状态，因此会有如下四种组合：</p>
<ul>
<li>
<p>无阻塞send，无阻塞receive：</p>
<p>等待消息接收，收到消息后继续执行。</p>
</li>
<li>
<p>阻塞send，阻塞receive：</p>
<p>发送者和接收者都被阻塞，直到信息被送达。（这种情况有时也称做会合(rendezvous)，它考虑到了进程间的紧密同步。）</p>
</li>
<li>
<p>无阻塞send，阻塞receive：</p>
<p>发送者可以继续，但接收者被阻塞直到请求的消息到达。</p>
<blockquote>
<p>这可能是最有用的一种组合，它允许一个进程给各个目标进程尽快地发送一条或多条消息。在继续工作前必须接收到消息的进程将被阻塞，直到这个消息到达。例如，一个服务器进程给其他进程提供服务或资源。</p>
</blockquote>
</li>
<li>
<p>阻塞send，无阻塞receive：</p>
<p>不要求任何一方等待。</p>
</li>
</ul>
<p>对于大多数并发程序设计任务来说：</p>
<ul>
<li>
<p>无阻塞send是最自然的：</p>
<blockquote>
<p>例如，无阻塞send用于请求一个输出操作，如打印，它允许请求进程以消息的形式发出请求，然后继续。无阻塞send存在一个潜在的危险：错误会导致进程重复地产生消息。由于对进程没有阻塞的要求，这些消息可能会消耗系统资源，包括处理器时间和缓冲区空间，从而损害其他进程和操作系统。同时，无阻塞send给程序员增加了负担，由于必须确定消息是否收到，因而进程必须使用应答消息，以证实收到了消息。</p>
</blockquote>
</li>
<li>
<p>阻塞receive是最自然的：</p>
<blockquote>
<p>通常，请求一个消息的进程都需要这个期望的信息才能继续执行下去，但是，如果消息丢失了（这在分布式系统中很可能发生），或者一个进程在发送预期的消息之前失败了，那么接收进程将会无限期地被阻塞下去。这个问题可以通过使用无阻塞receive来解决。但是，该方法的危险是，如果消息的发送在一个进程已经执行了与之相匹配的receive之后，该消息将被丢失。其他可能的方法是允许一个进程在发出receive之前检测是否有消息正在等待，或者允许进程在receive原语中确定多个源进程。如果一个进程正在等待从多个源进程发送来的消息，并且只要有一个消息到达就可以继续下去时，后一种方法是非常有用的。</p>
</blockquote>
</li>
</ul>
<h3 id="寻址（Addressing）">寻址（Addressing）</h3>
<p>显然，在send原语中确定哪个进程接收消息是很有必要的。同样，大多数实现允许接收进程指明消息的来源。</p>
<p>在send和receive原语中确定目标或源进程的方案可分为两类：<strong>直接寻址</strong>（direct addressing）和<strong>间接寻址</strong>（indirect addressing）。</p>
<ul>
<li>
<p>直接寻址：</p>
<p>send原语包含目标进程的标识符，而receive原语有两种处理方式：</p>
<ul>
<li>显示寻址：一个进程必须事先知道希望得到来自哪个源进程的消息，这种方式对于处理并发进程间的合作是非常有效的。</li>
<li>隐式寻址：例如打印机服务器进程将接受来自各个进程的打印请求，对这类应用使用隐式寻址更为有效。（不可能指定所期望的源进程）</li>
</ul>
</li>
<li>
<p>间接寻址：</p>
<p>在这种情况，消息不是直接从发送者发送到接收者，而是发送到一个共享数据结构，该结构由临时保存消息的队列组成，这些队列通常称为<strong>邮箱(mailbox)</strong>。因此，对两个通信进程，一个进程给合适的邮箱发送消息，另一个从邮箱中获得这些消息。</p>
<blockquote>
<p>间接寻址通过解除发送者和接收者之间的耦合关系，在消息的使用上允许更大的灵活性。发送者和接收者之间的关系可以是一对一、多对一、一对多或多对多（如下图）。</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OSAddressing.png" alt=""></p>
<ul>
<li>一对一的关系允许在两个进程间建立专用的通信链接，这可以把它们之间的交互隔离起来，避免其他进程的错误干扰；</li>
<li>多对一的关系对客户/服务器间的交互非常有用，一个进程给许多别的进程提供服务，这时，信箱常常称为一个端口（port）；</li>
<li>一对多的关系适用于一个发送者和多个接收者，它对于在一组进程间广播一条消息或某些信息的应用程序非常有用；</li>
<li>多对多的关系使得多个服务进程可以对多个客户进程提供服务。</li>
</ul>
<p>进程和信箱的关联可以是静态的，也可以是动态的。端口常常是静态地关联到一个特定的进程上，也就是说，端口是被永久地创建并指定到该进程。（在一对一的关系中就是典型的静态和永久性的关系）</p>
</blockquote>
</li>
</ul>
<h3 id="消息格式">消息格式</h3>
<p>消息的格式取决于消息机制的目标以及该机制是运行在一台计算机上还是分布式系统中。</p>
<blockquote>
<p>对某些操作系统，设计者优先选用短的、固定长度的消息，以减少处理和存储的开销。如果需要传递大量的数据，数据可以放置到一个文件中，消息可以简单地引用该文件。一种更灵活的方法是允许可变长度的消息。</p>
</blockquote>
<p>下图给出了一种操作系统的支持可变长度消息的典型消息格式：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/OS%E6%B6%88%E6%81%AF%E6%A0%BC%E5%BC%8F.png" alt=""></p>
<blockquote>
<p>该消息被划分成两部分：包含相关信息的消息头和包含实际内容的消息体。</p>
<ul>
<li>消息头用来存放用于控制消息传递的信息。</li>
<li>消息体用来存放进程间进程间通讯的内容。</li>
</ul>
<p>消息头可以包含消息的源和目标的标识符、长度域和判定各种消息类型的类型域，还可能含有一些额外的控制信息。（例如用于创建消息链表的指针域、记录源和目标之间传递的消息的数目、顺序和序号，以及一个优先级域）</p>
</blockquote>
<h3 id="排队原则">排队原则</h3>
<p>最简单的排队原则是先进先出原则，但是当某些消息比其他消息更紧急时，仅有这种原则是不够的。一个可选的原则是允许指定消息的优先级，这可以基于消息的类型或者由发送者指定，另一种选择是允许接收者检查消息队列并选择下一次接收哪个消息。</p>
<h3 id="互斥-2">互斥</h3>
<p>以下代码给出了可用于实施互斥的消息传递方式：</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*program mutualexclusion*/</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> n = <span class="comment">/*进程数*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> p(<span class="keyword">int</span> i)</span><br><span class="line">&#123;</span><br><span class="line">    message msg;</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>)&#123;</span><br><span class="line">        receive (box, msg);</span><br><span class="line">        <span class="comment">/*临界区*/</span>;</span><br><span class="line">        send (box, msg);</span><br><span class="line">        <span class="comment">/*其他部分*/</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">creat <span class="title">mailbox</span> <span class="params">(box)</span></span>;</span><br><span class="line">    send (box, null);</span><br><span class="line">    prabeginc(P(<span class="number">1</span>), P(<span class="number">2</span>),...,P(n));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>说明：</p>
<p>假设使用阻塞 receive原语和无阻塞 send原语，一组并发进程共享一个信箱box，它可供所有进程在发送和接收消息时使用，该信箱被初始化成一个无内容的消息。希望进人临界区的进程首先试图接收一条消息，如果信箱为空，则该进程被阻塞；一旦进程获得消息，它执行它的临界区，然后把该消息放回信箱。因此，消息函数可以看做是在进程之间传递的一个令牌。</p>
<p>上面的解决方案假设有多个进程并发地执行接收操作，则：</p>
<ul>
<li>如果有一条消息，它仅仅被传递给一个进程，其他进程被阻塞。</li>
<li>如果消息队列为空，所有进程被阻塞；当有一条消息可用时，只有一个阻塞进程被激活，并得到这条消息。</li>
</ul>
</blockquote>
<p>作为使用消息传递的另一个例子，以下代码是解决有界缓冲区生产者/消费者问题的一种方法：</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">int</span></span><br><span class="line">    capacity = <span class="comment">/*缓冲区容量*/</span></span><br><span class="line">    null = <span class="comment">/*空消息*/</span></span><br><span class="line"><span class="keyword">int</span> i;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*producer*/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">producer</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    message pmsg;</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>)&#123;</span><br><span class="line">        receive (mayproduce, pmsg);</span><br><span class="line">        pmsg = produce();</span><br><span class="line">        send (mayconsume, pmsg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*consumer*/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">consumer</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    message cmsg;</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>)&#123;</span><br><span class="line">        receive (mayconsume, cmsg);</span><br><span class="line">        consume (cmsg);</span><br><span class="line">        send (mayproduce, null);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    create_mailbox (mayproduce);</span><br><span class="line">    create_mailbox (mayconsume);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= capacity; i++)&#123;</span><br><span class="line">        send (mayproduce, null);</span><br><span class="line">    &#125;</span><br><span class="line">    parbegin (producer, consumer);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>说明：</p>
<p>它使用了两个信箱。当生产者产生了数据，它作为消息被发送到信箱mayconsume，只要该信箱中有一条消息，消费者就可以开始消费。从此之后mayconsume作为缓冲区，缓冲区中的数据被组织成消息队列，缓冲区的大小由全局变量capacity确定。信箱mayproduce最初填满了空消息，空消息的数量等于信箱的容量，每次生产使得mayproduce中的消息数缩小，每次消费使得mayproduce中的消息数增长。</p>
<p>这种方法非常灵活，可以有多个生产者和消费者，只要它们都访问这两个信箱即可。系统甚至可以是分布式系统，所有生产者进程和mayproduce信箱在一个站点上，所有消费者进程和mayconsume信箱在另一个站点上。</p>
</blockquote>
<hr>
<h1>后记</h1>
<p>本篇已完结</p>
<p>（如有修改或补充欢迎评论）</p>
]]></content>
      <categories>
        <category>学习笔记</category>
      </categories>
      <tags>
        <tag>操作系统</tag>
      </tags>
  </entry>
  <entry>
    <title>计算机网络学习笔记-应用层</title>
    <url>/2021/04/05/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E5%BA%94%E7%94%A8%E5%B1%82/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\css\APlayer.min.css"><script src="\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\js\Meting.min.js"></script><h1>前言</h1>
<p><em>正在学习计算机网络这门课程，顺便做个笔记，记录一下知识点。</em></p>
<blockquote>
<p>参考资料：</p>
<p>中科大郑烇老师全套《计算机网络（自顶向下方法 第7版，James F.Kurose，Keith W.Ross）》课程：<a href="https://www.bilibili.com/video/BV1JV411t7ow?p=1">https://www.bilibili.com/video/BV1JV411t7ow?p=1</a></p>
<p>《计算机网络（自顶向下方法 第7版，James F.Kurose，Keith W.Ross）》</p>
</blockquote>
<hr>
<h1>第二章：应用层</h1>
<blockquote>
<p>互联网层次中，应用层的协议是最多的。</p>
</blockquote>
<p>网络应用的原理：网络应用协议的概念和实现方面</p>
<ul>
<li>运输层的服务模型（transport-layer service models）</li>
<li>客户/服务器模式（client-server paradigm）</li>
<li>P2P模式（peer-to-peer paradigm）</li>
</ul>
<p>网络应用的实例：互联网流行的应用层协议</p>
<ul>
<li>HTTP</li>
<li>FTP</li>
<li>SMTP / POP3 / IMAP</li>
<li>DNS</li>
</ul>
<p>编程：网络应用程序创建</p>
<ul>
<li>socket API  / E-mail / web / instant messaging: (QQ), Wechat (即时消息) / remote login (远程登录) /  P2P file sharing (文件共享) / multi-user network games (多用户网络游戏) / streaming stored video clips (流式存储视频) / Social networks (社交网络) / voice over IP (IP电话) / real-time video conferencing (实时视频会议) / grid computing/Cloud computing (网格计算/云计算)</li>
</ul>
<p>创建一个新的网络应用：</p>
<ul>
<li>编程：
<ul>
<li>在不同的端系统上运行（run on different end systems）</li>
<li>通过网络基础设施提供的服务，应用进程彼此通信（communicate over network）</li>
<li>例如：Web服务器软件与浏览器软件通信（web server software communicates with browser software）</li>
</ul>
</li>
<li>无需为网络核心设备编写程序（no need to write software for networkcore devices）：
<ul>
<li>网络核心不会运行用户应用（network core devices do not run user applications）</li>
<li>网络应用只在端系统上存在 ，快速网络应用开发和部署（applications on end systems allows for rapid app development, propagation）</li>
</ul>
</li>
</ul>
<h2 id="应用层协议原理（Principles-of-network-applications）">应用层协议原理（Principles of network applications）</h2>
<p>可能的应用架构：</p>
<ul>
<li>
<p>客户-服务器模式（C/S:client/server）</p>
</li>
<li>
<p>对等模式（P2P:Peer To Peer）</p>
</li>
<li>
<p>混合体：客户-服务器和对等体系结构</p>
<blockquote>
<p>浏览器/服务器模式（B/S：Brower/Server）是C/S架构的一种特例</p>
</blockquote>
</li>
</ul>
<h3 id="客户-服务器（C-S）体系结构">客户-服务器（C/S）体系结构</h3>
<p>服务器：</p>
<ul>
<li>一直在运行</li>
<li>固定的IP地址和周知的端口号（约定）</li>
<li>服务器是数据中心（包括软件资源，硬件资源，数据资源）</li>
<li>扩展性差（性能在访问数量达到一定程度时会出现断崖式下跌）</li>
</ul>
<p>客户端：</p>
<ul>
<li>主动与服务器连接（服务器先运行，客户端后访问）</li>
<li>与互联网有间歇性的连接</li>
<li>可能是动态IP地址</li>
<li>不直接与其他客户端通信</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CNCS%E6%9E%B6%E6%9E%84.png" alt=""></p>
<h3 id="对等体（P2P）体系结构">对等体（P2P）体系结构</h3>
<ul>
<li>
<p>（几乎）没有一直运行的服务器</p>
</li>
<li>
<p>任意端系统之间可以进行通信</p>
</li>
<li>
<p>每一个节点既是客户端又是服务器</p>
<p>自扩展性：新peer节点带来新的服务能力，当然也带来新的服务请求</p>
</li>
<li>
<p>参与的主机间歇性连接且可以改变IP地址</p>
<p>带来的问题就是：难以管理</p>
</li>
<li>
<p>实例：迅雷</p>
</li>
</ul>
<h3 id="C-S和P2P体系结构的混合体">C/S和P2P体系结构的混合体</h3>
<p>Skype：</p>
<ul>
<li>
<p>文件（目录）查询：集中式</p>
<p>存在一个中心服务器</p>
</li>
<li>
<p>文件分发（传输）：P2P</p>
<p>客户端连接可以不通过服务器直接连接</p>
</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CNP2P%E6%9E%B6%E6%9E%84.png" alt=""></p>
<p>即时通讯（以QQ为例）：</p>
<ul>
<li>两个用户之间的聊天是P2P方式</li>
<li>当用户上线时，向中心服务器注册其IP地址</li>
<li>用户通过中心服务器找到好友IP地址</li>
</ul>
<h3 id="进程通信（Processes-communicating）">进程通信（Processes communicating）</h3>
<p>进程：在主机上运行的应用程序</p>
<p>进程间的通信：</p>
<ul>
<li>
<p>在同一个主机内：使用进程间通信机制通信（ 操作系统定义），无需协议。</p>
</li>
<li>
<p>在不同主机内：通过交换报文（Message）来通信。</p>
<ul>
<li>使用OS提供的通信服务</li>
<li>借助传输层提供的服务，按照应用协议交换报文</li>
</ul>
<blockquote>
<p>客户端进程：发起通信的进程</p>
<p>服务器进程：等待连接的进程</p>
<p>注意：P2P架构的应用也有客户端进程和服务器进程之分</p>
</blockquote>
</li>
</ul>
<p>分布式进程通信需要解决的问题：</p>
<ul>
<li>问题1：进程标识（自身）和寻址（让对方找得到自己）问题。</li>
<li>问题2：传输层-应用层是如何提供通信服务。
<ul>
<li>位置：层间界面的SAP（TCP/IP ：socket）</li>
<li>形式：应用程序接口API（TCP/IP ：socket API）</li>
</ul>
</li>
<li>问题3：：如何使用传输层提供的服务，实现应用进程间的报文交换，实现应用。
<ul>
<li>定义应用层协议：报文格式，解释，时序等</li>
<li>编制程序，使用OS提供的API ，调用网络基础设施提供通信服务传报文，实现应用时序等；</li>
</ul>
</li>
</ul>
<p>问题1：对进程进行编址：</p>
<ul>
<li>
<p>进程为了接收报文，必须有一个标识，即：SAP（当然发送也需要标识）</p>
<ul>
<li>
<p>主机IP：唯一的32位IP地址（仅仅有IP地址不能够唯一标示一个进程；在一台端系统上有很 多应用进程在运行）</p>
</li>
<li>
<p>所采用的传输层协议：TCP or UDP</p>
</li>
<li>
<p>端口号（Port Numbers）</p>
<p>一些知名端口号的例子：HTTP: TCP 80 Mail: TCP 25</p>
<p>TCP和UDP的端口号是不同的</p>
</li>
</ul>
</li>
<li>
<p>一个进程用IP地址和端口号（port）标识。</p>
</li>
<li>
<p>本质上，两个主机进程之间的通信是由2个端节点（end point）构成</p>
</li>
</ul>
<p>问题2：传输层-应用层提供的服务：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CN%E4%BC%A0%E8%BE%93%E5%B1%82%E5%BA%94%E7%94%A8%E5%B1%82.png" alt=""></p>
<ul>
<li>层间接口必须要携带的信息（3类）
<ul>
<li>要传输的报文（对于本层来说就是SDU）</li>
<li>谁传递的信息：本方应用进程的标识，即本方IP+TCP(UDP) 端口</li>
<li>信息要传递给谁：对方应用进程的标识，即对方IP+TCP(UDP) 端口</li>
</ul>
</li>
<li>传输层实体（tcp或者udp实体）根据这些信息进行TCP报文段（UDP报文段）的封装
<ul>
<li>源端口号，目标端口号，数据等</li>
<li>将IP地址往下交IP实体，用于封装IP数据报：源IP,目标IP</li>
</ul>
</li>
</ul>
<h3 id="Socket（套接字）">Socket（套接字）</h3>
<p>进程通过套接字发送或接受报文。</p>
<p>可以把套接字比作一道门。发送进程将报文推出门户，发送进程依赖于传输层设施在另外一侧的门将报文交付给接收进程，同样的，接收进程从另外一端的门户收到报文（依赖于传输层设施）</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CN%E5%A5%97%E6%8E%A5%E5%AD%97.png" alt=""></p>
<blockquote>
<p>传输层提供的服务-层间信息的代表：</p>
<p>层间建立连接后需要传输大量的信息，如果Socket API 每次传输报文，都携带如此多 的信息，太繁琐易错，不便于管理。为了解决这个问题，出现了Socket（套接字，实际上就是用一个整数表示两个应用实体之间的通信关系 ，是一个本地标识）。</p>
</blockquote>
<blockquote>
<p>TCP之上的套接字：</p>
<p>对于使用面向连接服务（TCP）的应用而言，套接字是4元组的一个具有本地意义的标识。</p>
<ul>
<li>4元组：源IP，源port，目标IP，目标port</li>
<li>唯一的指定了一个会话（2个进程之间的会话关系）</li>
<li>应用使用这个标示，与远程的应用进程通信</li>
<li>不必在每一个报文的发送都要指定这4元组</li>
<li>简单，便于管理</li>
</ul>
<p>UDP之上的套接字：</p>
<p>（由于UDP服务下的进程通信前不需要连接，前后报文都是独立传输的，且可能传输给不同的分布式进程。所以只能用一个整数表示本应用实体的标识。）</p>
<p>对于使用无连接服务（UDP）的应用而言，套 接字是2元组的一个具有本地意义的标识。</p>
<ul>
<li>2元组：源IP，源port</li>
<li>UDP套接字指定了应用所在的一个端节点（end point）</li>
<li>在发送数据报时，采用创建好的本地套接字（标识 ID），就不必在发送每个报文中指明自己所采用的 ip和port</li>
<li>但是在发送报文时，必须要指定对方的ip和udp port(另外一个端节点)</li>
</ul>
</blockquote>
<p>问题3：如何使用传输层提供的服务实现应用</p>
<ul>
<li>定义应用层协议：报文格式，解释，时序等</li>
<li>编制程序，通过API调用网络基础设施提供通信 服务传报文，解析报文，实现应用时序等</li>
</ul>
<p>应用层协议：</p>
<p>该协议定义了：运行在不同端系统上的应用进程如何相互交换报文。（仅仅规范了两个进程在通信中需要遵守的规则）</p>
<ul>
<li>
<p>交换的报文类型：请求和应答报文</p>
</li>
<li>
<p>各种报文类型的语法：报文中的各个字段及其描述</p>
</li>
<li>
<p>字段的语义：即字段取值的含义</p>
</li>
<li>
<p>进程何时、如何发送报文及对报文进行响应的规则</p>
<blockquote>
<p>应用协议仅仅是应用的一个组成部分。一个应用还包括用户界面，本地I/O操作，业务逻辑等</p>
</blockquote>
</li>
<li>
<p>公开协议：</p>
<ul>
<li>
<p>由RFC文档定义</p>
</li>
<li>
<p>允许互操作</p>
</li>
<li>
<p>举例：HTTP、SMTP</p>
</li>
</ul>
</li>
<li>
<p>私有协议（不公开）：例如：SKype、QQ、wechat</p>
</li>
</ul>
<p>应用需要传输层提供的服务：</p>
<ul>
<li>
<p>数据丢失率（Data loss）：</p>
<p>有些应用则要求100%的可靠数据传输（如文件），有些应用（如音频）能容忍 一定比例以下的数据丢失</p>
<blockquote>
<p>实际上在看视频时是会有丢帧的情况，我们无法察觉的原因是因为采用了一些掩盖技术：</p>
<p>比如第二帧的画面丢失，可以选择重放第一帧或第三帧，也可以计算并播放第一、三帧求和后取均值。</p>
</blockquote>
</li>
<li>
<p>延迟（Timing）：</p>
<p>一些应用出于有效性考虑，对数据传输有严格的时间限制（如：Internet 电话、交互式游戏）</p>
</li>
<li>
<p>吞吐（Throughput）</p>
<p>一些应用（如多媒体应用）必须需要最小限度的吞吐，从而使得应用能够有效运转。一些应用能充分利用可供使用的吞吐(“弹性应用”)</p>
</li>
<li>
<p>安全性（Security）</p>
<p>机密性、数据完整性、可认证性（鉴别）…</p>
</li>
</ul>
<p>下表是一些常见应用对传输服务的要求：</p>
<table>
<thead>
<tr>
<th>应用</th>
<th>数据丢失率</th>
<th>吞吐</th>
<th>时间敏感性</th>
</tr>
</thead>
<tbody>
<tr>
<td>文件传输</td>
<td>不能丢失</td>
<td>弹性</td>
<td>不</td>
</tr>
<tr>
<td>E-mail</td>
<td>不能丢失</td>
<td>弹性</td>
<td>不</td>
</tr>
<tr>
<td>Web 文档</td>
<td>不能丢失</td>
<td>弹性</td>
<td>不</td>
</tr>
<tr>
<td>实时音视频</td>
<td>容忍丢失</td>
<td>音频： 5kbps-1Mbps 视频：10kbps-5Mbps</td>
<td>是，100ms</td>
</tr>
<tr>
<td>存储音视频</td>
<td>容忍丢失</td>
<td>音频： 5kbps-1Mbps 视频：10kbps-5Mbps</td>
<td>是，几秒</td>
</tr>
<tr>
<td>交互式游戏</td>
<td>容忍丢失</td>
<td>几kbps ~10kbps</td>
<td>是，100ms</td>
</tr>
<tr>
<td>即时讯息</td>
<td>不能丢失</td>
<td>弹性</td>
<td>是和不是</td>
</tr>
</tbody>
</table>
<p>Internet传输层提供的服务：</p>
<ul>
<li>
<p>TCP服务：</p>
<ul>
<li>可靠的传输服务（不出错、不丢失、不乱序）</li>
<li>流量控制：发送方不会淹没接受方</li>
<li>拥塞控制：当网络出现拥塞时，能抑制发送方</li>
<li>不能提供的服务：延时保证、最小吞吐（带宽）保证和安全性</li>
<li>面向连接：要求在客户端进程和服务器进程之间建立连接</li>
</ul>
</li>
<li>
<p>UDP服务：</p>
<ul>
<li>
<p>不可靠数据传输</p>
</li>
<li>
<p>不提供的服务：可靠， 流量控制、拥塞控制、 延时、带宽保证、不建立连接</p>
<blockquote>
<p>UDP存在的必要性：</p>
<ul>
<li>能够区分不同的进程，而IP服务不能。（在IP提供的主机到主机/端到端功能的基础上，区分了主机的 应用进程）</li>
<li>无需建立连接：省去了建立连接时间，适合事务性的应用</li>
<li>不做可靠性的工作：例如检错重发，适合那些对实时性要求比较高而对正确性要求不高的应用。（实现可靠性是必须要付出时间代价的）</li>
<li>没有拥塞控制和流量控制：应用能够按照设定的速度发送数据。（在TCP上面的应用，应用发送数据的速度和主机向网络发送的实际速度是不一致的，因为有流量控制和拥塞控制）</li>
</ul>
</blockquote>
</li>
</ul>
</li>
</ul>
<p>下表展示了Internet应用及其应用层协议和传输协议</p>
<table>
<thead>
<tr>
<th>应用</th>
<th>应用层协议</th>
<th>下层的传输协议</th>
</tr>
</thead>
<tbody>
<tr>
<td>E-mail</td>
<td>SMTP [RFC 2821]</td>
<td>TCP</td>
</tr>
<tr>
<td>远程终端访问</td>
<td>Telnet [RFC 854]</td>
<td>TCP</td>
</tr>
<tr>
<td>Web</td>
<td>HTTP [RFC 2616]</td>
<td>TCP</td>
</tr>
<tr>
<td>文件传输</td>
<td>FTP [RFC 959]</td>
<td>TCP</td>
</tr>
<tr>
<td>流媒体</td>
<td>专用协议 (如RealNetworks)</td>
<td>TCP 或 UDP</td>
</tr>
<tr>
<td>Internet电话</td>
<td>专用协议 (如Net2Phone)</td>
<td>TCP 或 UDP</td>
</tr>
</tbody>
</table>
<p>安全TCP</p>
<ul>
<li>
<p>TCP&amp;UDP</p>
<ul>
<li>都没有加密</li>
<li>明文通过互联网传输 ，甚至密码</li>
</ul>
</li>
<li>
<p>SSL</p>
<ul>
<li>在TCP上面实现，提供加密的TCP连接（https://）</li>
<li>私密性</li>
<li>数据完整性</li>
<li>端到端的鉴别/认证</li>
</ul>
</li>
<li>
<p>SSL在应用层</p>
<ul>
<li>应用采用SSL库，SSL库使用TCP通信</li>
</ul>
</li>
<li>
<p>SSL socket API</p>
<p>应用通过API将明文交给socket，SSL将其加密在互联网上传输</p>
</li>
</ul>
<h2 id="Web-and-HTTP">Web and HTTP</h2>
<p>一些术语：</p>
<ul>
<li>
<p>Web页：由一些对象组成。（对象可以是HTML文件、JPEG图像、Java小程序、声 音剪辑文件等）</p>
</li>
<li>
<p>Web页含有一个基本的HTML文件，该基本HTML文件又包含若干对象的引用（链接）</p>
</li>
<li>
<p>通过URL对每个对象进行引用</p>
<p>包含访问协议，用户名，口令字，端口等；（如下图）</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CNURL.png" alt=""></p>
</li>
</ul>
<blockquote>
<p>一个网页通常是一个baseHTML文件，这个文件是HTML的形式，浏览器可以解析。其中包含各种对象，但是并不包括对象本身，而是这个对象的引用链接。（浏览器需要判断这个链接，并且去再次访问这个对象链接，从而将对象本身访问到并展示在baseHTML页面上）</p>
</blockquote>
<h3 id="HTTP（hypertext-transfer-protocol）：超文本传输协议">HTTP（hypertext transfer protocol）：超文本传输协议</h3>
<ul>
<li>
<p>Web的应用层协议</p>
</li>
<li>
<p>客户/服务器模式（C/S）</p>
<p>客户: 请求、接收和显示 Web对象的浏览器。</p>
<p>服务器: 对请求进行响应， 发送对象的Web服务器。</p>
<blockquote>
<ul>
<li>HTTP/1.0 : RFC 1945（1996年）</li>
<li>HTTP/1.1 : RFC 2616（1999年）</li>
<li>HTTP/2 : RFC 7540（2015年）、RFC 8740（2020年）</li>
</ul>
</blockquote>
</li>
<li>
<p>使用TCP：</p>
<ul>
<li>
<p>客户发起一个与服务器的TCP连接 (建立套接字) ，端口号为80。</p>
<blockquote>
<p>服务器在最初建立之时会有一个socket（waiting socket）守候在80端口。如果一个浏览器（客户端）向服务器建立连接，此时又会有一个socket（connection socket）产生（代表该服务器与客户端的会话关系）。</p>
<p>waiting socket比较特殊，作用就是等待其他浏览器（客户端）并发访问该服务器，而connection socket则表示会话关系，可以有多个。</p>
</blockquote>
</li>
<li>
<p>服务器接受客户的TCP连接</p>
</li>
<li>
<p>在浏览器(HTTP客户端)与 Web服务器(HTTP服务器server)交换HTTP报文(应用层协议报文)</p>
</li>
<li>
<p>TCP连接关闭</p>
</li>
</ul>
</li>
<li>
<p>HTTP是无状态的：服务器并不维护关于客户的任何信息（无状态的好处就是简单，不需要维护一些内容）</p>
<blockquote>
<p>无状态：客户端向服务器发送请求，服务器接收请求，并返回响应报文，断开连接，结束。（不知道该客户端之前有没有访问过，未来还会不会接着访问）</p>
</blockquote>
</li>
<li>
<p>非持久HTTP（Nonpersistent HTTP）连接</p>
<ul>
<li>
<p>最多只有一个对象在TCP连接上发送</p>
</li>
<li>
<p>下载多个对象需要多个TCP连接</p>
</li>
<li>
<p>HTTP/1.0使用非持久连接</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CN%E9%9D%9E%E6%8C%81%E4%B9%85HTTP.png" alt=""></p>
<blockquote>
<p>下图为非持久HTTP连接请求index.html以及10个jpeg图片对象的过程</p>
<p>（注：以下关于RTT的数量计算均基于此例）</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CN%E9%9D%9E%E6%8C%81%E4%B9%85HTTP%E8%BF%9E%E6%8E%A5.png" alt=""></p>
</blockquote>
</li>
</ul>
</li>
<li>
<p>持久HTTP（Persistent HTTP）连接</p>
<ul>
<li>
<p>多个对象可以在一个（在客户端和服务器之间的）TCP连接上传输</p>
</li>
<li>
<p>HTTP/1.1 默认使用持久连接</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CN%E6%8C%81%E4%B9%85HTTP.png" alt=""></p>
</li>
</ul>
</li>
</ul>
<h3 id="响应时间模型：">响应时间模型：</h3>
<ul>
<li>
<p><strong>RTT（往返时间，round-trip time）</strong>：一个小的分组从客户端到服务器，再回到客户端的时间（传输时间忽略）</p>
</li>
<li>
<p>响应时间：</p>
<ul>
<li>一个RTT用来发起TCP连接</li>
<li>一个 RTT用来HTTP请求并等待HTTP响应</li>
<li>文件传输时间</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CN%E5%93%8D%E5%BA%94%E6%97%B6%E9%97%B4%E6%A8%A1%E5%9E%8B.png" alt=""></p>
<blockquote>
<p>在非持久HTTP连接下请求一个文件（对象）的时间 = 2RTT + 传输时间</p>
</blockquote>
</li>
</ul>
<p>非持久HTTP的缺点：</p>
<ul>
<li>
<p>请求每个对象需要2个 RTT</p>
</li>
<li>
<p>操作系统必须为每个TCP连接分配资源</p>
</li>
<li>
<p>浏览器通常打开并行TCP连接 ，以获取引用对象</p>
<blockquote>
<p>并行连接，即同时开启多个连接请求不同对象。</p>
<p>1index.html + 10jpeg = 2RTT（建立连接） + 2RTT（并行请求对象） = 4RTT</p>
</blockquote>
</li>
</ul>
<p>持久HTTP（Persistent HTTP）连接：</p>
<ul>
<li>
<p>服务器在发送响应后，仍保持TCP连接</p>
</li>
<li>
<p>在相同客户端和服务器之间的后续请求和响应报文通过相同的连接进行传送</p>
</li>
<li>
<p>客户端在遇到一个引用对象的时候，就可以尽快发送该对象的请求</p>
</li>
<li>
<p>非流水方式的持久HTTP（Persistent without pipelining）：</p>
<ul>
<li>
<p>客户端只能在收到前一个响应后才能发出新的请求</p>
</li>
<li>
<p>每个引用对象需要一个RTT</p>
<blockquote>
<p>1index.html + 10jpeg = 2RTT（建立连接） + 10×1RTT（10jpeg） = 12RTT</p>
</blockquote>
</li>
</ul>
</li>
<li>
<p>流水方式的持久HTTP（Persistent with pipelining）：</p>
<ul>
<li>
<p>HTTP/1.1的默认模式</p>
</li>
<li>
<p>客户端遇到一个引用对象就立即产生一个请求</p>
</li>
<li>
<p>所有引用（小）对象基本上只用一个RTT时间就能满足</p>
<blockquote>
<p>1index.html + 10jpeg = 2RTT（建立连接） + 1RTT（10jpeg） = 3RTT</p>
</blockquote>
</li>
</ul>
</li>
</ul>
<h3 id="HTTP报文">HTTP报文</h3>
<p>有两种类型的HTTP报文：request（请求报文）、response（响应报文）。</p>
<ul>
<li>
<p>HTTP请求报文：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CNHTTP%E8%AF%B7%E6%B1%82%E6%8A%A5%E6%96%87.png" alt=""></p>
<p>请求报文的通用格式如下图：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CNHTTP%E8%AF%B7%E6%B1%82%E6%8A%A5%E6%96%87%E9%80%9A%E7%94%A8%E6%A0%BC%E5%BC%8F.png" alt=""></p>
<blockquote>
<p>提交表单有两种方式：</p>
<ul>
<li>Post方式：
<ul>
<li>网页通常包括表单输入</li>
<li>输入的数据放在实体(entity body )部分上传到服务器</li>
</ul>
</li>
<li>URL方式：
<ul>
<li>方法：GET方法</li>
<li>输入的数据放在URL中上传</li>
</ul>
</li>
</ul>
</blockquote>
<blockquote>
<p>方法类型：</p>
<ul>
<li>HTTP/1.0
<ul>
<li>GET</li>
<li>POST</li>
<li>HEAD（要求服务器在响应报文中不包含请求对象→维护或者建立索引时引用）</li>
</ul>
</li>
<li>HTTP/1.1
<ul>
<li>GET, POST, HEAD</li>
<li>PUT（将实体中的文件上载到URL字段规定的路径→通常做网页内容的维护）</li>
<li>DELETE（删除URL字段规定的文件）</li>
</ul>
</li>
</ul>
</blockquote>
</li>
<li>
<p>HTTP响应报文：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CNHTTP%E5%93%8D%E5%BA%94%E6%8A%A5%E6%96%87.png" alt=""></p>
<blockquote>
<p>HTTP响应状态码：</p>
<ul>
<li>200 OK：请求成功，请求对象包含在响应报文的后续部分。</li>
<li>301 Moved Permanently：请求的对象已经被永久转移了；新的URL在响应报文的Location: 首部行中指定。客户端软件自动用新的URL去获取对象。</li>
<li>400 Bad Request：一个通用的差错代码，表示该请求不能被服务器解读。</li>
<li>404 Not Found：请求的文档在该服务上没有找到。</li>
<li>505 HTTP Version Not Supported</li>
</ul>
</blockquote>
</li>
</ul>
<h3 id="用户-服务器状态：cookies">用户-服务器状态：cookies</h3>
<blockquote>
<p>大多数主要的门户网站使用 cookies</p>
</blockquote>
<p>cookies有4个组成部分：</p>
<ul>
<li>
<p>在HTTP响应报文中有一个cookie的首部行</p>
</li>
<li>
<p>在HTTP请求报文含有一个cookie的首部行</p>
</li>
<li>
<p>在用户端系统中保留有一个cookie文件，由用户的浏览器管理</p>
</li>
<li>
<p>在Web站点有一个后端数据库</p>
<blockquote>
<p>客户端（浏览器）在第一次向服务器发送请求时不携带cookie，服务器也会判断，这是第一次访问，并会在响应报文中设置一个cookie，客户端收到响应报文后会将服务器发送来的cookie存到本地，下一次再访问该服务器时就会携带上该cookie值，此时服务器就可以凭借cookie值去判断、分析客户端的状态。</p>
<p>通过cookie，可以将HTTP从一个无状态的协议转换为一个有状态的协议。</p>
</blockquote>
</li>
</ul>
<p>cookies可以带来以下内容：</p>
<ul>
<li>authorization 授权（用户验证）</li>
<li>shopping carts 购物车</li>
<li>recommendations 推荐</li>
<li>user session state (Web e-mail) 用户会话状态</li>
</ul>
<blockquote>
<p>如何维护状态：</p>
<ul>
<li>协议端节点：在多个事务上 ，发送端和接收端维持状态（不会保留在中间节点中）</li>
<li>http报文携带状态信息</li>
</ul>
</blockquote>
<p>cookies的副作用：</p>
<ul>
<li>Cookies允许站点知道许多关于用户的信息（隐私）</li>
<li>网站记录用户信息并分析用户行为（可能将它知道的东西卖给第三方）</li>
<li>使用重定向和cookie的搜索引擎还能知道用户更多的信息（姓名、电话、邮箱等）</li>
</ul>
<h3 id="Web-caches（proxy-server）缓存（代理服务器）">Web caches（proxy server）缓存（代理服务器）</h3>
<p>目标：不访问原始服务器，就可以满足客户的请求。</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CN%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8.png" alt=""></p>
<p>缓存既是客户端又是服务器。</p>
<p>通常缓存是由ISP安装 (大学、公司、居民区ISP)</p>
<blockquote>
<p>浏览器将所有的HTTP请求发给缓存（代理服务器）</p>
<ul>
<li>在缓存中的对象：缓存直接返回对象</li>
<li>如对象不在缓存，缓存请求原始服务器，然后再将对象返回给客户端</li>
</ul>
<p>优势：</p>
<ul>
<li>降低客户端的请求响应时间</li>
<li>可以大大减少一个机构内部网络与Internent接入链路上的流量</li>
<li>互联网大量采用了缓存： 可以使较弱的ICP也能够有效提供内容（快速分发内容）</li>
</ul>
</blockquote>
<p>条件GET方法</p>
<blockquote>
<p>使用缓存有一个风险：客户端访问到的缓存中的数据，在原始服务器中已修改，结果就是拿到旧数据。</p>
<p>为此HTTP协议做了一个升级：Conditional GET（条件GET）</p>
</blockquote>
<p>目标：如果缓存器中的对象拷贝是最新的，就不要发送对象</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CN%E6%9D%A1%E4%BB%B6GET.png" alt=""></p>
<blockquote>
<ul>
<li>
<p>缓存器: 在HTTP请求中指定缓存拷贝的日期</p>
<p>If-modified-since:&lt;date’&gt;</p>
</li>
<li>
<p>服务器:</p>
<ul>
<li>如果缓存拷贝没有改变，则响应报文不包含对象: HTTP/1.0 304 Not Modified</li>
<li>如果缓存拷贝改变，则返回数据：HTTP/1.0 200 OK &lt;data’&gt;</li>
</ul>
</li>
</ul>
</blockquote>
<h3 id="Short-URL">Short URL</h3>
<p>把普通网址，转换成比较短的网址。（比如：<a href="http://t.cn/RlB2PdD%EF%BC%89">http://t.cn/RlB2PdD）</a></p>
<ul>
<li>微博；这些限制字数的应用里都用到这种技术。</li>
<li>百度短网址：<a href="http://dwz.cn/">http://dwz.cn/</a></li>
<li>google短网址： <a href="https://goo.gl/">https://goo.gl/</a></li>
</ul>
<p>当我们在浏览器里输入 <code>http://t.cn/RlB2PdD</code> 时会经历以下步骤：</p>
<ul>
<li>
<p>浏览器解析DNS，获取域名对应的IP；</p>
</li>
<li>
<p>当获取到IP时，会往这个IP地址发送http的get请求以获取到RlB2PdD对应的长链接地址；</p>
</li>
<li>
<p>HTTP通过301转到对应的长链接URL；</p>
<blockquote>
<p>注意：这里为什么使用301？</p>
<p>301是永久性转移（重定向）。也就是说，这个短地址 一经生成就不会发生变化了。</p>
</blockquote>
</li>
</ul>
<h2 id="FTP（文件传输协议）">FTP（文件传输协议）</h2>
<ul>
<li>
<p>向远程主机上传输文件或从远程主机接收文件</p>
</li>
<li>
<p>建立在TCP基础之上</p>
</li>
<li>
<p>客户/服务器模式：</p>
<ul>
<li>客户端：发起传输的一方</li>
<li>服务器：远程主机</li>
</ul>
</li>
<li>
<p>ftp: RFC 959</p>
</li>
<li>
<p>ftp服务器：端口号为21</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CNFTP.png" alt=""></p>
</li>
</ul>
<blockquote>
<ul>
<li>
<p>FTP客户端与FTP服务器通过<code>端口21</code>联系，并使用<code>TCP</code>为传输协议</p>
</li>
<li>
<p>客户端通过控制连接获得身份确认（通过TCP）（用户名和口令，全部都为明文）</p>
</li>
<li>
<p>客户端通过控制连接发送命令浏览远程目录（可以上传、下载）</p>
</li>
<li>
<p>收到一个文件传输命令时，服务器打开一个到客户端的TCP数据传输连接（客户端的20号端口，由服务器主动建立），控制信息/指令和数据传输的连接是不一样的。</p>
</li>
<li>
<p>一个文件传输完成后，服务器关闭连接</p>
</li>
<li>
<p>服务器打开第二个TCP数据连接用来传输另一个文件</p>
</li>
<li>
<p>控制连接： 带外（ “out of band” ）传送（只能建立一个）</p>
</li>
<li>
<p>数据连接：带内传送（可以建立多个）</p>
</li>
<li>
<p>FTP服务器维护用户的状态信息： 当前路径、用户帐户与控制连接对应（FTP是一个有状态的协议）</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CNFTP%E8%BF%9E%E6%8E%A5.png" alt=""></p>
</li>
</ul>
</blockquote>
<p>FTP在控制连接上以ASCII文本方式传送：</p>
<blockquote>
<p>命令样例：</p>
<ul>
<li>USER username</li>
<li>PASS password</li>
<li>LIST：请服务器返回远程主机当前目录的文件列表</li>
<li>RETR filename（重复性下载文件）：从远程主机的当前目录检索文件 (gets)</li>
<li>STOR filename（上载文件）：向远程主机的当前目录存放文件 (puts)</li>
</ul>
<p>返回码样例：（状态码和状态信息 (同HTTP)）</p>
<ul>
<li>331 Username OK, password required</li>
<li>125 data connection already open; transfer starting</li>
<li>425 Can’t open data connection</li>
<li>452 Error writing file</li>
</ul>
</blockquote>
<h2 id="Electronic-mail（Email）">Electronic mail（Email）</h2>
<h3 id="电子邮件（Email）的三个主要组成部分">电子邮件（Email）的三个主要组成部分</h3>
<ul>
<li>
<p>user agents （用户代理）</p>
<blockquote>
<ul>
<li>又名 “邮件阅读器”</li>
<li>撰写、编辑和阅读邮件</li>
<li>如Outlook、Foxmail</li>
<li>输出和输入邮件保存在服务器上</li>
</ul>
</blockquote>
</li>
<li>
<p>mail servers（邮件服务器）</p>
<blockquote>
<ul>
<li>邮箱中管理和维护发送给用户的邮件</li>
<li>输出报文队列保持待发送邮件报文</li>
<li>邮件服务器之间的SMTP协议：发送email报文
<ul>
<li>客户：发送方邮件服务器</li>
<li>服务器：接收端邮件服务器</li>
</ul>
</li>
</ul>
<p>两个作用：</p>
<ol>
<li>
<p>用户代理配置好邮件服务器的IP地址、端口号，然后用户代理把邮件发送给邮件服务器的队列当中。邮件服务器会把队列中的邮件依次发送到目标邮件服务器中。</p>
<p><strong>（用户代理发邮件到邮件服务器用的是SMTP协议）</strong></p>
</li>
<li>
<p>然后目标邮件服务器接收到邮件后会把邮件放到相应用户的目录（邮箱）当中。收件人运行客户代理，从邮件服务器中相应的自己的邮箱中把信件拉回到本地。</p>
<p><strong>（邮件服务器发给目标邮件服务器使用的是SMTP协议）</strong></p>
<p><strong>（“拉”邮件的协议有三种：POP3、IMAP、HTTP）</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CN%E9%82%AE%E4%BB%B6%E4%BC%A0%E8%BE%93%E8%BF%87%E7%A8%8B.png" alt=""></p>
</li>
</ol>
</blockquote>
</li>
<li>
<p>simple mail transfer protocol: SMTP（简单邮件传输协议）</p>
</li>
</ul>
<blockquote>
<ul>
<li>
<p>使用TCP在客户端和服务器之间传送报文，端口号为25</p>
</li>
<li>
<p>直接传输：从发送方服务器到接收方服务器</p>
</li>
<li>
<p>传输的3个阶段：</p>
<ul>
<li>握手</li>
<li>传输报文</li>
<li>关闭</li>
</ul>
</li>
<li>
<p>命令/响应交互：</p>
<ul>
<li>命令：ASCII文本</li>
<li>响应：状态码和状态信息</li>
</ul>
</li>
<li>
<p>报文必须为7位ASCII码（邮件的内容必须是7位ASCII码的范围，超过是不允许传输的）</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CNSMTP.png" alt=""></p>
</li>
</ul>
</blockquote>
<p>邮件发送举例如下图：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CN%E9%82%AE%E4%BB%B6%E5%8F%91%E9%80%81%E4%B8%BE%E4%BE%8B.png" alt=""></p>
<p>说明：</p>
<ol>
<li>
<p>Alice使用用户代理撰写邮件并发送给bob@someschool.edu</p>
</li>
<li>
<p>Alice的用户代理将邮件发送到她的邮件服务器；邮件放在报文队列中（SMTP）</p>
</li>
<li>
<p>SMTP的客户端打开到Bob邮件服务器的TCP连接</p>
</li>
<li>
<p>SMTP客户端通过TCP连接发送Alice的邮件（SMTP）</p>
</li>
<li>
<p>Bob的邮件服务器将邮件放到Bob的邮箱</p>
</li>
<li>
<p>Bob调用他的用户代理阅读邮件（POP3、IMAP、HTTP）</p>
</li>
</ol>
<blockquote>
<ul>
<li>邮件服务器会周期性扫描队列，隔一段时间将收集的邮件全部发出。（如果每时每刻都处于“待命”状态是很耗能的）</li>
<li>可能导致邮件发送失败的原因：
<ul>
<li>网络连接有问题</li>
<li>接收方的邮件服务器地址填写错误</li>
<li>垃圾邮件过滤</li>
</ul>
</li>
<li>如果邮件发送失败，会将该邮件发送给另外一个失败的队列中，隔一段时间后重新发送，若仍失败，则退回该邮件。</li>
</ul>
</blockquote>
<p>简单的SMTP交互案例：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CNSMTP%E4%BA%A4%E4%BA%92.png" alt=""></p>
<p>SMTP vs HTTP</p>
<blockquote>
<p>SMTP</p>
<ul>
<li>SMTP：推（push）</li>
<li>SMTP使用持久连接</li>
<li>SMTP要求报文（首部和主体）为7位ASCII编码</li>
<li>SMTP服务器使用 CRLF.CRLF决定报文的尾部</li>
<li>SMTP：多个对象包含在一个报文中</li>
</ul>
<p>HTTP</p>
<ul>
<li>HTTP：拉（pull）</li>
<li>二者都是ASCII形式的命令/响应交互、状态码</li>
<li>HTTP：每个对象封装在各自的响应报文中</li>
</ul>
</blockquote>
<h3 id="邮件报文格式">邮件报文格式</h3>
<ul>
<li>
<p>SMTP：交换email报文的协议</p>
</li>
<li>
<p>RFC 822: 文本报文的标准：</p>
<ul>
<li>首部行：如
<ul>
<li>To:</li>
<li>From:</li>
<li>Subject:</li>
<li>与SMTP命令不同 ！</li>
</ul>
</li>
<li>主体：
<ul>
<li>报文，只能是ASCII码字符</li>
</ul>
</li>
</ul>
</li>
<li>
<p>问题：如果传输的内容包含中文字符，都不在ASCII范围之内。就要对其进行编码（扩展）：</p>
<ul>
<li>
<p>MIME：多媒体邮件扩展（multimedia mail extension）,RFC 2045, 2056</p>
</li>
<li>
<p>在报文首部用额外的行申明MIME内容类型</p>
</li>
<li>
<p>内部的编码采用base64编码格式</p>
<blockquote>
<p>使用bsae64，将不在ASCII范围之内的内容进行长扩展，使得其在ASCII范围之内。（大小写英文字母，加号，等号）</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CNMIME.png" alt=""></p>
</li>
</ul>
</li>
</ul>
<h3 id="邮件访问协议">邮件访问协议</h3>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CN%E9%82%AE%E4%BB%B6%E8%AE%BF%E9%97%AE%E5%8D%8F%E8%AE%AE.png" alt=""></p>
<ul>
<li>SMTP: 传送到接收方的邮件服务器</li>
<li>邮件访问协议：从服务器访问邮件（“拉”）
<ul>
<li>POP：邮局访问协议（Post Office Protocol）[RFC 1939]
<ul>
<li>用户身份确认 (代理&lt;–&gt;服务器) 并下载</li>
</ul>
</li>
<li>IMAP：Internet邮件访问协议（Internet Mail Access Protocol）[RFC 1730]
<ul>
<li>相比POP3更多特性 (更复杂，如：远程目录维护；仅仅只下载邮件正文，附件可选择下载，对手机端友好)</li>
<li>直接在邮件服务器上处理存储的报文</li>
</ul>
</li>
<li>HTTP：Hotmail , Yahoo! Mail等
<ul>
<li>方便</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>POP3协议</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CNPOP3%E5%8D%8F%E8%AE%AE.png" alt=""></p>
<blockquote>
<ul>
<li>有邮件“download and delete”（下载并删除）模式</li>
<li>有邮件“Download-and-keep”（下载并保留）模式（不同的客户机都可以拷贝邮件）</li>
<li>POP3在会话中是无状态的（不支持远程目录维护）</li>
</ul>
</blockquote>
<p>IMAP协议</p>
<ul>
<li>IMAP服务器将每个报文与一个文件夹联系起来</li>
<li>允许用户用目录来组织报文</li>
<li>允许用户读取报文组件</li>
<li>IMAP在会话过程中保留用户状态：目录名、报文ID与目录名之间映射</li>
</ul>
<h2 id="DNS-Domain-Name-System">DNS(Domain Name System)</h2>
<p>域名解析系统是一个给其他“应用”应用的应用。（提供域名到IP地址的转换）</p>
<p>DNS的必要性：</p>
<p>先明白IP地址的作用：一个是标识，一个是寻址。网络设备都是按照IP地址来工作的，但是这有一个问题，IP地址都是数字（IPv4：4Byte，32bit；IPv6：16Byte，128bit），人很难记忆。人类还是更倾向于使用有意义的字符串来标识Internet上的设备。所以域名解析系统就应运而生：它提供域名到IP地址的转换。</p>
<p>接下来我们要考虑的是DNS如何实现这一功能，即我们需要考虑以下问题：</p>
<ul>
<li>
<p>问题一：如何命名设备？</p>
<blockquote>
<ul>
<li>用有意义的字符串：好记，便于人类用使用</li>
<li>解决一个平面命名的重名问题：层次化命名</li>
</ul>
</blockquote>
</li>
<li>
<p>问题二：如何完成名字到IP地址的转换？</p>
<blockquote>
<p>分布式的数据库维护和响应名字查询（仅由单一设备去维护上亿数量的用户设备的域名解析是不可能的）</p>
</blockquote>
</li>
<li>
<p>问题三：如何维护：增加或者删除一个域，需要在域名系统中做哪些工作？</p>
</li>
</ul>
<blockquote>
<p>历史：</p>
<ul>
<li>ARPANET的名字解析解决方案
<ul>
<li>主机名：没有层次的一个字符串（一个平面）</li>
<li>存在着一个（集中）维护站：维护着一张主机名-IP地址的映射文件：<code>Hosts.txt</code></li>
<li>每台主机定时从维护站取文件</li>
</ul>
</li>
<li>ARPANET解决方案的问题，当网络中主机数量很大时
<ul>
<li>没有层次的主机名称很难分配</li>
<li>文件的管理、发布、查找都很麻烦</li>
</ul>
</li>
</ul>
</blockquote>
<p>DNS总体思路和目标</p>
<ul>
<li>
<p>主要思路：</p>
<ul>
<li><strong>分层</strong>的、基于域的命名机制</li>
<li>若干<strong>分布式的数据库</strong>完成名字到IP地址的转换</li>
<li>运行在UDP之上端口号为53的应用服务</li>
<li>核心的Internet功能，但在端系统（边缘）中的应用层实现</li>
</ul>
</li>
<li>
<p>主要目标：</p>
<ul>
<li>
<p>实现主机名-IP地址的转换(name/IP translate)</p>
</li>
<li>
<p>其他目的：</p>
<ul>
<li>
<p>主机别名-规范名字的转换：Host aliasing</p>
<blockquote>
<p>规范名字便于管理，主机别名便于访问</p>
</blockquote>
</li>
<li>
<p>邮件服务器别名-邮件服务器的正规名字的转换：Mail server aliasing</p>
</li>
<li>
<p>负载均衡：Load Distribution</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="DNS名字空间">DNS名字空间</h3>
<p>DNS域名结构</p>
<p>一个层面命名设备会有很多重名，因而DNS采用层次树状结构的命名方法：</p>
<ul>
<li>
<p>Internet根被划为几百个顶级域(top lever domains，TLD)</p>
<ul>
<li>
<p>通用的(generic)：</p>
<p><code>.com</code>; <code>.edu</code> ; <code>.gov</code> ; <code>.int</code> ; <code>.mil</code> ; <code>.net</code> ; <code>.org</code>; <code>.firm</code> ; <code>.hsop</code> ; <code>.web</code> ; <code>.arts</code> ; <code>.rec</code> ;</p>
</li>
<li>
<p>国家的(countries)：</p>
<p><code>.cn</code> ; <code>.us</code> ; <code>.nl</code> ; <code>.jp</code></p>
</li>
</ul>
</li>
<li>
<p>每个(子)域下面可划分为若干子域(subdomains)</p>
</li>
<li>
<p>树叶是主机</p>
</li>
</ul>
<p>如下图，一共有13个根域名服务器</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CN%E6%A0%B9%E5%9F%9F%E5%90%8D%E6%9C%8D%E5%8A%A1%E5%99%A8.png" alt=""></p>
<p>域名（Domain Name）</p>
<ul>
<li>从本域往上，直到树根（根域名）。中间使用“.”间隔不同的级别
<ul>
<li>域的域名：可以用于表示一个域</li>
<li>主机的域名：一个域上的一个主机</li>
</ul>
</li>
</ul>
<p>域名的管理</p>
<ul>
<li>一个域管理其下的子域（例如：.cn 被划分为 <a href="http://edu.cn">edu.cn</a> ；<a href="http://com.cn">com.cn</a> ）</li>
<li>创建一个新的域，必须征得它所属域的同意</li>
</ul>
<p>域与物理网络无关</p>
<ul>
<li>
<p>域遵从组织界限，而不是物理网络</p>
<ul>
<li>
<p>一个域的主机可以不在一个网络</p>
</li>
<li>
<p>一个网络的主机不一定在一个域</p>
<blockquote>
<p>例如：我在中国的某间教室运行一台主机，而这台主机域名由欧洲的某个服务器维护。</p>
</blockquote>
</li>
</ul>
</li>
<li>
<p>域的划分是逻辑的，而不是物理的</p>
</li>
</ul>
<h3 id="域名-IP地址的转换">域名-IP地址的转换</h3>
<blockquote>
<p>前面提到单一域名服务器存在的问题：</p>
<ul>
<li>可靠性问题：单点故障</li>
<li>扩展性问题：通信容量</li>
<li>维护问题：远距离的集中式数据库</li>
</ul>
</blockquote>
<p>区域(zone)：</p>
<ul>
<li>
<p>区域的划分有区域管理者自己决定</p>
</li>
<li>
<p>将DNS名字空间划分为互不相交的区域，每个区域都是树的一部分</p>
</li>
<li>
<p>名字服务器：</p>
<ul>
<li>每个区域都有一个权威名字服务器：维护着它所管辖区域的权威信息 (authoritative record)</li>
<li>名字服务器允许被放置在区域之外，以保障可靠性</li>
</ul>
<p>区域的划分如下图：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CN%E5%8C%BA%E5%9F%9F%E5%88%92%E5%88%86.png" alt=""></p>
</li>
</ul>
<p>TLD服务器（顶级域服务器）</p>
<p>负责顶级域名（如com, org, net, edu和gov）和所有国家级的顶级域名（如cn, uk, fr, ca, jp）</p>
<ul>
<li>Network solutions 公司维护com TLD服务器</li>
<li>Educause公司维护edu TLD服务器</li>
</ul>
<p>区域名字服务器维护资源记录</p>
<ul>
<li>
<p>资源记录(resource records)</p>
<ul>
<li>作用：维护域名-IP地址(其它)的映射关系</li>
<li>位置：Name Server的分布式数据库中</li>
</ul>
</li>
<li>
<p>RR格式: (domain_name, ttl, type,class,Value)</p>
<ul>
<li>
<p>Domain_name: 域名</p>
</li>
<li>
<p>TTL: time to live : 生存时间(权威，缓冲记录)</p>
<blockquote>
<p>决定了资源记录应当从缓存中删除的时间</p>
</blockquote>
</li>
<li>
<p>Class 类别 ：对于Internet，值为IN</p>
</li>
<li>
<p>Value 值：可以是数字，域名或ASCII串</p>
</li>
<li>
<p>Type 类别：资源记录的类型</p>
<ul>
<li>Type=A：
<ul>
<li>Name为主机</li>
<li>Value为IP地址</li>
</ul>
</li>
<li>Type=CNAME：
<ul>
<li>Name为规范名字的别名（如：<a href="http://www.ibm.com">www.ibm.com</a> <a href="http://xn--servereast-xx2p927cdlw040g9fvbnuw.backup2.ibm.com">的规范名字为servereast.backup2.ibm.com</a>）</li>
<li>value 为规范名字</li>
</ul>
</li>
<li>Type=NS：
<ul>
<li>Name域名(<a href="http://xn--foo-eo8e.com">如foo.com</a>)</li>
<li>Value为该域名的权威服务器的域名</li>
</ul>
</li>
<li>Type=MX：
<ul>
<li>Value为name对应的邮件服务器的名字</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="DNS工作过程">DNS工作过程</h3>
<ul>
<li>
<p>应用调用解析器(resolver)</p>
</li>
<li>
<p>解析器作为客户向Local Name Server发出查询报文（封装在UDP段中）</p>
<blockquote>
<p>解析器如何知道Local Name Server的IP地址：这是提前配置好的</p>
<p>一台设备上网，必须要具备四个信息：</p>
<ul>
<li>主机的IP地址</li>
<li>所在的子网的子网掩码</li>
<li>Local Name Server</li>
<li>Default Gateway（默认网关）：从当前子网将数据传出其他子网</li>
</ul>
</blockquote>
</li>
<li>
<p>Name Server返回响应报文(name/ip)</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CNDNS%E5%A4%A7%E8%87%B4%E5%B7%A5%E4%BD%9C%E8%BF%87%E7%A8%8B.png" alt=""></p>
</li>
</ul>
<p>本地名字服务器（Local Name Server）</p>
<ul>
<li>
<p>并不严格属于层次结构</p>
</li>
<li>
<p>每个ISP (居民区的ISP、公司、大学）都有一 个本地DNS服务器（也称为“默认名字服务器”）</p>
</li>
<li>
<p>当一个主机发起一个DNS查询时，查询被送到其本地DNS服务器</p>
<blockquote>
<p>起着代理的作用，将查询转发到层次结构中</p>
</blockquote>
</li>
</ul>
<p>名字解析过程</p>
<ul>
<li>目标名字在Local Name Server中
<ul>
<li>情况1：查询的名字在该区域内部</li>
<li>情况2：缓存(cashing)</li>
</ul>
</li>
</ul>
<p>如果Local Name Server的缓存没有信息</p>
<ul>
<li>
<p>递归查询</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CN%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90%E9%80%92%E5%BD%92%E6%9F%A5%E8%AF%A2.png" alt=""></p>
<p>问题：名字解析负担都放在当前联络的名字服务器上，根服务器的负担太重</p>
<p>为此出现了迭代查询</p>
</li>
<li>
<p>迭代查询</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CN%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90%E8%BF%AD%E4%BB%A3%E6%9F%A5%E8%AF%A2.png" alt=""></p>
<blockquote>
<p><a href="http://xn--cis-g88dt65i.poly.edu">主机cis.poly.edu</a> 想知道 主机 <a href="http://gaia.cs.umass.edu">gaia.cs.umass.edu</a> 的IP地址</p>
<ul>
<li>根（及各级域名）服务器返回的不是查询结果，而是下一个NS的地址</li>
<li>最后由权威名字服务器给出解析结果</li>
<li>当前联络的服务器给出可以联系的服务器的名字</li>
<li>“我不知道这个名字，但可以向这个服务器请求”</li>
</ul>
</blockquote>
</li>
</ul>
<h3 id="DNS协议、报文">DNS协议、报文</h3>
<p>如下图所示：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CNDNS%E5%8D%8F%E8%AE%AE%E6%8A%A5%E6%96%87%E4%B8%80.png" alt=""></p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CNDNS%E5%8D%8F%E8%AE%AE%E6%8A%A5%E6%96%87%E4%BA%8C.png" alt=""></p>
<p>提高性能：缓存</p>
<ul>
<li>
<p>一旦名字服务器学到了一个映射，就将该映射缓存起来</p>
</li>
<li>
<p>根服务器通常都在本地服务器中缓存着（使得根服务器不用经常被访问）</p>
</li>
<li>
<p>目的：提高效率</p>
</li>
<li>
<p>可能存在的问题：如果情况变化，缓存结果和权威资源记录不一致</p>
<blockquote>
<p>解决方案：TTL（默认2天）</p>
</blockquote>
</li>
</ul>
<h3 id="新增域">新增域</h3>
<ul>
<li>
<p>在上级域的名字服务器中增加两条记录，指向这个新增的子域的<strong>域名</strong>和<strong>域名服务器</strong>的地址</p>
</li>
<li>
<p>在新增子域的名字服务器上运行名字服务器，负责本域的名字解析： 名字→IP地址</p>
<blockquote>
<p>如：在com域中建立一个“Network Utopia”</p>
</blockquote>
</li>
<li>
<p><a href="http://xn--networkutopia-he1va63x07l7qs6z2ekhb685dda4847c0m2g.com">到注册登记机构注册域名networkutopia.com</a></p>
<ul>
<li>
<p>需要向该机构提供权威DNS服务器（基本的、和辅助的）的名字和IP地址</p>
</li>
<li>
<p>登记机构在com TLD服务器中插入两条RR记录:</p>
<blockquote>
<p>(<a href="http://networkutopia.com">networkutopia.com</a>, <a href="http://dns1.networkutopia.com">dns1.networkutopia.com</a>, NS)</p>
<p>(<a href="http://dns1.networkutopia.com">dns1.networkutopia.com</a>, 212.212.212.1, A)</p>
</blockquote>
</li>
</ul>
</li>
<li>
<p>在networkutopia.com的权威服务器中确保有：</p>
<ul>
<li>用于Web服务器的www.networkuptopia.com的类型为A的记录</li>
<li>用于邮件服务器mail.networkutopia.com的类型为MX的记录</li>
</ul>
</li>
</ul>
<h3 id="攻击DNS">攻击DNS</h3>
<p>DDoS 攻击</p>
<ul>
<li>对根服务器进行流量轰炸攻击：发送大量ping
<ul>
<li>没有成功
<ul>
<li>原因１：根目录服务器配置了流量过滤器，防火墙</li>
<li>原因２：Local DNS 服务器缓存了TLD服务器的IP地址, 因此无需查询根服务器</li>
</ul>
</li>
</ul>
</li>
<li>向TLD服务器流量轰炸攻击 ：发送大量查询
<ul>
<li>可能更危险</li>
<li>效果一般，大部分DNS缓存了TLD</li>
</ul>
</li>
</ul>
<p>重定向攻击</p>
<ul>
<li>中间人攻击
<ul>
<li>截获查询，伪造回答，从而攻击某个（DNS回答指定的IP）站点</li>
</ul>
</li>
<li>DNS中毒
<ul>
<li>发送伪造的应答给DNS服务器，希望它能够缓存这个虚假的结果</li>
</ul>
</li>
<li>技术上较困难：分布式截获和伪造利用DNS基础设施进行DDoS</li>
<li>伪造某个IP进行查询，攻击这个目标IP</li>
<li>查询放大，响应报文比查询报文大</li>
<li>效果有限</li>
</ul>
<blockquote>
<p>总体来讲：DNS是比较健壮的。</p>
</blockquote>
<h2 id="P2P应用">P2P应用</h2>
<p>前面介绍过，任何节点即是服务器，又是客户端。</p>
<ul>
<li>没有（或极少）一直运行的服务器</li>
<li>任意端系统都可以直接通信</li>
<li>利用peer的服务能力</li>
<li>Peer节点间歇上网，每次IP地址都有可能变化</li>
<li>例子：
<ul>
<li>文件分发 (BitTorrent)</li>
<li>流媒体(KanKan)</li>
<li>VoIP (Skype)</li>
</ul>
</li>
</ul>
<h3 id="P2P文件传输">P2P文件传输</h3>
<p>这一部分我们将C/S模式和P2P模式的文件分发对比来看：</p>
<ul>
<li>
<p>文件分发时间：C/S模式</p>
<ul>
<li>服务器传输： 都是由服务器发送给peer，服务器必须顺序传输（上载）N个文件拷贝:
<ul>
<li>发送一个copy: F/u<sub>s</sub></li>
<li>发送N个copy： NF/u<sub>s</sub></li>
</ul>
</li>
<li>客户端: 每个客户端必须下载一个文件拷贝
<ul>
<li>d<sub>min</sub> = 客户端最小的下载速率</li>
<li>下载带宽最小的客户端下载的时间：F/d<sub>min</sub></li>
</ul>
</li>
</ul>
<blockquote>
<p>采用C/S方法将一个F大小的文件分发给N个客户端耗时：</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>D</mi><mrow><mi>C</mi><mi mathvariant="normal">/</mi><mi>S</mi></mrow></msub><mo>≥</mo><mi>max</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>N</mi><mi>F</mi><mi mathvariant="normal">/</mi><msub><mi>u</mi><mi>s</mi></msub><mo separator="true">,</mo><mi>F</mi><mi mathvariant="normal">/</mi><msub><mi>d</mi><mrow><mi>m</mi><mi>i</mi><mi>n</mi></mrow></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">D_{C/S} \ge \max(NF/u_s,F/d_{min})
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.03853em;vertical-align:-0.3551999999999999em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.34480000000000005em;"><span style="top:-2.5198em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">C</span><span class="mord mtight">/</span><span class="mord mathnormal mtight" style="margin-right:0.05764em;">S</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3551999999999999em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">≥</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop">max</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.13889em;">NF</span><span class="mord">/</span><span class="mord"><span class="mord mathnormal">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mord">/</span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">min</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></p>
<ul>
<li>当客户端数量很少时，影响传输时间的瓶颈是客户端的下载速率；</li>
<li>当客户端数量很多时，影响传输时间的瓶颈是服务器端的上载速率。</li>
</ul>
</blockquote>
</li>
<li>
<p>文件分发时间：P2P模式</p>
<ul>
<li>
<p>服务器传输：最少需要上载一份拷贝</p>
<ul>
<li>发送一个拷贝的时间：F/u<sub>s</sub></li>
</ul>
</li>
<li>
<p>客户端: 每个客户端必须下载一个拷贝</p>
<ul>
<li>最小下载带宽客户单耗时：: F/d<sub>min</sub></li>
</ul>
</li>
<li>
<p>客户端: 所有客户端总体下载量NF</p>
<ul>
<li>
<p>最大上载带宽是：</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>u</mi><mi>s</mi></msub><mo>+</mo><munder><mo>∑</mo><mrow></mrow></munder><msub><mi>u</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">u_s + \sum_{} u_i
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:2.3000100000000003em;vertical-align:-1.250005em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.050005em;"><span style="top:-1.8999949999999999em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"></span></span></span><span style="top:-3.0500049999999996em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.250005em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p>
</li>
<li>
<p>除了服务器可以上载，其他所有的peer节点都可以上载</p>
</li>
</ul>
</li>
</ul>
<blockquote>
<p>采用P2P方法 将一个F大小的文件分发给N个客户端耗时:</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>D</mi><mrow><mi>P</mi><mn>2</mn><mi>P</mi></mrow></msub><mo>≥</mo><mi>max</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>F</mi><mi mathvariant="normal">/</mi><msub><mi>u</mi><mi>s</mi></msub><mo separator="true">,</mo><mi>F</mi><mi mathvariant="normal">/</mi><msub><mi>d</mi><mrow><mi>m</mi><mi>i</mi><mi>n</mi></mrow></msub><mo separator="true">,</mo><mi>N</mi><mi>F</mi><mi mathvariant="normal">/</mi><mo stretchy="false">(</mo><msub><mi>u</mi><mi>s</mi></msub><mo>+</mo><mo>∑</mo><mrow></mrow><msub><mi>u</mi><mi>i</mi></msub><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">D_{P2P} \ge \max(F/u_s, F/d_{min}, NF/(u_s + \sum{}u_i))
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">P</span><span class="mord mtight">2</span><span class="mord mathnormal mtight" style="margin-right:0.13889em;">P</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">≥</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop">max</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mord">/</span><span class="mord"><span class="mord mathnormal">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mord">/</span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">min</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">NF</span><span class="mord">/</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.6000100000000002em;vertical-align:-0.55001em;"></span><span class="mop op-symbol large-op" style="position:relative;top:-0.000004999999999977245em;">∑</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"></span><span class="mord"><span class="mord mathnormal">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">))</span></span></span></span></span></p>
<p>随着客户端的数量增多，P2P模式的优势就体现出来了：客户端数量越多，较C/S模式节约的时间就越多。</p>
</blockquote>
</li>
</ul>
<p>下图比较直观的给出二者的对比：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CN%E6%96%87%E4%BB%B6%E5%88%86%E5%8F%91%E4%B8%8B%E8%BD%BD%E5%AF%B9%E6%AF%94.png" alt=""></p>
<blockquote>
<p>P2P文件共享的例子：</p>
<ul>
<li>Alice在其笔记本电脑上运行P2P客户端程序</li>
<li>间歇性地连接到Internet，每次从其ISP得到新的IP地址</li>
<li>请求“双截棍.MP3”</li>
<li>应用程序显示其他有“ 双截棍.MP3” 拷贝的对等方</li>
<li>Alice选择其中一个对等方， 如Bob.</li>
<li>文件从Bob’s PC传送到Alice的笔记本上：HTTP</li>
<li>当Alice下载时，其他用户也可以从Alice处下载</li>
<li>Alice的对等方既是一个Web客户端，也是一个瞬时Web服务器</li>
</ul>
</blockquote>
<p>从以上例子我们会思考，P2P文件共享需要解决以下问题：</p>
<ul>
<li>
<p>如何定位所需资源</p>
</li>
<li>
<p>如何处理对等方的加入与离开</p>
<blockquote>
<p>可能的方案：</p>
<ul>
<li>集中式目录</li>
<li>完全分布式</li>
<li>混合体</li>
</ul>
</blockquote>
</li>
</ul>
<h3 id="P2P：集中式目录">P2P：集中式目录</h3>
<p>最初的“Napster”设计：</p>
<ul>
<li>
<p>当对等方连接时，它告知中心服务器：</p>
<ul>
<li>IP地址</li>
<li>内容</li>
</ul>
</li>
<li>
<p>Alice查询 “双截棍 .MP3”</p>
</li>
<li>
<p>Alice从Bob处请求文件</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CN%E9%9B%86%E4%B8%AD%E5%BC%8F%E7%9B%AE%E5%BD%95%E6%9C%8D%E5%8A%A1%E5%99%A8.png" alt=""></p>
<blockquote>
<p>集中式目录存在的问题：</p>
<ul>
<li>单点故障</li>
<li>性能瓶颈</li>
<li>侵犯版权</li>
</ul>
</blockquote>
</li>
</ul>
<h3 id="P2P：查询洪泛（Gnutella）">P2P：查询洪泛（Gnutella）</h3>
<ul>
<li>全分布式（没有中心服务器）</li>
<li>开放文件共享协议</li>
<li>许多Gnutella客户端实现了Gnutella协议（类似HTTP有许多的浏览器）</li>
<li>覆盖网络：图
<ul>
<li>如果X和Y之间有一个TCP连接，则二者之间存在一条边</li>
<li>所有活动的对等方和边就是覆盖网络</li>
<li>边并不是物理链路</li>
<li>给定一个对等方，通常所连接的节点少于10个</li>
</ul>
</li>
</ul>
<blockquote>
<p>Gnutella：协议</p>
<ul>
<li>
<p>在已有的TCP连接上发送查询报文</p>
</li>
<li>
<p>对等方转发查询报文</p>
</li>
<li>
<p>以反方向返回查询命中报文</p>
</li>
<li>
<p>“泛洪”：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CN%E6%B3%9B%E6%B4%AA.png" alt=""></p>
</li>
</ul>
<p>Gnutella：对等方加入</p>
<ol>
<li>对等方X必须首先发现某些已经在覆盖网络中的其他对等方：使用可用对等方列表
<ul>
<li>自己维持一张对等方列表（经常开机的对等方的IP）</li>
<li>联系维持列表的Gnutella站点</li>
</ul>
</li>
<li>X接着试图与该列表上的对等方建立TCP连接，直到与某个对等方Y建立连接</li>
<li>X向Y发送一个Ping报文，Y转发该Ping报文</li>
<li>所有收到Ping报文的对等方以Pong报文响应
<ul>
<li>IP地址、共享文件的数量及总字节数</li>
</ul>
</li>
<li>X收到许多Pong报文，然后它能建立其他TCP连接</li>
</ol>
<p>当节点离开时，会向“邻居”发送消息：“我走啦”，于是其他的节点会再次以以上的方式添加一个新的节点，维持连接强度。</p>
<p>但是Gnutella实际效果并不好。</p>
</blockquote>
<h3 id="P2P：利用不匀称性（KaZaA）">P2P：利用不匀称性（KaZaA）</h3>
<ul>
<li>
<p>每个对等方要么是一个 组长，要么隶属于一个组长</p>
<ul>
<li>对等方与其组长之间有TCP连接</li>
<li>组长对之间有TCP连接</li>
</ul>
</li>
<li>
<p>组长跟踪其所有的孩子的内容</p>
</li>
<li>
<p>组长与其他组长联系：</p>
<ul>
<li>转发查询到其他组长</li>
<li>获得其他组长的数据拷贝</li>
</ul>
<blockquote>
<p>组的成员向组长发出一个查询，如果组内有，组长会告知该节点：“咱们组里有，你去向XXX请求吧。”；如果组内没有，那么该组长会向其他组长发出查询。</p>
<ul>
<li>在组内的层面是集中式的</li>
<li>在组长的层面是分布式的</li>
</ul>
</blockquote>
</li>
</ul>
<blockquote>
<p>KaZaA：查询</p>
<ul>
<li>每个文件有一个散列标识码和一个描述符</li>
<li>客户端向其组长发送关键字查询</li>
<li>组长用匹配进行响应：
<ul>
<li>对每个匹配：元数据、散列标识码和IP地址</li>
</ul>
</li>
<li>如果组长将查询转发给其他组长，其他组长也以匹配进行响应</li>
<li>客户端选择要下载的文件
<ul>
<li>向拥有文件的对等方发送一个带散列标识码的HTTP请求</li>
</ul>
</li>
</ul>
<p>KaZaA小技巧</p>
<ul>
<li>请求排队
<ul>
<li>限制并行上载的数量</li>
<li>确保每个被传输的文件从上载节点接收一定量的带宽</li>
</ul>
</li>
<li>激励优先权
<ul>
<li>鼓励用户上载文件</li>
<li>加强系统的扩展性</li>
</ul>
</li>
<li>并行下载
<ul>
<li>HTTP的字节范围首部</li>
<li>更快地检索一个文件</li>
</ul>
</li>
</ul>
</blockquote>
<h3 id="比特洪流（BitTorrent）">比特洪流（BitTorrent）</h3>
<blockquote>
<p>Peer如果想参与到文件传输需要加入到“洪流”（指一些Peer节点的列表和它们之间服务与被服务的关系）当中。</p>
<p>以学习小组为例会比较形象的描述文件传输的过程：假设一门课程的内容被分为很多小的知识点，这些知识点被分发在学习小组当中，那么节点与节点之间可以相互通信，共享这些知识点，从而使每个节点都学习到所有的知识点，掌握整门课程内容。</p>
<p>课程内容就是一个大型文件，知识点就是被划分为的一个个块（256KB）。</p>
<p>那么我们开始思考，各个节点如何知晓其他节点需要哪些块呢？</p>
<p>这里就会提出一个概念：bit map。</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CNbitmap.png" alt=""></p>
<p>我们可以用很小的位去标识整个文件中所有块的有无情况：1表示有；0表示无。这样构成一个一一映射的关系。</p>
<p>洪流中的节点会定期互相交换自己的bit map，从而就知晓了其他节点拥有块的情况。</p>
<p>一开始新加入的节点没有任何块，它会随机的访问其他节点获取块，当获取到四个块之后，就会改变获取策略：优先请求稀缺的块。</p>
<p>简单分析一下这种思想：节点优先获取稀缺的块，从而其他节点就会不断访问该节点，该节点从其他节点不断地获取更好的服务，同时也可以向其他节点提供更好的服务。</p>
</blockquote>
<ul>
<li>
<p>文件被分为一个个块256KB</p>
</li>
<li>
<p>网络中的这些peers发送接收文件块，相互服务</p>
</li>
<li>
<p><strong>tracker</strong>:跟踪torrent中参与节点</p>
</li>
<li>
<p>Torrent（洪流）: 节点的组，之间交换文件块</p>
<blockquote>
<p>例：Alice加入到网络中，首先需要从从跟踪服务器处获得peer节点列表， 然后开始和torrent中的peer节点交换块。</p>
<blockquote>
<p>Peer如何加入torrent：</p>
<ul>
<li>一开始没有块，但是将会通过其他节点处累积文件块</li>
<li>向跟踪服务器注册，获得peer节点列表，和部分peer节点构成邻居关系 (“连接 ”)</li>
</ul>
</blockquote>
<ul>
<li>当peer下载时，该peer可以同时向其他节点提供上载服务</li>
<li>Peer可能会变换用于交换块的peer节点</li>
<li>扰动churn: peer节点可能会上线或者下线</li>
<li>一旦一个peer拥有整个文件，它会（自私的）离开或者保 留（利他主义）在torrent中</li>
</ul>
</blockquote>
</li>
</ul>
<p>请求块</p>
<ul>
<li>在任何给定时间，不同peer节点拥有一个文件块的子集</li>
<li>周期性的，Alice节点向邻居询问他们拥有哪些块的信息</li>
<li>Alice向peer节点请求它希望的块，稀缺的块</li>
</ul>
<p>发送块（一报还一报 tit-for-tat）</p>
<p>Alice向4个peer发送块，这些块向它自己提供最大带宽的服务</p>
<ul>
<li>其他peer被Alice阻塞 (将不会从Alice处获得服务)</li>
<li>每10秒重新评估一次：前4位</li>
</ul>
<p>每个30秒：随机选择其他peer节点，向这个节点发送块</p>
<ul>
<li>“优化疏通” 这个节点</li>
<li>新选择的节点可以加入这个top 4</li>
</ul>
<h2 id="CDN（Content-Distribution-Networks）">CDN（Content Distribution Networks）</h2>
<p>视频业务属于互联网“杀手级”应用（占用流量多，而且吸引用户）的一种。据统计，目前视频流量占据着互联网大部分的带宽（七、八成甚至更多）。如何向成千上万的用户提供并行的视频服务是一个比较大的挑战。</p>
<p>我们可以将视频认为是固定速度显示的图像序列。（例：24 images/sec）</p>
<p>网络视频特点：</p>
<ul>
<li>高码率：&gt;10x于音频,高的网络带宽需求</li>
<li>可以被压缩</li>
<li>90%以上的网络流量是视频</li>
</ul>
<p>数字化图像：像素的阵列</p>
<ul>
<li>每个像素被若干bits表示</li>
</ul>
<p>编码：使用图像内和图像间的冗余来降低编码的比特数</p>
<ul>
<li>
<p>空间冗余（图像内）</p>
</li>
<li>
<p>时间冗余（相邻的图像间）</p>
<blockquote>
<p>实际上在传输的时候只需要把画面动起来的部分传输就好。</p>
</blockquote>
</li>
</ul>
<blockquote>
<ul>
<li>CBR: (constant bit rate): 以固定速率编码</li>
<li>VBR: (variable bit rate): 视频编码速率随时间的变化而变化</li>
</ul>
</blockquote>
<h3 id="存储视频的流化服务：">存储视频的流化服务：</h3>
<p>视频服务可以通过像文件下载一样的方式将所有数据下载到本地，再进行观看，但这样时间成本太大。流化服务指的是，会有一个缓冲区，可以实现一边下载一边播放的效果。可以极大地减少用户的等待时间。</p>
<p>多媒体流化服务：DASH</p>
<p>DASH: Dynamic Adaptive Streaming over HTTP（动态自适应流化）</p>
<blockquote>
<p>自适应：一个完整的视频被切分成一块一块的小部分（可维持几秒钟的播放），每个部分会处理成不同的解析度（处理成不同的编码标准）。所以在流媒体服务器中会包含一个视频的很多版本。</p>
</blockquote>
<ul>
<li>服务器：
<ul>
<li>将视频文件分割成多个块</li>
<li>每个块独立存储，编码于不同码率（8-10种）</li>
<li>告示文件（manifest file）: 提供不同块的URL</li>
</ul>
</li>
<li>客户端：
<ul>
<li>先获取告示文件</li>
<li>周期性地测量服务器到客户端的带宽</li>
<li>查询告示文件,在一个时刻请求一个块，HTTP头部指定字节范围
<ul>
<li>如果带宽足够，选择最大码率的视频块</li>
<li>会话中的不同时刻，可以切换请求不同的编码块 (取决于当时的可用带宽)</li>
</ul>
</li>
</ul>
</li>
<li>“智能”客户端: 客户端自适应决定
<ul>
<li>什么时候去请求块 ：不至于缓存挨饿，或者溢出</li>
<li>请求什么编码速率的视频块 ：当带宽够用时，请求高质量的视频块)</li>
<li>哪里去请求块 ：可以向离自己近的服务器发送URL，或者向高可用带宽的服务器请求)</li>
</ul>
</li>
</ul>
<blockquote>
<p>服务器如何通过网络向上百万用户同时流化视频内容 (上百万视频内容)?</p>
<ul>
<li>选择一：单个的、大的超级服务中心“megaserver”
<ul>
<li>服务器到客户端路径上跳数较多，瓶颈链路的带宽小导致停顿</li>
<li>“二八规律”决定了网络同时充斥着同一个视频的多个拷贝，效率低（付费高、带宽浪费、效果差）</li>
<li>单点故障点，性能瓶颈</li>
<li>周边网络的拥塞</li>
<li>评价：相当简单，但是这个方法不可扩展</li>
</ul>
</li>
<li>选择二：通过CDN，全网部署缓存节点，存储服务内容，就近为用户提供服务，提高用户体验
<ul>
<li>enter deep: 将CDN服务器深入到许多接入网
<ul>
<li>更接近用户，数量多，离用户近，管理困难</li>
<li>Akamai, 1700个位置</li>
</ul>
</li>
<li>bring home: 部署在少数(10个左右)关键位置，如将服务器簇安装于POP附近（离若干1stISP POP较近）
<ul>
<li>采用租用线路将服务器簇连接起来</li>
<li>Limelight</li>
</ul>
</li>
</ul>
</li>
</ul>
</blockquote>
<p>CDN：在CDN节点中存储内容的多个拷贝</p>
<blockquote>
<p>工作原理：向提供流媒体服务的运营商提供CDN服务，CDN在全球的网络中部署了很多的缓存节点，把一些内容预先的部署在缓存节点中。用户访问时通过域名解析的重定向，定向到离他最近，提供服务质量最好的缓存节点，由这些缓存节点向他提供服务。</p>
</blockquote>
<p>用户从CDN中请求内容：</p>
<ul>
<li>重定向到最近的拷贝，请求内容</li>
<li>如果网络路径拥塞，可能选择不同的拷贝</li>
</ul>
<p>下面看一个具体图例：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CNCDN%E5%9B%BE%E4%BE%8B.png" alt=""></p>
<h2 id="TCP套接字编程">TCP套接字编程</h2>
<h3 id="Socket编程">Socket编程</h3>
<p>Socket: 分布式应用进程之间的门，传输层协议提供的端到端服务接口。</p>
<blockquote>
<p>套接字：应用进程与端到端传输协议（TCP或UDP）之间的门户。</p>
</blockquote>
<p>应用进程使用传输层提供的服务才能够交换报文，实现应用协议，实现应用。</p>
<p>TCP/IP：应用进程使用Socket API访问传输服务</p>
<ul>
<li>地点：界面上的SAP(Socket）</li>
<li>方式：Socket API</li>
</ul>
<p>2种传输层服务的socket类型：</p>
<ul>
<li>TCP: 可靠的、字节流的服务</li>
<li>UDP: 不可靠（数据UDP数据报）服务</li>
</ul>
<h3 id="TCP套接字编程-2">TCP套接字编程</h3>
<p>服务器首先运行，等待连接建立：</p>
<ul>
<li>服务器进程必须先处于运行状态
<ul>
<li>创建欢迎socket</li>
<li>和本地端口捆绑</li>
<li>在欢迎socket上阻塞式等待接收用户的连接</li>
</ul>
</li>
<li>服务器接受来自用户端的请求，解除阻塞式等待，返回一个新的socket（与欢迎socket不一样），与客户端通信
<ul>
<li>允许服务器与多个客户端通信</li>
<li>使用源IP和源端口来区分不同的客户端</li>
</ul>
</li>
</ul>
<p>客户端主动和服务器建立连接：</p>
<ul>
<li>创建客户端本地套接字（隐式捆绑到本地port）
<ul>
<li>指定服务器进程的IP地址和端口号，与服务器进程连接</li>
</ul>
</li>
<li>连接API调用有效时，客户端P与服务器建立了TCP连接</li>
</ul>
<blockquote>
<p>从应用程序的角度：</p>
<p>TCP在客户端和服务器进程之间提供了可靠的、字节流（管道）服务</p>
</blockquote>
<blockquote>
<p>C/S模式的应用样例:</p>
<ol>
<li>
<p>客户端从标准输入装置读取一行字符，发送给服务器</p>
</li>
<li>
<p>服务器从socket读取字符</p>
</li>
<li>
<p>服务器将字符转换成大写，然后返回给客户端</p>
</li>
<li>
<p>客户端从socket中读取一行字符，然后打印出来</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CNTCP%E5%A5%97%E6%8E%A5%E5%AD%97%E7%BC%96%E7%A8%8B.png" alt=""></p>
</li>
</ol>
</blockquote>
<blockquote>
<p>这里我们补充两个结构体：</p>
<ul>
<li>
<p>数据结构 sockaddr_in</p>
<p>IP地址和port捆绑关系的数据结构（标示进程的端节点）</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">sockaddr_in</span> </span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">short</span> sin_familt;    <span class="comment">//地址簇</span></span><br><span class="line">    u_shout sin_port;    <span class="comment">//port端口</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">in_addr</span> <span class="title">sin_addr</span>;</span>    <span class="comment">//IP地址</span></span><br><span class="line">    <span class="keyword">char</span> sin_zero[<span class="number">8</span>];    <span class="comment">//对齐</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>数据结构 hostent</p>
<p>域名和IP地址的数据结构</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">hostent</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">char</span> *h_name;    <span class="comment">//主机域名</span></span><br><span class="line">    <span class="keyword">char</span> **h_aliases;    <span class="comment">//域名的别名</span></span><br><span class="line">    <span class="keyword">int</span> h_length;    <span class="comment">//地址长度</span></span><br><span class="line">    <span class="keyword">char</span> **h_addr_list;    <span class="comment">//IP地址列表</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> h_addr h_addr_list[0];</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>作为调用域名解析函数时的参数</p>
<p>返回后，将IP地址拷贝到 sockaddr_in的IP地址部分</p>
</blockquote>
</li>
</ul>
</blockquote>
<h2 id="UDP套接字编程">UDP套接字编程</h2>
<p>UDP: 在客户端和服务器之间没有连接。</p>
<ul>
<li>没有握手</li>
<li>发送端在每一个报文中明确地指定目标的IP地址和端口号</li>
<li>服务器必须从收到的分组中提取出发送端的IP地址和端口号</li>
</ul>
<p>UDP: 传送的数据可能乱序，也可能丢失。</p>
<blockquote>
<p>进程视角看UDP服务：</p>
<p>UDP 为客户端和服务器提供不可靠的字节组的传送服务。</p>
</blockquote>
<h3 id="UDP套接字编程-2">UDP套接字编程</h3>
<blockquote>
<p>C/S模式的应用样例:</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CNUDP%E5%A5%97%E6%8E%A5%E5%AD%97%E7%BC%96%E7%A8%8B.png" alt=""></p>
</blockquote>
<hr>
<h1>后记</h1>
<p>本篇已完结</p>
<p>（如有补充或错误，欢迎评论区留言）</p>
]]></content>
      <categories>
        <category>学习笔记</category>
      </categories>
      <tags>
        <tag>计算机网络</tag>
      </tags>
  </entry>
  <entry>
    <title>计算机网络学习笔记-网络层</title>
    <url>/2021/06/08/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E7%BD%91%E7%BB%9C%E5%B1%82/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\css\APlayer.min.css"><script src="\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\js\Meting.min.js"></script><h1>前言</h1>
<p><em>正在学习计算机网络这门课程，顺便做个笔记，记录一下知识点。</em></p>
<blockquote>
<p>参考资料：</p>
<p>中科大郑烇老师全套《计算机网络（自顶向下方法 第7版，James F.Kurose，Keith W.Ross）》课程：<a href="https://www.bilibili.com/video/BV1JV411t7ow?p=1">https://www.bilibili.com/video/BV1JV411t7ow?p=1</a></p>
<p>《计算机网络（自顶向下方法 第7版，James F.Kurose，Keith W.Ross）》</p>
</blockquote>
<hr>
<h1>第四章：网络层</h1>
<h2 id="导论">导论</h2>
<p>网络层所提供的服务：</p>
<ul>
<li>在发送主机和接收主机对之间传送段（segment）
<ul>
<li>在发送端将段封装到数据报中</li>
<li>在接收端，将段上交给传输层实体</li>
</ul>
</li>
<li>网络层协议存在于每一个主机和路由器
<ul>
<li>路由器检查每一个经过它的IP数据报的头部</li>
</ul>
</li>
</ul>
<p>网络层的关键功能：<strong>转发</strong>和<strong>路由</strong></p>
<ul>
<li>
<p>转发：将分组从路由器的输入接口转发到合适的输出接口</p>
<p>这是一个局部的功能</p>
<p>是数据平面的功能</p>
<blockquote>
<p>路由器从不同的端口接收分组，再通过合适的端口将其分发出去。</p>
</blockquote>
</li>
<li>
<p>路由：使用路由算法来决定分组从发送主机到目标接收主机的路径</p>
<p>这是一个全局的功能</p>
<p>是控制平面的功能</p>
<ul>
<li>路由选择算法</li>
<li>路由选择协议</li>
</ul>
</li>
</ul>
<blockquote>
<p>举个例子说明转发与路由：</p>
<p>计算机网络一口气学了好长时间，打算去郊区的公园散散心：</p>
<ul>
<li>转发就好像是在行程中通过每个路口时的决策，从哪里进入路口，又从哪里出去</li>
<li>路由就像是在出发前用手机导航规划全局路径的过程</li>
</ul>
</blockquote>
<h3 id="数据平面与控制平面">数据平面与控制平面</h3>
<ul>
<li>
<p>数据平面：</p>
<p>局部的处理，每个路由的功能：</p>
<ul>
<li>决定从路由器输入端口到达的分组如何转发到输出端口</li>
<li>转发功能：
<ul>
<li>传统方式：基于目标地址 + 转发表</li>
<li>SDN方式：基于多个字段 + 流表</li>
</ul>
</li>
</ul>
</li>
<li>
<p>控制平面：</p>
<p>全局的处理，网络范围内的逻辑：</p>
<ul>
<li>决定数据报如何在路由器之间路由，决定数据报从源到目标主机之间的端到端路径</li>
<li>两个个控制平面方法：
<ul>
<li>传统的路由算法: 在路由器中被实现（路由表）</li>
<li>SDN（software-defined networking，软件定义网络）：在远程的服务器中实现</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>传统方式：每一个路由器既实现了数据平面的功能，也实现了控制平面的功能。</p>
<ul>
<li>
<p>在每一个路由器中的单独路由器算法元件，在控制平面进行交互</p>
<ul>
<li>控制平面：路由算法决定端到端路径（分布式操作）</li>
<li>数据平面：IP协议根据转发表决定了IP数据报在此路由器上的局部转发（分布式操作）</li>
<li>二者是紧耦合的，在一个路由实体中</li>
</ul>
<blockquote>
<p>在路由器之上有路由实体，这些路由实体之间要交换路由信息。然后分布式的计算路由表，交给IP协议实体，然后IP协议实体根据路由表进行匹配，最后转发。</p>
</blockquote>
<ul>
<li>带来的问题：分布式的操作使得修改路由器的运行逻辑是一件困难的事情</li>
</ul>
</li>
</ul>
<p>SDN方式：逻辑集中的控制平面</p>
<ul>
<li>一个不同的（通常是远程的）控制器与本地控制代理（CAs）交互
<ul>
<li>控制平面的功能集中在一个服务器（远程控制器，Remote Controller）上去实现，计算得到流表，将其交给每一个分组交换设备，分组交换设备对流表进行装载，对接收到的IP实体做多字段的匹配（传统方式只匹配目标主机的IP地址），按照流表对应的动作对IP实体进行操作，包括：转发，阻塞（block），泛洪等</li>
<li>分组交换设备仅按照远端的服务器计算发来的流表进行操作，这样改变其行为逻辑就会简单许多。</li>
<li>由此分析：控制平面是集中式的、远程的，便于修改。</li>
</ul>
</li>
</ul>
<h3 id="网络服务模型">网络服务模型</h3>
<p>从发送方主机到接收方主机传输数据报的“通道”，网络提供的服务模型：</p>
<ul>
<li>对于单个数据报的服务：
<ul>
<li>可靠传送</li>
<li>延迟保证，如：少于40ms的延迟</li>
</ul>
</li>
<li>对于数据报流的服务：
<ul>
<li>保序数据报传送</li>
<li>保证流的最小带宽</li>
<li>分组之间的延迟差</li>
</ul>
</li>
<li>连接建立：在某些网络架构中是第三个重要的功能
<ul>
<li>在分组传输之前，在两个主机之间，在通过一些路由器所构成的路径上建立一个网络层连接（涉及到路由器）</li>
<li>网络层和传输层连接服务区别：
<ul>
<li>网络层: 在两个主机之间，涉及到路径上的一些路由器</li>
<li>传输层: 在两个进程之间，很可能只体现在端系统上(TCP连接)</li>
</ul>
</li>
</ul>
</li>
</ul>
<img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CN网络层服务模型.png" style="zoom:80%;" />
<h2 id="虚电路和数据报网络">虚电路和数据报网络</h2>
<p>网络层能够在两台主机之间提供无连接的服务或有连接的服务</p>
<ul>
<li>数据报网络（datagram network）仅在网络层提供无连接服务</li>
<li>虚电路网络（Virtual-Circuit，VC）仅在网络层提供连接服务</li>
</ul>
<p>由上一章我们知道运输层也可以实现面向连接的服务，但是这与网络层实现连接服务是不同的：</p>
<ul>
<li>
<p>网络层提供的是主机到主机（host-to-host）间的服务</p>
<blockquote>
<p>运输层提供进程到进程间的服务</p>
</blockquote>
</li>
<li>
<p>网络层连接服务除了在端系统中，也在位于网络核心的路由器中出现</p>
<blockquote>
<p>运输层的连接服务只在端系统中实现</p>
</blockquote>
</li>
</ul>
<h3 id="虚电路网络">虚电路网络</h3>
<p>虚电路网络从源头到目的地的路径表现得很像电话线路。</p>
<p>一条虚电路的组成如下：</p>
<ul>
<li>
<p>源和目的主机之间的路径（即一系列链路和路由器）</p>
</li>
<li>
<p>VC号，沿着该路径的每段链路的一个号码</p>
</li>
<li>
<p>沿着该路径的每台路由器中的转发表表项</p>
<blockquote>
<p>属于一条虚电路的分组将在它的首部携带一个VC号。因为一条虚电路在每条链路上可能具有不同的VC号，每台中间路由器必须用一个新的VC号替代每个传输分组的VC号，该新的VC号从转发表获得。</p>
</blockquote>
</li>
</ul>
<p>下图展示了一个简单的虚电路网络和对应路由器的转发表</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CN%E8%B7%AF%E7%94%B1%E5%99%A8%E8%BD%AC%E5%8F%91%E8%A1%A8.png" alt=""></p>
<blockquote>
<p>虚电路中路由器维持着连接状态信息</p>
</blockquote>
<p><em>（埋个坑，以后补充）</em></p>
<h2 id="路由器的组成">路由器的组成</h2>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CN%E8%B7%AF%E7%94%B1%E5%99%A8%E7%BB%93%E6%9E%84%E6%A6%82%E5%86%B52.png" alt=""></p>
<p>路由：运行路由选择算法／协议 (RIP, OSPF, BGP)-生成路由表</p>
<p>路由器的组成包括：</p>
<ul>
<li>输入端口</li>
<li>输出端口</li>
<li>交换机（high-seed switching fabric）将输入端口与输出端口连接起来，构成局部的转发（根据路由表）。</li>
</ul>
<h3 id="输入端口">输入端口</h3>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CN%E8%B7%AF%E7%94%B1%E8%BE%93%E5%85%A5%E7%AB%AF%E5%8F%A3%E5%8A%9F%E8%83%BD.png" alt=""></p>
<ul>
<li>
<p>物理层：把物理信号转化为数字信号（Bit级接收）</p>
</li>
<li>
<p>数据链路层：链路层协议动作、解封装得到IP协议实体</p>
<blockquote>
<p>判断帧头、帧尾，利用CRC检查出错（具体见下一章）</p>
</blockquote>
</li>
<li>
<p>网络层：通过路由表将分组进行转发</p>
<p>分布式交换：</p>
<ul>
<li>根据数据报头部的信息如：目的地址，在输入端口内存中的转发表中查找合适的输出端口（匹配+行动）</li>
<li>基于目标的转发：仅仅依赖于IP数据报的目标IP地址（传统方法）</li>
<li>通用转发：基于头部字段的任意集合进行转发</li>
</ul>
</li>
<li>
<p>输入端口缓存：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CN%E8%B7%AF%E7%94%B1%E8%BE%93%E5%85%A5%E7%AB%AF%E5%8F%A3%E7%BC%93%E5%AD%98.png" alt=""></p>
<p>在输入端口会有一个队列，用于缓解输出、输入的不一致性。</p>
<ul>
<li>
<p>当交换机构的速率小于输入端口的汇聚速率时， 在输入端口可能要排队</p>
<blockquote>
<p>排队延迟以及由于输入缓存溢出可能造成丢失</p>
</blockquote>
</li>
<li>
<p>排在队头的数据报阻止了队列中其他数据报向前移动</p>
</li>
</ul>
</li>
</ul>
<h3 id="交换结构">交换结构</h3>
<p>交换速率：分组可以按照该速率从输入传输到输出</p>
<ul>
<li>运行速度经常是输入/输出链路速率的若干倍</li>
<li>如果是N 个输入端口：交换机构的交换速度是输入线路速度的N倍比较理想，才不会成为瓶颈</li>
</ul>
<p>下面我们来分析分组如何从输入端口转向输出端口：</p>
<p>三种典型的交换机构</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CN%E4%B8%89%E7%A7%8D%E5%85%B8%E5%9E%8B%E7%9A%84%E4%BA%A4%E6%8D%A2%E6%9C%BA%E6%9E%84.png" alt=""></p>
<ul>
<li>
<p>基于memory（内存）</p>
<ul>
<li>
<p>第一代路由器</p>
</li>
<li>
<p>路由器就是一个计算机，通过软件的方式实现路由</p>
</li>
<li>
<p>输入端口和输出端口分别插入网卡，从输入端口接收来的分组，通过系统总线，交给路由软件，匹配路由表，最后决定从哪一个网口发出。</p>
</li>
<li>
<p>转发速率被内存的带宽限制 (数据报通过BUS两遍)</p>
</li>
<li>
<p>一次只能转发一个分组</p>
</li>
</ul>
</li>
<li>
<p>基于bus（总线）</p>
<ul>
<li>数据报通过共享总线，从输入端口转发到输出端口</li>
<li>总线竞争: 交换速度受限于总线带宽</li>
<li>一次处理一个分组</li>
<li>总线速度能达到：Cisco 1900：1 Gbps；Cisco 5600：32 Gbps。对于接 入或企业级路由器，速度足够（ 但不适合区域或骨干网络）</li>
</ul>
</li>
<li>
<p>基于crossbar（互联网络）</p>
<ul>
<li>同时并发转发多个分组，克服总线带宽限制</li>
<li>当分组从端口A到达，转给端口Y；控制器短接相应的两个总线</li>
<li>高级设计：将数据报分片为固定长度的信元，通过交换网络交换（分组长度是不同的）</li>
<li>Cisco12000：以60Gbps的交换速率通过互联网络</li>
</ul>
</li>
</ul>
<h3 id="输出端口">输出端口</h3>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CN%E8%B7%AF%E7%94%B1%E8%BE%93%E5%87%BA%E7%AB%AF%E5%8F%A3%E5%8A%9F%E8%83%BD.png" alt=""></p>
<ul>
<li>
<p>网络层：接收fabric传来的分组，将分组排队，将分组交给对应链路层的网卡</p>
<blockquote>
<ul>
<li>当数据报从交换机构的到达速度比传输速率快 就需要输出端口缓存</li>
<li>同样，如果队列溢出，分组丢失</li>
<li>由调度规则选择排队的数据报进行传输（并不一定是先来先服务）</li>
</ul>
</blockquote>
</li>
<li>
<p>链路层：封装成帧（添加帧头、帧尾、目标MAC地址）</p>
</li>
<li>
<p>物理层：将数字信号转化为物理信号，将数据传出去</p>
</li>
<li>
<p>输出端口排队：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CN%E8%B7%AF%E7%94%B1%E8%BE%93%E5%87%BA%E7%AB%AF%E5%8F%A3%E7%BC%93%E5%AD%98.png" alt=""></p>
<ul>
<li>假设交换速率R<sub>switch</sub>是R<sub>line</sub>的N倍（N：输入端口的数量）</li>
<li>当多个输入端口同时向输出端口发送时，缓冲该分组（当通过交换网络到达的速率超过输出速率则缓存）</li>
<li>排队带来延迟，由于输出端口缓存溢出则丢弃数据报（不一定丢弃最后进入队列的分组，取决于规则）</li>
</ul>
</li>
</ul>
<h3 id="调度机制">调度机制</h3>
<p>调度: 选择下一个要通过链路传输的分组</p>
<ul>
<li>FIFO (first in first out) scheduling: 按照分组到来的次序发送
<ul>
<li>丢弃策略：
<ul>
<li>tail drop: 丢弃刚到达的分组</li>
<li>priority: 根据优先权丢失/移除分组</li>
<li>random: 随机地丢弃/移除</li>
</ul>
</li>
</ul>
</li>
<li>优先权调度：发送最高优先权的分组
<ul>
<li>多类，不同类别有不同的优先权
<ul>
<li>类别可能依赖于标记或者其他的头部字段（如：IP source/dest, port numbers, ds，等）</li>
<li>先传高优先级的队列中的分组，除非没有</li>
<li>高（低）优先权中的分组传输次序：FIFO</li>
</ul>
</li>
</ul>
</li>
<li>轮转 （Round Robin (RR) ）调度：
<ul>
<li>多类</li>
<li>循环扫描不同类型的队列, 发送完一类的一个分组，再发送下一个类的一个分组，循环所有类</li>
</ul>
</li>
<li>Weighted Fair Queuing (WFQ，加权公平队列)：
<ul>
<li>一般化的Round Robin</li>
<li>在一段时间内，每个队列得到的服务时间是：W<sub>i</sub>  / (XIGMA(W<sub>i</sub> )) ×t，和权重成正比</li>
<li>每个类在每一个循环中获得不同权重的服务量</li>
</ul>
</li>
</ul>
<h2 id="IP协议（Internet-Protocol）">IP协议（Internet Protocol）</h2>
<p>IP协议在整个协议栈的位置：</p>
<img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CNIP协议栈位置.png" style="zoom:80%;" />
<h3 id="IP数据报格式">IP数据报格式</h3>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CNIP%E6%95%B0%E6%8D%AE%E6%8A%A5%E6%A0%BC%E5%BC%8F.png" alt=""></p>
<ul>
<li>固定20字节头部（一行4字节，固定一共5行）</li>
<li>除固定20字节头部外有可选项部分</li>
<li>body部分（数据载荷部分）
<ul>
<li>TCP的段</li>
<li>UDP的数据报</li>
</ul>
</li>
</ul>
<blockquote>
<p>说明：</p>
<ul>
<li>
<p>ver（IP 协议版本号，4bit）：4 → IPv4； 6 → IPv6</p>
</li>
<li>
<p>head.len（头部长度，4bit）：以字节为单位</p>
</li>
<li>
<p>type of service（数据类型，8bit）：标识数据报载荷的类型，为了使分组调度时有依据（由于IP网络运营模式，现在基本不用）</p>
</li>
<li>
<p>length（数据报总长，16bit）：标识此IP数据报的总长，以字节为单位</p>
</li>
<li>
<p>分片/重组使用（如果IP数据报超过链路层的最大传输单元MTU，就会分片）</p>
<ul>
<li>16-bit identifier（16bit）：判断分片是否是同一个IP数据报</li>
<li>flags（4bit）：1 → 后面还有分片；0 → 后面无分片（此分片是最后一个）</li>
<li>fragment offset（12bit）：偏移量</li>
</ul>
</li>
<li>
<p>time to live（TTL，8bit）：最大剩余段数（每经过一个路由器减一）</p>
</li>
<li>
<p>upper layer（上层协议，8bit）：决定将载荷部分交给上层哪种类型的协议实体（例：TCP、UDP等）</p>
</li>
<li>
<p>Internet checksum（头部校验和，16bit）：数据部分不进行校验，只判断头部是否异常</p>
<blockquote>
<p>IPv6取消了该字段</p>
</blockquote>
</li>
<li>
<p>32 bit source IP address（32位源IP地址）</p>
</li>
<li>
<p>32 bit destination IP address（32位目标IP地址）</p>
</li>
<li>
<p>data：数据报的载荷部分</p>
</li>
<li>
<p>Options（可选部分）：例如，每经过一个交换节点，该地址会被记录在option中，即形成一个经过的路由器的列表，这样一来，目标端就知道该分组的传输路径。</p>
</li>
</ul>
</blockquote>
<h3 id="IP-分片和重组">IP 分片和重组</h3>
<p>IP 分片的原因：</p>
<p>网络链路有MTU (最大传输单元)：链路层帧所携带的最大数据长度。如果IP数据报长度大于MTU，那么就需要将其分片。</p>
<blockquote>
<p>不同的链路类型有不同的MTU</p>
</blockquote>
<p>思考，如果仅仅是将一个IP数据报“粗暴”地直接分片，那么第一片包含头部信息，路由器知道如何处理，那么其他片没有头部信息，路由器便无法识别，显然这样是不行的。那么分片就需要一些“手段”：</p>
<p>假设要传输一个4000字节的数据报：20字节头部 + 3980字节数据</p>
<p>链路层最大传输单元（MTU）为：1500字节</p>
<ul>
<li>
<p>第一片：20Bytes头部 + 1480Bytes数据</p>
<ul>
<li>flags = 1</li>
<li>fragment offset = 0</li>
</ul>
</li>
<li>
<p>第二片：20Bytes头部 + 1480Bytes数据</p>
<ul>
<li>flags = 1</li>
<li>fragment offset = 1480 / 8 = 185</li>
</ul>
</li>
<li>
<p>第三片：20Bytes头部 + 1020Bytes数据</p>
<ul>
<li>flags = 0</li>
<li>fragment offset = 2960 / 8 = 370</li>
</ul>
<blockquote>
<p>注意：在计算偏移量的时候需要除以8（以8字节为单位）</p>
</blockquote>
</li>
</ul>
<p>每一片都到最后的目标主机才进行重组，中间转发节点不重组。</p>
<p>如果到达目标主机的分片有丢失，那么分片全部丢弃。</p>
<h3 id="IPv4">IPv4</h3>
<h4 id="IP编址">IP编址</h4>
<p>IP地址：32位标示，对主机或者路由器的接口编址</p>
<ul>
<li>
<p>一个IP地址和一个接口相关联</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CNIP%E5%8F%B7%E4%B8%BE%E4%BE%8B.png" alt=""></p>
</li>
</ul>
<p>接口: 主机/路由器和物理链路的连接处</p>
<ul>
<li>路由器通常拥有多个接口</li>
<li>主机也有可能有多个接口</li>
<li>IP地址和每一个接口关联</li>
</ul>
<h4 id="子网（Subnets-）">子网（Subnets)）</h4>
<p>如下图，是一个包含三个子网的网络</p>
<img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CN子网示例.png" style="zoom:80%;" />
<p>必备的两个条件：</p>
<ul>
<li>IP地址
<ul>
<li>子网部分（高位bits），也称子网号：每个IP是相同的</li>
<li>主机部分（低位bits）</li>
</ul>
</li>
<li>在子网内部分组的收发不需要借助路由器（仅通过交换机），一跳可达。</li>
</ul>
<blockquote>
<p>子网的判断：</p>
<ul>
<li>
<p>要判断一个子网, 将每一个接口从主机或者路由器上分开,构成了一个个网络的孤岛</p>
</li>
<li>
<p>每一个孤岛（网络）都是一个都可以被称之为subnet</p>
</li>
<li>
<p>如下图，共有6个子网：</p>
<img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CN子网示例2.png" style="zoom:67%;" />
</li>
</ul>
</blockquote>
<h4 id="IP地址分类">IP地址分类</h4>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CNIP%E5%9C%B0%E5%9D%80%E7%B1%BB%E5%9E%8B%E5%88%92%E5%88%86.png" alt=""></p>
<p>A类地址：地址最高位为0，第一个字节的其它7位为网络号，后面三个字节（24bit）为主机号</p>
<ul>
<li>一共有126个网络（2<sup>7</sup> - 2，全零和全一的网络号不使用）</li>
<li>每个网络有2<sup>24</sup> - 2个主机</li>
</ul>
<p>B类地址：地址最高两位为10，前两个字节的其他14位为网络号，后面两个字节（16bit）为主机号</p>
<ul>
<li>一共有2<sup>14</sup> - 2个网络</li>
<li>每个网络有2<sup>16</sup> - 2个主机</li>
</ul>
<p>C类地址：地址最高三位为110，前三个字节的其他21位为网络号，后面一个字节（8bit）为主机号</p>
<ul>
<li>一共有2<sup>21</sup> - 2个网络</li>
<li>每个网络有2<sup>8</sup> - 2个主机</li>
</ul>
<blockquote>
<p>A、B、C类地址称为：“单播地址”</p>
<p>通常获取的都是C类地址</p>
</blockquote>
<p>D类地址（“组播地址”）：最高4位为1110，其余位为组播地址（Multicast address）</p>
<p>E类地址（预留）：最高5位为11110</p>
<blockquote>
<ul>
<li>互联网是以网络（局域网）为单位进行路由信息的通告，传播和计算。
<ul>
<li>每个网络是路由表中的一个表项，而非IP地址</li>
</ul>
</li>
<li>子网信息可以进一步聚集，更高层次可以以广域网为单位。</li>
</ul>
</blockquote>
<p>特殊的IP地址：</p>
<ul>
<li>
<p>约定：</p>
<ul>
<li>
<p>子网部分: 全为0 → 本网络</p>
</li>
<li>
<p>主机部分: 全为0 → 本主机</p>
</li>
<li>
<p>主机部分: 全为1 → 广播地址，这个网路所有的主机</p>
</li>
<li>
<p>127.X.X.X：回路地址（测试地址）：即TCP/UDP数据报传到IP层面后返回</p>
<blockquote>
<p>类似我们在一个web项目的时候，本地测试模拟网络状态，通常地址为127.0.0.1（实际上访问的是本机）</p>
</blockquote>
</li>
</ul>
</li>
</ul>
<p>内网(专用)IP地址：</p>
<ul>
<li>专用地址：地址空间的一部份供专用地址使用</li>
<li>永远不会被当做公用地址来分配, 不会与公用地址重复
<ul>
<li>只在局部网络中有意义，区分不同的设备</li>
</ul>
</li>
<li>路由器不对目标地址是专用地址的分组进行转发</li>
<li>专用地址范围：
<ul>
<li>Class A： 10.0.0.0 ~ 10.255.255.255    MASK 255.0.0.0</li>
<li>Class B： 172.16.0.0 ~ 172.31.255.255    MASK 255.255.0.0</li>
<li>Class C： 192.168.0.0 ~ 192.168.255.255    MASK 255.255.255.0</li>
</ul>
</li>
</ul>
<h4 id="无类域间路由（CIDR）">无类域间路由（CIDR）</h4>
<p>CIDR: Classless InterDomain Routing （无类域间路由）</p>
<blockquote>
<p>上述A、B、C类地址存在明确的划分（通过IP号），但这会存在一个问题，A类地址不必说，数量很少，瞬间就被分配完了，B类地址也是一样的道理，但是这类地址可分配的主机数量很多，通常没有企业单位会拥有如此多待分配的主机，为了充分利用资源，所以出现了无类域间路由。</p>
</blockquote>
<p>路由器如何区分无类域间路由？仅凭前几位是无法做到的（没有明确的网络号和主机号位数），因此伴随而生的子网掩码出现了：</p>
<ul>
<li>
<p>如果位为1：表示该位为网络位（子网部分）</p>
</li>
<li>
<p>如果位为0：表示该位为主机位</p>
</li>
<li>
<p>子网部分可以在任意的位置</p>
</li>
<li>
<p>地址格式: <code>a.b.c.d/x</code>, 其中 x 是地址中子网号的长度（另一种表示方式）</p>
<img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CN子网掩码示例.png" style="zoom:67%;" />
</li>
</ul>
<blockquote>
<p>给定一个IP地址，计算网络号：将IP地址与对应的子网掩码进行<code>与</code>运算</p>
</blockquote>
<blockquote>
<p>原始的A、B、C类网络的子网掩码分别是：</p>
<ul>
<li>A：255.0.0.0 ：11111111 00000000 0000000 00000000</li>
<li>B：255.255.0.0：11111111 11111111 0000000 00000000</li>
<li>C：255.255.255.0：11111111 11111111 11111111 00000000</li>
</ul>
</blockquote>
<p>路由信息的匹配，分析路由表表项：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CN%E8%BD%AC%E5%8F%91%E8%A1%A8%E5%88%86%E6%9E%90.png" alt=""></p>
<blockquote>
<ul>
<li>目标子网号</li>
<li>子网掩码</li>
<li>下一跳</li>
<li>端口</li>
</ul>
</blockquote>
<ul>
<li>获得IP数据报的目标地址，将其与子网掩码进行<code>与</code>运算，得到网络号</li>
<li>对照路由表的目标子网号进行匹配：
<ul>
<li>如果找到，则按照表项对应的接口转发该数据报</li>
<li>如果都没有找到,则使用默认表项转发数据报</li>
</ul>
</li>
</ul>
<p>一个主机如何获得IP地址：</p>
<ul>
<li>
<p>系统管理员手动分配，每个操作系统不一样</p>
</li>
<li>
<p>DHCP（ Dynamic Host Configuration Protocol）:从服务器中动态获得一个IP地址</p>
<ul>
<li>
<p>基于UDP的服务</p>
</li>
<li>
<p>允许主机在加入网络的时候，动态地从服务器那里获得IP地址：</p>
<ul>
<li>可以更新对主机在用IP地址的租用期（租期快到了）</li>
<li>重新启动时，允许重新使用以前用过的IP地址</li>
<li>支持移动用户加入到该网络（短期在网）</li>
</ul>
</li>
<li>
<p>DHCP工作概况：</p>
<ul>
<li>
<p>主机广播“DHCP discover” 报文[可选]</p>
</li>
<li>
<p>DHCP 服务器用 “DHCP offer”提供报文响应[可选]</p>
</li>
<li>
<p>主机请求IP地址：发送 “DHCP request” 报文</p>
</li>
<li>
<p>DHCP服务器发送地址：“DHCP ack” 报文</p>
<blockquote>
<p>最开始，主机用32位全零的地址作为本机地址，以32位全一的地址进行广播</p>
<img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CNDHCP过程.png" style="zoom: 80%;" />
<p>DHCP 返回:</p>
<ul>
<li>IP 地址</li>
<li>第一跳路由器的IP地址（默认网关）</li>
<li>DNS服务器的域名和IP地址</li>
<li>子网掩码 (指示地址部分的网络号和主机号)</li>
</ul>
</blockquote>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>一个主机如何获得一个网络的子网部分：</p>
<ul>
<li>一个机构，从ISP获得地址块中分配一个小地址块，该机构可以进行小地址块的分配</li>
<li>ICANN: Internet Corporation for Assigned Names and Numbers，通过该机构直接申请IP地址
<ul>
<li>分配地址</li>
<li>管理DNS</li>
<li>分配域名，解决冲突</li>
</ul>
</li>
</ul>
<p>路由聚集（route aggregation）：是一种层次编址的方式，目的是减少路由信息通告、计算的数量。在路由匹配表项的时候，数量要大大减少。</p>
<blockquote>
<p>在路由聚集时，如果出现一个IP地址能匹配到多个路由表项（这是可能出现的）：采用最长前缀匹配，因为更精确。</p>
</blockquote>
<h3 id="NAT（Network-Address-Translation）">NAT（Network Address Translation）</h3>
<p>NAT：网络地址转换</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CNNET%E7%A4%BA%E4%BE%8B.png" alt=""></p>
<p>内网主机向外部发送分组时，经过路由，将内网地址转换为外网地址；同样的，外网的分组经路由传向内网时，将外网地址转换为内网地址。（内网节点共用一个IP）</p>
<p>使用NAT的原因：本地网络只有一个有效IP地址（IP地址申请使用需要付费）</p>
<ul>
<li>不需要从ISP分配一块地址，可用一个IP地址用于所有的（局域网）设备 → 省钱</li>
<li>可以在局域网改变设备的地址情况下而无须通知外界</li>
<li>可以改变ISP（地址变化）而不需要改变内部的设备地址，更换方便</li>
<li>局域网内部的设备没有明确的地址，对外是不可见的 → 安全</li>
</ul>
<p>若要实现NAT，则路由器必须支持NAT：</p>
<ul>
<li>
<p>外出数据包：替换源地址和端口号为NAT IP地址和新的端口号，目标IP和端口不变</p>
<blockquote>
<p>远端的C/S将会用NAP IP地址，新端口号作为目标地址</p>
</blockquote>
</li>
<li>
<p>记住每个转换替换对（在NAT转换表中）</p>
<blockquote>
<p>源IP | 端口    vs    NAP IP | 新端口</p>
</blockquote>
</li>
<li>
<p>进入数据包：替换目标IP地址和端口号，采用存储在NAT表中的mapping表项，用（源IP，端口）</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CNNET%E7%A4%BA%E4%BE%8B2.png" alt=""></p>
</li>
</ul>
<p>对于NAT是有争议的：</p>
<ul>
<li>
<p>路由器只应该对第3层做信息处理（物理层、链路层、网络层），而这里对端口号（4层，传输层）作了处理，显然不符合分层规范。</p>
</li>
<li>
<p>违反了end-to-end 原则：</p>
<ul>
<li>
<p>端到端原则：复杂性放到网络边缘</p>
<p>无需借助中转和变换，就可以直接传送到目标主机，显然这里路由器也承担了很多工作</p>
</li>
<li>
<p>NAT可能要被一些应用设计者考虑，例如：P2P applications</p>
</li>
<li>
<p>外网的机器无法主动连接到内网的机器上（NAT穿越）</p>
</li>
</ul>
</li>
<li>
<p>NAT出现的原因是为了解决IP地址数量不够分配的情况，现在IP地址短缺的问题可以被IPv6解决</p>
</li>
<li>
<p>NAT穿越：</p>
<p>很明显，内网的设备主动联系外网设备是容易做到的（路由器会在分组发出的时候记录下映射关系），但是如果外网设备主动连接内网中的设备是不可以的，并不知道具体的端口号。</p>
<p>解决方案：</p>
<ul>
<li>
<p>方案一：把路由表固定写死，映射关系是确定的，这样外部来的分组就可以查路由表，交给内网对应的主机。</p>
</li>
<li>
<p>方案二： Universal Plug and Play (UPnP) 协议 / Internet Gateway Device (IGD) 协议</p>
<p>允许内网主机：</p>
<ul>
<li>
<p>获知网络的公共 IP地址</p>
</li>
<li>
<p>列举存在的端口映射</p>
</li>
<li>
<p>增/删端口映射 (在租用时间内)</p>
<blockquote>
<p>自动化静态NAT端口映射配置：外部分组到来，先查询路由表的映射关系，如果没有找到对应的端口，自动分配一个主机，赋予其端口号。</p>
</blockquote>
</li>
</ul>
</li>
<li>
<p>方案三：中继（used in Skype）</p>
<ul>
<li>NAT后面的服务器主动建立和中继的连接（强调：需要主动连接）</li>
<li>外部的客户端链接到中继</li>
<li>中继在两个连接之间桥接</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="ICMP">ICMP</h3>
<p>因特网控制报文协议（ Internet Control Message Protocol，ICMP）</p>
<p>ICMP最典型的用途：差错报告</p>
<ul>
<li>由主机、路由器、网关用于 传达网络层控制信息
<ul>
<li>错误报告：主机不可到达、 网络、端口、协议</li>
<li>Echo 请求和回复（ping）</li>
</ul>
</li>
<li>ICMP处在网络层，但是是在IP协议的上面
<ul>
<li>ICMP消息由IP数据报承载</li>
</ul>
</li>
</ul>
<p>ICMP报文：类型（Type）、编码（Code）、引起ICMP报文首次生成的IP数据报首部和前8个字节内容（以便发送方能确定引发该差错的数据报）</p>
<table>
<thead>
<tr>
<th>ICMP类型</th>
<th>编码</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>0</td>
<td>回显回答（对ping的回答）</td>
</tr>
<tr>
<td>3</td>
<td>0</td>
<td>目的网络不可达</td>
</tr>
<tr>
<td>3</td>
<td>1</td>
<td>目的主机不可达</td>
</tr>
<tr>
<td>3</td>
<td>2</td>
<td>目的协议不可达</td>
</tr>
<tr>
<td>3</td>
<td>3</td>
<td>目的端口不可达</td>
</tr>
<tr>
<td>3</td>
<td>6</td>
<td>目的网络未知</td>
</tr>
<tr>
<td>3</td>
<td>7</td>
<td>目的主机未知</td>
</tr>
<tr>
<td>4</td>
<td>0</td>
<td>源抑制（拥塞控制）</td>
</tr>
<tr>
<td>8</td>
<td>0</td>
<td>回显请求</td>
</tr>
<tr>
<td>9</td>
<td>0</td>
<td>路由器通告</td>
</tr>
<tr>
<td>10</td>
<td>0</td>
<td>路由器发现</td>
</tr>
<tr>
<td>11</td>
<td>0</td>
<td>TTL过期</td>
</tr>
<tr>
<td>12</td>
<td>0</td>
<td>IP首部损坏</td>
</tr>
</tbody>
</table>
<h4 id="Traceroute">Traceroute</h4>
<ul>
<li>源主机发送一系列UDP段给目标主机
<ul>
<li>第一个：TTL =1</li>
<li>第二个： TTL=2</li>
<li>依次递增</li>
<li>一个不可达的端口号</li>
</ul>
</li>
<li>当 nth 数据报到达 nth 路由器：
<ul>
<li>路由器抛弃数据报</li>
<li>然后发送一个给源主机的ICMP报文 (type 11, code 0) → TTL过期</li>
<li>报文包括了路由器的名字和IP地址</li>
</ul>
</li>
<li>当 ICMP报文到达，源端计算RTT</li>
<li>标准的Traceroute程序实际上用相同的TTL发送3个一组的分组；因此Traceroute输出对每个TTL提供了3个结果</li>
<li>停止的判据：
<ul>
<li>UDP 段最终到达目标主机</li>
<li>目标返回给源主机ICMP “端口不可达”报文 (type 3, code 3)</li>
<li>当源主机获得这个报文时，停止</li>
</ul>
</li>
</ul>
<hr>
<h3 id="IPv6">IPv6</h3>
<p>引入IPv6的动机：IPv4的32-bit地址空间将会被很快用完</p>
<p>其他的原因：使用IPv4时路由器负担太重</p>
<blockquote>
<p>IP数据报在每次经过路由时TTL就会减一，相应的头部长度就会变，首部校验和也会跟着改变，那么每一跳路由都需要进行校验和，此外上述提到的分片，加大了路由转发的负担。</p>
</blockquote>
<p>IPv6数据报格式：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CNIPv6%E6%A0%BC%E5%BC%8F.png" alt=""></p>
<blockquote>
<p>说明：</p>
<ul>
<li>
<p>固定的40字节头部</p>
</li>
<li>
<p>数据报传输过程中，不允许分片</p>
<blockquote>
<p>考虑如果分组太大，超过链路层的最大传输单元MTU，该如何处理？</p>
<p>分组会被丢掉，同时向源主机发送一个ICMPv6的错误报告，目的让源主机重新发送更小的分组。</p>
</blockquote>
</li>
<li>
<p>长度由32位变为128位</p>
</li>
<li>
<p>Priority（pri）: 标示流中数据报的优先级</p>
</li>
<li>
<p>Flow Label（流标签）：标示数据报在一个“flow”</p>
<p>同一个IP发送出去的同一个会话的数据，可以形成一个流，让网络对同一个流的数据做同样的处理</p>
</li>
<li>
<p>Next header：标示上层协议（相当于IPv4中的upper layer（上层协议））</p>
<p>标识传来的数据应该交给上层的哪一个协议实体去处理。</p>
</li>
<li>
<p>hop limit：（相当于IPv4中的TTL）</p>
</li>
</ul>
<p>相比于IPv4的其他变化：</p>
<ul>
<li>Checksum: 被移除掉，降低在每一段中的处理速度</li>
<li>Options: 允许，但是在头部之外, 被 “Next Header” 字段标示</li>
<li>ICMPv6: 新增ICMP的新版本
<ul>
<li>附加了报文类型，例如：“Packet Too Big”</li>
<li>增加多播组管理功能</li>
</ul>
</li>
</ul>
</blockquote>
<p>IPv4到IPv6的过渡：</p>
<p>不是所有的路由器都能够同时升级的，那么在IPv4和IPv6路由器混合时，网络如何运转？</p>
<p>同时升级不可行，因此只能采用平滑升级。</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CNIPv4%E5%88%B0IPv6%E7%9A%84%E8%BF%87%E6%B8%A1.png" alt=""></p>
<blockquote>
<p>分析上图，在目前一段时间内，可能有部分支持IPv6设备，它们在整个IPv4的“网络海洋”中犹如一个个的“孤岛”，支持IPv6与IPv4的设备不能相互通信（当然IPv6内部的网络可以通信，IPv4同样如此），如果一个IPv6的“孤岛”想向另一个IPv6的“孤岛”发送信息，只需要给分组在IPv4的“网络海洋”之中准备一艘“小船”就好，或者是隧道。</p>
</blockquote>
<p>隧道: 在IPv4路由器之间传输的IPv4数据报中携带IPv6数据报</p>
<blockquote>
<p>在IPv6与IPv4的边缘有同时支持两种协议的双栈协议。</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CNIPv4%E9%9A%A7%E9%81%93.png" alt=""></p>
<p>可以将IPv6的数据报封装在IPv4的数据报当中，进行传输。</p>
<img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CNIPv4隧道视图2.png" style="zoom:80%;" />
<blockquote>
<p>全面部署IPv6还需要很长一段时间，当慢慢地网络变成IPv6的“海洋”时，IPv4称为“孤岛”，那么则使用IPv6的隧道进行数据报传输，直到最后全面部署IPv6，完成平滑过渡。</p>
</blockquote>
<h2 id="路由选择算法">路由选择算法</h2>
<h3 id="路由（route）">路由（route）</h3>
<p>路由：按照某种指标(传输延迟,所经过的站点数目等)找到一条从源节点到目标节点的较好路径。</p>
<blockquote>
<ul>
<li>
<p>较好路径: 按照某种指标较小的路径</p>
</li>
<li>
<p>指标:站数, 延迟,费用,队列长度等, 或者是一些单纯指标的加权平均</p>
<p>采用什么样的指标,表示网络使用者希望网络在什么方面表现突出,什么指标网络使用者比较重视</p>
</li>
</ul>
</blockquote>
<p>路由的计算单位：网络（子网）</p>
<blockquote>
<p>以IPv4为例，如果仅以精确的IP地址为计算单位，一共有2<sup>32</sup>个，那么这个计算量过于庞大。</p>
</blockquote>
<ul>
<li>网络为单位进行路由，路由信息传输、计算和匹配的代价低</li>
<li>前提条件是：一个网络所有节点地址前缀相同，且物理上聚集</li>
<li>路由就是：计算网络到其他网络如何走的问题（路由信息通告+路由计算）</li>
</ul>
<p>网络 - 网络的路由 = 路由器 - 路由器间的路由</p>
<ul>
<li>网络对应的路由器到其他网络对应的路由器的路由</li>
<li>在一个网络中：路由器 - 主机之间的通信，链路层解决</li>
<li>到了这个路由器就是到了这个网络</li>
</ul>
<p>路由器 - 路由器之间的最优路径 = 主机对之间的最优路径</p>
<ul>
<li>路由器连接子网，子网到路由器之间的跳数就是一跳，必须要走</li>
<li>路由器到下一跳路由器（节点到节点）之间的最优路径找到了，也就找到了从源子网向目标子网所有主机对之间的最优路径</li>
<li>大大降低了路由计算的规模</li>
<li>在路由计算中按照子网到子网的路径计算为目标，而不是主机到主机</li>
</ul>
<p>路由选择算法(routing algorithm)：网络层软件的一部分,完成路由功能</p>
<p>下图为网络的图抽象</p>
<img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CN网络的图抽象.png" style="zoom:80%;" />
<blockquote>
<p>说明：</p>
<ul>
<li>节点：路由器</li>
<li>边：把路由器连接在一起的网络或者是点到点的链路</li>
</ul>
</blockquote>
<p>边的代价（Cost of path）：</p>
<ul>
<li>表示方式：c(x,x<sup>‘</sup>) → 链路的代价 (x,x<sup>’</sup>)</li>
</ul>
<blockquote>
<p>举例：c(w,z) = 5</p>
</blockquote>
<ul>
<li>代价可能总为１</li>
<li>或是链路带宽的倒数</li>
<li>或是拥塞情况的倒数</li>
</ul>
<p>路由的输入：拓扑、边的代价、源节点</p>
<p><strong>最优化原则(optimality principle)</strong></p>
<p>路由算法的最终目的是找到汇集树（sink tree）</p>
<ul>
<li>此节点到所有其它节点的最优路径形成的树</li>
<li>路由选择算法就是为所有路由器找到并使用汇集树</li>
</ul>
<p><strong>路由选择算法的原则：</strong></p>
<ul>
<li>
<p>正确性(correctness)：</p>
<p>算法必须是正确的和完整的,使分组一站一站接力，正确发向目标站；完整：目标所有的站地址，在路由表中都能找到相应的表项；没有处理不了的目标站地址；</p>
</li>
<li>
<p>简单性(simplicity)：</p>
<p>算法在计算机上应简单：最优但复杂的算法，时间上延迟很大，不实用，不应为了获取路由信息增加很多的通信量；</p>
<blockquote>
<p>在一条公路上，为了市民更好的通行而派出大量的警力去维持秩序，结果警力就占用了公路的三分之二，显然是不合理的。</p>
</blockquote>
</li>
<li>
<p>健壮性(robustness)：</p>
<p>算法应能适应<strong>通信量</strong>和<strong>网络拓扑</strong>的变化：通信量变化，网络拓扑的变化算法能很快适应；不向很拥挤的链路发数据，不向断了的链路发送数据；</p>
<blockquote>
<ul>
<li>两个路由节点之间的通信链路的传输速度有可能会发生改变</li>
<li>网络拓扑有可能发生改变：可能A、B两个节点原来是有通路的，结果这条通路又断掉了</li>
</ul>
<p>算法应该要适应这些变化。</p>
</blockquote>
</li>
<li>
<p>稳定性(stability)：</p>
<p>产生的路由不应该摇摆</p>
</li>
<li>
<p>公平性(fairness)：</p>
<p>对每一个站点都公平</p>
</li>
<li>
<p>最优性(optimality)：</p>
<p>某一个指标的最优，时间上，费用上，等指标，或综合指标；实际上，获取最优的结果代价较高，可以是次优的</p>
</li>
</ul>
<p>路由算法的分类：</p>
<p>从一个角度来看，可分为全局、分布式</p>
<ul>
<li>全局：
<ul>
<li>所有的路由器拥有完整的拓扑和边的代价的信息</li>
<li>link state 算法</li>
</ul>
</li>
<li>分布式：
<ul>
<li>路由器只知道与它有物理连接关系的邻居路由器，和到相应邻居路由器的代价值</li>
<li>叠代地与邻居交换路由信息、 计算路由信息</li>
<li>distance vector 算法</li>
</ul>
</li>
</ul>
<p>从另一个角度看，可分为静态、动态</p>
<ul>
<li>静态：
<ul>
<li>路由随时间变化缓慢</li>
<li>非自适应算法(non-adaptive algorithm)：不能适应网络拓扑和通信量的变化,路由表是事先计算好的</li>
</ul>
</li>
<li>动态：
<ul>
<li>路由变化很快
<ul>
<li>周期性更新</li>
<li>根据链路代价的变化而变化</li>
</ul>
</li>
<li>自适应路由选择(adaptive algorithm)：能适应网络拓扑和通信量的变化</li>
</ul>
</li>
</ul>
<h3 id="链路状态算法（link-state，LS）">链路状态算法（link state，LS）</h3>
<p>链路状态算法就是著名的迪杰斯特拉(Dijkstra)算法。</p>
<p>配置LS路由选择算法的路由工作过程：</p>
<ul>
<li>
<p>各点通过各种渠道获得整个网络拓扑, 网络中所有链路代价等信息（这部分和算法没关系，属于协议和实现）</p>
</li>
<li>
<p>使用LS路由算法,计算本站点到其它站点的最优路径(汇集树),得到路由表</p>
</li>
<li>
<p>按照此路由表转发分组(datagram方式)【数据平面的工作】</p>
<ul>
<li>分发到输入端口的网络层（严格意义上说不是路由的一个步骤）</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CNLS%E7%AE%97%E6%B3%95%E6%B5%81%E7%A8%8B.png" alt=""></p>
</li>
</ul>
<h4 id="基本工作过程">基本工作过程</h4>
<p>链路状态（LS）路由的基本工作过程：</p>
<ol>
<li>
<p>发现相邻节点,获知对方网络地址</p>
<ul>
<li>一个路由器上电之后,向所有线路发送<code>HELLO</code>分组</li>
<li>其它路由器收到<code>HELLO</code>分组,回送应答,在应答分组中,告知自己的名字(全局唯一)</li>
<li>在LAN中,通过广播<code>HELLO</code>分组,获得其它路由器的信息,可以认为引入一个人工节点</li>
</ul>
</li>
<li>
<p>测量到相邻节点的代价(延迟,开销)</p>
<ul>
<li>实测法,发送一个分组要求对方立即响应</li>
<li>回送一个<code>ECHO</code>分组</li>
<li>通过测量时间可以估算出延迟情况</li>
</ul>
</li>
<li>
<p>组装一个链路状态（LS）分组,描述它到相邻节点的代价情况</p>
<ul>
<li>发送者名称</li>
<li>序号,年龄</li>
<li>列表: 给出它相邻节点,和它到相邻节点的延迟</li>
</ul>
</li>
<li>
<p>将分组通过扩散（泛洪）的方法发到所有其它路由器</p>
<ul>
<li>
<p>顺序号:用于控制无穷的扩散,每个路由器都记录(源路由器,顺序号),发现重复的或老的就不扩散（网络是一个环状的，不加以控制可以一直扩散下去，形成”广播风暴“，浪费了大量的资源，）</p>
<blockquote>
<p>具体问题：</p>
<ul>
<li>具体问题1: 循环使用问题</li>
<li>具体问题2: 路由器崩溃之后序号从0开始</li>
<li>具体问题3:序号出现错误</li>
</ul>
<p>解决方案：年龄字段(age)</p>
<ul>
<li>生成一个分组时,年龄字段不为0</li>
<li>每个一个时间段,AGE字段减1</li>
<li>AGE字段为0的分组将被抛弃</li>
</ul>
</blockquote>
</li>
<li>
<p>关于扩散分组的数据结构</p>
<ul>
<li>Source ：从哪个节点收到LS分组</li>
<li>Seq，Age：序号,年龄</li>
<li>Send flags：发送标记,必须向指定的哪些相邻站点转发LS分组</li>
<li>ACK flags：本站点必须向哪些相邻站点发送应答</li>
<li>DATA：来自source站点的LS分组</li>
</ul>
</li>
</ul>
<blockquote>
<p>以上4步让每个路由器获得拓扑和边代价</p>
</blockquote>
</li>
<li>
<p>通过Dijkstra算法找出最短路径（这才是路由算法）</p>
<ul>
<li>路由器获得各站点LS分组和整个网络的拓扑</li>
<li>通过Dijkstra算法计算出到其它各路由器的最短 路径(汇集树)
<ul>
<li>每个节点独立算出来到其他节点（路由器=网络）的最短路径</li>
<li>迭代算法：第k步能够知道本节点到k个其他节点的最短路径</li>
</ul>
</li>
<li>将计算结果安装到路由表中</li>
</ul>
</li>
</ol>
<h4 id="应用情况">应用情况</h4>
<p>链路状态的应用情况：</p>
<ul>
<li>OSPF协议是一种LS协议,被用于Internet上</li>
<li>IS-IS(intermediate system - intermediate system)：被用于Internet主干中, Netware</li>
</ul>
<h4 id="算法原理">算法原理</h4>
<p>符号标记：</p>
<ul>
<li>c(i,j)：从节点 i 到 j 链路代价（初始状态下非相邻节点之间的链路代价为∞）</li>
<li>D(v)：从源节点到节点V的当前路径代价（节点的代价）</li>
<li>P(v)：从源到节点V的路径前序节点</li>
<li>N’: 当前已经知道最优路径的的节点集合（永久节点的集合）</li>
</ul>
<p>节点标记：每一个节点使用(D(v),p(v))</p>
<blockquote>
<p>如： (3,B) 标记</p>
</blockquote>
<ul>
<li>D(v)从源节点由已知最优路径到达本节点的<strong>距离</strong></li>
<li>P(v)<strong>前序节点</strong>来标注</li>
</ul>
<p>两类节点：</p>
<ul>
<li>临时节点(tentative node)：还没有找到从源节点到此节点的最优路径的节点</li>
<li>永久节点(permanent node) <strong>N’</strong>：已经找到了从源节点到此节点的最优路径的节点</li>
</ul>
<p>流程：</p>
<ol>
<li>
<p>初始化</p>
<ul>
<li>除了源节点外,所有节点都为临时节点</li>
<li>节点代价除了与源节点代价相邻的节点外,都为∞</li>
</ul>
</li>
<li>
<p>从所有临时节点中找到一个节点代价最小的临时节点,将之变成永久节点（假设找到一个节点W）</p>
</li>
<li>
<p>对此节点的所有在临时节点集合中的邻节点，假设为节点V</p>
<ul>
<li>
<p>如 D(v) &gt; D(w) + c(w,v), 则重新标注此点, (D(W)+C(W,V), W)</p>
<blockquote>
<p>即源节点到V节点的距离又有最小值，则更新</p>
</blockquote>
</li>
<li>
<p>否则，不重新标注</p>
</li>
</ul>
</li>
<li>
<p>返回第2步，开始一个新的循环</p>
</li>
</ol>
<p>案例：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CN%E8%BF%AA%E6%9D%B0%E6%96%AF%E7%89%B9%E6%8B%89%E7%AE%97%E6%B3%95%E6%A1%88%E4%BE%8B.png" alt=""></p>
<h4 id="Dijkstra算法的讨论">Dijkstra算法的讨论</h4>
<ul>
<li>
<p>算法复杂度: n节点</p>
<ul>
<li>每一次迭代: 需要检查所有不在永久集合N中节点</li>
<li>n(n+1)/2 次比较: O(n<sup>2</sup>)</li>
<li>有很有效的实现: O(nlogn)</li>
</ul>
</li>
<li>
<p>可能的震荡：</p>
<p>举例：如果链路代价 = 链路承载的流量（拥塞程度）：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CN%E9%93%BE%E8%B7%AF%E5%8F%AF%E8%83%BD%E9%9C%87%E8%8D%A1.png" alt=""></p>
</li>
</ul>
<h3 id="距离矢量算法（distance-vector，DV）">距离矢量算法（distance vector，DV）</h3>
<ul>
<li>动态路由算法之一</li>
<li>DV算法历史及应用情况：
<ul>
<li>1957 Bellman, 1962 Ford Fulkerson</li>
<li>用于ARPANET, Internet(RIP) DECnet , Novell, ApplTalk</li>
</ul>
</li>
<li>距离矢量路由选择的基本思想
<ul>
<li>各路由器维护一张路由表</li>
<li>各路由器与相邻路由器交换路由表</li>
<li>根据获得的路由信息,更新路由表</li>
</ul>
</li>
</ul>
<p>如下图示例：</p>
<img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CN距离矢量路由选择示例.png" style="zoom: 67%;" />
<p>代价及相邻节点间代价的获得：</p>
<ul>
<li>跳数(hops), 延迟(delay),队列长度</li>
<li>相邻节点间代价的获得：通过实测</li>
</ul>
<p>路由信息的更新：</p>
<ul>
<li>根据实测 得到本节点A到相邻站点的代价（如:延迟）</li>
<li>根据各相邻站点声称它们到目标站点B的代价</li>
<li>计算出本站点A经过各相邻站点到目标站点B的代价</li>
<li>找到一个最小的代价，和相应的下一个节点Z，到达节点 B经过此节点Z，并且代价为A-Z-B的代价</li>
</ul>
<blockquote>
<p>其它所有的目标节点一个计算法</p>
</blockquote>
<h4 id="实例">实例</h4>
<p>如下图：</p>
<img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CN距离矢量路由案例一续改.png" style="zoom:80%;" />
<ul>
<li>以当前节点J为例,相邻节点 A,I,H,K</li>
<li>J测得到A,I,H,K的延迟为： 8ms,10ms,12ms,6ms</li>
<li>通过交换DV, 从A,I,H,K获得到它们到G的延迟为 18ms,31ms,6ms,31ms</li>
<li>因此从J经过A,I,H,K到G的延迟为26ms,41ms,18ms, 37ms</li>
<li>将到G的路由表项更新为18ms,下一跳为：H</li>
<li>其它目标一样，除了本节点J（分组从J到J当然为0）</li>
</ul>
<h4 id="贝尔曼-福特（Bellman-Ford-）方程">贝尔曼-福特（Bellman-Ford ）方程</h4>
<p>实际上距离矢量算法是基于<strong>贝尔曼-福特（Bellman-Ford ）方程</strong>（动态规划）。</p>
<ul>
<li>
<p>设：d<sub>x</sub> (y) = 从x到y的最小路径代价（x为源节点，y为目标节点）</p>
</li>
<li>
<p>则 d<sub>x</sub> (y) = min { c(x,v) + d<sub>v</sub> (y) }</p>
<blockquote>
<ul>
<li>min：取所有x的邻居取最小的v</li>
<li>c(x,v)：x到邻居v的代价</li>
<li>d<sub>v</sub> (y)：从邻居v到目标y的代价</li>
</ul>
</blockquote>
</li>
</ul>
<p>案例1：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CN%E8%B4%9D%E5%B0%94%E6%9B%BC%E7%A6%8F%E7%89%B9%E6%96%B9%E7%A8%8B%E6%A1%88%E4%BE%8B.png" alt=""></p>
<ul>
<li>
<p>明显：d<sub>v</sub> (z) = 5 , d<sub>x</sub> (z) = 3 , d<sub>w</sub> (z) = 3</p>
</li>
<li>
<p>由 B-F 方程得到：</p>
<p>d<sub>u</sub> (z) = min { c(u,v) + d<sub>v</sub> (z) ,  c(u,x) + d<sub>x</sub> (z) , c(u,w) + d<sub>w</sub> (z) } = { 2+5 , 1+3 , 5+3 } = 4</p>
</li>
</ul>
<p>核心思路：</p>
<ul>
<li>
<p>每个节点都将自己的距离矢量估计值传送给邻居，定时或者DV有变化时，让对方去算</p>
</li>
<li>
<p>当x从邻居收到DV时，自己运算，更新它自己的距离矢量（采用B-F equation）</p>
</li>
<li>
<p>D<sub>x</sub> (y)估计值最终收敛于实际的最小代价值d<sub>x</sub> (y)</p>
<blockquote>
<p>是迭代算法、分布式算法</p>
</blockquote>
</li>
</ul>
<p>异步式,迭代：每次本地迭代被以下事件触发：</p>
<ul>
<li>本地链路代价变化了</li>
<li>从邻居来了DV的更新消息</li>
</ul>
<p>分布式：</p>
<ul>
<li>每个节点只是在自己的DV改变之后向邻居通告</li>
<li>然后邻居们在有必要的时候通知他们的邻居</li>
</ul>
<p>每个节点的动作如下图：</p>
<img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CN距离矢量算法每个节点.png" style="zoom: 67%;" />
<p>案例2：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CN%E8%B4%9D%E5%B0%94%E6%9B%BC%E7%A6%8F%E7%89%B9%E6%96%B9%E7%A8%8B%E6%A1%88%E4%BE%8B2.png" alt=""></p>
<h4 id="DV的特点">DV的特点</h4>
<p>特点：</p>
<ul>
<li>
<p>好消息传的快</p>
<p>好消息的传播以每一个交换周期前进一个路由器的速度进行</p>
<p>举例：假设刚架设的路由节点A，它与B连通了</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CNDV%E5%A5%BD%E6%B6%88%E6%81%AF.png" alt=""></p>
<blockquote>
<ul>
<li>经过第一个周期，c(A,B) = 1</li>
<li>经过第二个周期，c(A,C) = 2</li>
<li>如此下去</li>
</ul>
</blockquote>
</li>
<li>
<p>坏消息传的慢（无穷计算问题）</p>
<p>举例：路由节点A刚刚撤销了</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CNDV%E5%9D%8F%E6%B6%88%E6%81%AF.png" alt=""></p>
<blockquote>
<ul>
<li>第一次交换之后, B从C处获得信息,C可以到达A(C-A,但是要经过B本身),但是路径是2,因此B变成3,从C处走</li>
<li>第二次交换,C从B处获得消息, B可以到达A,路径为3, 因此,C到A从B走,代价为4</li>
<li>形成了一个环路</li>
<li>无限次循环下去，到A的距离就变成了∞（不可达）</li>
</ul>
</blockquote>
</li>
</ul>
<p>实际上有一种缓解环路（无穷计算）的情况，即水平分裂(split horizon)算法。</p>
<h4 id="水平分裂-split-horizon-算法">水平分裂(split horizon)算法</h4>
<blockquote>
<p>注：有些教材也解释为“毒性逆转”。</p>
</blockquote>
<p>一种对无穷计算问题的解决办法：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CN%E6%B0%B4%E5%B9%B3%E5%88%86%E8%A3%82%E7%AE%97%E6%B3%95%E4%B8%BE%E4%BE%8B.png" alt=""></p>
<ul>
<li>
<p>假设节点B直达A，C到A依赖于B，D到A依赖于B，C</p>
</li>
<li>
<p>现在突然A节点不可达</p>
</li>
<li>
<p>C知道要经过B才能到达A，所以C向B报告它到A的距离为∞（虚假信息）；但是C告诉D它到A的真实距离</p>
</li>
<li>
<p>同样的，D告诉C它通向A的距离为∞（虚假信息），但是D告诉E它到A的真实距离</p>
<blockquote>
<p>“左向虚假，右向真实”</p>
</blockquote>
</li>
<li>
<p>这样在第一次交换的时候，B通过测试发现到A的路径为∞，而C也告诉B到A的距离为∞，因此B到A的距离为∞</p>
</li>
<li>
<p>在第二次交换的时候，C从B和D那里获知,到A的距离为∞，因此C到A的距离为∞</p>
</li>
<li>
<p>如此，坏消息也同样以一次交换一个节点的速度传播</p>
</li>
</ul>
<p>值得注意的是，水平分裂算法在某些拓扑形式下会失败（存在环路），分析下图：</p>
<img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CN水平分裂算法问题.png" style="zoom: 67%;" />
<ul>
<li>A,B到D的距离为2, C到D的距离为1</li>
<li>现在假设C-D通路销毁</li>
<li>C获知到D的距离为∞，从A,B获知到D的距离为∞，因此C认为D不可达</li>
<li>A从C获知D的距离为∞，但从B处获知它到D的距离为2，因此A到B的距离为3，从B走</li>
<li>B也有类似的问题</li>
<li>经过无限次之后，A和B都知道到D的距离为∞</li>
</ul>
<h3 id="LS-和-DV-算法的比较">LS 和 DV 算法的比较</h3>
<p>下面我们来分析链路状态算法和距离矢量算法的差别：</p>
<ul>
<li>
<p>消息复杂度</p>
<ul>
<li>LS: 有 n 节点, E 条链路,发送 报文O(nE)个
<ul>
<li>局部的路由信息；全局传播</li>
</ul>
</li>
<li>只和邻居交换信息
<ul>
<li>全局的路由信息，局部传播</li>
</ul>
</li>
<li>距离矢量算法更优</li>
</ul>
</li>
<li>
<p>收敛时间</p>
<ul>
<li>LS：O(n<sup>2</sup>) 算法
<ul>
<li>有可能震荡</li>
</ul>
</li>
<li>DV: 收敛较慢
<ul>
<li>可能存在路由环路（无限循环问题）</li>
</ul>
</li>
<li>链路状态算法更优</li>
</ul>
</li>
<li>
<p>健壮性：如果路由器故障会发生什么</p>
<ul>
<li>
<p>LS：</p>
<ul>
<li>节点会通告不正确的链路代价</li>
<li>每个节点只计算自己的路由表</li>
<li>错误信息影响较小，局部，路由较健壮</li>
</ul>
</li>
<li>
<p>DV：</p>
<ul>
<li>
<p>DV 节点可能通告对全网所有节点的不正确路径代价</p>
</li>
<li>
<p>每一个节点的路由表可能被其它节点使用</p>
<blockquote>
<p>假如一个节点出现错误，通告全网到此路由的代价为0，那么全网的所有分组就都会涌向此节点</p>
</blockquote>
</li>
<li>
<p>错误可以扩散到全网</p>
</li>
</ul>
</li>
<li>
<p>链路状态算法更优</p>
</li>
</ul>
</li>
</ul>
<blockquote>
<p>两种路由选择算法都有其优缺点，而且在互联网上都有应用。</p>
</blockquote>
<h2 id="因特网中自治系统（AS）内部的路由选择">因特网中自治系统（AS）内部的路由选择</h2>
<h3 id="路由选择信息协议（Routing-Information-Protocol，RIP）">路由选择信息协议（Routing Information Protocol，RIP）</h3>
<ul>
<li>
<p>在 1982年发布的BSD-UNIX 中实现</p>
</li>
<li>
<p>基于距离矢量算法：</p>
<ul>
<li>
<p>距离矢量：每条链路cost = 1，</p>
<p>代价就是跳数 (max = 15 hops，16代表目标不可达)</p>
</li>
<li>
<p>约定V每隔30秒和邻居交换距离矢量（DV），通告</p>
<ul>
<li>情况一：定期30秒，而且在改变路由的时候发送通告报文</li>
<li>情况二：在对方的请求下也可以发送通告报文</li>
</ul>
</li>
<li>
<p>每个通告包括：最多25个目标子网</p>
<ul>
<li>内容：目标网络 + 跳数（最大跳数为16，表示不可达）</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>下图是一个RIP协议的实例：</p>
<img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CNRIP案例.png" style="zoom: 67%;" />
<p>如果此时，节点A发送给D新的距离矢量，告知A到Z的跳数为4，那么D的距离矢量就会更新，如下图：</p>
<img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CNRIP案例续.png" style="zoom: 67%;" />
<h4 id="链路失效和恢复">链路失效和恢复</h4>
<p>如果180秒（6个周期）没有收到通告信息，则表示邻居或者链路失效</p>
<ul>
<li>发现经过这个邻居的路由已失效</li>
<li>新的通告报文会传递给邻居</li>
<li>邻居因此发出新的通告 (如果路由变化的话)</li>
<li>使用毒性逆转（poison reverse）/水平分裂算法，阻止ping-pong回路 ( 不可达的距离：跳数无限 = 16 段)</li>
</ul>
<h4 id="RIP-进程处理">RIP 进程处理</h4>
<ul>
<li>
<p>RIP 以应用进程的方式实现：route-d (daemon)</p>
</li>
<li>
<p>通告报文通过UDP报文传送，周期性重复</p>
</li>
<li>
<p>网络层的协议使用了传输层的服务，以应用层实体的方式实现</p>
<blockquote>
<p>这一点很有趣，网络层的功能以应用进程的形式来实现，为了实现这个功能，还要借助传输层来传输距离矢量DV</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CNRIP%E7%9A%84%E5%AE%9E%E7%8E%B0%E4%BE%9D%E8%B5%96.png" alt=""></p>
</blockquote>
</li>
</ul>
<h3 id="开放最短路优先（Open-Shortest-Path-First，OSFP）">开放最短路优先（Open Shortest Path First，OSFP）</h3>
<ul>
<li>
<p>“open”：标准可公开获得</p>
</li>
<li>
<p>使用链路状态算法：</p>
<ul>
<li>LS 分组在网络中（一个AS内部）分发</li>
<li>全局网络拓扑、代价在每一个节点中都保持</li>
<li>路由计算采用Dijkstra算法</li>
</ul>
</li>
<li>
<p>OSPF通告信息中携带：每一个邻居路由器一个表项</p>
<blockquote>
<p>“我是谁”，传输的链路状态分组是第几个版本，TTL</p>
<p>“我有哪些邻居，我到邻居的代价是多少”</p>
</blockquote>
</li>
<li>
<p>通告信息会传遍AS全部（通过泛洪）</p>
<ul>
<li>在IP数据报上直接传送OSPF报文 (而不是通过UDP和TCP)</li>
</ul>
</li>
<li>
<p>IS-IS路由协议：几乎和OSPF一样</p>
</li>
</ul>
<h4 id="OSPF高级特性">OSPF高级特性</h4>
<p>这些特性是在RIP中所没有的。</p>
<ul>
<li>
<p>安全: 所有的OSPF报文都是经过认证的 (防止恶意的攻击)</p>
</li>
<li>
<p>允许有多个代价相同的路径存在 (在RIP协议中只有一个)</p>
<blockquote>
<p>可以在代价相同的节点作“负载均衡”。</p>
</blockquote>
</li>
<li>
<p>对于每一个链路，对于不同的TOS有多重代价矩阵</p>
<blockquote>
<p>例如：卫星链路代价对于尽力而为的服务代价设置比较低，对实时服务代价设置的比较高</p>
<p>支持按照不同的代价计算最优路径，如：按照时间和延迟分别计算最优路径</p>
</blockquote>
</li>
<li>
<p>对单播和多播的集成支持：</p>
<ul>
<li>Multicast OSPF (MOSPF) 使用相同的拓扑数据库，就像在OSPF中一样</li>
</ul>
</li>
<li>
<p>在大型网络中支持<code>层次性OSPF</code></p>
<img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CN层次化OSPF路由.png" style="zoom: 67%;" />
<blockquote>
<p>如果网络比较大，可以把自治区域划分成：骨干区域（backbone）、区域一、区域二…</p>
<p>不同的小区域之间的分组转发都需要借助区域边界路由器（area border routers），先将其路由至骨干区域。</p>
<p>泛洪仅在小区域内部进行。</p>
<p>分组的传递过程：小区域 →（通过区域边界路由器）→ 骨干区域 →（通过边界路由器）→ 传送到其他子网（依然通过另一个子网的骨干区域到达小区域）</p>
</blockquote>
</li>
</ul>
<p>层次性的OSPF路由：</p>
<ul>
<li>
<p>两个级别的层次性: 本地, 骨干</p>
<ul>
<li>
<p>链路状态通告仅仅在本地区域Area范围内进行</p>
</li>
<li>
<p>每一个节点拥有本地区域的拓扑信息</p>
<blockquote>
<p>关于其他区域，知道去它的方向，通过区域边界路由器（最短路径）</p>
</blockquote>
</li>
</ul>
</li>
<li>
<p>区域边界路由器: “汇总（聚集）”到自己区域内网络的距离, 向其它区域边界路由器通告</p>
<blockquote>
<p>同时参与了两个区域的路由计算</p>
</blockquote>
</li>
<li>
<p>骨干路由器: 仅仅在骨干区域内，运行OSPF路由</p>
</li>
<li>
<p>边界路由器: 连接其它的自治系统（AS’s）</p>
</li>
</ul>
<blockquote>
<p>小结一下：</p>
<p>如果</p>
</blockquote>
<h2 id="ISP之间的路由选择">ISP之间的路由选择</h2>
<h3 id="一个平面的路由">一个平面的路由</h3>
<ul>
<li>一个网络中的所有路由器的地位一样</li>
<li>通过LS, DV，或者其他路由算法，所有路由器都要知道其他所有路由器（子网）如何走</li>
<li>所有路由器在一个平面</li>
<li>平面路由的问题：
<ul>
<li>规模巨大的网络中，路由信息的存储、传输和计算代价巨大：
<ul>
<li>DV: 距离矢量很大，且不能够收敛</li>
<li>LS：几百万个节点的LS分组的泛洪传输，存储以及最短路径算法的计算</li>
</ul>
</li>
<li>管理问题：
<ul>
<li>不同的网络所有者希望按照自己的方式管理网络</li>
<li>一方面希望对外隐藏自己网络的细节</li>
<li>当然，还希望和其它网络互联</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>一个平面的路由面临计算成本的高昂代价以及管理问题，为此出现了一个解决方案：层次路由。</p>
<h3 id="层次路由">层次路由</h3>
<blockquote>
<p>将互联网中的路由问题分为两个层面（按照物理分布范围）：</p>
<ul>
<li>自治区域内</li>
<li>自治区域间</li>
</ul>
</blockquote>
<ul>
<li>
<p>层次路由：将互联网分成一个个自治区域AS(路由器区域)</p>
<ul>
<li>某个区域内的路由器集合，自治系统（autonomous systems ，AS)</li>
<li>一个AS用 <code>AS Number（ASN)</code>唯一标示</li>
<li>一个ISP可能包括一个或者多个AS</li>
</ul>
</li>
<li>
<p>路由变成了两个层次的路由：</p>
<ul>
<li>AS内部路由：在同一个AS内路由器运行相同的路由协议
<ul>
<li><strong>intra-AS routing protocol：内部网关协议</strong></li>
<li>不同的AS可能运行着不同的内部网关协议（如：LS，DV）</li>
<li>能够解决规模和管理问题</li>
<li>如：RIP,OSPF,IGRP</li>
<li>网关路由器：AS边缘路由器，可以连接到其他AS</li>
</ul>
</li>
<li>AS间运行AS间路由协议
<ul>
<li><strong>inter-AS routing protocol：外部网关协议</strong></li>
<li>解决AS之间的路由问题，完成AS之间的互联互通</li>
</ul>
</li>
</ul>
</li>
<li>
<p>层次路由的优点：</p>
<ul>
<li>
<p>解决了规模问题：</p>
<ul>
<li>
<p>内部网关协议解决：AS内部数量有限的路由器相互到达的问题, AS内部规模可控</p>
<blockquote>
<p>如果AS节点太多，可继续分割AS，使得AS内部的节点数量有限</p>
</blockquote>
</li>
<li>
<p>AS之间的路由的规模问题：</p>
<ul>
<li>增加一个AS，对于AS之间的路由从总体上来说，只是增加了一个节点=子网（每个AS可以用一个点来表示）</li>
<li>对于其他AS来说只是增加了一 个表项，就是这个新增的AS如何走的问题</li>
<li>扩展性强：规模增大，性能不会减得太多</li>
</ul>
</li>
</ul>
</li>
<li>
<p>解决了管理问题：</p>
<ul>
<li>各个AS可以运行不同的内部网关协议</li>
<li>可以使自己网络的细节不向外透露，增加安全性</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="边界网关协议（Border-Gateway-Protocol，BGP）">边界网关协议（Border Gateway Protocol，BGP）</h3>
<ul>
<li>
<p>BGP (Border Gateway Protocol): 自治区域间路由协议“事实上的”标准</p>
<blockquote>
<p>将互联网各个AS粘在一起的胶水</p>
</blockquote>
</li>
<li>
<p>BGP 提供给每个AS以以下方法：</p>
<ul>
<li>
<p>eBGP: 从相邻的ASes那里获得子网可达信息（外部）</p>
</li>
<li>
<p>iBGP: 将获得的子网可达信息传遍到AS内部的所有路由器（内部）</p>
</li>
<li>
<p>根据子网可达信息和策略来决定到达子网的“最优”路径</p>
<img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CNBGP连接.png" style="zoom: 67%;" />
</li>
</ul>
</li>
<li>
<p>允许子网向互联网其他网络通告“我在这里”</p>
</li>
<li>
<p>基于距离矢量算法（路径矢量）</p>
<ul>
<li>这是一种“改进”后的距离矢量</li>
<li>不仅仅是距离矢量，还包括到达各个目标网络的详细路径（AS序号的列表）能够避免简单DV算法的路由环路问题</li>
</ul>
</li>
</ul>
<h4 id="BGP会话">BGP会话</h4>
<ul>
<li>
<p>BGP 会话: 两个BGP路由器(“peers”)在一个半永久的TCP连接上 交换BGP报文（包括子网可达信息）:</p>
<ul>
<li>通告向不同目标子网前缀的“路径”（BGP是一个“路径矢量”协议）</li>
</ul>
</li>
<li>
<p>当AS3中新增了X节点（如下图）：</p>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CNBGP%E8%BF%9E%E6%8E%A52.png" alt=""></p>
<p>当AS3网关路由器3a向AS2的网关路由器2c通告路径： AS3,X</p>
<ul>
<li>3a参与AS内路由运算，知道本AS所有子网X信息</li>
<li>语义上：AS3向AS2承诺，它可以向子网X转发数据报</li>
<li>3a是2c关于X的下一跳（next hop）</li>
</ul>
</li>
</ul>
<p>路径的属性：</p>
<ul>
<li>当通告一个子网前缀时，通告包括 BGP 属性：
<ul>
<li>prefix + attributes = “route”</li>
</ul>
</li>
<li>两个重要的属性：
<ul>
<li><strong>AS-PATH</strong>: 前缀的通告所经过的AS列表: AS 67、AS 17
<ul>
<li>检测环路；多路径选择</li>
<li>在向其它AS转发时，需要将自己的AS号加在路径上</li>
</ul>
</li>
<li><strong>NEXT-HOP</strong>: 从当前AS到下一跳AS有多个链路，在NETX-HOP属性中，告诉对方通过那个 链路转发</li>
<li>其它属性：路由偏好指标，如何被插入的属性</li>
</ul>
</li>
</ul>
<p>BGP是基于策略的路由：</p>
<ul>
<li>当一个网关路由器接收到了一个路由通告, 使用<strong>输入策略</strong>来接受或过滤（accept / decline）
<ul>
<li>过滤原因例1：不想经过某个AS，转发某些前缀的分组</li>
<li>过滤原因例2：已经有了一条往某前缀的偏好路径</li>
</ul>
</li>
<li>策略也决定了是否向它别的邻居通告收到的这个路由信息</li>
</ul>
<h4 id="BGP路径通告">BGP路径通告</h4>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CNBGP%E8%B7%AF%E5%BE%84%E9%80%9A%E5%91%8A.png" alt=""></p>
<ul>
<li>
<p>路由器AS2.2c从AS3.3a接收到的AS3,X路由通告 (通过eBGP)</p>
</li>
<li>
<p>基于AS2的输入策略，AS2.2c决定接收AS3,X的通告，而且通过iBGP（TCP连接）向AS2的所有路由器进行通告</p>
</li>
<li>
<p>基于AS2的策略，AS2路由器2a通过eBGP向AS1.1c路由器通告 AS2,AS3,X 路由信息</p>
<blockquote>
<p>路径上加上了 AS2自己作为AS序列的一跳</p>
</blockquote>
</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CNBGP%E8%B7%AF%E5%BE%84%E9%80%9A%E5%91%8A2.png" alt=""></p>
<p>网关路由器可能获取有关一个子网X的多条路径，从多个eBGP 会话上：</p>
<ul>
<li>
<p>AS1 网关路由器1c从2a学习到路径：<code>AS2,AS3,X</code></p>
</li>
<li>
<p>AS1网关路由器1c从3a处学习到路径：<code>AS3,X</code></p>
</li>
<li>
<p>基于策略，AS1路由器1c选择了路径：<code>AS3,X</code>，而且通过iBGP告诉所有AS1内部的路由器</p>
<blockquote>
<p>不一定跳数少即判定为代价小，要基于策略的判断</p>
<p>有政治策略（例如：敌对公司）、经济策略等</p>
</blockquote>
</li>
</ul>
<h4 id="BGP报文">BGP报文</h4>
<ul>
<li>
<p>使用TCP协议交换BGP报文</p>
</li>
<li>
<p>BGP 报文：</p>
<p><code>OPEN</code>：打开TCP连接，认证发送方</p>
<p><code>UPDATE</code>：通告新路径 (或者撤销原路径)</p>
<p><code>KEEPALIVE</code>：在没有更新时保持连接，也用于对 OPEN 请求确认</p>
<p><code>NOTIFICATION</code>：报告以前消息的错误，也用来关闭连接</p>
</li>
</ul>
<p>问题：一个自治区域（AS1）中的普通路由器如何才能将分组传递到另一个自治区域（AS2）内的路由器？</p>
<p>区域边界路由器可以通过外部网关协议获知AS2中路由器的存在，并通过内部网关协议通告AS1中所有的路由器。</p>
<h4 id="BGP-路径选择">BGP 路径选择</h4>
<ul>
<li>路由器可能获得一个网络前缀的多个路径，路由器必须进行路径的选择，路由选择可以基于：
<ul>
<li>本地偏好值属性: 偏好策略决定</li>
<li>最短AS-PATH：AS的跳数</li>
<li>最近的NEXT-HOP路由器：热土豆路由（给最近的）</li>
<li>附加的判据：使用BGP标示</li>
</ul>
</li>
<li>一个前缀对应着多种路径，采用消除规则直到留下一条路径</li>
</ul>
<h4 id="热土豆路由">热土豆路由</h4>
<p><img src="https://cdn.jsdelivr.net/gh/CNhuazhu/Image/CNBGP%E7%83%AD%E5%9C%9F%E8%B1%86%E8%B7%AF%E7%94%B1.png" alt=""></p>
<ul>
<li>2d通过iBGP获知，它可以通过2a或者2c到达X</li>
<li>热土豆策略：选择具备最小内部区域代价的网关作为往X的出口（如：2d选择2a，即使往X可能有比较多的AS跳数）：<strong>不要操心域间的代价</strong></li>
</ul>
<h3 id="内部网关协议与外部网关协议的不同">内部网关协议与外部网关协议的不同</h3>
<ul>
<li>策略：
<ul>
<li>Inter-AS: 管理员需要控制通信路径，谁在使用它的网络进行数据传输</li>
<li>Intra-AS: 一个管理者，所以无需策略
<ul>
<li>AS内部的各子网的主机尽可能地利用资源进行快速路由</li>
</ul>
</li>
</ul>
</li>
<li>规模：
<ul>
<li>AS间路由必须考虑规模问题，以便支持全网的数据转发</li>
<li>AS内部路由规模不是一个大的问题
<ul>
<li>如果AS 太大，可将此AS分成小的AS；规模可控</li>
<li>AS之间只不过多了一个点而已</li>
<li>或者AS内部路由支持层次性，层次性路由节约了表空间, 降低了更新的数据流量</li>
</ul>
</li>
</ul>
</li>
<li>性能：
<ul>
<li>Intra-AS: 关注性能</li>
<li>Inter-AS: 策略可能比性能更重要</li>
</ul>
</li>
</ul>
<hr>
<h1>后记</h1>
<p>本篇已完结</p>
<p>（如有补充或错误，欢迎评论区留言）</p>
]]></content>
      <categories>
        <category>学习笔记</category>
      </categories>
      <tags>
        <tag>计算机网络</tag>
      </tags>
  </entry>
</search>
